<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-services/bff/reference/bff-idp-oauth-e2e" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Backend-for-Frontend (BFF) + IdP OAuth – End‑to‑End Configuration and Matching Guide | EmpowerNow Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://empowerid.github.io/empowernow_docs/img/empowernow-logo.svg"><meta data-rh="true" name="twitter:image" content="https://empowerid.github.io/empowernow_docs/img/empowernow-logo.svg"><meta data-rh="true" property="og:url" content="https://empowerid.github.io/empowernow_docs/docs/services/bff/reference/bff-idp-oauth-e2e"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Backend-for-Frontend (BFF) + IdP OAuth – End‑to‑End Configuration and Matching Guide | EmpowerNow Docs"><meta data-rh="true" name="description" content="Mental model refresher"><meta data-rh="true" property="og:description" content="Mental model refresher"><link data-rh="true" rel="icon" href="/empowernow_docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://empowerid.github.io/empowernow_docs/docs/services/bff/reference/bff-idp-oauth-e2e"><link data-rh="true" rel="alternate" href="https://empowerid.github.io/empowernow_docs/docs/services/bff/reference/bff-idp-oauth-e2e" hreflang="en"><link data-rh="true" rel="alternate" href="https://empowerid.github.io/empowernow_docs/docs/services/bff/reference/bff-idp-oauth-e2e" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"BFF","item":"https://empowerid.github.io/empowernow_docs/docs/services/bff/"},{"@type":"ListItem","position":2,"name":"BFF + IdP OAuth (E2E)","item":"https://empowerid.github.io/empowernow_docs/docs/services/bff/reference/bff-idp-oauth-e2e"}]}</script><link rel="stylesheet" href="/empowernow_docs/assets/css/styles.b212d4ba.css">
<script src="/empowernow_docs/assets/js/runtime~main.b7e4b38b.js" defer="defer"></script>
<script src="/empowernow_docs/assets/js/main.288af713.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/empowernow_docs/img/en-logo-light.png"><link rel="preload" as="image" href="/empowernow_docs/img/en-logo-dark.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/empowernow_docs/"><div class="navbar__logo"><img src="/empowernow_docs/img/en-logo-light.png" alt="EmpowerNow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/empowernow_docs/img/en-logo-dark.png" alt="EmpowerNow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/empowernow_docs/">Home</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/website_copy/solutions">Solutions</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/website_copy/products">Products</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/website_copy/pricing">Pricing</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/website_copy/trust">Trust</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/website_copy/resources">Resources</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/website_copy/company">Company</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/empowernow_docs/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/services/crud-service/explanation/secrets-executive-overview">Secrets Overview</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/services/bff/explanation/executive-overview">BFF Overview</a><a class="navbar__item navbar__link" href="/empowernow_docs/docs/services/bff/explanation/bff-visual-guide">BFF Visual Guide</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/empowerID/empowernow_docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/empowernow_docs/docs/intro">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/empowernow_docs/docs/services/identity-fabric">Services</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/identity-fabric">Identity Fabric</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/empowernow_docs/docs/services/crud-service">CRUD Service</a><button aria-label="Expand sidebar category &#x27;CRUD Service&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/empowernow_docs/docs/services/bff">BFF</a><button aria-label="Collapse sidebar category &#x27;BFF&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/empowernow_docs/docs/services/bff/tutorials/spa-golden-path">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/empowernow_docs/docs/services/bff/how-to/spa-with-bff">How‑to</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/empowernow_docs/docs/services/bff/explanation/executive-overview">Explanations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/amazing-faq">Reference</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/amazing-faq">BFF – FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/bff-llm-pdp-enforcement">AI Chat Completions (PDP Enforcement)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/admin-config">Admin Configuration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/bff-idp-oauth-e2e">BFF + IdP OAuth (E2E)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/certificates-admin">Certificates &amp; Secrets (Admins)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/certificates-audit">Certificates &amp; Keys (Auditors)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/certificates-devops">Certificates, Keys, and Secrets (DevOps)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/config-overview">Configuration Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/configuration">Configuration Map</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/empowerid-direct">EmpowerID direct API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/empowerid-endpoints-reference">empowerid_endpoints.yaml Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/environment-index">Environment Variables Index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/fapi-support">FAPI 2.0 Features — Verified Support and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/faq">BFF FAQ (for SPA Developers)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/fips-140-3">FIPS 140‑3 Readiness — Verified Features, Gaps, and Rollout Steps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/frontend-errors">Frontend Errors and UX Patterns (401/403)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/health-metrics">Health / Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/idp-admin-proxy">IdP admin proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/idps-reference">idps.yaml Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/legacy-proxy">Legacy proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/legacy-services-reference">legacy_services.yaml Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/llm-routing-config">LLM Routing Configuration Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/llm-routing-pdp">LLM Routing PDP Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/logging-events">Logging, Events, and Publishers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/logging-reference">logging.yaml Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/observability">Observability (Metrics, Tracing, Health)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/pdp-mapping">PDP mapping (legacy)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/pdp-reference">pdp.yaml Reference (legacy)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/proxy-yaml-reference">YAML proxy (routes.yaml)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/qa-advanced">QA Appendix — Full Test Execution Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/qa-troubleshooting">QA — Troubleshooting Checklist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/routes-reference">routes-reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/session-binding-csrf">Session Binding and CSRF (Verified)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/settings-reference">settings.yaml Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/spa-pdp-usage">SPA PDP usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/streaming">Streaming / SSE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/traefik-forwardauth">Traefik ForwardAuth with the BFF (Verified)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/empowernow_docs/docs/services/bff/reference/ui-permissions">Permission Gating in the UI</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/empowernow_docs/docs/services/pdp">PDP</a><button aria-label="Expand sidebar category &#x27;PDP&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/empowernow_docs/docs/services/experience">Experience</a><button aria-label="Expand sidebar category &#x27;Experience&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/empowernow_docs/docs/services/aria-shield">ARIA Shield</a><button aria-label="Expand sidebar category &#x27;ARIA Shield&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/empowernow_docs/docs/services/nowconnect">NowConnect</a><button aria-label="Expand sidebar category &#x27;NowConnect&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/empowernow_docs/docs/services/idp">IdP</a><button aria-label="Expand sidebar category &#x27;IdP&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/empowernow_docs/docs/personas/faq">Personas</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/empowernow_docs/docs/marketing">Marketing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/empowernow_docs/docs/enablement/product-review-study-guide">Enablement</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/empowernow_docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Services</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/empowernow_docs/docs/services/bff"><span>BFF</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">BFF + IdP OAuth (E2E)</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Backend-for-Frontend (BFF) + IdP OAuth – End‑to‑End Configuration and Matching Guide</h1></header><p>Mental model refresher</p>
<ul>
<li>End-user identity: comes from the OIDC ID token (or UserInfo) after the BFF exchanges the authorization code; the BFF stores <code>user_id = id_token.sub</code> in the session.</li>
<li>Backend tokens: obtained and held by the BFF for upstream calls (client-credential or token-exchange). Their <code>sub</code> is usually the OAuth client (e.g., <code>bff-server</code>) and is not the end-user.</li>
<li>No browser token exposure: only cookies are visible to the SPA.</li>
</ul>
<p>Use this as the single source for setup, onboarding, and troubleshooting. It explains how the BFF, IdP, and SPAs fit together for OAuth 2.0/OIDC with DCR, PKCE, PAR, JARM, DPoP, and how to safely switch token endpoint authentication methods.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-overview">System overview<a href="#system-overview" class="hash-link" aria-label="Direct link to System overview" title="Direct link to System overview">​</a></h2>
<ul>
<li>BFF<!-- -->
<ul>
<li>Hosts <code>/auth/login</code>, <code>/auth/callback</code>, <code>/auth/session</code>, <code>/auth/logout</code> for SPAs</li>
<li>Redirects browser to IdP; exchanges authorization code; manages session cookies</li>
<li>Talks to IdP using PKCE, PAR, JARM; supports DPoP and <code>private_key_jwt</code></li>
</ul>
</li>
<li>IdP<!-- -->
<ul>
<li>Provides OIDC endpoints (<code>/.well-known/openid-configuration</code>, <code>/authorize</code>, <code>/token</code>, …)</li>
<li>Accepts DCR; stores clients in <code>ServiceConfigs/IdP/config/clients.yaml</code></li>
<li>Enforces <code>redirect_uris</code>, scopes, and <code>token_endpoint_auth_method</code></li>
</ul>
</li>
<li>SPAs<!-- -->
<ul>
<li>Delegate OAuth to the BFF; receive only session cookies</li>
</ul>
</li>
</ul>
<p>See also: <code>services/bff/explanation/bff-visual-guide</code>, <code>services/bff/explanation/authentication</code>, <code>services/bff/explanation/golden-path</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-configuration-lives">Where configuration lives<a href="#where-configuration-lives" class="hash-link" aria-label="Direct link to Where configuration lives" title="Direct link to Where configuration lives">​</a></h2>
<ul>
<li>BFF runtime (compose): <code>CRUDService/docker-compose-authzen4.yml</code> (<code>bff</code> service env)</li>
<li>BFF code: <code>ms_bff_spike/ms_bff/src/services/idp_client.py</code> (token exchange, PKCE/Redis)</li>
<li>IdP DCR policy: <code>ServiceConfigs/IdP/config/dcr_config.yaml</code> (top-level <code>policy</code>, <code>client_profiles</code>)</li>
<li>IdP client store: <code>ServiceConfigs/IdP/config/clients.yaml</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="matching-matrix-must-align">Matching matrix (must align)<a href="#matching-matrix-must-align" class="hash-link" aria-label="Direct link to Matching matrix (must align)" title="Direct link to Matching matrix (must align)">​</a></h2>
<table><thead><tr><th>BFF (compose env)</th><th>IdP DCR policy / client profile</th><th>IdP clients.yaml</th></tr></thead><tbody><tr><td><code>AUTH_CLIENT_ID=bff-server</code></td><td>DCR payload <code>client_id</code></td><td><code>client_id: bff-server</code></td></tr><tr><td><code>MS_BFF_TOKEN_AUTH_METHOD</code> = <code>private_key_jwt</code> or `client_secret_post</td><td>basic`</td><td><code>client_profiles.code-flow-pkjwt.token_endpoint_auth_method: private_key_jwt</code> (or secret-based profile)</td></tr><tr><td><code>BFF_JWT_SIGNING_KEY</code> (PEM path)</td><td>DCR sends JWKS with <code>kid</code> matching PEM</td><td><code>jwks.keys[].kid/alg/n/e</code> pairs with BFF private key</td></tr><tr><td><code>DCR_REDIRECT_URIS</code> include <code>https://&lt;host&gt;/auth/callback</code></td><td>Policy validates schemes/limits</td><td><code>redirect_uris:</code> include exact host + <code>/auth/callback</code></td></tr><tr><td><code>OIDC_SCOPES</code> (space‑sep)</td><td><code>policy.allowed_scopes</code> includes all requested</td><td><code>scopes:</code> and <code>scope:</code> include the same set</td></tr><tr><td><code>OIDC_AUTHORIZATION_URL</code> (public)</td><td>—</td><td>—</td></tr><tr><td><code>OIDC_ISSUER</code>/<code>OIDC_TOKEN_URL</code> (internal acceptable)</td><td>—</td><td>—</td></tr></tbody></table>
<p>Tips:</p>
<ul>
<li>If <code>BFF_DYNAMIC_CALLBACK=true</code>, the BFF computes <code>https://&lt;request-host&gt;/auth/callback</code>. Every such host must be present in the client’s <code>redirect_uris</code> without a trailing slash.</li>
<li>Internal service‑to‑service calls can use HTTP on the Docker network; browser‑facing redirects must be public HTTPS.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-endpoint-authentication-methods">Token endpoint authentication methods<a href="#token-endpoint-authentication-methods" class="hash-link" aria-label="Direct link to Token endpoint authentication methods" title="Direct link to Token endpoint authentication methods">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="private_key_jwt-recommended-fapialigned">private_key_jwt (recommended; FAPI‑aligned)<a href="#private_key_jwt-recommended-fapialigned" class="hash-link" aria-label="Direct link to private_key_jwt (recommended; FAPI‑aligned)" title="Direct link to private_key_jwt (recommended; FAPI‑aligned)">​</a></h3>
<ul>
<li>BFF signs <code>client_assertion</code> with its private key; IdP validates via client JWKS</li>
<li>Requires: BFF PEM mounted (<code>BFF_JWT_SIGNING_KEY</code>), IdP client with JWKS and <code>private_key_jwt</code></li>
<li>Failure signature if misaligned: 401 <code>invalid_client</code> with messages like “client_assertion_type must be jwt-bearer” or signature/JWK mismatch</li>
</ul>
<p>Short operational guidance</p>
<ul>
<li>Perform a one-time DCR with a fresh IAT to register the client (PKJWT + JWKS/JWKS URI).</li>
<li>After success, stop providing <code>DCR_IAT</code> in the BFF environment; startup remains idempotent.</li>
<li>Set the client’s <code>jwks_uri</code> to the BFF JWKS endpoint: <code>https://&lt;your-bff-host&gt;/.well-known/jwks.json</code>.</li>
<li>Rotate the BFF signing key and publish both old and new keys in JWKS briefly; the IdP will re-fetch via <code>jwks_uri</code>. No DCR re-registration needed.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="client_secret_postbasic-simpler-not-fapi">client_secret_post/basic (simpler; not FAPI)<a href="#client_secret_postbasic-simpler-not-fapi" class="hash-link" aria-label="Direct link to client_secret_post/basic (simpler; not FAPI)" title="Direct link to client_secret_post/basic (simpler; not FAPI)">​</a></h3>
<ul>
<li>BFF uses a shared secret via form body or Authorization header</li>
<li>Requires: IdP client with <code>client_secret</code> or <code>client_secret_hash</code> and matching <code>token_endpoint_auth_method</code></li>
<li>Trade‑offs: easier but weaker; secret distribution/rotation burden</li>
</ul>
<p>See how‑tos: <code>services/bff/how-to/register-bff-private-key-jwt</code>, <code>services/bff/how-to/switch-auth-methods</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="redirect-uris-exact-matching">Redirect URIs: exact matching<a href="#redirect-uris-exact-matching" class="hash-link" aria-label="Direct link to Redirect URIs: exact matching" title="Direct link to Redirect URIs: exact matching">​</a></h2>
<ul>
<li>Use <code>/auth/callback</code> consistently. Do not register <code>/callback</code> if BFF uses <code>/auth/callback</code>.</li>
<li>Register each SPA host separately in <code>redirect_uris</code> (array; not a comma‑joined string).</li>
<li>Common pitfalls: host typos, trailing slashes, mixing HTTP/HTTPS.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pkce-and-redis">PKCE and Redis<a href="#pkce-and-redis" class="hash-link" aria-label="Direct link to PKCE and Redis" title="Direct link to PKCE and Redis">​</a></h2>
<ul>
<li><code>/auth/login</code>: BFF stores <code>code_verifier</code> in Redis keyed by <code>pkce:{state}</code></li>
<li><code>/auth/callback</code> → <code>/token</code>: BFF retrieves and includes <code>code_verifier</code></li>
<li>Health: Redis reachable (e.g., <code>REDIS_URL=redis://shared_redis:6379/5</code>), state not expired</li>
</ul>
<p>See how‑to: <code>services/bff/how-to/pkce-redis-health</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="failure-signatures--causes--fixes">Failure signatures → causes → fixes<a href="#failure-signatures--causes--fixes" class="hash-link" aria-label="Direct link to Failure signatures → causes → fixes" title="Direct link to Failure signatures → causes → fixes">​</a></h2>
<table><thead><tr><th>Error signature</th><th>Likely cause</th><th>Fix</th></tr></thead><tbody><tr><td>400 DCR <code>invalid_scope</code></td><td><code>policy.allowed_scopes</code> missing requested scope</td><td>Add scope in <code>dcr_config.yaml</code>, restart IdP, rerun DCR</td></tr><tr><td>400 DCR <code>invalid_redirect_uri</code></td><td>Mismatch of host/path (<code>/auth/callback</code>) or unregistered URI</td><td>Align <code>DCR_REDIRECT_URIS</code> and <code>clients.yaml.redirect_uris</code>, set <code>DCR_FORCE_REPLACE=true</code>, restart BFF</td></tr><tr><td>401 <code>/token</code> <code>invalid_client</code> “client_assertion_type must be jwt-bearer”</td><td>BFF using secret while IdP expects PKJWT, or missing PEM/JWKS</td><td>Set <code>MS_BFF_TOKEN_AUTH_METHOD=private_key_jwt</code>, mount PEM, ensure matching JWKS in client</td></tr><tr><td>CAEP consumer “Unable to bootstrap from (‘localhost’, 9092)”</td><td>Kafka not configured for BFF</td><td>Set <code>KAFKA_BOOTSTRAP_SERVERS=kafka:9092</code></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="switching-methods-safely">Switching methods safely<a href="#switching-methods-safely" class="hash-link" aria-label="Direct link to Switching methods safely" title="Direct link to Switching methods safely">​</a></h2>
<ol>
<li>IdP: Change client record or re‑DCR to desired <code>token_endpoint_auth_method</code>; for secrets, ensure <code>client_secret</code> or <code>client_secret_hash</code></li>
<li>BFF: Set <code>MS_BFF_TOKEN_AUTH_METHOD</code>, provide <code>AUTH_CLIENT_SECRET</code> for secret modes or PEM for PKJWT</li>
<li>Restart BFF; verify <code>/token</code> success</li>
</ol>
<p>Detailed steps: <code>services/bff/how-to/switch-auth-methods</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="minimal-operational-workflow">Minimal operational workflow<a href="#minimal-operational-workflow" class="hash-link" aria-label="Direct link to Minimal operational workflow" title="Direct link to Minimal operational workflow">​</a></h2>
<ol>
<li>Prepare IdP policy (<code>dcr_config.yaml</code>) and restart IdP</li>
<li>Set BFF env for DCR and auth method in compose; ensure PEM mounted</li>
<li>Restart BFF only; confirm DCR 201 and healthy service</li>
<li>Attempt SPA login; verify token exchange and session</li>
<li>Remove <code>DCR_IAT</code> from the environment once registration is confirmed</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="visuals">Visuals<a href="#visuals" class="hash-link" aria-label="Direct link to Visuals" title="Direct link to Visuals">​</a></h2>
<p>Sequence (Authorization Code with PKCE/PAR via BFF):</p>
<!-- -->
<p>See also: <code>services/bff/explanation/bff-visual-guide</code> for detailed architecture.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pointers-and-references">Pointers and references<a href="#pointers-and-references" class="hash-link" aria-label="Direct link to Pointers and references" title="Direct link to Pointers and references">​</a></h2>
<ul>
<li>BFF env index: <code>services/bff/reference/environment-index</code></li>
<li>FAPI features: <code>services/bff/reference/fapi-support</code></li>
<li>DCR bootstrap: <code>services/bff/how-to/dcr-bootstrap</code>, <code>services/crud-service/how-to/bff-startup-dcr-iat</code></li>
<li>IdP policy and clients: <code>ServiceConfigs/IdP/config/dcr_config.yaml</code>, <code>ServiceConfigs/IdP/config/clients.yaml</code></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/bff-idp-oauth-e2e.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/empowernow_docs/docs/services/bff/reference/admin-config"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Admin Configuration Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/empowernow_docs/docs/services/bff/reference/certificates-admin"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Certificates &amp; Secrets (Admins)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-overview" class="table-of-contents__link toc-highlight">System overview</a></li><li><a href="#where-configuration-lives" class="table-of-contents__link toc-highlight">Where configuration lives</a></li><li><a href="#matching-matrix-must-align" class="table-of-contents__link toc-highlight">Matching matrix (must align)</a></li><li><a href="#token-endpoint-authentication-methods" class="table-of-contents__link toc-highlight">Token endpoint authentication methods</a><ul><li><a href="#private_key_jwt-recommended-fapialigned" class="table-of-contents__link toc-highlight">private_key_jwt (recommended; FAPI‑aligned)</a></li><li><a href="#client_secret_postbasic-simpler-not-fapi" class="table-of-contents__link toc-highlight">client_secret_post/basic (simpler; not FAPI)</a></li></ul></li><li><a href="#redirect-uris-exact-matching" class="table-of-contents__link toc-highlight">Redirect URIs: exact matching</a></li><li><a href="#pkce-and-redis" class="table-of-contents__link toc-highlight">PKCE and Redis</a></li><li><a href="#failure-signatures--causes--fixes" class="table-of-contents__link toc-highlight">Failure signatures → causes → fixes</a></li><li><a href="#switching-methods-safely" class="table-of-contents__link toc-highlight">Switching methods safely</a></li><li><a href="#minimal-operational-workflow" class="table-of-contents__link toc-highlight">Minimal operational workflow</a></li><li><a href="#visuals" class="table-of-contents__link toc-highlight">Visuals</a></li><li><a href="#pointers-and-references" class="table-of-contents__link toc-highlight">Pointers and references</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/intro">Getting Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Marketing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/website_copy/solutions">Solutions</a></li><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/website_copy/pricing">Pricing</a></li><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/website_copy/products">Products</a></li><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/website_copy/trust">Trust</a></li><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/website_copy/resources">Resources</a></li><li class="footer__item"><a class="footer__link-item" href="/empowernow_docs/docs/website_copy/company">Company</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/empowerID/empowernow_docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 EmpowerNow. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>