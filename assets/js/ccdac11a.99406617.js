"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[7198],{28453:(e,o,s)=>{s.d(o,{R:()=>t,x:()=>c});var n=s(96540);const i={},r=n.createContext(i);function t(e){const o=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),n.createElement(r.Provider,{value:o},e.children)}},75362:(e,o,s)=>{s.r(o),s.d(o,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"services/bff/how-to/cors-cookie-domain","title":"Configure CORS and Cookie Domain (Verified)","description":"This guide explains how CORS allow\u2011lists and cookie domains work in the EmpowerNow stack for SPAs using the BFF.","source":"@site/docs/services/bff/how-to/cors-cookie-domain.md","sourceDirName":"services/bff/how-to","slug":"/services/bff/how-to/cors-cookie-domain","permalink":"/empowernow_docs/docs/services/bff/how-to/cors-cookie-domain","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/how-to/cors-cookie-domain.md","tags":[],"version":"current","frontMatter":{"title":"Configure CORS and Cookie Domain (Verified)"},"sidebar":"tutorialSidebar","previous":{"title":"Configure PDP (pdp.yaml)","permalink":"/empowernow_docs/docs/services/bff/how-to/configure-pdp"},"next":{"title":"Dynamic Client Registration (DCR) Runbook \u2014 BFF Client","permalink":"/empowernow_docs/docs/services/bff/how-to/dcr-bootstrap"}}');var i=s(74848),r=s(28453);const t={title:"Configure CORS and Cookie Domain (Verified)"},c=void 0,d={},l=[];function a(e){const o={code:"code",li:"li",mermaid:"mermaid",ol:"ol",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.p,{children:"This guide explains how CORS allow\u2011lists and cookie domains work in the EmpowerNow stack for SPAs using the BFF."}),"\n",(0,i.jsx)(o.p,{children:"What\u2019s implemented (verified)"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["CORS: The BFF parses an allow\u2011list for origins. Code reads from environment to build a list (see ",(0,i.jsx)(o.code,{children:"ms_bff_spike/ms_bff/src/main.py"})," and ",(0,i.jsx)(o.code,{children:"ms_bff_spike/ms_bff/src/utils/proxy.py"}),", which handle ",(0,i.jsx)(o.code,{children:"CORS__ALLOW_ORIGINS"})," and ",(0,i.jsx)(o.code,{children:"ALLOWED_STREAM_ORIGINS"})," parsing)."]}),"\n",(0,i.jsxs)(o.li,{children:["Cookies: The session cookie name is ",(0,i.jsx)(o.code,{children:"bff_session"})," (see security docs). Domain/scope are set by the BFF response and enforced by the browser; in production we recommend a shared parent domain (e.g., ",(0,i.jsx)(o.code,{children:".ocg.labs.empowernow.ai"}),") so all SPAs can share the session."]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"Same\u2011origin SPA vs cross\u2011origin dev"}),"\n",(0,i.jsx)(o.mermaid,{value:"flowchart LR\r\n  subgraph Dev\r\n    V[http://localhost:5173 SPA]\r\n    B[http://localhost:8000 BFF]\r\n  end\r\n  subgraph Prod\r\n    H[https://automate.ocg... SPA + /api]\r\n    A[https://api.ocg... BFF]\r\n  end\r\n  V -- CORS allowlist --\x3e B\r\n  H -- Same-origin cookie --\x3e A"}),"\n",(0,i.jsx)(o.p,{children:"Steps"}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsx)(o.p,{children:"Dev (cross\u2011origin)"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Set ",(0,i.jsx)(o.code,{children:"CORS__ALLOW_ORIGINS"})," to include your dev server (e.g., ",(0,i.jsx)(o.code,{children:"http://localhost:5173"}),")."]}),"\n",(0,i.jsxs)(o.li,{children:["For streaming endpoints, set ",(0,i.jsx)(o.code,{children:"ALLOWED_STREAM_ORIGINS"})," if you use SSE from a different origin."]}),"\n",(0,i.jsx)(o.li,{children:"Verify preflights succeed; unauthenticated calls should return JSON with CORS headers."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsx)(o.p,{children:"Prod (same\u2011origin)"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Serve the SPA and BFF under the same host (e.g., ",(0,i.jsx)(o.code,{children:"automate.ocg.labs..."})," routes ",(0,i.jsx)(o.code,{children:"/api/**"})," to BFF)."]}),"\n",(0,i.jsxs)(o.li,{children:["The browser sends cookies automatically; no CORS preflight is triggered for ",(0,i.jsx)(o.code,{children:"/api/**"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsx)(o.p,{children:"Cookie domain"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Use a shared parent domain at the ingress (Traefik) so the BFF sets the cookie for ",(0,i.jsx)(o.code,{children:".ocg.labs.empowernow.ai"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:["Ensure ",(0,i.jsx)(o.code,{children:"Secure"})," and ",(0,i.jsx)(o.code,{children:"SameSite=Lax"})," are set; do not expose tokens to the browser."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"Validate"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["DevTools \u2192 Application \u2192 Cookies: ",(0,i.jsx)(o.code,{children:"bff_session"})," present for your domain."]}),"\n",(0,i.jsxs)(o.li,{children:["Response headers on unauthenticated API call contain ",(0,i.jsx)(o.code,{children:"Access-Control-Allow-Origin"})," with your dev origin."]}),"\n"]})]})}function h(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);