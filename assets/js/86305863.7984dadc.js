"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[4010],{26352:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"services/crud-service/reference/mcp_loopback_howto","title":"mcp_loopback_howto","description":"Loopback MCP tools in CRUDService \u2013 Admin How\u2011To","source":"@site/docs/services/crud-service/reference/mcp_loopback_howto.md","sourceDirName":"services/crud-service/reference","slug":"/services/crud-service/reference/mcp_loopback_howto","permalink":"/empowernow_docs/docs/services/crud-service/reference/mcp_loopback_howto","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/reference/mcp_loopback_howto.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"mcp_faq","permalink":"/empowernow_docs/docs/services/crud-service/reference/mcp_faq"},"next":{"title":"mcp_opt_in_annotations","permalink":"/empowernow_docs/docs/services/crud-service/reference/mcp_opt_in_annotations"}}');var r=s(74848),l=s(28453);const c={},i=void 0,t={},d=[{value:"Loopback MCP tools in CRUDService \u2013 Admin How\u2011To",id:"loopback-mcp-tools-in-crudservice--admin-howto",level:2},{value:"What you get",id:"what-you-get",level:3},{value:"Endpoints",id:"endpoints",level:3},{value:"Auth and scopes",id:"auth-and-scopes",level:3},{value:"Tool sources and naming",id:"tool-sources-and-naming",level:3},{value:"Catalogue behavior",id:"catalogue-behavior",level:3},{value:"Observability",id:"observability",level:3},{value:"Examples",id:"examples",level:3},{value:"Architecture (transport) overview",id:"architecture-transport-overview",level:4},{value:"List tools (REST)",id:"list-tools-rest",level:4},{value:"List tools (JSON\u2011RPC)",id:"list-tools-jsonrpc",level:4},{value:"Health (JSON\u2011RPC)",id:"health-jsonrpc",level:4},{value:"Invoke a workflow tool",id:"invoke-a-workflow-tool",level:4},{value:"Invoke a system command tool",id:"invoke-a-system-command-tool",level:4},{value:"Rollout tips",id:"rollout-tips",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Quick start",id:"quick-start",level:3},{value:"Cursor setup (copy/paste)",id:"cursor-setup-copypaste",level:3},{value:"See also",id:"see-also",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"loopback-mcp-tools-in-crudservice--admin-howto",children:"Loopback MCP tools in CRUDService \u2013 Admin How\u2011To"}),"\n",(0,r.jsx)(n.h3,{id:"what-you-get",children:"What you get"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"In\u2011process MCP server"})," under ",(0,r.jsx)(n.code,{children:"/mcp"})," that exposes tools generated from ServiceConfigs (systems + workflows)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single source of truth"}),": tools derive from your YAML configs (no separate MCP processes required)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ToolCatalogue auto\u2011merge"}),": built\u2011ins from ",(0,r.jsx)(n.code,{children:"config/tools.yaml"})," + loopback MCP + any external MCP endpoints in ",(0,r.jsx)(n.code,{children:"config/mcp_endpoints.yaml"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"endpoints",children:"Endpoints"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["GET ",(0,r.jsx)(n.code,{children:"/mcp/tools/list"})]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Returns ",(0,r.jsx)(n.code,{children:'{ "tools": [ { name, description, inputSchema, source, metadata } ] }'})]}),"\n",(0,r.jsxs)(n.li,{children:["Requires scope: ",(0,r.jsx)(n.code,{children:"mcp.tools.discovery"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["POST ",(0,r.jsx)(n.code,{children:"/mcp/jsonrpc"})]})," (JSON\u2011RPC 2.0)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Supported methods:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tools/list"})," \u2192 returns same structure as REST list"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tools/invoke"})," \u2192 executes named tool; body: ",(0,r.jsx)(n.code,{children:'{ id, method: "tools/invoke", params: { name, arguments } }'})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tools/call"})," \u2192 alias for ",(0,r.jsx)(n.code,{children:"tools/invoke"})," (compatibility)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Requires scope: ",(0,r.jsx)(n.code,{children:"mcp.tools.invoke"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"auth-and-scopes",children:"Auth and scopes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Reuses CRUDService authn/z. Provide ",(0,r.jsx)(n.code,{children:"Authorization: Bearer <token>"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Scopes enforced:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mcp.tools.discovery"})," for listing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mcp.tools.invoke"})," for invoking"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["PDP ",(0,r.jsx)(n.code,{children:"enable_authorization"})," flag is read from ",(0,r.jsx)(n.code,{children:"config/pdp.yaml"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tool-sources-and-naming",children:"Tool sources and naming"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default namespaced"}),": ",(0,r.jsx)(n.code,{children:"provider.instance.base"})," for system tools (e.g., ",(0,r.jsx)(n.code,{children:"entra.cont.account.get_by_id"}),", ",(0,r.jsx)(n.code,{children:"ldap.av.account.get_by_dn"}),"). Workflows use ",(0,r.jsx)(n.code,{children:"workflow.<name>"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Router (optional)"}),": short names with ",(0,r.jsx)(n.code,{children:"oneOf"})," input schema; enable via ",(0,r.jsx)(n.code,{children:"MCP_ENABLE_ROUTER=true"})," (invocation routing remains namespaced)."]}),"\n",(0,r.jsx)(n.li,{children:"JSON Schema for inputs is auto\u2011derived; falls back to a permissive object when unspecified."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"catalogue-behavior",children:"Catalogue behavior"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["On startup, CRUDService builds a ToolCatalogue with:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Built\u2011ins from ",(0,r.jsx)(n.code,{children:"config/tools.yaml"})]}),"\n",(0,r.jsxs)(n.li,{children:["Loopback MCP tools (when ",(0,r.jsx)(n.code,{children:"ToolCatalogue"})," is constructed with a ",(0,r.jsx)(n.code,{children:"config_loader"})," \u2013 default in ",(0,r.jsx)(n.code,{children:"src/main.py"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["External MCP endpoints in ",(0,r.jsx)(n.code,{children:"config/mcp_endpoints.yaml"})," (merged)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["After mutations, catalogue refreshes automatically:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Systems: create/update/delete (",(0,r.jsx)(n.code,{children:"/config/systems/*"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Workflows: create/update/delete (",(0,r.jsx)(n.code,{children:"/workflows/*"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Tools config replace: ",(0,r.jsx)(n.code,{children:"PUT /config/tools"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"observability",children:"Observability"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Structured logs with ",(0,r.jsx)(n.code,{children:"correlation_id"})," and durations:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mcp_tools_list_start"})," / ",(0,r.jsx)(n.code,{children:"mcp_tools_list_complete"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mcp_jsonrpc_call"})," / ",(0,r.jsx)(n.code,{children:"mcp_jsonrpc_complete"})]}),"\n",(0,r.jsxs)(n.li,{children:["Errors/denied: ",(0,r.jsx)(n.code,{children:"mcp_jsonrpc_error"}),", ",(0,r.jsx)(n.code,{children:"mcp_jsonrpc_forbidden"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.h4,{id:"architecture-transport-overview",children:"Architecture (transport) overview"}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart LR\r\n  Cursor["Cursor (MCP client)"]\r\n  BFF["BFF\\\\nGET /api/crud/mcp/jsonrpc (SSE)"]\r\n  CRUD["CRUDService\\\\nPOST /mcp/jsonrpc"]\r\n  GEN["LoopbackToolGenerator\\\\n(ServiceConfigs)"]\r\n\r\n  Cursor -- SSE GET --\x3e BFF\r\n  BFF -- JSON-RPC POST --\x3e CRUD\r\n  CRUD -- list/invoke --\x3e GEN\r\n  GEN -- tools/result --\x3e CRUD\r\n  CRUD -- result --\x3e BFF\r\n  BFF -- SSE events --\x3e Cursor'}),"\n",(0,r.jsx)(n.h4,{id:"list-tools-rest",children:"List tools (REST)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer $TOKEN" \\\r\n  https://crud.service.local/mcp/tools/list\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response (truncated):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "tools": [\r\n  { "name": "entra.cont.account.get_by_id", "source": "system", "inputSchema": {"type":"object",...} },\r\n  { "name": "workflow.onboard_user", "source": "workflow", "inputSchema": {"type":"object",...} }\r\n]}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"list-tools-jsonrpc",children:"List tools (JSON\u2011RPC)"}),"\n",(0,r.jsx)(n.h4,{id:"health-jsonrpc",children:"Health (JSON\u2011RPC)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "jsonrpc":"2.0","id":"1","method":"tools/call",\r\n    "params":{"name":"system.health","arguments":{"verbose":true}}\r\n  }\' \\\r\n  https://crud.service.local/mcp/jsonrpc\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Also supported: ",(0,r.jsx)(n.code,{children:'"name":"system_health"'}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" \\\r\n  -d \'{"jsonrpc":"2.0","id":"1","method":"tools/list"}\' \\\r\n  https://crud.service.local/mcp/jsonrpc\n'})}),"\n",(0,r.jsx)(n.h4,{id:"invoke-a-workflow-tool",children:"Invoke a workflow tool"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'WF=workflow_onboard_user\r\ncurl -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "jsonrpc":"2.0","id":"2","method":"tools/invoke",\r\n    "params": {"name":"\'"$WF"\'","arguments":{"username":"jdoe","email":"jdoe@example.com"}}\r\n  }\' \\\r\n  https://crud.service.local/mcp/jsonrpc\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response (loopback MVP):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "jsonrpc": "2.0", "id": "2", "result": {\r\n  "content": [{ "type": "text", "text": "{\\"accepted\\": true, \\"workflow\\": \\"onboard_user\\", \\"params\\": {\\"username\\":\\"jdoe\\",\\"email\\":\\"jdoe@example.com\\"}}" }]\r\n}}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"invoke-a-system-command-tool",children:"Invoke a system command tool"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'TOOL=ldap_account_create\r\ncurl -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "jsonrpc":"2.0","id":"3","method":"tools/invoke",\r\n    "params": {"name":"\'"$TOOL"\'","arguments":{"uid":"jdoe","cn":"John Doe"}}\r\n  }\' \\\r\n  https://crud.service.local/mcp/jsonrpc\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response (truncated):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "jsonrpc": "2.0", "id": "3", "result": { "content": [ { "type": "text", "text": "{...}" } ] } }\n'})}),"\n",(0,r.jsx)(n.h3,{id:"rollout-tips",children:"Rollout tips"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Start in non\u2011prod; monitor the structured log events above."}),"\n",(0,r.jsx)(n.li,{children:"Ensure tokens used by agent UIs carry the minimal scopes required."}),"\n",(0,r.jsxs)(n.li,{children:["External MCP endpoints remain optional; add them via ",(0,r.jsx)(n.code,{children:"config/mcp_endpoints.yaml"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["403 or JSON\u2011RPC error ",(0,r.jsx)(n.code,{children:"-32001"}),": missing scope (",(0,r.jsx)(n.code,{children:"mcp.tools.discovery"})," or ",(0,r.jsx)(n.code,{children:"mcp.tools.invoke"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Empty list: confirm ServiceConfigs are mounted and readable; check logs for loader validation errors."}),"\n",(0,r.jsx)(n.li,{children:"Stale list: trigger a change or call an admin mutation to refresh; or restart service."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-32601 Method not found"}),": use ",(0,r.jsx)(n.code,{children:"tools/call"})," (alias) or check method casing."]}),"\n",(0,r.jsxs)(n.li,{children:["Health tool missing: set ",(0,r.jsx)(n.code,{children:"MCP_LOOPBACK_ONLY_HEALTH=false"})," (or unset) and redeploy."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"quick-start",children:"Quick start"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.code,{children:"MCP_MAX_TOOLS=80"})," on CRUDService."]}),"\n",(0,r.jsxs)(n.li,{children:["Add minimal ",(0,r.jsx)(n.code,{children:"mcp"})," blocks to one Azure/Auth0 GET command and one workflow."]}),"\n",(0,r.jsxs)(n.li,{children:["Call tools/list; verify tools plus ",(0,r.jsx)(n.code,{children:"system.health"}),"/",(0,r.jsx)(n.code,{children:"system_health"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Invoke health via ",(0,r.jsx)(n.code,{children:"tools/call"})," with ",(0,r.jsx)(n.code,{children:"{ verbose: true }"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Invoke an enabled Azure/Auth0 tool with required params."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cursor-setup-copypaste",children:"Cursor setup (copy/paste)"}),"\n",(0,r.jsxs)(n.p,{children:["Create or edit ",(0,r.jsx)(n.code,{children:"~/.cursor/mcp.json"})," (Windows: ",(0,r.jsx)(n.code,{children:"%USERPROFILE%\\.cursor\\mcp.json"}),")."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\r\n  "mcpServers": {\r\n    "crud-mcp": {\r\n      "type": "streamable-http",\r\n      "url": "https://api.ocg.labs.empowernow.ai/api/crud/mcp/jsonrpc",\r\n      "headers": {\r\n        "Authorization": "Bearer <ACCESS_TOKEN_WITH_scopes_mcp.tools.discovery_mcp.tools.invoke>",\r\n        "Content-Type": "application/json"\r\n      }\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Then in Cursor:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Open the MCP tools panel \u2192 enable ",(0,r.jsx)(n.code,{children:"crud-mcp"})," if disabled"]}),"\n",(0,r.jsxs)(n.li,{children:["Ask: \u201cList tools from crud-mcp\u201d (Cursor sends ",(0,r.jsx)(n.code,{children:"tools/list"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Ask: \u201cRun the CRUD MCP health check with verbose true\u201d (Cursor sends ",(0,r.jsx)(n.code,{children:"tools/call"})," to ",(0,r.jsx)(n.code,{children:"system.health"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Tips"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If you see 403/CSRF, ensure the URL points to the BFF proxy and you\u2019re sending a Bearer token."}),"\n",(0,r.jsxs)(n.li,{children:["If Cursor uses ",(0,r.jsx)(n.code,{children:"tools/call"}),", the server handles it; ",(0,r.jsx)(n.code,{children:"tools/invoke"})," also works."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Quickstart: ",(0,r.jsx)(n.code,{children:"../how-to/mcp-quickstart.md"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cursor integration: ",(0,r.jsx)(n.code,{children:"../how-to/mcp-cursor-integration.md"})]}),"\n",(0,r.jsxs)(n.li,{children:["API Reference: ",(0,r.jsx)(n.code,{children:"./mcp_api_reference.md"})]}),"\n",(0,r.jsxs)(n.li,{children:["BFF MCP proxy routing: ",(0,r.jsx)(n.code,{children:"../../bff/devops/mcp_proxy_routing.md"})]}),"\n",(0,r.jsxs)(n.li,{children:["Opt\u2011in authors guide: ",(0,r.jsx)(n.code,{children:"../how-to/mcp-opt-in-authors-guide.md"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var o=s(96540);const r={},l=o.createContext(r);function c(e){const n=o.useContext(l);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(l.Provider,{value:n},e.children)}}}]);