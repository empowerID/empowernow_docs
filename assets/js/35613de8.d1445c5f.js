"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[4518],{28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>t});var s=r(96540);const i={},d=s.createContext(i);function c(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(d.Provider,{value:n},e.children)}},94503:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"services/pdp/explanation/policy_dsl_cheatsheet","title":"PDP Policy DSL \u2013 Quick Reference","description":"Need narrative examples and audit checklist? See policyauthorguide.md.","source":"@site/docs/services/pdp/explanation/policy_dsl_cheatsheet.md","sourceDirName":"services/pdp/explanation","slug":"/services/pdp/explanation/policy_dsl_cheatsheet","permalink":"/empowernow_docs/docs/services/pdp/explanation/policy_dsl_cheatsheet","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/pdp/explanation/policy_dsl_cheatsheet.md","tags":[],"version":"current","frontMatter":{}}');var i=r(74848),d=r(28453);const c={},t="PDP Policy DSL \u2013 Quick Reference",l={},o=[{value:"1. File Skeleton",id:"1-file-skeleton",level:2},{value:"2. Condition Language",id:"2-condition-language",level:2},{value:"Operators",id:"operators",level:3},{value:"3. Obligations &amp; Constraints",id:"3-obligations--constraints",level:2},{value:"4. Effect mapping rules",id:"4-effect-mapping-rules",level:2},{value:"5. Common gotchas",id:"5-common-gotchas",level:2},{value:"6. CLI Helpers",id:"6-cli-helpers",level:2},{value:"7. Full syntax catalogue (auto-derived)",id:"7-full-syntax-catalogue-auto-derived",level:2},{value:"7.1 Rule-level keys",id:"71-rule-level-keys",level:3},{value:"7.2 Syntactic-sugar \u2192 effect resolution",id:"72-syntactic-sugar--effect-resolution",level:3},{value:"7.3 Supported operators (string form)",id:"73-supported-operators-string-form",level:3},{value:"7.4 Attribute scopes",id:"74-attribute-scopes",level:3},{value:"7.5 Dynamic subjects",id:"75-dynamic-subjects",level:3},{value:"7.6 Path-attribute matching",id:"76-path-attribute-matching",level:3},{value:"8.1 Guarded permits \u2014 examples and alternatives",id:"81-guarded-permits--examples-and-alternatives",level:2},{value:"Anti-pattern (over-permitting)",id:"anti-pattern-over-permitting",level:3},{value:"Recommended (true guard)",id:"recommended-true-guard",level:3},{value:"Alternatives",id:"alternatives",level:3},{value:"Lint suggestion",id:"lint-suggestion",level:3},{value:"Testing checklist",id:"testing-checklist",level:3},{value:"7.7 Constraints vs Obligations cheat-sheet",id:"77-constraints-vs-obligations-cheat-sheet",level:3},{value:"8. Effect of placeholders / templates",id:"8-effect-of-placeholders--templates",level:2},{value:"9. Regeneration instructions",id:"9-regeneration-instructions",level:2},{value:"10. Combining algorithm &amp; defaults",id:"10-combining-algorithm--defaults",level:2},{value:"11. Constraint &amp; obligation catalogue  (built-ins)",id:"11-constraint--obligation-catalogue--built-ins",level:2},{value:"12. Context contract (caller \u2192 PDP)",id:"12-context-contract-caller--pdp",level:2},{value:"Application-Scoped Policy Loading",id:"application-scoped-policy-loading",level:3},{value:"Directory Structure",id:"directory-structure",level:3},{value:"13. Path-attribute schema &amp; example",id:"13-path-attribute-schema--example",level:2},{value:"14. Machine-readable schema",id:"14-machine-readable-schema",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"pdp-policy-dsl--quick-reference",children:"PDP Policy DSL \u2013 Quick Reference"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Need narrative examples and audit checklist?"})," See ",(0,i.jsx)(n.a,{href:"/empowernow_docs/docs/services/pdp/explanation/policy_author_guide",children:"policy_author_guide.md"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Updated automatically:"})," keep this file in sync with the YAMLPolicyParser & ConditionParser."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-file-skeleton",children:"1. File Skeleton"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'id: example-policy\r\nname: Human-readable Name\r\nversion: "1.0"\r\n\r\nsubjects:\r\n  - type: user   # or agent / service / group \u2026\r\n    id: "*"      # wildcard or literal\r\n\r\nrules:\r\n  - id: rule-1\r\n    resource: "document"\r\n    action: "read"\r\n    effect: permit     # permit | deny\r\n    condition: subject.properties.clearance >= resource.properties.classification\r\n    obligations: []    # optional \u2013 see \xa74\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-condition-language",children:"2. Condition Language"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Supported scope"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"subject"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"subject.id == 'alice'"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resource"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resource.type == 'file'"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"action"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"action.name == 'delete'"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"context"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"context.request_ip == '1.1.1.1'"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"environment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"environment.current_time < '18:00:00'"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"operators",children:"Operators"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"==  !=  >  <  >=  <=  IN  NOT IN  LIKE  NOT LIKE  MATCHES  NOT MATCHES"})}),"\n",(0,i.jsxs)(n.p,{children:["Dict-only helpers (not valid in string form): ",(0,i.jsx)(n.code,{children:"contains"}),", ",(0,i.jsx)(n.code,{children:"startswith"}),", ",(0,i.jsx)(n.code,{children:"endswith"}),", ",(0,i.jsx)(n.code,{children:"path_match"}),", ",(0,i.jsx)(n.code,{children:"path_match_any"}),", ",(0,i.jsx)(n.code,{children:"cidr_match"}),", ",(0,i.jsx)(n.code,{children:"ip_range"}),", ",(0,i.jsx)(n.code,{children:"date_range"}),", ",(0,i.jsx)(n.code,{children:"equals_after_type_conversion"}),", ",(0,i.jsx)(n.code,{children:"money_*"}),", ",(0,i.jsx)(n.code,{children:"velocity_within"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Logical connectors: ",(0,i.jsx)(n.code,{children:"AND"}),", ",(0,i.jsx)(n.code,{children:"OR"}),", ",(0,i.jsx)(n.code,{children:"NOT"})]}),"\n",(0,i.jsx)(n.p,{children:"Syntactic sugar:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowIf"}),", ",(0,i.jsx)(n.code,{children:"denyIf"}),", ",(0,i.jsx)(n.code,{children:"when"}),", ",(0,i.jsx)(n.code,{children:"unless"}),", ",(0,i.jsx)(n.code,{children:"exceptIf"}),", ",(0,i.jsx)(n.code,{children:"none"}),", ",(0,i.jsx)(n.code,{children:"all"}),", ",(0,i.jsx)(n.code,{children:"any"}),", ",(0,i.jsx)(n.code,{children:"not"}),", ",(0,i.jsx)(n.code,{children:"If"}),"/",(0,i.jsx)(n.code,{children:"Then"}),"/",(0,i.jsx)(n.code,{children:"Else"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Examples"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"when:\r\n  all:\r\n    - subject.role IN ['manager', 'director']\r\n    - resource.sensitivity <= 2\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-obligations--constraints",children:"3. Obligations & Constraints"}),"\n",(0,i.jsx)(n.p,{children:"Both share the same literal shape \u2013 the evaluator distinguishes by context."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"obligations:\r\n  - id: log_access\r\n    attributes:\r\n      level: detailed\r\nconstraints:\r\n  - id: spend_cap\r\n    type: numeric_limit\r\n    value: 5000\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Put custom data under ",(0,i.jsx)(n.code,{children:"attributes:"})," (obligations) or at top-level except ",(0,i.jsx)(n.code,{children:"id"}),"/",(0,i.jsx)(n.code,{children:"type"})," (constraints)."]}),"\n",(0,i.jsxs)(n.li,{children:["The parser automatically converts ",(0,i.jsx)(n.code,{children:"constraints:"})," inside ",(0,i.jsx)(n.code,{children:"on_permit"})," / ",(0,i.jsx)(n.code,{children:"on_deny"})," to obligation objects."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-effect-mapping-rules",children:"4. Effect mapping rules"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field present"}),(0,i.jsxs)(n.th,{children:["Automatic ",(0,i.jsx)(n.code,{children:"effect"})," value"]})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"allowIf"})}),(0,i.jsx)(n.td,{children:"permit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"denyIf"})}),(0,i.jsx)(n.td,{children:"deny"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"effect"})," missing"]}),(0,i.jsx)(n.td,{children:"permit (default)"})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Guard semantics: Use ",(0,i.jsx)(n.code,{children:"when"})," to guard a rule so that a false condition yields ",(0,i.jsx)(n.code,{children:"not_applicable"}),". Pairing ",(0,i.jsx)(n.code,{children:"allowIf"})," with ",(0,i.jsx)(n.code,{children:"effect: permit"})," acts as an override, not a guard, and can over-permit if the condition is false."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-common-gotchas",children:"5. Common gotchas"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"AND"})," / ",(0,i.jsx)(n.code,{children:"OR"})," ",(0,i.jsx)(n.strong,{children:"not"})," ",(0,i.jsx)(n.code,{children:"&&"})," / ",(0,i.jsx)(n.code,{children:"||"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"is not None"})," is unsupported \u2013 use ",(0,i.jsx)(n.code,{children:"!= None"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Custom subject / resource data must be under ",(0,i.jsx)(n.code,{children:"properties"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Only the five scopes above resolve attributes; ",(0,i.jsx)(n.code,{children:"principal.*"})," or ",(0,i.jsx)(n.code,{children:"ctx.*"})," will be ",(0,i.jsx)(n.code,{children:"None"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Do not use ",(0,i.jsx)(n.code,{children:"conditions"})," (plural). Supported keys are ",(0,i.jsx)(n.code,{children:"condition"})," (singular) or sugar: ",(0,i.jsx)(n.code,{children:"allowIf"})," / ",(0,i.jsx)(n.code,{children:"denyIf"})," / ",(0,i.jsx)(n.code,{children:"when"})," / ",(0,i.jsx)(n.code,{children:"unless"})," / ",(0,i.jsx)(n.code,{children:"exceptIf"}),". The plural key is ignored and will cause rules to behave as unconditional."]}),"\n",(0,i.jsxs)(n.li,{children:["Prefer ",(0,i.jsx)(n.code,{children:"when"}),' for "permit-only-on-match". ',(0,i.jsx)(n.code,{children:"allowIf + effect: permit"})," keeps permit on false and is not a guard."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-cli-helpers",children:"6. CLI Helpers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Validate a policy:  ",(0,i.jsx)(n.code,{children:"python tools/policy_lint.py my_policy.yaml"})]}),"\n",(0,i.jsxs)(n.li,{children:["Pretty-print a Condition: ",(0,i.jsx)(n.code,{children:"ConditionParser.to_natural_language(cond)"})," (Python REPL)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-full-syntax-catalogue-auto-derived",children:"7. Full syntax catalogue (auto-derived)"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["The tables below were generated by scanning ",(0,i.jsx)(n.code,{children:"YAMLPolicyParser"}),", ",(0,i.jsx)(n.code,{children:"ConditionParser"}),", ",(0,i.jsx)(n.code,{children:"ExpressionEvaluator"})," and the Pydantic models.  If you add an operator/field in code, regenerate this file."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"71-rule-level-keys",children:"7.1 Rule-level keys"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Key"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["Defaults to ",(0,i.jsx)(n.code,{children:"resource:action"})," if omitted"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"description"})}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"free-text"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resource"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"yes"})}),(0,i.jsxs)(n.td,{children:["string (",(0,i.jsx)(n.code,{children:'"doc"'}),") or dict ",(0,i.jsx)(n.code,{children:"{type,id}"}),".  Wildcards with ",(0,i.jsx)(n.code,{children:"*"})," supported"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"action"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"yes"})}),(0,i.jsxs)(n.td,{children:["string or list.  Wildcard ",(0,i.jsx)(n.code,{children:"*"})," allowed"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"effect"})}),(0,i.jsx)(n.td,{children:"auto"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"permit"})," / ",(0,i.jsx)(n.code,{children:"deny"}),".  Overridden by sugar fields \u2013 see \xa77.3"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"condition"})}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["structured/dotted expression; may embed ",(0,i.jsx)(n.code,{children:"all/any/not/none"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"allowIf"})," / ",(0,i.jsx)(n.code,{children:"denyIf"})]}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"string / dict / list sugar that sets effect automatically"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"when"})," / ",(0,i.jsx)(n.code,{children:"unless"})," / ",(0,i.jsx)(n.code,{children:"exceptIf"})]}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["logical sugar wrappers (",(0,i.jsx)(n.code,{children:"when"})," acts as a guard; false \u2192 ",(0,i.jsx)(n.code,{children:"not_applicable"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"If"})," / ",(0,i.jsx)(n.code,{children:"Then"})," / ",(0,i.jsx)(n.code,{children:"Else"})]}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["branching sugar (",(0,i.jsx)(n.code,{children:"If"})," expression evaluated \u2192 chooses Then/Else sub-rule)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"on_permit"})," / ",(0,i.jsx)(n.code,{children:"on_deny"})]}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["obligations ",(0,i.jsx)(n.strong,{children:"or"})," constraints; parser normalises"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"conditions"})}),(0,i.jsx)(n.td,{children:"\u2014"}),(0,i.jsxs)(n.td,{children:["Unsupported alias. Use ",(0,i.jsx)(n.code,{children:"condition"})," or sugar (",(0,i.jsx)(n.code,{children:"allowIf"}),"/",(0,i.jsx)(n.code,{children:"denyIf"}),"/",(0,i.jsx)(n.code,{children:"when"}),"/",(0,i.jsx)(n.code,{children:"unless"}),"/",(0,i.jsx)(n.code,{children:"exceptIf"}),")."]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"72-syntactic-sugar--effect-resolution",children:"7.2 Syntactic-sugar \u2192 effect resolution"}),"\n",(0,i.jsx)(n.p,{children:"Priority (high \u2192 low):"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowIf"})," sets effect ",(0,i.jsx)(n.strong,{children:"permit"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"denyIf"}),"  sets effect ",(0,i.jsx)(n.strong,{children:"deny"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"effect:"})," explicit value (if neither sugar present)"]}),"\n",(0,i.jsxs)(n.li,{children:["default ",(0,i.jsx)(n.strong,{children:"permit"})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"when"})," to gate rule applicability. If ",(0,i.jsx)(n.code,{children:"when"})," is false, the rule is ",(0,i.jsx)(n.code,{children:"not_applicable"})," and contributes no decision."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"73-supported-operators-string-form",children:"7.3 Supported operators (string form)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"==  !=  >  <  >=  <=  IN  NOT IN  LIKE  NOT LIKE  MATCHES  NOT MATCHES"})}),"\n",(0,i.jsxs)(n.p,{children:["Special operators exposed by ",(0,i.jsx)(n.code,{children:"ExpressionEvaluator"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path_match"})," / ",(0,i.jsx)(n.code,{children:"path_match_any"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"money_equals"})," / ",(0,i.jsx)(n.code,{children:"money_greater_than"})," \u2026 (prefixed ",(0,i.jsx)(n.code,{children:"money_"}),")"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"velocity_within"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cidr_match"}),", ",(0,i.jsx)(n.code,{children:"ip_range"}),", ",(0,i.jsx)(n.code,{children:"date_range"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Time / environment shorthands (",(0,i.jsx)(n.code,{children:"TIME_OPERATORS"}),"):\r\n",(0,i.jsx)(n.code,{children:"during_business_hours"}),", ",(0,i.jsx)(n.code,{children:"on_weekday"}),", ",(0,i.jsx)(n.code,{children:"on_weekend"}),", ",(0,i.jsx)(n.code,{children:"after_date"}),", ",(0,i.jsx)(n.code,{children:"before_date"}),", ",(0,i.jsx)(n.code,{children:"after_time"}),", ",(0,i.jsx)(n.code,{children:"before_time"})]}),"\n",(0,i.jsx)(n.h3,{id:"74-attribute-scopes",children:"7.4 Attribute scopes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scope"}),(0,i.jsx)(n.th,{children:"Resolved by"}),(0,i.jsx)(n.th,{children:"Example path"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"subject"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_get_subject_attribute"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"subject.properties.role"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resource"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_get_resource_attribute"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resource.type"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"action"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_get_action_attribute"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"action.name"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"context"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_get_context_attribute"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"context.request_ip"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"environment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_get_environment_attribute"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"environment.current_time"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"75-dynamic-subjects",children:"7.5 Dynamic subjects"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"subjects:\r\n  - where: subject.properties.roles IN ['admin','manager']\r\n  - type: group\r\n    id: sales\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"where:"})," value is parsed by ",(0,i.jsx)(n.strong,{children:"ConditionParser"})," identically to rule conditions."]}),"\n",(0,i.jsx)(n.h3,{id:"76-path-attribute-matching",children:"7.6 Path-attribute matching"}),"\n",(0,i.jsxs)(n.p,{children:["Policies may declare path attribute patterns (see ",(0,i.jsx)(n.code,{children:"policy.path_attributes"}),") and use:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"condition: resource.properties.full_path MATCHES path_attr_downloads\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Internally ",(0,i.jsx)(n.code,{children:"MATCHES"})," resolves the right-hand side against ",(0,i.jsx)(n.code,{children:"resource.path_attributes"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Note: Prefer the ",(0,i.jsx)(n.code,{children:"MATCHES path_attr_name"})," form in ",(0,i.jsx)(n.code,{children:"condition"}),"/sugar. A ",(0,i.jsx)(n.code,{children:"path_conditions:"})," helper exists in the evaluator for advanced cases, but ",(0,i.jsx)(n.code,{children:"MATCHES"})," is the supported, portable way and maps cleanly to the path-attribute schema."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"81-guarded-permits--examples-and-alternatives",children:"8.1 Guarded permits \u2014 examples and alternatives"}),"\n",(0,i.jsx)(n.h3,{id:"anti-pattern-over-permitting",children:"Anti-pattern (over-permitting)"}),"\n",(0,i.jsxs)(n.p,{children:["False condition \u2192 base effect stays ",(0,i.jsx)(n.code,{children:"permit"}),"; rule still permits."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Avoid: allowIf + effect: permit (override, not guard)\r\n- description: "EntraID user forms"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "permit"\r\n  allowIf: "resource.properties.resource_id in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"recommended-true-guard",children:"Recommended (true guard)"}),"\n",(0,i.jsxs)(n.p,{children:["True \u2192 permit; false \u2192 ",(0,i.jsx)(n.code,{children:"not_applicable"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'- description: "EntraID user forms (guarded)"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "permit"\r\n  when: "resource.properties.resource_id in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"alternatives",children:"Alternatives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Default-deny and open on match:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'- description: "EntraID user forms (default deny)"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "deny"\r\n  allowIf: "resource.properties.resource_id in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Default-permit but explicitly deny non-listed:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'- description: "EntraID user forms (deny negative)"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "permit"\r\n  denyIf: "resource.properties.resource_id not in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"lint-suggestion",children:"Lint suggestion"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Flag ",(0,i.jsx)(n.code,{children:"allowIf"})," present with ",(0,i.jsx)(n.code,{children:"effect: permit"})," unless waived; suggest using ",(0,i.jsx)(n.code,{children:"when"})," or flipping base ",(0,i.jsx)(n.code,{children:"effect"})," to ",(0,i.jsx)(n.code,{children:"deny"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"testing-checklist",children:"Testing checklist"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Positive: matching id \u2192 permit via this rule."}),"\n",(0,i.jsxs)(n.li,{children:["Negative: non-matching id \u2192 rule ",(0,i.jsx)(n.code,{children:"not_applicable"}),"; final allow only if another rule permits; otherwise deny."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"77-constraints-vs-obligations-cheat-sheet",children:"7.7 Constraints vs Obligations cheat-sheet"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Meaning in evaluator"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"_constraint: true"})," (auto)"]}),(0,i.jsxs)(n.td,{children:["Parser marks items that originated in ",(0,i.jsx)(n.code,{children:"constraints:"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"type:"})}),(0,i.jsxs)(n.td,{children:["Semantic classifier (",(0,i.jsx)(n.code,{children:"numeric_limit"}),", ",(0,i.jsx)(n.code,{children:"geo_restriction"}),", \u2026)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Arbitrary keys"}),(0,i.jsxs)(n.td,{children:["land in ",(0,i.jsx)(n.code,{children:"attributes"})," (oblig.) or ",(0,i.jsx)(n.code,{children:"parameters"})," (constraint model)"]})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"8-effect-of-placeholders--templates",children:"8. Effect of placeholders / templates"}),"\n",(0,i.jsxs)(n.p,{children:["Strings wrapped in ",(0,i.jsx)(n.code,{children:"{{ \u2026 }}"})," are ",(0,i.jsx)(n.strong,{children:"not"})," evaluated by PDP; they are just carried through to the caller (IdP or downstream PEP) for later substitution."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"9-regeneration-instructions",children:"9. Regeneration instructions"}),"\n",(0,i.jsxs)(n.p,{children:["Run ",(0,i.jsx)(n.code,{children:"python tools/update_cheatsheet.py"})," ",(0,i.jsx)(n.em,{children:"(TODO)"})," after changing parser code to refresh operators & field lists."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["Generated ",(0,i.jsx)(n.code,{children:"{{date}}"})," by docs maintainers."]})}),"\n",(0,i.jsx)(n.h2,{id:"10-combining-algorithm--defaults",children:"10. Combining algorithm & defaults"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Situation"}),(0,i.jsx)(n.th,{children:"Result"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"Any"})," rule with ",(0,i.jsx)(n.code,{children:"effect: deny"})," or ",(0,i.jsx)(n.code,{children:"denyIf"})," evaluates ",(0,i.jsx)(n.em,{children:"true"})]}),(0,i.jsxs)(n.td,{children:["Final decision = ",(0,i.jsx)(n.strong,{children:"DENY"})," (deny-override)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["At least one permit rule matches, ",(0,i.jsx)(n.strong,{children:"no"})," deny matches"]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"PERMIT"})," (permit or permit_with_obligations)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"No rule matches"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"DENY"})," (implicit)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Mixed ",(0,i.jsx)(n.code,{children:"not_applicable"})," only"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"DENY"})})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Evaluator class: ",(0,i.jsx)(n.code,{children:"PolicyEvaluator._combine_decisions"})," implements the deny-override logic."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"11-constraint--obligation-catalogue--built-ins",children:"11. Constraint & obligation catalogue  (built-ins)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"ID / type"}),(0,i.jsx)(n.th,{children:"Kind"}),(0,i.jsx)(n.th,{children:"Key parameters"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"numeric_limit"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"value: int"})," (maximum)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"geo_restriction"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"value: [ISO-country-codes]"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"velocity_limit"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"parameters.count"}),", ",(0,i.jsx)(n.code,{children:"parameters.window_minutes"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"time_restriction"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"parameters.start"}),", ",(0,i.jsx)(n.code,{children:"parameters.end"}),", ",(0,i.jsx)(n.code,{children:"parameters.timezone"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"scope_downgrade"})," / ",(0,i.jsx)(n.code,{children:"scope_restriction"})]}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"parameters.downgraded"})," / ",(0,i.jsx)(n.code,{children:"allowed_scopes"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"device_binding"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"value: device_hash"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ip_restriction"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"value: [CIDR]"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"trust_threshold"})}),(0,i.jsx)(n.td,{children:"constraint"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"value: int"})," (0-100)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"(add your custom)"})}),(0,i.jsx)(n.td,{children:"obligation/constraint"}),(0,i.jsxs)(n.td,{children:["any \u2013 evaluator treats unknown ",(0,i.jsx)(n.code,{children:"type"})," as custom"]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Criticality enum"})," (obligations): ",(0,i.jsx)(n.code,{children:"critical | high | medium | low"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"12-context-contract-caller--pdp",children:"12. Context contract (caller \u2192 PDP)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsonc",children:'{\r\n  "subject": { "id": "\u2026", "type": "user", "properties": {"roles": ["admin"]} },\r\n  "resource": { \r\n    "id": "\u2026", \r\n    "type": "document", \r\n    "properties": {\r\n      "classification": "secret",\r\n      "pdp_application": "my-app"    // Application-scoped policy targeting\r\n    }\r\n  },\r\n  "action":   { "name": "read", "properties": {} },\r\n  "context": {\r\n    "attributes": { "delegator_id": "pers_123" },\r\n    "request_ip": "203.0.113.42",\r\n    "timestamp": "2025-05-02T12:34:56Z"\r\n  }\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["All additional data should be nested under ",(0,i.jsx)(n.code,{children:"context.attributes"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"application-scoped-policy-loading",children:"Application-Scoped Policy Loading"}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"resource.properties.pdp_application"})," is provided:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": Loads only relevant application policies vs. all global policies"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Isolation"}),": Applications get their specific policy set"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Hierarchy"}),": 5-level inheritance (Global \u2192 Domain \u2192 Application)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fallback"}),": Missing field falls back to global policy loading"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"policies/\r\n\u251c\u2500\u2500 global/                    # Level 5: Fallback policies\r\n\u251c\u2500\u2500 domains/my-domain/\r\n\u2502   \u251c\u2500\u2500 shared/               # Level 4: Domain shared\r\n\u2502   \u251c\u2500\u2500 cross-environment/    # Level 3: Cross-environment  \r\n\u2502   \u2514\u2500\u2500 environments/prod/    # Level 2: Domain + environment\r\n\u2514\u2500\u2500 applications/my-app/      # Level 1: Application specific (highest priority)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"13-path-attribute-schema--example",children:"13. Path-attribute schema & example"}),"\n",(0,i.jsx)(n.p,{children:"Path attributes allow reuse of regex/glob patterns."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'path_attributes:\r\n  - name: doc_path            # required, unique per policy\r\n    type: path                # reserved keyword\r\n    patterns:                 # list of glob/regex strings\r\n      - "/docs/*.pdf"\r\n      - "/reports/**/*.xlsx"\r\n    description: "Public & internal docs"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["A rule can then reference the attribute via ",(0,i.jsx)(n.code,{children:"MATCHES"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'- resource: document\r\n  action: view\r\n  effect: permit\r\n  when: "resource.properties.full_path MATCHES doc_path"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"14-machine-readable-schema",children:"14. Machine-readable schema"}),"\n",(0,i.jsxs)(n.p,{children:["\u2022 JSON-Schema: ",(0,i.jsx)(n.code,{children:"schema/policy.schema.json"}),(0,i.jsx)(n.br,{}),"\n","\u2022 Condition sub-schema: ",(0,i.jsx)(n.code,{children:"schema/condition.schema.json"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["(Schemas generated by ",(0,i.jsx)(n.code,{children:"tools/generate_schema.py"})," \u2013 regenerate on parser changes)."]})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);