"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2478],{28453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var s=i(96540);const r={},l=s.createContext(r);function d(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(l.Provider,{value:n},e.children)}},48401:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"services/experience/plugin_guide","title":"Experience Plugin Development Guide (Step-by-Step)","description":"Author, configure, deploy, and verify an Experience plugin end-to-end \u2014 including BFF config, SPA wiring, PDP gating, and E2E checks.","source":"@site/docs/services/experience/plugin_guide.md","sourceDirName":"services/experience","slug":"/services/experience/plugin_guide","permalink":"/empowernow_docs/docs/services/experience/plugin_guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/experience/plugin_guide.md","tags":[],"version":"current","frontMatter":{"title":"Experience Plugin Development Guide (Step-by-Step)","sidebar_label":"Plugin Dev Guide","description":"Author, configure, deploy, and verify an Experience plugin end-to-end \u2014 including BFF config, SPA wiring, PDP gating, and E2E checks."},"sidebar":"tutorialSidebar","previous":{"title":"Plugin Starter","permalink":"/empowernow_docs/docs/services/experience/plugin-starter"},"next":{"title":"Plugins Storage & Deployment","permalink":"/empowernow_docs/docs/services/experience/plugins-storage-deployment"}}');var r=i(74848),l=i(28453);const d={title:"Experience Plugin Development Guide (Step-by-Step)",sidebar_label:"Plugin Dev Guide",description:"Author, configure, deploy, and verify an Experience plugin end-to-end \u2014 including BFF config, SPA wiring, PDP gating, and E2E checks."},c=void 0,o={},t=[{value:"Overview",id:"overview",level:3},{value:"1) Author your plugin bundle",id:"1-author-your-plugin-bundle",level:3},{value:"2) Declare the plugin in ServiceConfigs",id:"2-declare-the-plugin-in-serviceconfigs",level:3},{value:"3) BFF integration (already wired)",id:"3-bff-integration-already-wired",level:3},{value:"4) SPA integration (already wired)",id:"4-spa-integration-already-wired",level:3},{value:"5) Configure environment variables",id:"5-configure-environment-variables",level:3},{value:"6) Deploy",id:"6-deploy",level:3},{value:"7) Verify",id:"7-verify",level:3},{value:"8) E2E tests (Playwright)",id:"8-e2e-tests-playwright",level:3},{value:"9) Troubleshooting checklist",id:"9-troubleshooting-checklist",level:3},{value:"10) Example end-to-end flow (quick demo)",id:"10-example-end-to-end-flow-quick-demo",level:3},{value:"See also",id:"see-also",level:3}];function a(e){const n={code:"code",h3:"h3",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["This step\u2011by\u2011step focuses on wiring and verification. For the shortest path, start with the Quickstart ",(0,r.jsx)(n.code,{children:"./quickstart"}),". For full architecture and ops, see the canonical reference ",(0,r.jsx)(n.code,{children:"./experience_plugins"}),". It assumes the reader understands why a CSP\u2011safe, same\u2011origin plugin model is needed:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Many vendor "extension" models require cross\u2011origin scripts or iframes which weaken CSP and make per\u2011plugin governance hard'}),"\n",(0,r.jsx)(n.li,{children:"UI\u2011only extensions often bypass centralized authorization; we pre\u2011gate via AuthZEN decisions before mounting"}),"\n",(0,r.jsxs)(n.li,{children:["Experience enforces per\u2011plugin allow\u2011lists and rate limits in the BFF and stamps ",(0,r.jsx)(n.code,{children:"X\u2011Plugin\u2011Id"})," for auditability"]}),"\n"]}),"\n",(0,r.jsx)(n.mermaid,{value:"flowchart LR\r\n  A[Author plugin ESM bundle] --\x3e B[Declare manifest in ServiceConfigs]\r\n  B --\x3e C[BFF serves manifests + bundles]\r\n  C --\x3e D[SPA discovers manifests]\r\n  D --\x3e E[PDP pre\u2011gate: /access/v1/evaluations]\r\n  E --\x3e|allow| F[Import bundle via /api/plugins/bundle]\r\n  F --\x3e G[Render routes/widgets]\r\n  E --\x3e|deny| H[Not mounted]"}),"\n",(0,r.jsx)(n.h3,{id:"1-author-your-plugin-bundle",children:"1) Author your plugin bundle"}),"\n",(0,r.jsx)(n.p,{children:"Goal: produce an ESM module that exports component records for routes/widgets."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Minimal ESM (hello plugin) example:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// hello-plugin.js (must be same-origin; served by BFF bundle proxy)\r\nconst React = (window && window.React) || undefined;\r\n\r\nconst Hello = () =>\r\n  React ? React.createElement('div', { className: 'glass-card p-4' }, 'Hello Plugin') : null;\r\n\r\nexport const routes = { Hello };\r\nexport const widgets = {}; // or { HelloWidget }\r\n\r\nexport default { routes, widgets };\n"})}),"\n",(0,r.jsx)(n.p,{children:"Notes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The loader imports same-origin via ",(0,r.jsx)(n.code,{children:"/api/plugins/bundle?entry={id}&id={id}"})," to preserve CSP ",(0,r.jsx)(n.code,{children:"script-src 'self'"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Bundle should not fetch external dependencies during import."}),"\n",(0,r.jsxs)(n.li,{children:["Keep code size small and avoid heavy peer deps; the host supplies ",(0,r.jsx)(n.code,{children:"window.React"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Subject normalization (AuthZEN): When evaluating permissions from the SPA, use the canonical subject shape ",(0,r.jsx)(n.code,{children:"{ type: 'account', id: 'auth:account:{provider}:{user_id}' }"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"2-declare-the-plugin-in-serviceconfigs",children:"2) Declare the plugin in ServiceConfigs"}),"\n",(0,r.jsxs)(n.p,{children:["Create/update ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'tenants:\r\n  experience.ocg.labs.empowernow.ai:\r\n    - id: hello\r\n      version: "1.0.0"\r\n      engine:\r\n        experience: ">=1.0.0"\r\n      # integrity: "sha256:<optional_hex_hash>"  # adds bundle integrity checking\r\n      permissions:\r\n        api:\r\n          - method: GET\r\n            path: /api/plugins/secure-echo\r\n          - method: POST\r\n            path: /api/plugins/telemetry\r\n        sse: []\r\n      contributions:\r\n        routes:\r\n          - path: /hello\r\n            component: Hello\r\n            resource: plugin.route\r\n            action: view\r\n        widgets: []\n'})}),"\n",(0,r.jsx)(n.p,{children:"Key fields:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tenants"}),": host-based scoping for multi-tenant."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"engine.experience"}),": semver range; SPA checks against ",(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_VERSION"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"permissions"}),": API and SSE allow-lists enforced in BFF middleware."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"contributions.routes|widgets"}),": component mapping and optional PDP hints."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-bff-integration-already-wired",children:"3) BFF integration (already wired)"}),"\n",(0,r.jsx)(n.p,{children:"Touch points:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"ms_bff_spike/ms_bff/src/api/v1/endpoints/plugins.py"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/plugins/manifests"}),": reads manifests from ",(0,r.jsx)(n.code,{children:"plugins.yaml"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/plugins/bundle?entry={id}&id={id}"}),": serves ESM bundle, sets ",(0,r.jsx)(n.code,{children:"ETag"}),", ",(0,r.jsx)(n.code,{children:"Cache-Control"}),", and verifies optional sha256."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/plugins/refresh"}),": reloads registry from disk."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/plugins/telemetry"}),": ingests plugin telemetry (counts)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"ms_bff_spike/ms_bff/src/services/plugin_registry.py"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Loads ",(0,r.jsx)(n.code,{children:"plugins.yaml"})," and provides manifests and integrity hints."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Middleware enforcement:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ms_bff_spike/ms_bff/src/middleware/plugin_enforcer.py"}),": enforces allow-lists for API and SSE with ",(0,r.jsx)(n.code,{children:"X-Plugin-Id"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ms_bff_spike/ms_bff/src/middleware/rate_limit_plugin.py"}),": per-plugin rate limiting."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["No changes needed for new plugins; BFF reads from ",(0,r.jsx)(n.code,{children:"plugins.yaml"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Security notes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Per\u2011plugin allow\u2011lists cover API and SSE routes; violations return 403 and are logged"}),"\n",(0,r.jsxs)(n.li,{children:["Optional integrity hash (",(0,r.jsx)(n.code,{children:"sha256"}),") ensures tamper\u2011evident bundles in production"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-spa-integration-already-wired",children:"4) SPA integration (already wired)"}),"\n",(0,r.jsx)(n.p,{children:"Touch points:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"experience/frontend/src/plugins/loader.ts"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Imports bundles via ",(0,r.jsx)(n.code,{children:"/api/plugins/bundle"})," and enforces semver with ",(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_VERSION"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"experience/frontend/src/plugins/DynamicRoutes.tsx"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Discovers manifests \u2192 batch PDP pre-gates via ",(0,r.jsx)(n.code,{children:"/access/v1/evaluations"})," \u2192 mounts allowed routes."]}),"\n",(0,r.jsxs)(n.li,{children:["Wraps plugin routes in ",(0,r.jsx)(n.code,{children:"PluginErrorBoundary"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Denied routes are not mounted; widgets hidden"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"experience/frontend/src/pages/Dashboard.tsx"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Loads plugin widgets \u2192 batch PDP pre-gates \u2192 renders allowed widgets."}),"\n",(0,r.jsxs)(n.li,{children:["Wraps widget renders in ",(0,r.jsx)(n.code,{children:"PluginErrorBoundary"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"experience/frontend/src/plugins/sdk.ts"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Stamps ",(0,r.jsx)(n.code,{children:"X-Plugin-Id"}),", has ",(0,r.jsx)(n.code,{children:"sse.unsubscribeAll"}),", sends fire-and-forget telemetry for API calls/errors."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"experience/frontend/src/plugins/registry.ts"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Shared loader cache for routes & widgets."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"experience/frontend/src/main.tsx"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Exposes ",(0,r.jsx)(n.code,{children:"window.React"})," for same-origin plugin bundles."]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"})," (optional)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_VERSION"})," (e.g. ",(0,r.jsx)(n.code,{children:"1.0.0"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"5-configure-environment-variables",children:"5) Configure environment variables"}),"\n",(0,r.jsxs)(n.p,{children:["In the Experience SPA ",(0,r.jsx)(n.code,{children:"env.local"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"}),": '' (same-origin) or ",(0,r.jsx)(n.code,{children:"https://bff.host"})," (for dev)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_VERSION"}),": ",(0,r.jsx)(n.code,{children:"1.0.0"})," (used for plugin semver checks)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"BFF environment:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"config/"})," points to ServiceConfigs (already standard)."]}),"\n",(0,r.jsxs)(n.li,{children:["If needed, mount ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config"})," into ",(0,r.jsx)(n.code,{children:"/app/config"})," in your compose."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"6-deploy",children:"6) Deploy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure Traefik routes the Experience host to the SPA container (static) and to BFF for ",(0,r.jsx)(n.code,{children:"/api/**"})," and streams."]}),"\n",(0,r.jsxs)(n.li,{children:["Copy your ",(0,r.jsx)(n.code,{children:"hello-plugin.js"})," code into BFF\u2019s bundle handler (for demo we inline). In a production setup you can:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Serve from BFF filesystem or dynamically from a registry but always via ",(0,r.jsx)(n.code,{children:"/api/plugins/bundle"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"plugins.yaml"}),", then call:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/plugins/refresh"})," to reload at runtime."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Operational guidance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Monitor plugin errors via telemetry endpoint; set per\u2011plugin rate limits conservatively at first"}),"\n",(0,r.jsxs)(n.li,{children:["Keep a runbook entry for quickly disabling a plugin by id in ",(0,r.jsx)(n.code,{children:"plugins.yaml"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"7-verify",children:"7) Verify"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["GET ",(0,r.jsx)(n.code,{children:"https://experience.ocg.labs.empowernow.ai/api/plugins/manifests"})," returns the ",(0,r.jsx)(n.code,{children:"hello"})," manifest (requires correct Host)."]}),"\n",(0,r.jsxs)(n.li,{children:["Navigate to ",(0,r.jsx)(n.code,{children:"/hello"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PDP batch check should allow (by default), route renders \u201cHello Plugin\u201d."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Call ",(0,r.jsx)(n.code,{children:"/api/plugins/secure-echo"})," without ",(0,r.jsx)(n.code,{children:"X-Plugin-Id"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Should return 403 (middleware enforcement)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["With ",(0,r.jsx)(n.code,{children:"X-Plugin-Id: hello"}),", call ",(0,r.jsx)(n.code,{children:"/api/plugins/secure-echo"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Should return 200 with plugin echo payload."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"8-e2e-tests-playwright",children:"8) E2E tests (Playwright)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Example test (already added):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ms_bff_spike/e2e/plugin-hello.spec.ts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verifies ",(0,r.jsx)(n.code,{children:"/hello"})," renders."]}),"\n",(0,r.jsx)(n.li,{children:"Verifies API enforcement (403 without header)."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To run E2E locally (example):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure the stack is running and DNS/hosts map ",(0,r.jsx)(n.code,{children:"experience.ocg.labs.empowernow.ai"})," to your Traefik gateway."]}),"\n",(0,r.jsx)(n.li,{children:"From repo root (or Playwright config path), run:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# PowerShell: adjust to your setup\r\npwsh -NoProfile -Command "cd ms_bff_spike; npx playwright test e2e/plugin-hello.spec.ts"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"9-troubleshooting-checklist",children:"9) Troubleshooting checklist"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Manifest not loaded:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check Host header; ensure ",(0,r.jsx)(n.code,{children:"plugins.yaml"})," has the correct tenant host."]}),"\n",(0,r.jsxs)(n.li,{children:["Call ",(0,r.jsx)(n.code,{children:"/api/plugins/refresh"})," after updating ",(0,r.jsx)(n.code,{children:"plugins.yaml"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Route not rendering:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check PDP decisions (batch pre-gate). Ensure ",(0,r.jsx)(n.code,{children:"/access/v1/evaluations"})," is reachable and returns allow."]}),"\n",(0,r.jsxs)(n.li,{children:["Confirm ",(0,r.jsx)(n.code,{children:"engine.experience"})," satisfies ",(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_VERSION"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"403 when calling plugin APIs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"X-Plugin-Id"})," header is present from the plugin SDK."]}),"\n",(0,r.jsxs)(n.li,{children:["Check ",(0,r.jsx)(n.code,{children:"permissions.api"})," allow-list covers the method and path."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"CSP violations:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure bundle loaded from ",(0,r.jsx)(n.code,{children:"/api/plugins/bundle"})," (same-origin only). No external URLs."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"10-example-end-to-end-flow-quick-demo",children:"10) Example end-to-end flow (quick demo)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Add this manifest to ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"})," under your tenant (shown earlier)."]}),"\n",(0,r.jsx)(n.li,{children:"Reload registry:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# curl example\r\ncurl -X POST https://experience.ocg.labs.empowernow.ai/api/plugins/refresh\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.code,{children:"https://experience.ocg.labs.empowernow.ai/hello"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Expected: \u201cHello Plugin\u201d glass card."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Verify enforcement:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Without header -> 403\r\ncurl -i https://experience.ocg.labs.empowernow.ai/api/plugins/secure-echo\r\n\r\n# With header -> 200\r\ncurl -i -H "X-Plugin-Id: hello" https://experience.ocg.labs.empowernow.ai/api/plugins/secure-echo\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This covers all touch points: ServiceConfigs (",(0,r.jsx)(n.code,{children:"plugins.yaml"}),"), BFF routes/middleware/registry, SPA loader/routes/widgets/PDP gating, and test coverage."]}),"\n",(0,r.jsx)(n.h3,{id:"see-also",children:"See also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Experience \u2192 Plugins reference: ./plugins.md"}),"\n",(0,r.jsx)(n.li,{children:"Experience \u2192 React app overview: ./overview.md"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);