"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[1873],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var r=s(96540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}},61509:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"services/bff/explanation/security-model","title":"Security Model","description":"Identity and tokens","source":"@site/docs/services/bff/explanation/security-model.md","sourceDirName":"services/bff/explanation","slug":"/services/bff/explanation/security-model","permalink":"/empowernow_docs/docs/services/bff/explanation/security-model","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/explanation/security-model.md","tags":[],"version":"current","frontMatter":{"title":"Security Model"},"sidebar":"tutorialSidebar","previous":{"title":"Dynamic AI Model Routing \u2014 How It Works","permalink":"/empowernow_docs/docs/services/bff/explanation/llm-dynamic-model-routing"},"next":{"title":"BFF \u2013 FAQ","permalink":"/empowernow_docs/docs/services/bff/reference/amazing-faq"}}');var i=s(74848),o=s(28453);const t={title:"Security Model"},c=void 0,d={},l=[];function a(e){const n={code:"code",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Identity and tokens"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["End-user identity is established from the OIDC ID token (or UserInfo) at login; the BFF stores ",(0,i.jsx)(n.code,{children:"user_id = id_token.sub"})," in the session."]}),"\n",(0,i.jsxs)(n.li,{children:["Backend service access tokens used by the BFF are not user identity and remain server-side. Their ",(0,i.jsx)(n.code,{children:"sub"})," commonly equals the OAuth client (e.g., ",(0,i.jsx)(n.code,{children:"bff-server"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"The browser never receives or interprets backend tokens."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Trust boundaries"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Edge (Traefik) \u2194 BFF: session gating via ForwardAuth (",(0,i.jsx)(n.code,{children:"/auth/verify"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"BFF \u2194 Backends: server\u2011side tokens injected; no browser tokens cross the boundary"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Controls"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Session cookie: ",(0,i.jsx)(n.code,{children:"bff_session"})," (HttpOnly, Secure, SameSite=Lax, domain per env)"]}),"\n",(0,i.jsx)(n.li,{children:"Session binding: IP/User\u2011Agent hashing; reject on mismatch; metrics increment on failures"}),"\n",(0,i.jsxs)(n.li,{children:["CSRF: ",(0,i.jsx)(n.code,{children:"_eid_csrf_v1"})," cookie + ",(0,i.jsx)(n.code,{children:"X-CSRF-Token"})," header (HMAC\u2011based); required for state\u2011changing methods"]}),"\n",(0,i.jsx)(n.li,{children:"OAuth2: PKCE + PAR; optional DPoP and mTLS depending on env flags"}),"\n",(0,i.jsxs)(n.li,{children:["ForwardAuth: <1ms session existence check at edge with ",(0,i.jsx)(n.code,{children:"X-Session-ID"}),", ",(0,i.jsx)(n.code,{children:"X-Auth-Time"}),", ",(0,i.jsx)(n.code,{children:"X-Correlation-ID"})]}),"\n",(0,i.jsx)(n.li,{children:"Rate limiting: enforced at Traefik per router (burst/average) and documented in How\u2011to"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Header contracts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["ForwardAuth response headers: ",(0,i.jsx)(n.code,{children:"X-Session-ID"}),", ",(0,i.jsx)(n.code,{children:"X-Auth-Time"}),", ",(0,i.jsx)(n.code,{children:"X-Correlation-ID"})]}),"\n",(0,i.jsxs)(n.li,{children:["Downstream headers to services: always ",(0,i.jsx)(n.code,{children:"X-Correlation-ID"}),"; ",(0,i.jsx)(n.code,{children:"X-Original-User"})," when ARN available; ",(0,i.jsx)(n.code,{children:"Authorization"})," when target requires it"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"What we do not do"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Never expose OAuth tokens to the browser"}),"\n",(0,i.jsx)(n.li,{children:"No WebSockets exposed via BFF (SSE supported)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Evidence and audit"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Kafka topics (see Logging/Events reference): login/logout, session lifecycle, API access"}),"\n",(0,i.jsxs)(n.li,{children:["Metrics: ",(0,i.jsx)(n.code,{children:"bff_verify_duration_seconds"}),", ",(0,i.jsx)(n.code,{children:"traefik_forwardauth_{success,rejected}_total"}),", ",(0,i.jsx)(n.code,{children:"bff_session_binding_failures_total"}),", PDP latency/decisions"]}),"\n",(0,i.jsx)(n.li,{children:"Logs: correlation\u2011id based tracing across edge and BFF"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"FAPI/FIPS posture"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FAPI features: PKCE, PAR, DPoP (middleware), optional enterprise mTLS"}),"\n",(0,i.jsx)(n.li,{children:"FIPS: enabled via hardened OAuth client; see FIPS reference for rollout/evidence"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See also: ",(0,i.jsx)(n.code,{children:"../reference/session-binding-csrf"}),", ",(0,i.jsx)(n.code,{children:"../reference/traefik-forwardauth"}),", ",(0,i.jsx)(n.code,{children:"../reference/fapi-support"}),", ",(0,i.jsx)(n.code,{children:"../reference/fips-140-3"}),", ",(0,i.jsx)(n.code,{children:"../how-to/rate-limiting"})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);