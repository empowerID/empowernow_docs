"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[4767],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var i=s(96540);const l={},r=i.createContext(l);function c(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),i.createElement(r.Provider,{value:n},e.children)}},74471:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"source_content/loopback_mcp_persona_guide","title":"loopback_mcp_persona_guide","description":"Loopback MCP and Tool Catalogue \u2013 Persona Guide","source":"@site/docs/source_content/loopback_mcp_persona_guide.md","sourceDirName":"source_content","slug":"/source_content/loopback_mcp_persona_guide","permalink":"/empowernow_docs/docs/source_content/loopback_mcp_persona_guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/source_content/loopback_mcp_persona_guide.md","tags":[],"version":"current","frontMatter":{}}');var l=s(74848),r=s(28453);const c={},o=void 0,d={},t=[{value:"Loopback MCP and Tool Catalogue \u2013 Persona Guide",id:"loopback-mcp-and-tool-catalogue--persona-guide",level:2},{value:"Architecture overview",id:"architecture-overview",level:3},{value:"Backend developers (CRUDService)",id:"backend-developers-crudservice",level:2},{value:"Virtual views (filtered MCP catalogs)",id:"virtual-views-filtered-mcp-catalogs",level:2},{value:"Frontend developers (Visual Designer and SDK)",id:"frontend-developers-visual-designer-and-sdk",level:2},{value:"SRE / DevOps",id:"sre--devops",level:2},{value:"Security / Authorization",id:"security--authorization",level:2},{value:"QA / Testing",id:"qa--testing",level:2},{value:"External agent integrators",id:"external-agent-integrators",level:2},{value:"Migration notes and limits",id:"migration-notes-and-limits",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"loopback-mcp-and-tool-catalogue--persona-guide",children:"Loopback MCP and Tool Catalogue \u2013 Persona Guide"}),"\n",(0,l.jsx)(n.p,{children:'This guide explains how CRUDService exposes system commands and workflows as MCP tools in\u2011process ("loopback MCP"), how they are discovered/merged by the ToolCatalogue, and how clients (UIs and agents) consume them. It provides role\u2011specific instructions and references.'}),"\n",(0,l.jsx)(n.h3,{id:"architecture-overview",children:"Architecture overview"}),"\n",(0,l.jsx)(n.mermaid,{value:'graph TD\r\n  A["ServiceConfigs YAML<br/>- systems<br/>- workflows"] --\x3e B["CRUDService<br/>Loopback MCP Generator"]\r\n  B --\x3e C["/mcp/tools/list<br/>/mcp/jsonrpc"]\r\n  C --\x3e D["ToolCatalogue<br/>merge built-ins + MCP"]\r\n  D --\x3e E["/tools/list<br/>/tools/search"]\r\n  F["Visual Designer / SDK<br/>Tool Picker"] --\x3e E\r\n  G[External Agents] --\x3e C\r\n  H["BFF /api/crud/* routes"] --\x3e|proxy| C'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"backend-developers-crudservice",children:"Backend developers (CRUDService)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Source of truth"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["System commands: ",(0,l.jsx)(n.code,{children:"config/systems/<system>.yaml"})," (objects.actions/commands)"]}),"\n",(0,l.jsxs)(n.li,{children:["Workflows: ",(0,l.jsx)(n.code,{children:"config/workflows/*.yaml"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Tool generation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Class: ",(0,l.jsx)(n.code,{children:"src/mcp/loopback/generator.py"})]}),"\n",(0,l.jsxs)(n.li,{children:["Naming (deterministic):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Default: namespaced ",(0,l.jsx)(n.code,{children:"provider.instance.base"})," (e.g., ",(0,l.jsx)(n.code,{children:"entra.cont.account.get_by_id"}),", ",(0,l.jsx)(n.code,{children:"ldap.av.account.get_by_dn"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Workflow \u2192 ",(0,l.jsx)(n.code,{children:"workflow.<name>"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"50\u2011char cap with stable hash; fail\u2011fast on pre\u2011cap and final collisions."}),"\n",(0,l.jsxs)(n.li,{children:["Optional Router surface (short names with ",(0,l.jsx)(n.code,{children:"oneOf"}),") disabled by default."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Input schema derivation:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Commands: prefer ",(0,l.jsx)(n.code,{children:"input_schema"}),"; else derive from ",(0,l.jsx)(n.code,{children:"required_params"})," and optional ",(0,l.jsx)(n.code,{children:"input_params"})," hints; fallback ",(0,l.jsx)(n.code,{children:"{ type: object, additionalProperties: true }"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Workflows: prefer top\u2011level ",(0,l.jsx)(n.code,{children:"parameters"})," JSON Schema; else fallback permissive object."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Loopback MCP endpoints (FastAPI)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /mcp/tools/list"})," \u2013 returns ",(0,l.jsx)(n.code,{children:"[ { name, description, inputSchema, source, metadata, title, annotations } ]"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /mcp/{view}/tools/list"})," \u2013 filtered discovery for a virtual view (see Virtual views)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"POST /mcp/jsonrpc"})," \u2013 JSON\u2011RPC 2.0"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"POST /mcp/{view}/jsonrpc"})," \u2013 JSON\u2011RPC within a virtual view (only tools matching the view are callable)","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"tools/list"})," \u2192 ",(0,l.jsx)(n.code,{children:"{ result: { tools: [...] } }"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"tools/invoke"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["System tool \u2192 executes ",(0,l.jsx)(n.code,{children:"CommandExecutor.execute_command_action"})]}),"\n",(0,l.jsxs)(n.li,{children:["Workflow tool \u2192 validates arguments; by default returns ",(0,l.jsx)(n.code,{children:"{ accepted: true }"})," stub"]}),"\n",(0,l.jsxs)(n.li,{children:["Optional direct start behind flag ",(0,l.jsx)(n.code,{children:"MCP_LOOPBACK_WORKFLOW_DIRECT_INVOKE=true"})," (internal ASGI call to ",(0,l.jsx)(n.code,{children:"/workflow/start"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Security and scopes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Discovery requires scope: ",(0,l.jsx)(n.code,{children:"mcp.tools.discovery"})]}),"\n",(0,l.jsxs)(n.li,{children:["Invoke requires scope: ",(0,l.jsx)(n.code,{children:"mcp.tools.invoke"})]}),"\n",(0,l.jsxs)(n.li,{children:["Both enforced in ",(0,l.jsx)(n.code,{children:"src/api/mcp_loopback_routes.py"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"ToolCatalogue merge"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Class: ",(0,l.jsx)(n.code,{children:"src/services/tool_catalogue.py"})]}),"\n",(0,l.jsxs)(n.li,{children:["Always loads built\u2011ins from ",(0,l.jsx)(n.code,{children:"config/tools.yaml"})]}),"\n",(0,l.jsxs)(n.li,{children:["Includes loopback MCP tools when ",(0,l.jsx)(n.code,{children:"config_loader"})," is provided"]}),"\n",(0,l.jsxs)(n.li,{children:["External MCP endpoints (optional) from ",(0,l.jsx)(n.code,{children:"config/mcp_endpoints.yaml"})]}),"\n",(0,l.jsxs)(n.li,{children:["Name constraints: ",(0,l.jsx)(n.code,{children:"ToolInfo.name"})," \u2264 64 chars; long names will be skipped and logged"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Observability"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Structured logs for ",(0,l.jsx)(n.code,{children:"mcp_tools_list_*"})," and ",(0,l.jsx)(n.code,{children:"mcp_jsonrpc_*"})," events with correlation IDs and durations"]}),"\n",(0,l.jsxs)(n.li,{children:["Virtual views discovery emits: ",(0,l.jsx)(n.code,{children:"mcp_views_candidate_paths"}),", ",(0,l.jsx)(n.code,{children:"mcp_views_file_loaded"}),", ",(0,l.jsx)(n.code,{children:"mcp_views_file_not_found"}),", ",(0,l.jsx)(n.code,{children:"mcp_view_fallback_created"}),", and ",(0,l.jsx)(n.code,{children:"mcp_unknown_view"})]}),"\n",(0,l.jsxs)(n.li,{children:["OTEL can be disabled locally: ",(0,l.jsx)(n.code,{children:"OTEL_DISABLED=true"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Feature flags / env"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_LOOPBACK_WORKFLOW_DIRECT_INVOKE=true"})," \u2192 actually invoke ",(0,l.jsx)(n.code,{children:"/workflow/start"})," inside tools/invoke"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_VIRTUAL_SERVERS_FILE"})," \u2192 override path to ",(0,l.jsx)(n.code,{children:"mcp_virtual_servers.yaml"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_ENABLE_ROUTER=true|false"})," \u2192 include optional short-name router tools"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_DUPLICATE_POLICY=fail|keep_first|keep_last|drop"})," \u2192 resolve duplicate tool names deterministically"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_TOOL_NAME_CAP=<int>"})," \u2192 hard cap for generated tool names (helps client-specific limits)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OTEL_DISABLED=true"})," (tests/local)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"virtual-views-filtered-mcp-catalogs",children:"Virtual views (filtered MCP catalogs)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Define filtered subsets of the tool catalog in ",(0,l.jsx)(n.code,{children:"ServiceConfigs/CRUDService/config/mcp_virtual_servers.yaml"})," (override via ",(0,l.jsx)(n.code,{children:"MCP_VIRTUAL_SERVERS_FILE"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Each view creates endpoints under ",(0,l.jsx)(n.code,{children:"/mcp/{view}"})," (",(0,l.jsx)(n.code,{children:"tools/list"}),", ",(0,l.jsx)(n.code,{children:"jsonrpc"}),"). Health tools are always included."]}),"\n",(0,l.jsxs)(n.li,{children:["If the file is missing, sensible fallback views are derived automatically:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"workflows"})," \u2192 ",(0,l.jsx)(n.code,{children:'source: ["workflow"]'})," (router off)"]}),"\n",(0,l.jsxs)(n.li,{children:["provider-based views (e.g., ",(0,l.jsx)(n.code,{children:"entra"}),", ",(0,l.jsx)(n.code,{children:"ldap"}),", ",(0,l.jsx)(n.code,{children:"auth0"}),") \u2192 ",(0,l.jsx)(n.code,{children:"filters.provider=[view]"})," (router on)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Views hot-reload when an unknown view is requested; after reload, internal ",(0,l.jsx)(n.code,{children:"ConfigLoader"})," caches are invalidated so changes to ",(0,l.jsx)(n.code,{children:"mcpInstance"}),"/systems are reflected immediately."]}),"\n",(0,l.jsx)(n.li,{children:"Structured logs document discovery and fallback, as noted above."}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"frontend-developers-visual-designer-and-sdk",children:"Frontend developers (Visual Designer and SDK)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Catalogue APIs"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /api/crud/tools/list?type=builtin|mcp"})," \u2192 list tools (BFF proxies CRUDService ",(0,l.jsx)(n.code,{children:"/tools/list"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /api/crud/tools/search?q=<query>&limit=<n>"})," \u2192 search tools (merged list)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Hooks and service (Visual Designer)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/services/toolService.ts"})," \u2013 ",(0,l.jsx)(n.code,{children:"listTools"}),", ",(0,l.jsx)(n.code,{children:"searchTools"})," returning ",(0,l.jsx)(n.code,{children:"{ name, type, description, func?, metadata }"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/hooks/useTools.ts"})," \u2013 ",(0,l.jsx)(n.code,{children:"useToolList(type?)"}),", ",(0,l.jsx)(n.code,{children:"useToolSearch(q, limit, includeEmpty?)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Tool Picker modal (large catalog ready)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Component: ",(0,l.jsx)(n.code,{children:"visual_designer/frontend/src/components/ToolPicker/index.tsx"})]}),"\n",(0,l.jsx)(n.li,{children:"Features: debounced search, segmented filter (All/Built\u2011in/MCP), endpoint column for MCP, paging (20/50/100), scroll; disables already selected."}),"\n",(0,l.jsxs)(n.li,{children:["Usage: In your editor page, keep a Set of selected tool names, pass ",(0,l.jsx)(n.code,{children:"alreadySelected"}),", and handle ",(0,l.jsx)(n.code,{children:"onSelect(ToolInfo)"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"<ToolPicker\r\n  open={isOpen}\r\n  onClose={() => setOpen(false)}\r\n  onSelect={(t) => addTool(t)}\r\n  alreadySelected={new Set(selected.map(s => s.name))}\r\n/>\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"sre--devops",children:"SRE / DevOps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"BFF routing (proxy to CRUDService MCP)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["File: ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/config/routes.yaml"})]}),"\n",(0,l.jsxs)(n.li,{children:["Added:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /api/crud/mcp/tools/list"})," \u2192 CRUD ",(0,l.jsx)(n.code,{children:"/mcp/tools/list"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"POST /api/crud/mcp/jsonrpc"})," \u2192 CRUD ",(0,l.jsx)(n.code,{children:"/mcp/jsonrpc"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET|POST /api/crud/mcp/*"})," \u2192 CRUD ",(0,l.jsx)(n.code,{children:"/mcp/{path}"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Security middlewares"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["CRUDService exempts ",(0,l.jsx)(n.code,{children:"/mcp/*"})," from CSRF/origin validation for server\u2011side clients; keep BFF session auth on ",(0,l.jsx)(n.code,{children:"/api/crud/*"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Env and resilience"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Disable OTEL locally/tests: ",(0,l.jsx)(n.code,{children:"OTEL_DISABLED=true"})]}),"\n",(0,l.jsxs)(n.li,{children:["Tests may bypass FIPS: ",(0,l.jsx)(n.code,{children:"ALLOW_NONFIPS_FOR_TESTS=true"})]}),"\n",(0,l.jsxs)(n.li,{children:["Naming/identity:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_NAMING_STRATEGY=global_namespace"})," (default). Fallback suffix when identity missing."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_DUPLICATE_POLICY=fail"})," enforces uniqueness (pre\u2011cap and final)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MCP_MAX_TOOLS"})," caps publication; list is deterministic and paginated."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"security--authorization",children:"Security / Authorization"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Scopes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mcp.tools.discovery"})," \u2013 required for listing tools"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mcp.tools.invoke"})," \u2013 required for invoking tools"]}),"\n",(0,l.jsxs)(n.li,{children:["Accepts scopes in ",(0,l.jsx)(n.code,{children:"user.scope"})," or ",(0,l.jsx)(n.code,{children:"normalized_permissions"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"PDP integration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Standard ",(0,l.jsx)(n.code,{children:"/api/crud/*"})," routes continue to go through BFF with PDP guards by configuration."]}),"\n",(0,l.jsx)(n.li,{children:"Loopback MCP runs in CRUDService; use session \u2192 service token flow or rely on BFF proxy with session to enforce policy at the edge."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"qa--testing",children:"QA / Testing"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Unit tests"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["MCP list: ",(0,l.jsx)(n.code,{children:"tests/unit/api/test_mcp_loopback_list.py"})]}),"\n",(0,l.jsxs)(n.li,{children:["MCP invoke: ",(0,l.jsx)(n.code,{children:"tests/unit/api/test_mcp_loopback_invoke.py"})]}),"\n",(0,l.jsxs)(n.li,{children:["ToolCatalogue merge: ",(0,l.jsx)(n.code,{children:"tests/unit/services/test_tool_catalogue_mcp_merge.py"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Integration tests"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Tools routes: ",(0,l.jsx)(n.code,{children:"tests/test_tool_routes.py"})]}),"\n",(0,l.jsxs)(n.li,{children:["MCP endpoints: ",(0,l.jsx)(n.code,{children:"tests/integration/test_mcp_endpoints.py"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Useful env for tests"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"OTEL_DISABLED=true"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ALLOW_NONFIPS_FOR_TESTS=true"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"external-agent-integrators",children:"External agent integrators"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Discovery (choose one)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Direct to CRUDService: ",(0,l.jsx)(n.code,{children:"GET /mcp/tools/list"})]}),"\n",(0,l.jsxs)(n.li,{children:["Via BFF proxy: ",(0,l.jsx)(n.code,{children:"GET /api/crud/mcp/tools/list"})," (session\u2011protected)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Invocation (JSON\u2011RPC 2.0)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Direct: ",(0,l.jsx)(n.code,{children:"POST /mcp/jsonrpc"})]}),"\n",(0,l.jsxs)(n.li,{children:["Via BFF: ",(0,l.jsx)(n.code,{children:"POST /api/crud/mcp/jsonrpc"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Example \u2013 list tools:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'curl -s -H "Authorization: Bearer <token>" \\\r\n  http://crud-service:8000/mcp/tools/list\n'})}),"\n",(0,l.jsx)(n.p,{children:"Example \u2013 invoke a system tool:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'curl -s -H "Authorization: Bearer <token>" \\\r\n  -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "jsonrpc": "2.0",\r\n    "id": "1",\r\n    "method": "tools/invoke",\r\n    "params": { "name": "svc_thing_do", "arguments": { "id": "123" } }\r\n  }\' \\\r\n  http://crud-service:8000/mcp/jsonrpc\n'})}),"\n",(0,l.jsx)(n.p,{children:"Workflow invocation behavior:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Validates arguments against the tool\u2019s JSON Schema"}),"\n",(0,l.jsxs)(n.li,{children:["Default returns ",(0,l.jsx)(n.code,{children:'{ accepted: true, workflow: "<name>", params: {...} }'})]}),"\n",(0,l.jsxs)(n.li,{children:["To start immediately (test/dev), set ",(0,l.jsx)(n.code,{children:"MCP_LOOPBACK_WORKFLOW_DIRECT_INVOKE=true"})," in CRUDService and reuse the same JSON\u2011RPC call"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"migration-notes-and-limits",children:"Migration notes and limits"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Tool name length \u2264 64 (Pydantic validation in ",(0,l.jsx)(n.code,{children:"ToolInfo"}),"); ultra\u2011long names are skipped with a warning."]}),"\n",(0,l.jsx)(n.li,{children:"Workflows missing full structure still emit tools (schema falls back); starting them may require proper definitions."}),"\n",(0,l.jsx)(n.li,{children:"Loopback MCP is always present; external MCP endpoints remain optional and are merged when configured."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);