"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[3427],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var c=i(96540);const s={},t=c.createContext(s);function o(e){const n=c.useContext(t);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),c.createElement(t.Provider,{value:n},e.children)}},61516:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});const c=JSON.parse('{"id":"services/experience/authorization-authzen","title":"Authorization (OpenID AuthZEN via BFF)","description":"Implementation-accurate guidance for SPA/BFF/PDP authorization using OpenID AuthZEN in the Experience app.","source":"@site/docs/services/experience/authorization-authzen.md","sourceDirName":"services/experience","slug":"/services/experience/authorization-authzen","permalink":"/empowernow_docs/docs/services/experience/authorization-authzen","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/experience/authorization-authzen.md","tags":[],"version":"current","frontMatter":{"title":"Authorization (OpenID AuthZEN via BFF)","sidebar_label":"Authorization (AuthZEN)","description":"Implementation-accurate guidance for SPA/BFF/PDP authorization using OpenID AuthZEN in the Experience app."},"sidebar":"tutorialSidebar","previous":{"title":"Plugins API Reference","permalink":"/empowernow_docs/docs/services/experience/api-reference"},"next":{"title":"Authorization","permalink":"/empowernow_docs/docs/services/experience/authorization"}}');var s=i(74848),t=i(28453);const o={title:"Authorization (OpenID AuthZEN via BFF)",sidebar_label:"Authorization (AuthZEN)",description:"Implementation-accurate guidance for SPA/BFF/PDP authorization using OpenID AuthZEN in the Experience app."},r=void 0,a={},l=[{value:"Authorization overview",id:"authorization-overview",level:2},{value:"What we protect (defense in depth)",id:"what-we-protect-defense-in-depth",level:2},{value:"How PDP requests are built",id:"how-pdp-requests-are-built",level:2},{value:"Single decision examples",id:"single-decision-examples",level:2},{value:"Batch decision examples",id:"batch-decision-examples",level:2},{value:"Mapping guidance",id:"mapping-guidance",level:2},{value:"Interpretation and UI behavior",id:"interpretation-and-ui-behavior",level:2},{value:"Error handling",id:"error-handling",level:2},{value:"Performance and caching",id:"performance-and-caching",level:2},{value:"Compliance and invariants",id:"compliance-and-invariants",level:2},{value:"Quick reference (copy\u2011paste)",id:"quick-reference-copypaste",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"authorization-overview",children:"Authorization overview"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Framework: OpenID AuthZEN PDP behind a BFF."}),"\n",(0,s.jsx)(n.li,{children:"Transport: Same\u2011origin requests from SPA \u2192 BFF; BFF preserves AuthZEN paths to PDP."}),"\n",(0,s.jsxs)(n.li,{children:["Endpoints (BFF \u2192 PDP):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"/access/v1/evaluation"})," \u2013 single decision"]}),"\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"/access/v1/evaluations"})," \u2013 batch decisions"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Decision model: PDP returns a boolean decision plus optional obligations and explanations. The SPA must \u201cfail closed\u201d if requests fail."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"what-we-protect-defense-in-depth",children:"What we protect (defense in depth)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Routes/pages: e.g., ",(0,s.jsx)(n.code,{children:"pages:list"})," gated by action ",(0,s.jsx)(n.code,{children:"view_all"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Navigation/menu links: render only if PDP allows for the associated resource/action."}),"\n",(0,s.jsxs)(n.li,{children:["Widgets and in\u2011page actions: e.g., Execute workflow uses ",(0,s.jsx)(n.code,{children:"workflows:execute_shortcut"})," with action ",(0,s.jsx)(n.code,{children:"execute_quick"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Row\u2011level and bulk actions: batch PDP checks for lists/tables; disable/hide controls when denied."}),"\n",(0,s.jsxs)(n.li,{children:["Plugin routes/widgets: plugins declare ",(0,s.jsx)(n.code,{children:"resource"}),"/",(0,s.jsx)(n.code,{children:"action"})," hints; host pre\u2011gates via batch PDP on manifest load and per\u2011render."]}),"\n",(0,s.jsx)(n.li,{children:"API/SSE calls that produce sensitive data: BFF enforces session and adds service tokens; PDP ensures the SPA only renders permitted UI."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-pdp-requests-are-built",children:"How PDP requests are built"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Subject (required):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Source: authenticated session via BFF; sent explicitly for clarity/compliance"}),"\n",(0,s.jsxs)(n.li,{children:["Canonical (enforced): ",(0,s.jsx)(n.code,{children:'subject.type = "account"'}),", ",(0,s.jsx)(n.code,{children:'subject.id = "auth:account:{provider}:{user_id}"'})]}),"\n",(0,s.jsxs)(n.li,{children:["Provider note: ",(0,s.jsx)(n.code,{children:"{provider}"})," is the IdP entry ",(0,s.jsx)(n.code,{children:"provider"})," alias (falls back to entry ",(0,s.jsx)(n.code,{children:"name"}),"). This stabilizes ARNs across audiences that share an issuer (e.g., admin vs CRUD), yielding ",(0,s.jsx)(n.code,{children:"auth:account:empowernow:{user_id}"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Example: ",(0,s.jsx)(n.code,{children:'subject: { type: "account", id: "auth:account:oidc:alice@example.com" }'})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Resource (required):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Shape: ",(0,s.jsx)(n.code,{children:'resource: { type: "<domain>", id: "<identifier>" }'})]}),"\n",(0,s.jsxs)(n.li,{children:["Examples:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Pages list: ",(0,s.jsx)(n.code,{children:'{ type: "pages", id: "list" }'})]}),"\n",(0,s.jsxs)(n.li,{children:["Workflow quick\u2011launch: ",(0,s.jsx)(n.code,{children:'{ type: "workflows", id: "execute_shortcut" }'})]}),"\n",(0,s.jsxs)(n.li,{children:["Task operation: ",(0,s.jsx)(n.code,{children:'{ type: "tasks", id: "<task_id>" }'})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Action (required):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Shape: ",(0,s.jsx)(n.code,{children:'action: { name: "<verb_or_capability>" }'})]}),"\n",(0,s.jsxs)(n.li,{children:["Common names: ",(0,s.jsx)(n.code,{children:"view_all"}),", ",(0,s.jsx)(n.code,{children:"execute_quick"}),", ",(0,s.jsx)(n.code,{children:"start"}),", ",(0,s.jsx)(n.code,{children:"resume"}),", ",(0,s.jsx)(n.code,{children:"complete"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Context (optional but recommended):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Shape: ",(0,s.jsx)(n.code,{children:"context: { ... }"})]}),"\n",(0,s.jsxs)(n.li,{children:["Typical attributes: request metadata (",(0,s.jsx)(n.code,{children:"ip"}),", ",(0,s.jsx)(n.code,{children:"user_agent"}),", ",(0,s.jsx)(n.code,{children:"request_time"}),"); UI or row context (",(0,s.jsx)(n.code,{children:"reason"}),", ",(0,s.jsx)(n.code,{children:"resourceAttributes"}),", ",(0,s.jsx)(n.code,{children:"locations"}),")"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Headers (SPA \u2192 BFF):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Content-Type: application/json"}),", ",(0,s.jsx)(n.code,{children:"X-Requested-With: XMLHttpRequest"}),", ",(0,s.jsx)(n.code,{children:"X-CSRF-Token"})," (when present), ",(0,s.jsx)(n.code,{children:"credentials: include"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"single-decision-examples",children:"Single decision examples"}),"\n",(0,s.jsx)(n.p,{children:"Request body:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "subject": { "type": "account", "id": "auth:account:oidc:alice@example.com" },\n  "resource": { "type": "workflows", "id": "execute_shortcut" },\n  "action": { "name": "execute_quick" },\n  "context": { "ip": "203.0.113.10", "user_agent": "Mozilla/5.0" }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{ "decision": true, "obligations": [], "explanation": { "mermaid": "graph TD; ..." } }\n'})}),"\n",(0,s.jsx)(n.p,{children:"curl:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -sS -X POST https://experience.ocg.labs.empowernow.ai/access/v1/evaluation \\\n  -H "Content-Type: application/json" \\\n  --cookie "bff_session=..." \\\n  --data \'{"subject":{"type":"account","id":"auth:account:oidc:alice@example.com"},"resource":{"type":"workflows","id":"execute_shortcut"},"action":{"name":"execute_quick"},"context":{"ip":"203.0.113.10","user_agent":"Mozilla/5.0"}}\'\n'})}),"\n",(0,s.jsx)(n.p,{children:"Browser fetch:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const csrf = document.cookie.match(/(?:^|; )_csrf_token=([^;]+)/)?.[1] || '';\nconst res = await fetch('/access/v1/evaluation', {\n  method: 'POST',\n  credentials: 'include',\n  headers: { 'Content-Type': 'application/json', 'X-CSRF-Token': csrf, 'X-Requested-With': 'XMLHttpRequest' },\n  body: JSON.stringify({\n    subject: { type: 'account', id: 'auth:account:oidc:alice@example.com' },\n    resource: { type: 'pages', id: 'list' },\n    action: { name: 'view_all' },\n    context: {}\n  })\n});\nconst { decision } = await res.json();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"batch-decision-examples",children:"Batch decision examples"}),"\n",(0,s.jsx)(n.p,{children:"Request body:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "evaluations": [\n    { "subject": { "type": "account", "id": "auth:account:oidc:alice@example.com" }, "resource": { "type": "pages", "id": "list" }, "action": { "name": "view_all" } },\n    { "subject": { "type": "account", "id": "auth:account:oidc:alice@example.com" }, "resource": { "type": "tasks", "id": "task-123" }, "action": { "name": "complete" }, "context": { "reason": "approve" } }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{ "decisions": [ { "decision": true }, { "decision": false, "obligations": [{ "id": "require_mfa", "type": "mfa" }] } ] }\n'})}),"\n",(0,s.jsx)(n.p,{children:"curl:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -sS -X POST https://experience.ocg.labs.empowernow.ai/access/v1/evaluations \\\n  -H "Content-Type: application/json" \\\n  --cookie "bff_session=..." \\\n  --data \'{"evaluations":[{"subject":{"type":"account","id":"auth:account:oidc:alice@example.com"},"resource":{"type":"pages","id":"list"},"action":{"name":"view_all"}},{"subject":{"type":"account","id":"auth:account:oidc:alice@example.com"},"resource":{"type":"tasks","id":"task-123"},"action":{"name":"complete"},"context":{"reason":"approve"}}]}\'\n'})}),"\n",(0,s.jsx)(n.p,{children:"Browser fetch:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const csrf = document.cookie.match(/(?:^|; )_csrf_token=([^;]+)/)?.[1] || '';\nconst resp = await fetch('/access/v1/evaluations', {\n  method: 'POST',\n  credentials: 'include',\n  headers: { 'Content-Type': 'application/json', 'X-CSRF-Token': csrf, 'X-Requested-With': 'XMLHttpRequest' },\n  body: JSON.stringify({\n    evaluations: [\n      { subject: { type: 'account', id: 'auth:account:oidc:alice@example.com' }, resource: { type: 'pages', id: 'list' }, action: { name: 'view_all' } },\n      { subject: { type: 'account', id: 'auth:account:oidc:alice@example.com' }, resource: { type: 'workflows', id: 'execute_shortcut' }, action: { name: 'execute_quick' } }\n    ]\n  })\n});\nconst { decisions } = await resp.json();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"mapping-guidance",children:"Mapping guidance"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Pages: ",(0,s.jsx)(n.code,{children:'resource: { type: "pages", id: "list" }'}),", ",(0,s.jsx)(n.code,{children:'action: { name: "view_all" }'})]}),"\n",(0,s.jsxs)(n.li,{children:["Workflows:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Launch pad/quick run: ",(0,s.jsx)(n.code,{children:'{ type: "workflows", id: "execute_shortcut" }'}),", ",(0,s.jsx)(n.code,{children:'action: { name: "execute_quick" }'})]}),"\n",(0,s.jsxs)(n.li,{children:["Start/resume: ",(0,s.jsx)(n.code,{children:'{ type: "workflow", id: "<workflow_id>" }'}),", action ",(0,s.jsx)(n.code,{children:"start"})," or ",(0,s.jsx)(n.code,{children:"resume"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Tasks: row action complete: ",(0,s.jsx)(n.code,{children:'{ type: "tasks", id: "<task_id>" }'}),", action ",(0,s.jsx)(n.code,{children:"complete"})]}),"\n",(0,s.jsxs)(n.li,{children:["Plugins: routes ",(0,s.jsx)(n.code,{children:'{ type: "plugin.route", id: "<path>" }'}),"; widgets ",(0,s.jsx)(n.code,{children:'{ type: "plugin.widget", id: "<slot_or_name>" }'})," with action ",(0,s.jsx)(n.code,{children:"view"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"interpretation-and-ui-behavior",children:"Interpretation and UI behavior"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"decision: true"})," \u2192 render/enable the affordance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"decision: false"})," \u2192 hide or disable with a clear affordance (tooltip/message)"]}),"\n",(0,s.jsx)(n.li,{children:"Obligations may require extra UX (e.g., MFA) before enabling"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error handling"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SPA: network/JSON errors are treated as deny (fail closed) for protected UI"}),"\n",(0,s.jsxs)(n.li,{children:["BFF: preserves ",(0,s.jsx)(n.code,{children:"/access/v1/*"}),", attaches service token, returns 401 for API calls if no session"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-and-caching",children:"Performance and caching"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Single checks for high\u2011value UI; batch checks for lists/menus/plugins"}),"\n",(0,s.jsx)(n.li,{children:"Short TTL caching in hooks to avoid redundant calls within a view"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"compliance-and-invariants",children:"Compliance and invariants"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Requests include required AuthZEN fields: ",(0,s.jsx)(n.code,{children:"subject"}),", ",(0,s.jsx)(n.code,{children:"action"}),", ",(0,s.jsx)(n.code,{children:"resource"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resource"})," includes both ",(0,s.jsx)(n.code,{children:"type"})," and ",(0,s.jsx)(n.code,{children:"id"}),"; ",(0,s.jsx)(n.code,{children:"action"})," includes ",(0,s.jsx)(n.code,{children:"name"})]}),"\n",(0,s.jsx)(n.li,{children:"SPA never sends tokens; BFF injects service tokens; cookies carry session"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"quick-reference-copypaste",children:"Quick reference (copy\u2011paste)"}),"\n",(0,s.jsx)(n.p,{children:"Endpoints:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"/access/v1/evaluation"})," \u2013 single decision"]}),"\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"/access/v1/evaluations"})," \u2013 batch decisions"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Single request example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "subject": { "type": "account", "id": "auth:account:oidc:alice@example.com" },\n  "resource": { "type": "workflows", "id": "execute_shortcut" },\n  "action": { "name": "execute_quick" },\n  "context": { "ip": "203.0.113.10" }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Batch request example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "evaluations": [\n    {\n      "subject": { "type": "account", "id": "auth:account:oidc:alice@example.com" },\n      "resource": { "type": "pages", "id": "list" },\n      "action": { "name": "view_all" }\n    },\n    {\n      "subject": { "type": "account", "id": "auth:account:oidc:alice@example.com" },\n      "resource": { "type": "plugin.widget", "id": "hello:HelloWidget" },\n      "action": { "name": "view" }\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"What is protected:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Routes (e.g., ",(0,s.jsx)(n.code,{children:"/workflows"}),") via action ",(0,s.jsx)(n.code,{children:"view_all"})," on ",(0,s.jsx)(n.code,{children:"workflows"}),"/",(0,s.jsx)(n.code,{children:"pages"})]}),"\n",(0,s.jsx)(n.li,{children:"Navigation links (hidden when denied)"}),"\n",(0,s.jsxs)(n.li,{children:["Widgets: core and plugin (e.g., ",(0,s.jsx)(n.code,{children:"plugin.widget"})," with ",(0,s.jsx)(n.code,{children:"view"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"SPA behavior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Subject is read from ",(0,s.jsx)(n.code,{children:"/auth/session"})," and injected into all PDP requests"]}),"\n",(0,s.jsxs)(n.li,{children:["On plugin manifest load, the app pre\u2011gates contributed routes/widgets with ",(0,s.jsx)(n.code,{children:"/access/v1/evaluations"})," and mounts only allowed ones"]}),"\n",(0,s.jsx)(n.li,{children:"Hooks fail closed on errors"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);