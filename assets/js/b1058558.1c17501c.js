"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[6811],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var r=i(96540);const s={},o=r.createContext(s);function c(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(o.Provider,{value:n},e.children)}},70207:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"services/nowconnect/how-to/upgrade-rollback","title":"upgrade-rollback","description":"Upgrade and Rollback Guide (HA Safe Sequencing)","source":"@site/docs/services/nowconnect/how-to/upgrade-rollback.md","sourceDirName":"services/nowconnect/how-to","slug":"/services/nowconnect/how-to/upgrade-rollback","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/upgrade-rollback","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/nowconnect/how-to/upgrade-rollback.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"testing-guide","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/testing-guide"},"next":{"title":"architecture","permalink":"/empowernow_docs/docs/services/nowconnect/explanation/architecture"}}');var s=i(74848),o=i(28453);const c={},l=void 0,a={},d=[{value:"Upgrade and Rollback Guide (HA Safe Sequencing)",id:"upgrade-and-rollback-guide-ha-safe-sequencing",level:2},{value:"Upgrade sequencing (minor/patch releases)",id:"upgrade-sequencing-minorpatch-releases",level:3},{value:"Rollback sequencing",id:"rollback-sequencing",level:3},{value:"Visual: shadow \u2192 active rollout",id:"visual-shadow--active-rollout",level:3},{value:"Compatibility",id:"compatibility",level:3},{value:"Backout triggers",id:"backout-triggers",level:3}];function t(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",ol:"ol",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"upgrade-and-rollback-guide-ha-safe-sequencing",children:"Upgrade and Rollback Guide (HA Safe Sequencing)"}),"\n",(0,s.jsxs)(n.p,{children:["This guide describes safe sequencing to upgrade the Cloud Hub and to roll back if needed, with HA mesh modes ",(0,s.jsx)(n.code,{children:"off | shadow | active"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"upgrade-sequencing-minorpatch-releases",children:"Upgrade sequencing (minor/patch releases)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Pre-checks","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Review release notes; verify config compatibility."}),"\n",(0,s.jsx)(n.li,{children:"Ensure Redis healthy; mesh links stable."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"ha.mode: shadow"})," on all hubs."]}),"\n",(0,s.jsxs)(n.li,{children:["Upgrade one hub (blue/green or rolling) and verify:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/readyz"})," = ",(0,s.jsx)(n.code,{children:"ready"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Mesh links established; no increase in ",(0,s.jsx)(n.code,{children:"nowconnect_mesh_link_errors_total"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Upgrade remaining hubs."}),"\n",(0,s.jsxs)(n.li,{children:["Switch ",(0,s.jsx)(n.code,{children:"ha.mode: active"})," on all hubs."]}),"\n",(0,s.jsx)(n.li,{children:"Monitor SLOs and error budgets."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"rollback-sequencing",children:"Rollback sequencing"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"ha.mode: shadow"})," to avoid cross-replica delivery."]}),"\n",(0,s.jsx)(n.li,{children:"Roll back pods to previous image/config."}),"\n",(0,s.jsxs)(n.li,{children:["Verify ",(0,s.jsx)(n.code,{children:"/readyz"})," and mesh health."]}),"\n",(0,s.jsxs)(n.li,{children:["Return ",(0,s.jsx)(n.code,{children:"ha.mode: active"})," when stable."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"visual-shadow--active-rollout",children:"Visual: shadow \u2192 active rollout"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\r\n  participant H1 as Hub A\r\n  participant H2 as Hub B\r\n  participant R as Redis\r\n\r\n  Note over H1,H2: Start in shadow\r\n  H1->>H1: Upgrade image\r\n  H1--\x3e>R: Register (shadow)\r\n  H2->>H2: Upgrade image\r\n  H2--\x3e>R: Register (shadow)\r\n  H1->>H1: Flip to active\r\n  H2->>H2: Flip to active\r\n  H1--\x3e>H2: Mesh cross-replica flow enabled"}),"\n",(0,s.jsx)(n.h3,{id:"compatibility",children:"Compatibility"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Mesh frames are versioned; minor versions are wire-compatible. If a breaking change is planned, upgrade windows will note ordering."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"backout-triggers",children:"Backout triggers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Elevated ",(0,s.jsx)(n.code,{children:"nowconnect_mesh_backpressure_drops_total"})," or link errors."]}),"\n",(0,s.jsx)(n.li,{children:"PDP error bursts with deny-fast impacts."}),"\n",(0,s.jsxs)(n.li,{children:["Redis instability causing ",(0,s.jsx)(n.code,{children:"/readyz"})," degraded in active mode."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}}}]);