"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[1108],{28453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>a});var r=n(96540);const l={},o=r.createContext(l);function s(e){const i=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(o.Provider,{value:i},e.children)}},92646:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"services/pdp/explanation/migration_guide","title":"Migration Guide \u2014 From Global to Application-Scoped Policies","description":"Canonical reference: scopedpolicydesign.md. This guide outlines a safe, incremental path to app-scoped policies.","source":"@site/docs/services/pdp/explanation/migration_guide.md","sourceDirName":"services/pdp/explanation","slug":"/services/pdp/explanation/migration_guide","permalink":"/empowernow_docs/docs/services/pdp/explanation/migration_guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/pdp/explanation/migration_guide.md","tags":[],"version":"current","frontMatter":{}}');var l=n(74848),o=n(28453);const s={},a="Migration Guide \u2014 From Global to Application-Scoped Policies",c={},t=[{value:"Goals",id:"goals",level:2},{value:"Step-by-step plan",id:"step-by-step-plan",level:2},{value:"Authoring tips",id:"authoring-tips",level:2},{value:"Validation &amp; safety",id:"validation--safety",level:2},{value:"Checklist",id:"checklist",level:2},{value:"Before/After examples",id:"beforeafter-examples",level:2},{value:"Before (global-only)",id:"before-global-only",level:3},{value:"After (domain + app)",id:"after-domain--app",level:3}];function d(e){const i={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.header,{children:(0,l.jsx)(i.h1,{id:"migration-guide--from-global-to-application-scoped-policies",children:"Migration Guide \u2014 From Global to Application-Scoped Policies"})}),"\n",(0,l.jsxs)(i.blockquote,{children:["\n",(0,l.jsxs)(i.p,{children:["Canonical reference: ",(0,l.jsx)(i.code,{children:"scoped_policy_design.md"}),". This guide outlines a safe, incremental path to app-scoped policies."]}),"\n"]}),"\n",(0,l.jsx)(i.h2,{id:"goals",children:"Goals"}),"\n",(0,l.jsxs)(i.ul,{children:["\n",(0,l.jsxs)(i.li,{children:["Single external identifier: ",(0,l.jsx)(i.code,{children:"resource.properties.pdp_application"})]}),"\n",(0,l.jsx)(i.li,{children:"Preserve deny-override and defaults"}),"\n",(0,l.jsx)(i.li,{children:"Minimize duplication with inheritance"}),"\n"]}),"\n",(0,l.jsx)(i.h2,{id:"step-by-step-plan",children:"Step-by-step plan"}),"\n",(0,l.jsxs)(i.ol,{children:["\n",(0,l.jsxs)(i.li,{children:["Create application registry entries (start with ",(0,l.jsx)(i.code,{children:"global.yaml"}),")"]}),"\n",(0,l.jsxs)(i.li,{children:["Move common policies to ",(0,l.jsx)(i.code,{children:"domains/<domain>/shared/"})]}),"\n",(0,l.jsxs)(i.li,{children:["Add environment-specific overlays under ",(0,l.jsx)(i.code,{children:"domains/<domain>/environments/<env>/"})]}),"\n",(0,l.jsxs)(i.li,{children:["Create per-application directories under ",(0,l.jsx)(i.code,{children:"applications/<app_id>/"})]}),"\n",(0,l.jsxs)(i.li,{children:["Add ",(0,l.jsx)(i.code,{children:"pdp_application"})," to client requests; keep existing global policies during transition"]}),"\n",(0,l.jsxs)(i.li,{children:["Enable ",(0,l.jsx)(i.code,{children:"USE_APP_SCOPED_POLICIES=true"})," in non-prod; test with trace endpoints"]}),"\n",(0,l.jsx)(i.li,{children:"Remove redundant global policies once app-scoped coverage is complete"}),"\n"]}),"\n",(0,l.jsx)(i.mermaid,{value:"flowchart LR\r\n  A[Global-only] --\x3e B[Domain shared]\r\n  B --\x3e C[Env overlays]\r\n  C --\x3e D[App-specific]\r\n  D --\x3e E[Enable app-scoped loading]"}),"\n",(0,l.jsx)(i.h2,{id:"authoring-tips",children:"Authoring tips"}),"\n",(0,l.jsxs)(i.ul,{children:["\n",(0,l.jsx)(i.li,{children:"Keep shared policies minimal and safe; prefer explicit app overrides for risky actions"}),"\n",(0,l.jsxs)(i.li,{children:["Use ",(0,l.jsx)(i.code,{children:"when"})," for guarded permits; avoid ",(0,l.jsx)(i.code,{children:"allowIf + effect: permit"})," when intending guards"]}),"\n",(0,l.jsxs)(i.li,{children:["Normalize effects to ",(0,l.jsx)(i.code,{children:"permit"}),"/",(0,l.jsx)(i.code,{children:"deny"})," early"]}),"\n"]}),"\n",(0,l.jsx)(i.h2,{id:"validation--safety",children:"Validation & safety"}),"\n",(0,l.jsxs)(i.ul,{children:["\n",(0,l.jsxs)(i.li,{children:["Run ",(0,l.jsx)(i.code,{children:"scripts/lint_policies.py"})," before merging"]}),"\n",(0,l.jsx)(i.li,{children:"Use debug trace to confirm inheritance source and load order"}),"\n",(0,l.jsxs)(i.li,{children:["Rollback plan: toggle ",(0,l.jsx)(i.code,{children:"USE_APP_SCOPED_POLICIES=false"})]}),"\n"]}),"\n",(0,l.jsx)(i.h2,{id:"checklist",children:"Checklist"}),"\n",(0,l.jsx)(i.h2,{id:"beforeafter-examples",children:"Before/After examples"}),"\n",(0,l.jsx)(i.h3,{id:"before-global-only",children:"Before (global-only)"}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-yaml",children:"# policies/core/document-access.yaml\r\nid: doc-access\r\nrules:\r\n  - resource: document\r\n    action: read\r\n    effect: permit\r\n    when: \"subject.properties.role IN ['employee','manager']\"\n"})}),"\n",(0,l.jsx)(i.h3,{id:"after-domain--app",children:"After (domain + app)"}),"\n",(0,l.jsx)(i.pre,{children:(0,l.jsx)(i.code,{className:"language-yaml",children:"# policies/domains/sharepoint/shared/document-actions.yaml\r\nid: sp-doc-actions\r\nrules:\r\n  - resource: document\r\n    action: read\r\n    effect: permit\r\n    when: \"subject.properties.role IN ['employee','manager']\"\r\n\r\n# policies/applications/sharepoint-prod/site-permissions.yaml\r\nid: sp-prod-overrides\r\nrules:\r\n  - resource: document\r\n    action: delete\r\n    effect: deny\r\n    description: No deletion in production\n"})}),"\n",(0,l.jsxs)(i.ul,{children:["\n",(0,l.jsx)(i.li,{children:"Registry entries created for all target apps"}),"\n",(0,l.jsx)(i.li,{children:"Directory structure matches inheritance model"}),"\n",(0,l.jsxs)(i.li,{children:[(0,l.jsx)(i.code,{children:"pdp_application"})," added to all target client requests"]}),"\n",(0,l.jsx)(i.li,{children:"Trace validation: policies loaded from all five levels as expected"}),"\n"]})]})}function p(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,l.jsx)(i,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);