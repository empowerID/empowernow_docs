"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[9794],{28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var r=i(96540);const o={},l=r.createContext(o);function s(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(l.Provider,{value:n},e.children)}},93241:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"services/pdp/explanation/application_scoped_overview","title":"Application-Scoped PDP \u2014 Overview & Mental Model","description":"Canonical reference: see scopedpolicydesign.md. This overview distills the major design changes and serves as an entry point to the deeper docs.","source":"@site/docs/services/pdp/explanation/application_scoped_overview.md","sourceDirName":"services/pdp/explanation","slug":"/services/pdp/explanation/application_scoped_overview","permalink":"/empowernow_docs/docs/services/pdp/explanation/application_scoped_overview","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/pdp/explanation/application_scoped_overview.md","tags":[],"version":"current","frontMatter":{}}');var o=i(74848),l=i(28453);const s={},a="Application-Scoped PDP \u2014 Overview & Mental Model",c={},t=[{value:"What changed (at a glance)",id:"what-changed-at-a-glance",level:2},{value:"End-to-end request flow (high level)",id:"end-to-end-request-flow-high-level",level:2},{value:"Resolution and evaluation sequence",id:"resolution-and-evaluation-sequence",level:2},{value:"Why <code>pdp_application</code> (not <code>application</code>)",id:"why-pdp_application-not-application",level:2},{value:"Quickstart for policy authors",id:"quickstart-for-policy-authors",level:2},{value:"Mental model for authors and reviewers",id:"mental-model-for-authors-and-reviewers",level:2},{value:"FAQ",id:"faq",level:2},{value:"Read next",id:"read-next",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"application-scoped-pdp--overview--mental-model",children:"Application-Scoped PDP \u2014 Overview & Mental Model"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Canonical reference: see ",(0,o.jsx)(n.code,{children:"scoped_policy_design.md"}),". This overview distills the major design changes and serves as an entry point to the deeper docs."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"what-changed-at-a-glance",children:"What changed (at a glance)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Single external identifier"}),": Callers specify only ",(0,o.jsx)(n.code,{children:"resource.properties.pdp_application"}),"; all domain/environment resolution is internal."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Scoped policy loading"}),": Policies load via a 5-level inheritance model (Global \u2192 Domain Shared \u2192 Cross-Environment \u2192 Domain Environment \u2192 Application), with specificity overriding general rules."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Evaluator hardening"}),": Normalized effects, deny-override semantics, and secure expression evaluation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Security boundaries"}),": Application boundary enforcement prevents cross-app leakage."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"DX & Ops"}),": Hot reload, lint CLI, scaffolding, debug traces, and cache strategy for latency reduction."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"end-to-end-request-flow-high-level",children:"End-to-end request flow (high level)"}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\r\n  A["Client Request\\nAuthZEN JSON"] --\x3e B[PDP]\r\n  B --\x3e C[Extract pdp_application]\r\n  C --\x3e D["Application Registry\\n(resolve domain/env internally)"]\r\n  D --\x3e E["Policy Loader\\n(load 5-level hierarchy)"]\r\n  E --\x3e F["Policy Evaluator\\n(deny-override, obligations, constraints)"]\r\n  F --\x3e G["Decision\\npermit/deny + obligations"]'}),"\n",(0,o.jsx)(n.h2,{id:"resolution-and-evaluation-sequence",children:"Resolution and evaluation sequence"}),"\n",(0,o.jsx)(n.mermaid,{value:"sequenceDiagram\r\n  participant Client\r\n  participant PDP\r\n  participant Registry as Application Registry\r\n  participant Loader as Policy Loader\r\n  participant Eval as Policy Evaluator\r\n\r\n  Client->>PDP: Evaluate(subject, action, resource{pdp_application})\r\n  PDP->>Registry: Resolve(application id)\r\n  Registry--\x3e>PDP: App context (domain/env metadata)\r\n  PDP->>Loader: Load policies (scoped by app context)\r\n  Loader--\x3e>PDP: Policies (application-scoped + inherited)\r\n  PDP->>Eval: Evaluate policies (deny-override)\r\n  Eval--\x3e>PDP: Decision + obligations/constraints\r\n  PDP--\x3e>Client: Permit/Deny"}),"\n",(0,o.jsxs)(n.h2,{id:"why-pdp_application-not-application",children:["Why ",(0,o.jsx)(n.code,{children:"pdp_application"})," (not ",(0,o.jsx)(n.code,{children:"application"}),")"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Avoids collisions with user-defined resource metadata."}),"\n",(0,o.jsxs)(n.li,{children:["Clear namespace for PDP-only routing while still AuthZEN-compliant (all properties accepted; only ",(0,o.jsx)(n.code,{children:"pdp_application"})," used for policy resolution)."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"quickstart-for-policy-authors",children:"Quickstart for policy authors"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Add the application identifier to the caller request:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "subject": {"id": "alice"},\r\n  "action": {"name": "read"},\r\n  "resource": {\r\n    "type": "document",\r\n    "id": "doc-1",\r\n    "properties": {"pdp_application": "sharepoint-prod"}\r\n  }\r\n}\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Organize policies (see full structure in application_policy_loading.md):","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"config/policies/\r\n\u2514\u2500\u2500 applications/sharepoint-prod/\r\n    \u2514\u2500\u2500 document-access.yaml\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Author a guarded-permit rule (use ",(0,o.jsx)(n.code,{children:"when"})," for permit-only-on-match):","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'id: sharepoint-doc-access\r\nrules:\r\n  - resource: document\r\n    action: read\r\n    effect: permit\r\n    when: "resource.properties.classification <= subject.properties.clearance"\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Validate and test:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Lint: ",(0,o.jsx)(n.code,{children:"python scripts/lint_policies.py"})]}),"\n",(0,o.jsx)(n.li,{children:"Evaluate with trace: see debug_tracing.md"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"mental-model-for-authors-and-reviewers",children:"Mental model for authors and reviewers"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Applicability first"}),": A rule must match ",(0,o.jsx)(n.code,{children:"resource"})," + ",(0,o.jsx)(n.code,{children:"action"})," before any condition/sugar matters."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Guarded permits"}),": Use ",(0,o.jsx)(n.code,{children:"when"})," for true guards (false \u2192 ",(0,o.jsx)(n.code,{children:"not_applicable"}),"). Avoid ",(0,o.jsx)(n.code,{children:"allowIf + effect: permit"})," when you mean a guard."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Deny-override"}),": Any matching deny cancels all permits."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Default"}),": If nothing applicable permits, result is deny."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Where do I put ",(0,o.jsx)(n.code,{children:"pdp_application"}),"?  In ",(0,o.jsx)(n.code,{children:"resource.properties.pdp_application"})," of the AuthZEN request."]}),"\n",(0,o.jsx)(n.li,{children:"What if it\u2019s missing or invalid?  The PDP falls back to global policies (see application_policy_loading.md)."}),"\n",(0,o.jsxs)(n.li,{children:["Should I use ",(0,o.jsx)(n.code,{children:"allowIf"})," or ",(0,o.jsx)(n.code,{children:"when"}),"?  Use ",(0,o.jsx)(n.code,{children:"when"})," to guard permits; ",(0,o.jsx)(n.code,{children:"allowIf"})," changes the effect to permit but does not guard applicability."]}),"\n",(0,o.jsxs)(n.li,{children:["How do I match paths?  Use ",(0,o.jsx)(n.code,{children:"MATCHES"})," with a named path-attribute and ",(0,o.jsx)(n.code,{children:"resource.properties.full_path"})," (see policy_dsl_cheatsheet.md)."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"read-next",children:"Read next"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Architecture details: ",(0,o.jsx)(n.code,{children:"application_policy_loading.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Expression evaluation: ",(0,o.jsx)(n.code,{children:"expression_evaluator_architecture.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Boundary enforcement: ",(0,o.jsx)(n.code,{children:"application_boundary_enforcement.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Debug & tracing: ",(0,o.jsx)(n.code,{children:"debug_tracing.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Performance & caching: ",(0,o.jsx)(n.code,{children:"performance_caching.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Dev tools & workflow: ",(0,o.jsx)(n.code,{children:"developer_tools.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["API contract: ",(0,o.jsx)(n.code,{children:"rest_api_contract.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Migration path: ",(0,o.jsx)(n.code,{children:"migration_guide.md"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);