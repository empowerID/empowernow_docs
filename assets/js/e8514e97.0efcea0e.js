"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[8939],{28453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var s=i(96540);const l={},r=s.createContext(l);function d(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),s.createElement(r.Provider,{value:n},e.children)}},48435:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"services/experience/plugins-storage-deployment","title":"Experience Plugins \u2014 Storage & Deployment Guide","description":"How plugins are built, stored, configured, served, enforced, and operated in the Experience platform.","source":"@site/docs/services/experience/plugins-storage-deployment.md","sourceDirName":"services/experience","slug":"/services/experience/plugins-storage-deployment","permalink":"/empowernow_docs/docs/services/experience/plugins-storage-deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/experience/plugins-storage-deployment.md","tags":[],"version":"current","frontMatter":{"title":"Experience Plugins \u2014 Storage & Deployment Guide","sidebar_label":"Plugins Storage & Deployment","description":"How plugins are built, stored, configured, served, enforced, and operated in the Experience platform."},"sidebar":"tutorialSidebar","previous":{"title":"Plugin Dev Guide","permalink":"/empowernow_docs/docs/services/experience/plugin_guide"},"next":{"title":"Plugins (Primer)","permalink":"/empowernow_docs/docs/services/experience/plugins"}}');var l=i(74848),r=i(28453);const d={title:"Experience Plugins \u2014 Storage & Deployment Guide",sidebar_label:"Plugins Storage & Deployment",description:"How plugins are built, stored, configured, served, enforced, and operated in the Experience platform."},c=void 0,o={},t=[{value:"Purpose",id:"purpose",level:2},{value:"Scope",id:"scope",level:2},{value:"1) High\u2011level model",id:"1-highlevel-model",level:2},{value:"2) Storage layout (source of truth)",id:"2-storage-layout-source-of-truth",level:2},{value:"3) Plugin config: <code>ServiceConfigs/BFF/config/plugins.yaml</code>",id:"3-plugin-config-serviceconfigsbffconfigpluginsyaml",level:2},{value:"4) Bundle contract (file\u2011backed ESM)",id:"4-bundle-contract-filebacked-esm",level:2},{value:"5) SPA integration",id:"5-spa-integration",level:2},{value:"6) BFF serving logic (what changed)",id:"6-bff-serving-logic-what-changed",level:2},{value:"7) Runtime enforcement (recap)",id:"7-runtime-enforcement-recap",level:2},{value:"8) Developer workflow",id:"8-developer-workflow",level:2},{value:"9) Operations &amp; DevOps",id:"9-operations--devops",level:2},{value:"10) Security posture",id:"10-security-posture",level:2},{value:"11) Example end\u2011to\u2011end (Hello Page + Hello Widget)",id:"11-example-endtoend-hello-page--hello-widget",level:2},{value:"12) Developer checklist",id:"12-developer-checklist",level:2},{value:"13) Appendix \u2013 API reference (BFF\u2011facing)",id:"13-appendix--api-reference-bfffacing",level:2},{value:"14) Notes on compatibility",id:"14-notes-on-compatibility",level:2}];function h(e){const n={code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,l.jsx)(n.p,{children:"Document how plugins are built, stored, configured, served, and operated in the Experience platform using file\u2011backed, same\u2011origin ESM bundles served by the BFF."}),"\n",(0,l.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Experience SPA host and plugin system"}),"\n",(0,l.jsx)(n.li,{children:"BFF plugin storage, serving, and enforcement"}),"\n",(0,l.jsx)(n.li,{children:"Dev workflow and DevOps operations for deploying, updating, and rolling back plugins"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"1-highlevel-model",children:"1) High\u2011level model"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Plugins are authored outside the host app and built as same\u2011origin ESM bundles."}),"\n",(0,l.jsxs)(n.li,{children:["The BFF serves:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Manifests from ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"})]}),"\n",(0,l.jsxs)(n.li,{children:["Bundles from file paths mounted read\u2011only under ",(0,l.jsx)(n.code,{children:"/app/plugins"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["The SPA:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Discovers manifests \u2192 batches PDP pre\u2011gating \u2192 dynamically imports file\u2011backed bundles \u2192 mounts contributions"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Runtime calls from plugins are enforced by the BFF via method+path allow\u2011lists and ",(0,l.jsx)(n.code,{children:"X-Plugin-Id"})," (see Plugins reference)."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"2-storage-layout-source-of-truth",children:"2) Storage layout (source of truth)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Host filesystem (checked into your configuration repo):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/<pluginId>/<version>/index.esm.js"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Container mount (BFF):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/app/plugins"})," (read\u2011only)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Configuration (BFF):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"})," \u2192 declares each plugin plus its bundle file path"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Compose mounts"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["docker\u2011compose\u2011authzen4.yml (BFF):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"../ServiceConfigs/BFF/plugins:/app/plugins:ro"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"../ServiceConfigs/BFF/config:/app/config:ro"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["docker\u2011compose\u2011nowconnect.yml (BFF):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"../ServiceConfigs/BFF/plugins:/app/plugins:ro"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"../ServiceConfigs/BFF/config:/app/config:ro"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.h2,{id:"3-plugin-config-serviceconfigsbffconfigpluginsyaml",children:["3) Plugin config: ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"})]}),"\n",(0,l.jsx)(n.p,{children:"Example (hello, page, and widget plugins):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'tenants:\r\n  experience.ocg.labs.empowernow.ai:\r\n    - id: hello\r\n      version: "1.0.0"\r\n      engine:\r\n        experience: ">=1.0.0"\r\n      bundle:\r\n        file: "/app/plugins/hello/1.0.0/index.esm.js"\r\n        # integrity: "sha256:<optional_hex_hash>"\r\n      permissions:\r\n        api:\r\n          - method: GET\r\n            path: /api/plugins/secure-echo\r\n          - method: POST\r\n            path: /api/plugins/telemetry\r\n        sse: []\r\n      contributions:\r\n        routes:\r\n          - path: /hello\r\n            component: Hello\r\n            resource: plugin.route\r\n            action: view\r\n        widgets:\r\n          - slot: dashboard.main\r\n            component: HelloWidget\r\n            resource: plugin.widget\r\n            action: view\r\n\r\n    - id: hello-page\r\n      version: "1.0.0"\r\n      engine:\r\n        experience: ">=1.0.0"\r\n      bundle:\r\n        file: "/app/plugins/hello-page/1.0.0/index.esm.js"\r\n      permissions:\r\n        api:\r\n          - method: GET\r\n            path: /api/plugins/secure-echo\r\n        sse: []\r\n      contributions:\r\n        routes:\r\n          - path: /hello-page\r\n            component: HelloPage\r\n            resource: plugin.route\r\n            action: view\r\n\r\n    - id: hello-widget\r\n      version: "1.0.0"\r\n      engine:\r\n        experience: ">=1.0.0"\r\n      bundle:\r\n        file: "/app/plugins/hello-widget/1.0.0/index.esm.js"\r\n      permissions:\r\n        api:\r\n          - method: POST\r\n            path: /api/plugins/telemetry\r\n        sse: []\r\n      contributions:\r\n        widgets:\r\n          - slot: dashboard.main\r\n            component: HelloWidget\r\n            resource: plugin.widget\r\n            action: view\n'})}),"\n",(0,l.jsx)(n.p,{children:"Key fields"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"id"}),"/",(0,l.jsx)(n.code,{children:"version"}),"/",(0,l.jsx)(n.code,{children:"engine.experience"}),": identity and compatibility range"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"bundle.file"}),": absolute file path inside the container under ",(0,l.jsx)(n.code,{children:"/app/plugins"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"bundle.integrity"})," (optional): content hash enforced at serve time"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"permissions"}),": allow\u2011list of method+path templates and SSE prefixes"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"contributions"}),": routes and/or widgets with PDP hints"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"4-bundle-contract-filebacked-esm",children:"4) Bundle contract (file\u2011backed ESM)"}),"\n",(0,l.jsxs)(n.p,{children:["Minimal examples (stored under ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/..."}),"):"]}),"\n",(0,l.jsxs)(n.p,{children:["Hello Page bundle (",(0,l.jsx)(n.code,{children:"hello-page/1.0.0/index.esm.js"}),")"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"import * as React from 'react';\r\n\r\nexport const routes = {\r\n  HelloPage: () => React.createElement(\r\n    'div',\r\n    { className: 'glass-card p-4' },\r\n    'Hello World Page'\r\n  )\r\n};\r\n\r\nexport default { routes };\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Hello Widget bundle (",(0,l.jsx)(n.code,{children:"hello-widget/1.0.0/index.esm.js"}),")"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"import * as React from 'react';\r\n\r\nexport const widgets = {\r\n  HelloWidget: () => React.createElement(\r\n    'div',\r\n    { className: 'glass-card p-2' },\r\n    'Hello World Widget'\r\n  )\r\n};\r\n\r\nexport default { widgets };\n"})}),"\n",(0,l.jsx)(n.p,{children:"Authoring rules"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Export ",(0,l.jsx)(n.code,{children:"routes"})," and/or ",(0,l.jsx)(n.code,{children:"widgets"})," as plain objects of React components."]}),"\n",(0,l.jsxs)(n.li,{children:["Treat ",(0,l.jsx)(n.code,{children:"react"}),", ",(0,l.jsx)(n.code,{children:"react-dom"}),", and ",(0,l.jsx)(n.code,{children:"@empowernow/ui"})," as externals; they are provided by the host."]}),"\n",(0,l.jsxs)(n.li,{children:["No global CSS or external scripts; CSP remains strict (",(0,l.jsx)(n.code,{children:"script-src 'self'"}),")."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"5-spa-integration",children:"5) SPA integration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Manifests: ",(0,l.jsx)(n.code,{children:"GET /api/plugins/manifests"})," (cookie\u2011auth, same\u2011origin)"]}),"\n",(0,l.jsx)(n.li,{children:"Import: SPA uses dynamic import on a URL pointing to the plugin bundle."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Current SPA loader URL pattern"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The loader requests:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/api/plugins/bundle?entry=<pluginId>&id=<pluginId>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Examples:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/api/plugins/bundle?entry=hello-page&id=hello-page"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/api/plugins/bundle?entry=hello-widget&id=hello-widget"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Note: The BFF maps ",(0,l.jsx)(n.code,{children:"id"})," to the configured ",(0,l.jsx)(n.code,{children:"bundle.file"})," and streams the file back as ",(0,l.jsx)(n.code,{children:"text/javascript"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"6-bff-serving-logic-what-changed",children:"6) BFF serving logic (what changed)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Manifests","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Loaded from ",(0,l.jsx)(n.code,{children:"plugins.yaml"})," into memory per tenant host."]}),"\n",(0,l.jsx)(n.li,{children:"Allow\u2011lists compiled for runtime request enforcement."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Bundles","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["For each request to ",(0,l.jsx)(n.code,{children:"/api/plugins/bundle?..."}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Check quarantine \u2192 403 with ",(0,l.jsx)(n.code,{children:"X-Plugin-Quarantined: 1"})," if blocked."]}),"\n",(0,l.jsxs)(n.li,{children:["Resolve ",(0,l.jsx)(n.code,{children:"id"})," to its configured ",(0,l.jsx)(n.code,{children:"bundle.file"})," (from ",(0,l.jsx)(n.code,{children:"plugins.yaml"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Root\u2011jail: Only serve files under ",(0,l.jsx)(n.code,{children:"/app/plugins"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Integrity (optional): if ",(0,l.jsx)(n.code,{children:"integrity"})," is set, verify the sha256 of the file content; on mismatch return 409 with ",(0,l.jsx)(n.code,{children:"X-Integrity-Error: 1"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Serve via ",(0,l.jsx)(n.code,{children:"FileResponse"})," with:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Content-Type: text/javascript; charset=utf-8"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ETag: sha256-<hex>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Cache-Control: public, max-age=31536000, immutable"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"X-Content-Type-Options: nosniff"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Cross-Origin-Resource-Policy: same-origin"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Authentication","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Route is ",(0,l.jsx)(n.code,{children:"auth: session"})," in ",(0,l.jsx)(n.code,{children:"routes.yaml"}),", so an authenticated session is required to fetch bundles."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Security","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Same\u2011origin ESM: no CSP relaxation needed."}),"\n",(0,l.jsxs)(n.li,{children:["Root\u2011jail ensures no path traversal outside ",(0,l.jsx)(n.code,{children:"/app/plugins"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"7-runtime-enforcement-recap",children:"7) Runtime enforcement (recap)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["BFF Middleware enforces allow\u2011lists per plugin:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["HTTP calls must include header ",(0,l.jsx)(n.code,{children:"X-Plugin-Id: <id>"})]}),"\n",(0,l.jsxs)(n.li,{children:["Method+path validated against templates compiled from ",(0,l.jsx)(n.code,{children:"permissions.api"})]}),"\n",(0,l.jsxs)(n.li,{children:["SSE prefixes validated against ",(0,l.jsx)(n.code,{children:"permissions.sse"})]}),"\n",(0,l.jsxs)(n.li,{children:["Violations return 403 with ",(0,l.jsx)(n.code,{children:"X-Allowlist-Violation: 1"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"SPA pre\u2011gates at render time using AuthZEN batch calls, so contributions are mounted only when permitted."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"8-developer-workflow",children:"8) Developer workflow"}),"\n",(0,l.jsx)(n.p,{children:"Build"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Author routes and/or widgets and export as ESM."}),"\n",(0,l.jsxs)(n.li,{children:["Externalize ",(0,l.jsx)(n.code,{children:"react"}),", ",(0,l.jsx)(n.code,{children:"react-dom"}),", ",(0,l.jsx)(n.code,{children:"@empowernow/ui"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Produce a single file bundle (e.g., ",(0,l.jsx)(n.code,{children:"index.esm.js"}),")."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Place"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Copy the built bundle to:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/<pluginId>/<version>/index.esm.js"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Configure"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Add/Update an entry under ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Set ",(0,l.jsx)(n.code,{children:"id"}),", ",(0,l.jsx)(n.code,{children:"version"}),", ",(0,l.jsx)(n.code,{children:"engine.experience"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Set ",(0,l.jsx)(n.code,{children:"bundle.file"})," to ",(0,l.jsx)(n.code,{children:"/app/plugins/<pluginId>/<version>/index.esm.js"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Add ",(0,l.jsx)(n.code,{children:"contributions"})," and ",(0,l.jsx)(n.code,{children:"permissions"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Deploy"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The BFF containers mount:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"../ServiceConfigs/BFF/plugins:/app/plugins:ro"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"../ServiceConfigs/BFF/config:/app/config:ro"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Restart/reload the BFF to pick up config changes (and bundles)."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Verify"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Hit ",(0,l.jsx)(n.code,{children:"GET /api/plugins/manifests"})," (authenticated session) and confirm your plugin appears."]}),"\n",(0,l.jsx)(n.li,{children:"Navigate to the route or widget location in the Experience SPA."}),"\n",(0,l.jsxs)(n.li,{children:["Inspect the Network tab for ",(0,l.jsx)(n.code,{children:"GET /api/plugins/bundle?..."})," with 200 and strong caching headers."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"9-operations--devops",children:"9) Operations & DevOps"}),"\n",(0,l.jsx)(n.p,{children:"Atomic rollout (recommended)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Stage new bundle files under ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/.staged/..."})]}),"\n",(0,l.jsxs)(n.li,{children:["After pushing the config entry, flip the directory or symlink in one step to the final ",(0,l.jsx)(n.code,{children:"/app/plugins/<id>/<version>"})," path to avoid broken references."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Integrity management (optional but recommended)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Compute a sha256 hash of the final ESM file and record it as ",(0,l.jsx)(n.code,{children:'bundle.integrity: "sha256:<hex>"'})]}),"\n",(0,l.jsxs)(n.li,{children:["On mismatch, the BFF fails closed with 409 and ",(0,l.jsx)(n.code,{children:"X-Integrity-Error: 1"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Quarantine"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Immediate kill switch to block serving and use:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"POST /api/plugins/quarantine/{plugin_id}"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"POST /api/plugins/unquarantine/{plugin_id}"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Hot reload of manifests"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"POST /api/plugins/refresh"})," triggers the BFF to reload ",(0,l.jsx)(n.code,{children:"plugins.yaml"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Monitoring (minimum recommended)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Track bundle serve outcomes and latencies by ",(0,l.jsx)(n.code,{children:"{tenant, plugin_id, version}"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"Track allow\u2011list denials and quarantine events."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Backups"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Treat ",(0,l.jsx)(n.code,{children:"ServiceConfigs"})," as the configuration SoT; ensure your normal config backup processes include the plugins folder and ",(0,l.jsx)(n.code,{children:"plugins.yaml"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"10-security-posture",children:"10) Security posture"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Same\u2011origin ESM; strict CSP."}),"\n",(0,l.jsx)(n.li,{children:"No runtime tokens in browser; cookies + CSRF via BFF."}),"\n",(0,l.jsx)(n.li,{children:"PDP pre\u2011gating at render time; BFF allow\u2011list enforcement at request time."}),"\n",(0,l.jsxs)(n.li,{children:["Root\u2011jail for bundles (",(0,l.jsx)(n.code,{children:"/app/plugins"}),")."]}),"\n",(0,l.jsx)(n.li,{children:"Optional integrity checks on bundles."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"11-example-endtoend-hello-page--hello-widget",children:"11) Example end\u2011to\u2011end (Hello Page + Hello Widget)"}),"\n",(0,l.jsx)(n.p,{children:"Files"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/hello-page/1.0.0/index.esm.js"})," (exports ",(0,l.jsx)(n.code,{children:"routes.HelloPage"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/hello-widget/1.0.0/index.esm.js"})," (exports ",(0,l.jsx)(n.code,{children:"widgets.HelloWidget"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Configuration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/config/plugins.yaml"})," entries for ",(0,l.jsx)(n.code,{children:"hello-page"})," and ",(0,l.jsx)(n.code,{children:"hello-widget"})," pointing to ",(0,l.jsx)(n.code,{children:"/app/plugins/.../index.esm.js"}),", with contributions and permissions."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Runtime"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["SPA discovers manifests, then imports:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/api/plugins/bundle?entry=hello-page&id=hello-page"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/api/plugins/bundle?entry=hello-widget&id=hello-widget"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"BFF serves file\u2011backed ESM with long\u2011lived immutable caching and ETags."}),"\n",(0,l.jsx)(n.li,{children:"Contributions mount only when permitted by PDP decisions."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"12-developer-checklist",children:"12) Developer checklist"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Build as ESM; exports ",(0,l.jsx)(n.code,{children:"routes"})," and/or ",(0,l.jsx)(n.code,{children:"widgets"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["No external UI kits; use ",(0,l.jsx)(n.code,{children:"@empowernow/ui"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Externals: ",(0,l.jsx)(n.code,{children:"react"}),", ",(0,l.jsx)(n.code,{children:"react-dom"}),", ",(0,l.jsx)(n.code,{children:"@empowernow/ui"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Place under ",(0,l.jsx)(n.code,{children:"ServiceConfigs/BFF/plugins/<id>/<version>/index.esm.js"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Configure ",(0,l.jsx)(n.code,{children:"plugins.yaml"})," with ",(0,l.jsx)(n.code,{children:"bundle.file"}),", contributions, and permissions."]}),"\n",(0,l.jsxs)(n.li,{children:["Restart/reload BFF; verify ",(0,l.jsx)(n.code,{children:"manifests"})," and network import URL."]}),"\n",(0,l.jsx)(n.li,{children:"Ensure PDP pre\u2011gating passes for your test user; mount points render."}),"\n",(0,l.jsxs)(n.li,{children:["Calls go through the SDK and carry ",(0,l.jsx)(n.code,{children:"X-Plugin-Id"}),"; 403s indicate allow\u2011list or authz issues."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"13-appendix--api-reference-bfffacing",children:"13) Appendix \u2013 API reference (BFF\u2011facing)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /api/plugins/manifests"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Returns ",(0,l.jsx)(n.code,{children:"PluginManifest[]"})," scoped by tenant host"]}),"\n",(0,l.jsxs)(n.li,{children:["Headers: ",(0,l.jsx)(n.code,{children:"Vary: Cookie, X-Plugin-Id"})," (for manifests, not bundles)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GET /api/plugins/bundle?entry=<id>&id=<id>"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Returns ESM bundle file"}),"\n",(0,l.jsxs)(n.li,{children:["Headers:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Content-Type: text/javascript; charset=utf-8"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ETag: sha256-<hex>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Cache-Control: public, max-age=31536000, immutable"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"X-Content-Type-Options: nosniff"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Cross-Origin-Resource-Policy: same-origin"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Errors:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["403 with ",(0,l.jsx)(n.code,{children:"X-Plugin-Quarantined: 1"})," if quarantined"]}),"\n",(0,l.jsx)(n.li,{children:"404 unknown plugin"}),"\n",(0,l.jsxs)(n.li,{children:["409 with ",(0,l.jsx)(n.code,{children:"X-Integrity-Error: 1"})," on integrity mismatch"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"POST /api/plugins/refresh"})," \u2192 reload manifests from config"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"POST /api/plugins/quarantine/{id}"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"POST /api/plugins/unquarantine/{id}"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"14-notes-on-compatibility",children:"14) Notes on compatibility"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The SPA loader continues to use query params; no host code changes required."}),"\n",(0,l.jsxs)(n.li,{children:["Future\u2011proofing: if you later switch to path params (e.g., ",(0,l.jsx)(n.code,{children:"/api/plugins/bundle/{pluginId}/{version}"}),") you can run both handlers in parallel and migrate the SPA loader when convenient."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"See also:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Experience \u2192 Plugins: ",(0,l.jsx)(n.code,{children:"./plugins"})]}),"\n",(0,l.jsxs)(n.li,{children:["Experience \u2192 Plugin Development Guide: ",(0,l.jsx)(n.code,{children:"./plugin_guide"})]}),"\n",(0,l.jsxs)(n.li,{children:["BFF \u2192 Experience Routing & Config: ",(0,l.jsx)(n.code,{children:"../bff/devops/experience_routing"})]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);