"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[5358],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var i=s(96540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},41342:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"services/empowernow_react_app","title":"empowernow_react_app","description":"EmpowerNow React App Specification","source":"@site/docs/services/empowernow_react_app.md","sourceDirName":"services","slug":"/services/empowernow_react_app","permalink":"/empowernow_docs/docs/services/empowernow_react_app","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/empowernow_react_app.md","tags":[],"version":"current","frontMatter":{}}');var r=s(74848),l=s(28453);const t={},o=void 0,c={},d=[{value:"EmpowerNow React App Specification",id:"empowernow-react-app-specification",level:2},{value:"Scope",id:"scope",level:3},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Core Dependencies",id:"core-dependencies",level:2},{value:"Project Structure (baseline)",id:"project-structure-baseline",level:2},{value:"Configuration (Vite envs)",id:"configuration-vite-envs",level:2},{value:"Routing",id:"routing",level:2},{value:"Authentication and Session",id:"authentication-and-session",level:2},{value:"API Access Pattern",id:"api-access-pattern",level:2},{value:"Design System &amp; Theming",id:"design-system--theming",level:2},{value:"Critical UI Pattern: Tile Grid (Do/Don&#39;t)",id:"critical-ui-pattern-tile-grid-dodont",level:3},{value:"Local Development",id:"local-development",level:2},{value:"Testing Standards",id:"testing-standards",level:2},{value:"Build and Deployment",id:"build-and-deployment",level:2},{value:"Security Guidelines",id:"security-guidelines",level:2},{value:"Accessibility &amp; Performance",id:"accessibility--performance",level:2},{value:"Creating a New App",id:"creating-a-new-app",level:2},{value:"EmpowerNow Experience App (End\u2011User Interface)",id:"empowernow-experience-app-enduser-interface",level:3},{value:"Modular Feature Activation",id:"modular-feature-activation",level:4},{value:"Unified Multi\u2011Service API Layer",id:"unified-multiservice-api-layer",level:4},{value:"Dynamic Navigation &amp; Routing",id:"dynamic-navigation--routing",level:4},{value:"Events &amp; Realtime",id:"events--realtime",level:4},{value:"Docker &amp; Traefik (Experience SPA)",id:"docker--traefik-experience-spa",level:4},{value:"Dashboard &amp; Widgets",id:"dashboard--widgets",level:3},{value:"End\u2011User Tasks &amp; Approvals (Experience)",id:"enduser-tasks--approvals-experience",level:3},{value:"Page Protection via OpenID AuthZEN PDP",id:"page-protection-via-openid-authzen-pdp",level:3},{value:"Handover Notes: Experience App Integration",id:"handover-notes-experience-app-integration",level:2},{value:"Readiness Checklist",id:"readiness-checklist",level:2},{value:"Core principles",id:"core-principles",level:3},{value:"Information architecture",id:"information-architecture",level:3},{value:"Authorization model (PDP)",id:"authorization-model-pdp",level:3},{value:"Data + realtime",id:"data--realtime",level:3},{value:"Authn/session",id:"authnsession",level:3},{value:"Runtime Page Runner (distinct from Designer)",id:"runtime-page-runner-distinct-from-designer",level:3},{value:"Tasks center",id:"tasks-center",level:3},{value:"Workflow runner",id:"workflow-runner",level:3},{value:"Navigation &amp; personalization",id:"navigation--personalization",level:3},{value:"Non-functional",id:"non-functional",level:3},{value:"Implementation delta (short)",id:"implementation-delta-short",level:3}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"empowernow-react-app-specification",children:"EmpowerNow React App Specification"}),"\n",(0,r.jsx)(n.p,{children:"This document specifies how EmpowerNow front-end React applications are built, configured, authenticated, deployed, and tested. It is intended for third\u2011party developers and internal \u201cvibe coders\u201d building new SPAs that conform to our platform standards."}),"\n",(0,r.jsx)(n.h3,{id:"scope",children:"Scope"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"IdP (Authentication Studio), PDP (Authorization Studio), and Workflow/Visual Designer SPAs follow the same conventions."}),"\n",(0,r.jsx)(n.li,{children:"SPAs are static builds served by Nginx and routed via Traefik; all API calls go through the Backend\u2011for\u2011Frontend (BFF) service."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SPA framework"}),": React 18 + TypeScript 5, bundled with Vite."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Design system"}),": ",(0,r.jsx)(n.code,{children:"@empowernow/ui"})," (Neon Flux theme) for consistent components and tokens."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Auth"}),": ",(0,r.jsx)(n.code,{children:"@empowernow/bff-auth-react"})," integrates browser auth with the BFF, which implements secure OAuth/OIDC flows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data fetching"}),": TanStack Query v5 for server state; optional Redux Toolkit for UI/app state."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transport"}),": All API requests are same\u2011origin to the BFF under ",(0,r.jsx)(n.code,{children:"/api/**"}),". Prefer SSE for realtime updates where applicable."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Containerization"}),": Built artifacts are served by Nginx as static SPAs; Traefik routes static vs API paths; the BFF handles auth/session and proxies service APIs."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"core-dependencies",children:"Core Dependencies"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Required"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"react"}),", ",(0,r.jsx)(n.code,{children:"react-dom"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"react-router-dom"})," (v7) for routing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@empowernow/ui"})," for UI components and Neon Flux design tokens"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@empowernow/bff-auth-react"})," for auth session + login flows"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@tanstack/react-query"})," for server state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"axios"})," for HTTP client (wrapped; see API section)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Common"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@empowernow/common"}),", ",(0,r.jsx)(n.code,{children:"@empowernow/react"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"antd"})," (select components), ",(0,r.jsx)(n.code,{children:"monaco-editor"})," (where needed), ",(0,r.jsx)(n.code,{children:"lucide-react"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"zod"}),"/",(0,r.jsx)(n.code,{children:"ajv"})," for schema validation as needed"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"project-structure-baseline",children:"Project Structure (baseline)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"frontend/\n  src/\n    app/               # App bootstrap (providers, routing)\n    pages/             # Route components\n    features/          # Feature slices\n    components/        # Reusable UI components\n    services/          # API clients, adapters\n    store/             # Optional Redux Toolkit store (UI state)\n    lib/               # Utilities, hooks\n  public/              # Static assets\n  env.local.template   # Vite environment variables template\n  package.json         # Scripts and deps\n  nginx-spa.conf       # Nginx SPA fallback config\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-vite-envs",children:"Configuration (Vite envs)"}),"\n",(0,r.jsxs)(n.p,{children:["Define these in ",(0,r.jsx)(n.code,{children:"env.local"})," (do not commit secrets):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_OIDC_AUTHORITY"}),": OIDC discovery base (e.g., ",(0,r.jsx)(n.code,{children:"https://idp.ocg.labs.empowernow.ai/api/oidc"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_OIDC_CLIENT_ID"}),": OIDC client id (e.g., ",(0,r.jsx)(n.code,{children:"spa-client"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_OIDC_SCOPE"}),": space\u2011separated scopes (e.g., ",(0,r.jsx)(n.code,{children:"openid profile email admin.api"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_OIDC_RESOURCE"})," (optional): audience/resource when required by IdP"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"}),": base URL for BFF; leave empty in same\u2011origin deployments (recommended)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Guidelines:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prefer same\u2011origin deployment where the SPA is hosted under the same domain as the BFF; set ",(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"})," to empty and use relative ",(0,r.jsx)(n.code,{children:"/api/**"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Do not embed direct service URLs in the SPA; route everything through the BFF for auth and policy enforcement."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"routing",children:"Routing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"react-router-dom"})," v7 with standard SPA client\u2011side routing."]}),"\n",(0,r.jsxs)(n.li,{children:["Nginx serves ",(0,r.jsx)(n.code,{children:"index.html"})," as a fallback (",(0,r.jsx)(n.code,{children:"try_files ... /index.html"}),") to support deep links."]}),"\n",(0,r.jsx)(n.li,{children:"Keep route modules lazy\u2011loaded where sensible to optimize initial load."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"authentication-and-session",children:"Authentication and Session"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"@empowernow/bff-auth-react"})," provider at the app root."]}),"\n",(0,r.jsxs)(n.li,{children:["Sessions are managed by the BFF (http\u2011only cookies). The SPA should:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check session via ",(0,r.jsx)(n.code,{children:"/api/auth/session"})," on load and on focus/visibility changes."]}),"\n",(0,r.jsx)(n.li,{children:"Initiate login via the auth provider; the BFF handles OIDC (FAPI/DPoP/private_key_jwt) and returns a session."}),"\n",(0,r.jsx)(n.li,{children:"Never store access tokens in local storage; use cookies via same\u2011origin requests."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Minimal wiring example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { createRoot } from 'react-dom/client';\nimport { BrowserRouter } from 'react-router-dom';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { BffAuthProvider } from '@empowernow/bff-auth-react';\nimport App from './app/App';\n\nconst qc = new QueryClient();\n\ncreateRoot(document.getElementById('root')!).render(\n  <BffAuthProvider>\n    <QueryClientProvider client={qc}>\n      <BrowserRouter>\n        <App />\n      </BrowserRouter>\n    </QueryClientProvider>\n  </BffAuthProvider>\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"api-access-pattern",children:"API Access Pattern"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All requests are relative to the BFF under ",(0,r.jsx)(n.code,{children:"/api/**"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Use a shared Axios instance configured for same\u2011origin credentials and error handling."}),"\n",(0,r.jsx)(n.li,{children:"Use TanStack Query for fetching/caching/invalidation; colocate queries with features."}),"\n",(0,r.jsxs)(n.li,{children:["Prefer Server\u2011Sent Events (SSE) for realtime updates where supported (e.g., ",(0,r.jsx)(n.code,{children:"/events/**"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Axios instance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import axios from 'axios';\n\nexport const api = axios.create({\n  baseURL: import.meta.env.VITE_BFF_BASE_URL || '/api',\n  withCredentials: true,\n  headers: { 'X-Requested-With': 'spa' }\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"React Query usage:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const { data, isLoading, error } = useQuery({\n  queryKey: ['users', page],\n  queryFn: () => api.get('/users', { params: { page } }).then(r => r.data)\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"SSE helper (example):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export function subscribe(path: string, onMessage: (data: any) => void) {\n  const url = (import.meta.env.VITE_BFF_BASE_URL || '') + path;\n  const es = new EventSource(url, { withCredentials: true } as any);\n  es.onmessage = (e) => onMessage(JSON.parse(e.data));\n  return () => es.close();\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"design-system--theming",children:"Design System & Theming"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"@empowernow/ui"})," components and tokens to align with the Neon Flux design system."]}),"\n",(0,r.jsx)(n.li,{children:"Import global CSS once at app root:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import '@empowernow/ui/dist/index.css';\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Avoid bespoke styling; extend via component tokens/props."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"See also:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/empowernow/client_sdk/blob/main/empowernow-packages/packages/empowernow-ui/docs/DESIGN_SYSTEM.md",children:"Design System (tokens, patterns, Monaco)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/empowernow/client_sdk/blob/main/empowernow-packages/packages/empowernow-ui/docs/DESIGN_SYSTEM_CHECKLIST.md",children:"Design System Compliance Checklist"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/empowernow/client_sdk/blob/main/empowernow-packages/packages/empowernow-ui/docs/vibe-coding-strategy.md",children:"Vibe Coding Strategy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/empowernow/client_sdk/blob/main/empowernow-packages/packages/empowernow-ui/docs/QUICK_START.md",children:"UI Quick Start"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"critical-ui-pattern-tile-grid-dodont",children:"Critical UI Pattern: Tile Grid (Do/Don't)"}),"\n",(0,r.jsx)(n.p,{children:"Use the standardized tile grid and glass card patterns. Do NOT use Ant Design List for card grids."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// \u274c WRONG - Ant Design List grid breaks glass-card styling\nimport { List } from 'antd';\n\n<List\n  grid={{ gutter: 16, column: 3 }}\n  dataSource={items}\n  renderItem={(item) => (\n    <List.Item>\n      <Card>{item.content}</Card>\n    </List.Item>\n  )}\n/>;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'// \u2705 CORRECT - Use tile-grid + TileCard (from @empowernow/ui)\nimport { TileCard } from \'@empowernow/ui\';\n\n<div className="tile-grid">\n  {items.map(item => (\n    <TileCard key={item.id} className="glass-card">\n      {item.content}\n    </TileCard>\n  ))}\n></div>;\n'})}),"\n",(0,r.jsx)(n.h2,{id:"local-development",children:"Local Development"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Scripts (typical):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"npm run dev"})," \u2013 start Vite dev server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"npm run build"})," \u2013 type\u2011check + build"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"npm run test"})," \u2013 unit tests (Vitest + jsdom)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"npm run test:e2e"})," \u2013 Playwright E2E"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Create ",(0,r.jsx)(n.code,{children:"env.local"})," from ",(0,r.jsx)(n.code,{children:"env.local.template"})," and set VITE_* values."]}),"\n",(0,r.jsxs)(n.li,{children:["When running the full stack locally, use the shared docker\u2011compose files provided in ",(0,r.jsx)(n.code,{children:"CRUDService/"})," if needed."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"testing-standards",children:"Testing Standards"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit"}),": Vitest + Testing Library for component and hook tests."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"E2E"}),": Playwright tests run against the built SPA + BFF; headless in CI, headed locally as needed."]}),"\n",(0,r.jsxs)(n.li,{children:["Keep happy\u2011path auth/login flows covered. Validate ",(0,r.jsx)(n.code,{children:"/api/auth/session"})," handling and protected route access."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"build-and-deployment",children:"Build and Deployment"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build"})," with Vite to ",(0,r.jsx)(n.code,{children:"dist/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Containerize"})," with Nginx serving the built assets and SPA fallback. Use the canonical Nginx config:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server {\n  listen 80;\n  root /usr/share/nginx/html;\n  index index.html;\n  location / { try_files $uri $uri/ /index.html; }\n  location ~* \\.(?:css|js|png|jpg|jpeg|gif|svg|woff2?)$ {\n    try_files $uri =404;\n    expires 30d;\n    access_log off;\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Route"})," via Traefik:"]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Static content on host routers; exclude ",(0,r.jsx)(n.code,{children:"/api/"}),", ",(0,r.jsx)(n.code,{children:"/auth/"}),", and known streaming endpoints from SPA router rules."]}),"\n",(0,r.jsxs)(n.li,{children:["Example (compose label rule): ",(0,r.jsx)(n.code,{children:'Host("authz.ocg.labs.empowernow.ai") && !PathPrefix("/api/") && !PathPrefix("/auth/")'})]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"BFF Integration"}),":"]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["BFF handles ",(0,r.jsx)(n.code,{children:"/api/**"})," routes, auth flows, and session verification. Keep same\u2011origin when possible so cookies flow correctly."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Multi\u2011stage builds"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Our canonical build uses a multi\u2011stage Dockerfile that builds each SPA with Node, then copies ",(0,r.jsx)(n.code,{children:"dist/"})," into lightweight ",(0,r.jsx)(n.code,{children:"nginx:alpine"})," images per app."]}),"\n",(0,r.jsxs)(n.li,{children:["Compose targets produce ",(0,r.jsx)(n.code,{children:"idp-ui"}),", ",(0,r.jsx)(n.code,{children:"authz-ui"}),", and ",(0,r.jsx)(n.code,{children:"workflow-ui"})," static containers, each with SPA fallback enabled."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"security-guidelines",children:"Security Guidelines"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Do not bypass the BFF; avoid direct service URLs."}),"\n",(0,r.jsx)(n.li,{children:"Do not store tokens in local/session storage; rely on http\u2011only cookies."}),"\n",(0,r.jsxs)(n.li,{children:["Use same\u2011origin requests where possible; set ",(0,r.jsx)(n.code,{children:"withCredentials: true"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Respect CSP; keep inline scripts/styles minimal and hashed when required."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"accessibility--performance",children:"Accessibility & Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Follow WCAG best practices; use semantic HTML and ARIA where appropriate."}),"\n",(0,r.jsx)(n.li,{children:"Code\u2011split large routes/features; cache immutable assets aggressively (hashed filenames)."}),"\n",(0,r.jsx)(n.li,{children:"Keep bundle size in check; prefer composable UI over one\u2011off heavy widgets."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-new-app",children:"Creating a New App"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use the ",(0,r.jsx)(n.code,{children:"@empowernow/ui"})," starter or CLI to scaffold consistent structure and theming."]}),"\n",(0,r.jsxs)(n.li,{children:["Wire ",(0,r.jsx)(n.code,{children:"@empowernow/bff-auth-react"}),", React Query provider, and Router in ",(0,r.jsx)(n.code,{children:"main.tsx"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Add an Axios instance under ",(0,r.jsx)(n.code,{children:"services/api.ts"})," and feature\u2011scoped query hooks."]}),"\n",(0,r.jsxs)(n.li,{children:["Configure VITE_* envs; validate ",(0,r.jsx)(n.code,{children:"/api/auth/session"})," flow early."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Helpful references:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/empowernow/client_sdk/blob/main/empowernow-packages/packages/empowernow-ui/docs/QUICK_START.md",children:"UI Quick Start"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/empowernow/client_sdk/blob/main/empowernow-packages/packages/empowernow-ui/docs/vibe-coding-strategy.md",children:"Vibe Coding Strategy"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"empowernow-experience-app-enduser-interface",children:"EmpowerNow Experience App (End\u2011User Interface)"}),"\n",(0,r.jsx)(n.p,{children:"The Experience app is the end\u2011user portal for the EmpowerNow Identity Fabric Suite. It must support customers running any subset of services (IdP, PDP, Workflow, CRUD, etc.). The UI enables or disables modules dynamically and calls all backends strictly through the BFF."}),"\n",(0,r.jsx)(n.h4,{id:"modular-feature-activation",children:"Modular Feature Activation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Source of truth: a BFF\u2011served UI config document.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Recommended endpoint: ",(0,r.jsx)(n.code,{children:"/api/configs/ui"})," (JSON) with an SSE stream at ",(0,r.jsx)(n.code,{children:"/api/configs/stream"})," for live updates."]}),"\n",(0,r.jsxs)(n.li,{children:["Example payload:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "modules": {\n    "idp": true,\n    "pdp": true,\n    "workflow": false,\n    "crud": true\n  }\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Build\u2011time fallback (optional): ",(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_MODULES=idp,pdp,workflow,crud"})," used only if the runtime config is unavailable."]}),"\n",(0,r.jsxs)(n.li,{children:["UI behavior:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hide navigation and routes for disabled modules."}),"\n",(0,r.jsx)(n.li,{children:"Guard deep links (redirect to home if module disabled)."}),"\n",(0,r.jsx)(n.li,{children:"Prefer runtime config over build\u2011time flags when both exist."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Minimal config hook:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { useQuery } from '@tanstack/react-query';\n\nexport function useUiConfig() {\n  return useQuery({\n    queryKey: ['ui-config'],\n    queryFn: () => fetch('/api/configs/ui', { credentials: 'include' }).then(r => r.json()),\n    staleTime: 60_000\n  });\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Optional SSE subscription for live updates:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { useEffect } from 'react';\nimport { subscribe } from '../services/sse'; // wrapper from this guide\n\nexport function useUiConfigStream(onUpdate: (cfg: any) => void) {\n  useEffect(() => subscribe('/configs/stream', onUpdate), [onUpdate]);\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"unified-multiservice-api-layer",children:"Unified Multi\u2011Service API Layer"}),"\n",(0,r.jsxs)(n.p,{children:["Implement a single ",(0,r.jsx)(n.code,{children:"@api"})," module modeled after Visual Designer\u2019s SDK\u2011backed client. Each service uses a canonical prefix routed by the BFF: ",(0,r.jsx)(n.code,{children:"/idp/**"}),", ",(0,r.jsx)(n.code,{children:"/pdp/**"}),", ",(0,r.jsx)(n.code,{children:"/crud/**"}),", ",(0,r.jsx)(n.code,{children:"/workflow/**"}),", etc."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// src/services/api.ts\nimport { apiClient } from '@empowernow/bff-auth-react';\n\nfunction stripApi(path: string) { return path.replace(/^\\/api/i, ''); }\n\nexport const api = {\n  get: (path: string, opts?: any) => apiClient.get(stripApi(path), opts),\n  post: (path: string, body?: any, opts?: any) => apiClient.post(stripApi(path), body, opts),\n  put: (path: string, body?: any, opts?: any) => apiClient.put(stripApi(path), body, opts),\n  patch: (path: string, body?: any, opts?: any) => apiClient.patch(stripApi(path), body, opts),\n  delete: (path: string, opts?: any) => apiClient.delete(stripApi(path), opts)\n};\n\n// Namespaced helpers\nexport const idpApi = {\n  getProfile: () => api.get('/idp/profile'),\n  // ...other IdP endpoints\n};\n\nexport const pdpApi = {\n  listPolicies: () => api.get('/pdp/policies'),\n  // ...other PDP endpoints\n};\n\nexport const workflowApi = {\n  listWorkflows: () => api.get('/workflow/workflows'),\n};\n\nexport const crudApi = {\n  listEntities: (t: string) => api.get(`/crud/${t}`),\n};\n"})}),"\n",(0,r.jsx)(n.p,{children:"Guidelines:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Always use BFF\u2011relative paths; never call services directly."}),"\n",(0,r.jsxs)(n.li,{children:["Keep each service in its own file and re\u2011export via an ",(0,r.jsx)(n.code,{children:"@api/index.ts"})," barrel."]}),"\n",(0,r.jsx)(n.li,{children:"Provide typed helpers per feature area; colocate React Query hooks with features."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"dynamic-navigation--routing",children:"Dynamic Navigation & Routing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Build the menu and routes from the active modules list."}),"\n",(0,r.jsx)(n.li,{children:"Lazy\u2011load module routes to minimize initial bundle size."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Pseudocode\nconst routes = [\n  modules.idp && { path: '/idp', element: <IdpRoutes /> },\n  modules.pdp && { path: '/pdp', element: <PdpRoutes /> },\n  modules.workflow && { path: '/workflow', element: <WorkflowRoutes /> },\n  modules.crud && { path: '/data', element: <CrudRoutes /> }\n].filter(Boolean);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"events--realtime",children:"Events & Realtime"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prefer SSE for user notifications and job/task progress per module:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/events/idp"}),", ",(0,r.jsx)(n.code,{children:"/events/pdp"}),", ",(0,r.jsx)(n.code,{children:"/events/workflow"}),", etc."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Use a single SSE helper to subscribe/unsubscribe; namespace by module."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"docker--traefik-experience-spa",children:"Docker & Traefik (Experience SPA)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Build args (compose): ",(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"}),", ",(0,r.jsx)(n.code,{children:"VITE_OIDC_*"}),", ",(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_MODULES"})," (optional)."]}),"\n",(0,r.jsxs)(n.li,{children:["Traefik router for the Experience host should exclude all API/auth/stream routes from the SPA router rule, similar to Workflow UI:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Example rule: ",(0,r.jsx)(n.code,{children:'Host("experience.ocg.labs.empowernow.ai") && !PathPrefix("/api/") && !PathPrefix("/auth/") && !PathPrefix("/events/") && !PathPrefix("/configs/stream") && !PathPrefix("/stream/") && !PathPrefix("/access/v1/") && !PathPrefix("/health")'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dashboard--widgets",children:"Dashboard & Widgets"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Landing page is a PDP\u2011aware dashboard composed of widgets."}),"\n",(0,r.jsxs)(n.li,{children:["Each widget declares ",(0,r.jsx)(n.code,{children:"{ resource, action }"})," and is rendered only if ",(0,r.jsx)(n.code,{children:"useAuthorization(resource, action)"})," allows."]}),"\n",(0,r.jsxs)(n.li,{children:["Users will be able to add/remove/reorder widgets (future); default set includes:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Tasks Summary (reads ",(0,r.jsx)(n.code,{children:"/api/crud/tasks/summary"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Workflow Shortcuts (invokes predefined workflows)"}),"\n",(0,r.jsxs)(n.li,{children:["Recently Completed (reads ",(0,r.jsx)(n.code,{children:"/api/crud/tasks?status=COMPLETED&limit=..."}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Navigation menu must be PDP\u2011driven: only pages for which the user is authorized should be listed."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Reference components to embed from Visual Designer:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Visualizer/ExecutionView.tsx"}),": render workflow execution diagrams (mermaid) and raw JSON results."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VisualDesigner/WorkflowExecutor.tsx"}),": modal to execute workflows, monitor progress via SSE ",(0,r.jsx)(n.code,{children:"/api/crud/events/workflow/status/{id}"}),", resume with forms."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Embedding guidance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Wrap embedded components with Experience providers (Auth, React Query)."}),"\n",(0,r.jsx)(n.li,{children:"Calls must remain BFF\u2011relative; do not port any direct service URLs."}),"\n",(0,r.jsxs)(n.li,{children:["Use the Experience ",(0,r.jsx)(n.code,{children:"AuthZProvider"})," and ",(0,r.jsx)(n.code,{children:"useAuthorization"})," to guard access to runner actions."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"enduser-tasks--approvals-experience",children:"End\u2011User Tasks & Approvals (Experience)"}),"\n",(0,r.jsx)(n.p,{children:"The Experience app provides a unified end\u2011user surface for Tasks/To\u2011Dos and approval requests sourced from the CRUD service via the BFF."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Canonical endpoints (via BFF):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/crud/tasks"})," \u2013 list, with filters: ",(0,r.jsx)(n.code,{children:"status"}),", ",(0,r.jsx)(n.code,{children:"type"}),", ",(0,r.jsx)(n.code,{children:"search"}),", ",(0,r.jsx)(n.code,{children:"limit"}),", ",(0,r.jsx)(n.code,{children:"offset"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/crud/tasks/summary"})," \u2013 counters for dashboard"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/crud/tasks/{id}"})," \u2013 task details"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/crud/tasks/{id}/complete"})," \u2013 complete/approve/reject"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Reference API (Visual Designer):"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-29:36:visual_designer/visual_designer/frontend/src/core/api/tasks.ts",children:"export async function listTasks(\n  params?: TaskQueryParams,\n  settings?: AppSettings\n): Promise<TaskListResponse> {\n  const qs = buildQuery(params as Record<string, unknown>);\n  const path = qs ? `/api/crud/tasks?${qs}` : '/api/crud/tasks';\n  return fetchWithAuth(path, { method: 'GET' }, settings) as Promise<TaskListResponse>;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-68:71:visual_designer/visual_designer/frontend/src/core/api/tasks.ts",children:"export async function getTaskSummary(settings?: AppSettings): Promise<TaskSummaryCounters> {\n  logger.debug('Fetching task summary counters');\n  return fetchWithAuth('/api/crud/tasks/summary', { method: 'GET' }, settings) as Promise<TaskSummaryCounters>;\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reference Page (Visual Designer):"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-130:186:visual_designer/visual_designer/frontend/src/pages/TasksPage.tsx",children:'return (\n  <div style={{ background: \'#0b1c3d\', padding: 16 }}>\n    <Space style={{ marginBottom: 16 }} wrap>\n      <Tooltip title="Refresh">\n        <Button icon={<ReloadOutlined />} onClick={fetchData} loading={loading} />\n      </Tooltip>\n      ...\n    </Space>\n    {loading ? (\n      <Spin />\n    ) : (\n      <Table\n        rowKey="id"\n        dataSource={tasks}\n        columns={columns}\n        size="small"\n        pagination={{ pageSize: PAGE_SIZE, current: page, total, onChange: (p) => setPage(p) }}\n      />\n    )}\n    ...\n  </div>\n);\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Experience should mirror this API shape and UI patterns using ",(0,r.jsx)(n.code,{children:"@empowernow/ui"})," components; page lives under ",(0,r.jsx)(n.code,{children:"/tasks"})," and requires session + authorization (see PDP protection below)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"page-protection-via-openid-authzen-pdp",children:"Page Protection via OpenID AuthZEN PDP"}),"\n",(0,r.jsx)(n.p,{children:"All pages must enforce authorization using the OpenID AuthZEN PDP through the BFF. The SPA must not call PDP directly; use BFF endpoints:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /access/v1/evaluation"})," \u2013 single decision"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /access/v1/evaluations"})," \u2013 batch decisions"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Reference (Visual Designer):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-1:12:visual_designer/visual_designer/frontend/src/core/auth/authz-context.tsx",children:"import React, { createContext, useContext } from 'react';\nconst AuthZContext = createContext<PDPStrategy | null>(null);\n...\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-58:66:visual_designer/visual_designer/frontend/src/core/auth/authz-hooks.ts",children:"const response = await fetch(`/access/v1/evaluation`, {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json', ...(token ? { Authorization: `Bearer ${token}` } : {}) },\n  body: JSON.stringify({ resource: { type: res }, action: { name: act }, context: {} }),\n  credentials: 'include',\n});\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-44:55:visual_designer/visual_designer/frontend/src/core/auth/authz-strategy.ts",children:"const { data } = await axios.post('/access/v1/evaluation', {\n  resource: { type: request.resourceType, id: request.resourceId, properties: request.context?.resourceAttributes || {} },\n  action: { name: request.action },\n  context: request.context,\n}, { withCredentials: true });\n"})}),"\n",(0,r.jsx)(n.p,{children:"Implementation guidance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Provide an ",(0,r.jsx)(n.code,{children:"AuthZProvider"})," and a ",(0,r.jsx)(n.code,{children:"useAuthorization()"})," hook to gate routes and actions."]}),"\n",(0,r.jsx)(n.li,{children:"For pages, evaluate coarse permissions on route load; for action buttons (e.g., Approve), evaluate fine\u2011grained permissions per item."}),"\n",(0,r.jsx)(n.li,{children:"Fail closed on PDP errors; surface a helpful message and disable restricted actions."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"handover-notes-experience-app-integration",children:"Handover Notes: Experience App Integration"}),"\n",(0,r.jsx)(n.p,{children:"These are the concrete infra/config steps required to run the Experience SPA in the platform. Use this as the completion checklist for the downstream team."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Experience SPA container"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Build from ",(0,r.jsx)(n.code,{children:"experience/frontend/Dockerfile"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Serve with ",(0,r.jsx)(n.code,{children:"nginx-spa.conf"})," router fallback."]}),"\n",(0,r.jsxs)(n.li,{children:["Compose service should include Traefik labels with SPA rule and security headers middleware reference:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# labels (example)\ntraefik.enable: "true"\ntraefik.http.routers.experience-ui.rule: >-\n  Host(`experience.ocg.labs.empowernow.ai`) &&\n  !PathPrefix(`/api/`) && !PathPrefix(`/auth/`) && !PathPrefix(`/events/`) &&\n  !PathPrefix(`/configs/stream`) && !PathPrefix(`/stream/`) && !PathPrefix(`/access/v1/`) && !PathPrefix(`/health`)\ntraefik.http.routers.experience-ui.entrypoints: websecure\ntraefik.http.routers.experience-ui.tls: "true"\ntraefik.http.routers.experience-ui.middlewares: security-headers@file\ntraefik.http.services.experience-ui.loadbalancer.server.port: "80"\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"BFF Traefik routers (on the BFF service) for the Experience host"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Intercept Experience host API and streaming paths so they reach the BFF before the SPA router:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Streaming: rule on ",(0,r.jsx)(n.code,{children:"Host(experience\u2026) && PathPrefix(/events/|/configs/stream|/stream/|/test/events)"})," \u2192 service ",(0,r.jsx)(n.code,{children:"api"})]}),"\n",(0,r.jsxs)(n.li,{children:["API/auth: rule on ",(0,r.jsx)(n.code,{children:"Host(experience\u2026) && (PathPrefix(/api/|/access/v1/|/auth/))"})," \u2192 service ",(0,r.jsx)(n.code,{children:"api"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"security-headers@file"})," middleware, set priority \u226595 as in other SPAs."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"BFF configuration updates (ServiceConfigs)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"routes.yaml"}),": add internal endpoints for Experience runtime UI config","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/configs/ui"})," (session\u2011protected)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /api/configs/stream"})," (SSE, session\u2011protected)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"settings.yaml"}),": add Experience domain to ",(0,r.jsx)(n.code,{children:"cors.allow_origins"})," and localhost ",(0,r.jsx)(n.code,{children:"5177"})," to ",(0,r.jsx)(n.code,{children:"dev_origins"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"IdP configuration updates (ServiceConfigs)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"settings.yaml"}),": add ",(0,r.jsx)(n.code,{children:"experience.ocg.labs.empowernow.ai"})," to ",(0,r.jsx)(n.code,{children:"trusted_hosts"})," and ",(0,r.jsx)(n.code,{children:"cors_origins"}),"; add ",(0,r.jsx)(n.code,{children:"localhost:5177"})," for local dev."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"clients.yaml"})," (SPA client): append Experience URIs:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"redirect_uris"}),": ",(0,r.jsx)(n.code,{children:"https://experience.ocg.labs.empowernow.ai/callback"}),", ",(0,r.jsx)(n.code,{children:"http://localhost:5177/callback"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"post_logout_redirect_uris"}),": ",(0,r.jsx)(n.code,{children:"https://experience.ocg.labs.empowernow.ai"}),", ",(0,r.jsx)(n.code,{children:"http://localhost:5177"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"BFF environment (compose) updates"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add Experience domain to:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"ALLOWED_REDIRECT_ORIGINS"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ALLOWED_FRONTEND_ORIGINS"})," (also include ",(0,r.jsx)(n.code,{children:"http://localhost:5177"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Experience app routes & modules"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Route: ",(0,r.jsx)(n.code,{children:"/tasks"})," (Tasks & Approvals page). Requires session and authorization."]}),"\n",(0,r.jsxs)(n.li,{children:["Feature toggling: driven by ",(0,r.jsx)(n.code,{children:"/api/configs/ui"})," with SSE at ",(0,r.jsx)(n.code,{children:"/api/configs/stream"}),"; fallback to ",(0,r.jsx)(n.code,{children:"VITE_EXPERIENCE_MODULES"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Local development"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Bind hosts entry for ",(0,r.jsx)(n.code,{children:"experience.ocg.labs.empowernow.ai"})," to the gateway IP used by Traefik."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"npm run dev"})," on port ",(0,r.jsx)(n.code,{children:"5177"})," if testing without containers; set ",(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"})," appropriately."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"readiness-checklist",children:"Readiness Checklist"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uses ",(0,r.jsx)(n.code,{children:"@empowernow/ui"})," components and Neon Flux theme CSS."]}),"\n",(0,r.jsxs)(n.li,{children:["Auth wired via ",(0,r.jsx)(n.code,{children:"@empowernow/bff-auth-react"}),"; session check on load and protected routes."]}),"\n",(0,r.jsxs)(n.li,{children:["All API calls are to the BFF (",(0,r.jsx)(n.code,{children:"/api/**"}),"), with credentials enabled."]}),"\n",(0,r.jsx)(n.li,{children:"React Query used for server state; optional Redux Toolkit only for UI/app state."}),"\n",(0,r.jsx)(n.li,{children:"Env config documented and applied via Vite."}),"\n",(0,r.jsxs)(n.li,{children:["Nginx SPA fallback in container; Traefik routes exclude ",(0,r.jsx)(n.code,{children:"/api/"})," and ",(0,r.jsx)(n.code,{children:"/auth/"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Unit tests (Vitest) and E2E tests (Playwright) pass locally."}),"\n",(0,r.jsx)(n.li,{children:"No direct service URLs or secrets in the client bundle."}),"\n",(0,r.jsxs)(n.li,{children:["CSS import uses ",(0,r.jsx)(n.code,{children:"@empowernow/ui/dist/index.css"})," at the app root."]}),"\n",(0,r.jsxs)(n.li,{children:["Tile grid uses ",(0,r.jsx)(n.code,{children:".tile-grid"})," + ",(0,r.jsx)(n.code,{children:"TileCard"}),"; Ant Design List grid is not used for cards."]}),"\n",(0,r.jsx)(n.li,{children:"Passed visual QA against the Design System Compliance Checklist."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Quick code checks (optional):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Non-standard opacity levels for deep space blue\ngrep -r "rgba(11, 28, 61, 0\\.[^8]" src/\n\n# Custom toolbar/header backgrounds (should use .glass-header)\ngrep -r "background.*rgba.*28.*61" src/ | grep -v "glass-header"\n\n# Raw Monaco usage (should use EmpowerNowMonacoEditor)\ngrep -r "from.*monaco-editor" src/ | grep -v "type"\n\n# \ud83d\udea8 Ant Design List card grid anti-pattern\ngrep -r "List.*grid" src/ | grep -v "// Correct pattern"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"core-principles",children:"Core principles"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"End-user first"}),": fast, simple, predictable. Designer UI never bleeds into runtime."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"BFF-only transport"}),": no tokens in the browser, cookie session via ",(0,r.jsx)(n.code,{children:"/auth/session"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PDP everywhere"}),": routes, nav, widgets, actions, and row-level affordances all PDP-gated."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Live UX"}),": SSE for task counters, workflow status, page widget refreshes."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"information-architecture",children:"Information architecture"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Home/Dashboard"}),": PDP-gated widgets (My Tasks, Recent Workflows, Favorites, Announcements). Drag\u2013drop layout, per-user saved layouts. Live counters via SSE."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pages"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"List of available pages (PDP-filtered) with search/favorites/recent."}),"\n",(0,r.jsxs)(n.li,{children:["Page Runner renders ",(0,r.jsx)(n.code,{children:"PageConfig"})," with: grid(s), search bar, action dock, form modals, empty/error states."]}),"\n",(0,r.jsx)(n.li,{children:"Contextual actions enabled only when rows selected and PDP allows."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Workflows"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Launchpad (search/favorites/recent)."}),"\n",(0,r.jsx)(n.li,{children:"Workflow Runner: start (inputs/form), live status via SSE, visualization (compact), resume/cancel, result panel."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tasks"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Inbox: tabs (All, Assigned to me, Awaiting my approval, Overdue). Filters, bulk actions (if PDP allows), SLA cues."}),"\n",(0,r.jsx)(n.li,{children:"Task Detail: summary, form/resume panel, history/audit, related items."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Activity"}),": recent runs, pages viewed, exported reports (optional)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Profile"}),": preferences (theme, language, time zone), notification settings."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Help"}),": quick tips, keyboard shortcuts."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"authorization-model-pdp",children:"Authorization model (PDP)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-level gating"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Route-level: protect ",(0,r.jsx)(n.code,{children:"/pages"}),", ",(0,r.jsx)(n.code,{children:"/workflows"}),", ",(0,r.jsx)(n.code,{children:"/tasks"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Nav/menu: ",(0,r.jsx)(n.code,{children:"useAuthorization"})," for link visibility and disabled states."]}),"\n",(0,r.jsx)(n.li,{children:"Widget/action-level: PDP checks on button render and on click (defense in depth)."}),"\n",(0,r.jsx)(n.li,{children:"Row-level: action availability per row (batch PDP with cache)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Caching"}),": short-lived PDP cache with TTL and max size; batch endpoints for lists."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"data--realtime",children:"Data + realtime"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API"}),": unified ",(0,r.jsx)(n.code,{children:"api.ts"})," (namespaces: pages, workflows, tasks, crud, pdp)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SSE"}),": channels for ",(0,r.jsx)(n.code,{children:"tasks/summary"}),", ",(0,r.jsx)(n.code,{children:"workflow/status/:id"}),", ",(0,r.jsx)(n.code,{children:"configs/stream"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query"}),": TanStack Query for caching, background refresh, stale-while-revalidate. Optimistic task completes where safe (quick undo)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"authnsession",children:"Authn/session"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Guard"}),": session-driven guard that hits ",(0,r.jsx)(n.code,{children:"/auth/session"}),"; allow ",(0,r.jsx)(n.code,{children:"/auth/*"})," and ",(0,r.jsx)(n.code,{children:"/login"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Callback"}),": ",(0,r.jsx)(n.code,{children:"/auth/callback"})," polls session then navigates to ",(0,r.jsx)(n.code,{children:"return_to"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Session UX"}),": idle timeout prompts, cross-tab sync via BroadcastChannel, graceful re-auth."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"runtime-page-runner-distinct-from-designer",children:"Runtime Page Runner (distinct from Designer)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Renderer"}),": small, production-only renderer that:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Handles multiple grids, simple search (plus advanced when present), pagination."}),"\n",(0,r.jsx)(n.li,{children:"Action dock (general + contextual), form modals (schema-driven)."}),"\n",(0,r.jsx)(n.li,{children:"Minimal mermaid/visualization only in Workflow result panel; no canvas editing."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Empty/error"}),": gentle messages; retry buttons; PDP nudges when denied."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tasks-center",children:"Tasks center"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Inbox UX"}),": keyboard nav, bulk select, quick filters (Overdue, High Priority, My queue)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Detail"}),": approve/complete with form; show upstream workflow breadcrumbs; audit trail."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Counters"}),": SSE-driven; low-frequency background revalidate."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"workflow-runner",children:"Workflow runner"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Start"}),": by name or ID (resolve name); optional quick-launch presets."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": SSE tags RUNNING/COMPLETED/FAILED; result panel; compact diagram (optional)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resume"}),": WAITING_FOR_INPUT form; PDP check before show."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"navigation--personalization",children:"Navigation & personalization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Nav"}),": built from BFF ",(0,r.jsx)(n.code,{children:"/api/configs/ui"})," + PDP; favorites drawer; recent list."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Personalization"}),": pinned pages/workflows; saved filters; per-user dashboard layout."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"non-functional",children:"Non-functional"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Design system"}),": Neon Flux only; responsive; WCAG AA."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Perf"}),": code-split per route; prefetch hover; debounce search; SSR not required."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Telemetry"}),": page views, action clicks, errors to BFF \u2192 Kafka; correlation-id propagation."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security"}),": CSP locked, httpOnly cookies, no localStorage secrets, strict SameSite/Domain."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementation-delta-short",children:"Implementation delta (short)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Finish auth flow"}),": ensure ",(0,r.jsx)(n.code,{children:"/auth/login"})," \u2192 IdP \u2192 ",(0,r.jsx)(n.code,{children:"/auth/callback"})," \u2192 ",(0,r.jsx)(n.code,{children:"/auth/session"})," true."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tasks"}),": switch ",(0,r.jsx)(n.code,{children:"TasksPage"})," to ",(0,r.jsx)(n.code,{children:"tasksApi"}),", add PDP gating, counters via SSE."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pages"}),": replace placeholders with ",(0,r.jsx)(n.code,{children:"PreviewMode"})," renderer (we added minimal); wire forms/actions progressively."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Workflows"}),": keep SSE status + ",(0,r.jsx)(n.code,{children:"ExecutionView"}),"; add resume/cancel endpoints."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Nav gating"}),": already added; extend to route protection wrappers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batch PDP"}),": add ",(0,r.jsx)(n.code,{children:"batchAuthorize"})," calls for lists."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tests"}),": Playwright flows (login, pages list/run, workflow start/status, task approve)."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["If you want, I\u2019ll implement the tasks page wiring (use ",(0,r.jsx)(n.code,{children:"tasksApi"}),", SSE counters, PDP gating) and add route-level PDP guards next, then run the e2e smoke."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);