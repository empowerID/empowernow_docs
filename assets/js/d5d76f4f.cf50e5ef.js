"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2455],{27499:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>l,frontMatter:()=>i,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"services/bff/reference/faq","title":"BFF FAQ (for SPA Developers)","description":"Q: Where does the user identity come from?","source":"@site/docs/services/bff/reference/faq.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/faq","permalink":"/empowernow_docs/docs/services/bff/reference/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/faq.md","tags":[],"version":"current","frontMatter":{"title":"BFF FAQ (for SPA Developers)"},"sidebar":"tutorialSidebar","previous":{"title":"FAPI 2.0 Features \u2014 Verified Support and Configuration","permalink":"/empowernow_docs/docs/services/bff/reference/fapi-support"},"next":{"title":"FIPS 140\u20113 Readiness \u2014 Verified Features, Gaps, and Rollout Steps","permalink":"/empowernow_docs/docs/services/bff/reference/fips-140-3"}}');var o=r(74848),t=r(28453);const i={title:"BFF FAQ (for SPA Developers)"},c=void 0,d={},a=[];function h(e){const s={code:"code",p:"p",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(s.p,{children:["Q: Where does the user identity come from?\nA: From the OIDC ID token (or UserInfo). The BFF stores ",(0,o.jsx)(s.code,{children:"user_id = id_token.sub"})," in the session."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Are backend service tokens the user identity?\nA: No. They\u2019re held server-side by the BFF (often ",(0,o.jsx)(s.code,{children:"sub = client_id"})," like ",(0,o.jsx)(s.code,{children:"bff-server"}),") and must never be exposed to the browser."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Do I need to attach Authorization headers?\nA: No. The BFF uses httpOnly cookies. Use ",(0,o.jsx)(s.code,{children:"apiClient"}),"/",(0,o.jsx)(s.code,{children:"fetchWithAuth"}),"; it sends credentials automatically."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Where do I point my SPA?\nA: Set ",(0,o.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," to your BFF origin (or ",(0,o.jsx)(s.code,{children:"/api"})," when same origin). The app wraps with ",(0,o.jsx)(s.code,{children:"AuthProvider"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Dev vs Prod base URL?\nA: Dev (separate origins): set ",(0,o.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," to the BFF origin (e.g., ",(0,o.jsx)(s.code,{children:"http://localhost:8000/api"}),") and allow your UI origin in CORS. Prod (same origin): set it to ",(0,o.jsx)(s.code,{children:"/api"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Where are the API routes defined?\nA: ",(0,o.jsx)(s.code,{children:"ServiceConfigs/BFF/config/routes.yaml"}),". Example: ",(0,o.jsx)(s.code,{children:"/api/crud/forms/*"})," \u2192 ",(0,o.jsx)(s.code,{children:"crud_service"})," with ",(0,o.jsx)(s.code,{children:"auth: session"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Why do SPA calls look like local ",(0,o.jsx)(s.code,{children:"/api/..."})," paths? How do they reach backends?\nA: Traefik routes ",(0,o.jsx)(s.code,{children:"PathPrefix(/api/*)"})," to the BFF. The BFF reads ",(0,o.jsx)(s.code,{children:"routes.yaml"})," where ",(0,o.jsx)(s.code,{children:"path"})," is the client path and ",(0,o.jsx)(s.code,{children:"upstream_path"})," points to the backend. It proxies the call to the target service (adding auth/context headers) and returns JSON to the SPA."]}),"\n",(0,o.jsx)(s.p,{children:"Q: Why 401 vs 403?\nA: 401 = not authenticated (login). 403 = authenticated but PDP denied the action."}),"\n",(0,o.jsxs)(s.p,{children:["Q: How are permissions decided?\nA: ",(0,o.jsx)(s.code,{children:"core/permissions.py"})," builds context; the route\u2019s inline ",(0,o.jsx)(s.code,{children:"authz_map"})," (preferred) maps method\u2192resource/action; legacy ",(0,o.jsx)(s.code,{children:"pdp.yaml:endpoint_map"})," is used if no inline mapping is present; ",(0,o.jsx)(s.code,{children:"services/pdp_client.py"})," calls PDP and caches decisions."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Which SPAs call the PDP from the UI?\nA: See ",(0,o.jsx)(s.code,{children:"Reference / SPA PDP usage"})," for a current inventory (Visual Designer: yes; IdP UI: no; PDP UI: yes for tools/visualization)."]}),"\n",(0,o.jsx)(s.p,{children:"Q: Can I call services directly?\nA: In production, no. All calls go via the BFF to prevent token exposure and centralize authorization."}),"\n",(0,o.jsxs)(s.p,{children:["Q: How should I register the BFF client with the IdP?\nA: Use the DCR bootstrap runbook. For inline JWKS rotation (no IdP refetch), enable the bootstrapper with ",(0,o.jsx)(s.code,{children:"DCR_ENABLED=true"}),", set ",(0,o.jsx)(s.code,{children:"DCR_SIGNING_KEY"})," and ",(0,o.jsx)(s.code,{children:"BFF_KID"}),", and provide a one-time ",(0,o.jsx)(s.code,{children:"DCR_IAT"})," for first registration. For safe rotations, set ",(0,o.jsx)(s.code,{children:"DCR_ROTATION_SAFE=true"})," and choose a ",(0,o.jsx)(s.code,{children:"DCR_REDIRECT_UPDATE_MODE"}),"."]}),"\n",(0,o.jsx)(s.p,{children:"Q: How do access tokens get renewed?\nA: The BFF auto-refreshes access tokens in the background and on demand before expiry. No SPA changes are required."}),"\n",(0,o.jsxs)(s.p,{children:["Q: How do we rotate credentials safely?\nA: With inline JWKS mode, the bootstrapper performs non-destructive rotations: it adds a new key (up to ",(0,o.jsx)(s.code,{children:"BFF_JWK_MAX_KEYS"}),"), retires old keys after ",(0,o.jsx)(s.code,{children:"BFF_JWK_RETIRE_AFTER_DAYS"}),", and only persists PEM after a successful PATCH. Redirect URIs are merged when ",(0,o.jsx)(s.code,{children:"DCR_ROTATION_SAFE=true"})," to avoid churn."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: Can I rotate or set ",(0,o.jsx)(s.code,{children:"client_secret"})," via public DCR PATCH?\nA: Not supported in our IdP\u2019s public DCR endpoint. Use an admin/out-of-band path if absolutely required; otherwise stick to ",(0,o.jsx)(s.code,{children:"private_key_jwt"})," + ",(0,o.jsx)(s.code,{children:"jwks_uri"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: How do I add a new API?\nA: Add a service in ",(0,o.jsx)(s.code,{children:"routes.yaml:services"}),", then a ",(0,o.jsx)(s.code,{children:"routes"})," entry for your canonical ",(0,o.jsx)(s.code,{children:"/api/<app>/*"})," path with ",(0,o.jsx)(s.code,{children:"auth: session"})," and an ",(0,o.jsx)(s.code,{children:"upstream_path"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Q: How do I style to match EmpowerNow?\nA: Import ",(0,o.jsx)(s.code,{children:"@empowernow/ui/dist/index.css"})," and use components from ",(0,o.jsx)(s.code,{children:"@empowernow/ui"}),"."]})]})}function l(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,s,r)=>{r.d(s,{R:()=>i,x:()=>c});var n=r(96540);const o={},t=n.createContext(o);function i(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);