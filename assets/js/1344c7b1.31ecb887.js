"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[7438],{5275:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"services/bff/explanation/bff-visual-guide","title":"BFF Visual Guide \u2014 Golden Path, Routing, PDP, EmpowerID, Legacy","description":"Use this visual guide to explain the BFF to any audience in minutes. Each diagram is presentable as a slide; keep this page open during your talk.","source":"@site/docs/services/bff/explanation/bff-visual-guide.md","sourceDirName":"services/bff/explanation","slug":"/services/bff/explanation/bff-visual-guide","permalink":"/empowernow_docs/docs/services/bff/explanation/bff-visual-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/explanation/bff-visual-guide.md","tags":[{"inline":true,"label":"service:bff","permalink":"/empowernow_docs/docs/tags/service-bff"},{"inline":true,"label":"type:explanation","permalink":"/empowernow_docs/docs/tags/type-explanation"},{"inline":true,"label":"visuals","permalink":"/empowernow_docs/docs/tags/visuals"}],"version":"current","sidebarPosition":2,"frontMatter":{"id":"bff-visual-guide","title":"BFF Visual Guide \u2014 Golden Path, Routing, PDP, EmpowerID, Legacy","sidebar_label":"Visual Guide","sidebar_position":2,"tags":["service:bff","type:explanation","visuals"]},"sidebar":"tutorialSidebar","previous":{"title":"BFF for React SPAs \u2014 How It Works","permalink":"/empowernow_docs/docs/services/bff/explanation/bff-for-spa-overview"},"next":{"title":"Authorization Model (PDP, Mapping, Caching)","permalink":"/empowernow_docs/docs/services/bff/explanation/authorization"}}');var i=n(74848),s=n(28453);const o={id:"bff-visual-guide",title:"BFF Visual Guide \u2014 Golden Path, Routing, PDP, EmpowerID, Legacy",sidebar_label:"Visual Guide",sidebar_position:2,tags:["service:bff","type:explanation","visuals"]},t=void 0,l={},c=[{value:"High\u2011level architecture",id:"highlevel-architecture",level:2},{value:"Golden Path (SPA login + API calls)",id:"golden-path-spa-login--api-calls",level:2},{value:"How SPA-local &quot;/api&quot; calls reach the BFF",id:"how-spa-local-api-calls-reach-the-bff",level:2},{value:"Automation Studio (Visual Designer) path examples",id:"automation-studio-visual-designer-path-examples",level:3},{value:"Routing layers (where ForwardAuth applies)",id:"routing-layers-where-forwardauth-applies",level:2},{value:"PDP mapping and decision flow",id:"pdp-mapping-and-decision-flow",level:2},{value:"YAML proxy (routes.yaml) model",id:"yaml-proxy-routesyaml-model",level:2},{value:"Legacy services proxy",id:"legacy-services-proxy",level:2},{value:"EmpowerID direct endpoints",id:"empowerid-direct-endpoints",level:2},{value:"Config sources at a glance",id:"config-sources-at-a-glance",level:2},{value:"Local/dev stack (compose)",id:"localdev-stack-compose",level:2},{value:"Presenter notes (grab-and-go)",id:"presenter-notes-grab-and-go",level:3}];function d(e){const r={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.p,{children:"Use this visual guide to explain the BFF to any audience in minutes. Each diagram is presentable as a slide; keep this page open during your talk."}),"\n",(0,i.jsx)(r.h2,{id:"highlevel-architecture",children:"High\u2011level architecture"}),"\n",(0,i.jsx)(r.mermaid,{value:'flowchart LR\r\n  subgraph Client["Client"]\r\n    SPA["Browser / SPA"]\r\n  end\r\n  subgraph Edge["Traefik"]\r\n    TR["Routers + headers<br/>(ForwardAuth optional)"]\r\n  end\r\n  subgraph BFF["BFF"]\r\n    AUTH["/auth/* (login, callback, verify/forward, csrf, logout)"]\r\n    API["/api/** (proxy, composition)"]\r\n  end\r\n  subgraph Control["Control"]\r\n    IDP["IdP OIDC"]\r\n    PDP["PDP AuthZ"]\r\n    REDIS[("Redis sessions and PDP cache")]\r\n  end\r\n  subgraph Backends["Backends"]\r\n    SVC["Backend Services"]\r\n  end\r\n  SPA --\x3e TR --\x3e AUTH\r\n  TR --\x3e API\r\n  BFF <--\x3e IDP\r\n  BFF <--\x3e PDP\r\n  BFF <--\x3e REDIS\r\n  API --\x3e SVC'}),"\n",(0,i.jsx)(r.h2,{id:"golden-path-spa-login--api-calls",children:"Golden Path (SPA login + API calls)"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n  autonumber\r\n  participant SPA\r\n  participant BFF\r\n  participant IdP\r\n  SPA->>BFF: GET /auth/login\r\n  BFF--\x3e>SPA: 302 to IdP /authorize (PKCE/PAR)\r\n  SPA->>IdP: GET /authorize\r\n  IdP--\x3e>BFF: 302 /auth/callback?code=...\r\n  BFF->>IdP: POST /token\r\n  BFF--\x3e>SPA: Set-Cookie bff_session\r\n  BFF--\x3e>SPA: 302 redirect to /\r\n  SPA->>BFF: GET /api/** (cookie + CSRF for writes)\r\n  BFF--\x3e>SPA: 200 JSON"}),"\n",(0,i.jsx)(r.h2,{id:"how-spa-local-api-calls-reach-the-bff",children:'How SPA-local "/api" calls reach the BFF'}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["SPA calls same-origin paths like ",(0,i.jsx)(r.code,{children:"/api/<app>/..."}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Traefik matches ",(0,i.jsx)(r.code,{children:"PathPrefix(/api/*)"})," and routes to the BFF service."]}),"\n",(0,i.jsxs)(r.li,{children:["The BFF looks up the request in ",(0,i.jsx)(r.code,{children:"routes.yaml"})," (",(0,i.jsx)(r.code,{children:"path"})," = client path, ",(0,i.jsx)(r.code,{children:"upstream_path"})," = backend path) and proxies to the target service, injecting auth/context headers."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Example"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-text",children:'Client \u2192 GET /api/myapp/items/123\r\nTraefik \u2192 forwards to BFF (rule: PathPrefix(/api/))\r\nBFF \u2192 routes.yaml: path "/api/myapp/items/*" \u2192 target_service "my_service", upstream_path "/items/{path}"\r\nBFF \u2192 calls GET http://my-service:8080/items/123 (+ Authorization, X-Correlation-ID)\r\nBFF \u2192 returns JSON to SPA\n'})}),"\n",(0,i.jsx)(r.p,{children:"Mini routing diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:"flowchart LR\r\n  UI[SPA] --\x3e|GET /api/myapp/items/123 (cookie)| TR[Traefik]\r\n  TR --\x3e BFF\r\n  subgraph BFF\r\n    R[(routes.yaml)]\r\n  end\r\n  BFF --\x3e|GET /items/123 + Authorization + X-Correlation-ID| SVC[my_service]\r\n  SVC --\x3e BFF --\x3e UI"}),"\n",(0,i.jsxs)(r.p,{children:["See also: ",(0,i.jsx)(r.code,{children:"Reference / YAML proxy (routes.yaml)"})," and ",(0,i.jsx)(r.code,{children:"Reference / Traefik ForwardAuth"}),"."]}),"\n",(0,i.jsx)(r.h3,{id:"automation-studio-visual-designer-path-examples",children:"Automation Studio (Visual Designer) path examples"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["CRUD and SSE: SPA calls ",(0,i.jsx)(r.code,{children:"/api/crud/..."})," \u2192 Traefik \u2192 BFF \u2192 ",(0,i.jsx)(r.code,{children:"crud_service"})]}),"\n",(0,i.jsxs)(r.li,{children:["PDP (AuthZEN): SPA calls ",(0,i.jsx)(r.code,{children:"/access/v1/evaluation"})," and ",(0,i.jsx)(r.code,{children:"/access/v1/evaluations"})," \u2192 Traefik \u2192 BFF \u2192 ",(0,i.jsx)(r.code,{children:"pdp_service"})," (path preserved)"]}),"\n",(0,i.jsxs)(r.li,{children:["Cookies/credentials: fetch ",(0,i.jsx)(r.code,{children:"credentials: 'include'"}),", axios ",(0,i.jsx)(r.code,{children:"withCredentials: true"}),"; EventSource sends cookies (use ",(0,i.jsx)(r.code,{children:"{ withCredentials: true }"})," for cross-origin dev)"]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["See also: ",(0,i.jsx)(r.code,{children:"Reference / SPA PDP usage"})," for a per\u2011SPA inventory of PDP calls and payloads."]}),"\n",(0,i.jsx)(r.h2,{id:"routing-layers-where-forwardauth-applies",children:"Routing layers (where ForwardAuth applies)"}),"\n",(0,i.jsx)(r.mermaid,{value:'flowchart TB\r\n  subgraph Traefik Routers\r\n    RP["bff-public: Host(api..) && PathPrefix(/auth/*)"]\r\n    RR["bff-protected: Host(api..) && PathPrefix(/api/*)<br/>ForwardAuth disabled (BFF handles auth)"]\r\n    PP["pdp-protected: Host(pdp..)<br/>ForwardAuth \u2192 BFF /auth/forward"]\r\n    TD["traefik-dashboard: Host(traefik..)<br/>ForwardAuth \u2192 BFF /auth/forward"]\r\n  end\r\n  subgraph BFF\r\n    Verify["GET /auth/verify or /auth/forward"]\r\n    Auth["/auth/login, /auth/callback, /auth/logout, /auth/csrf"]\r\n    Api["/api/**"]\r\n  end\r\n  RP --\x3e Auth\r\n  RR --\x3e Api\r\n  PP --\x3e Verify --\x3e PP\r\n  TD --\x3e Verify'}),"\n",(0,i.jsx)(r.h2,{id:"pdp-mapping-and-decision-flow",children:"PDP mapping and decision flow"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n  autonumber\r\n  participant Client\r\n  participant BFF\r\n  participant Mapper as PathMapper\r\n  participant PDP as PDP Service\r\n  Client->>BFF: GET /api/crud/forms/123\r\n  BFF->>Mapper: Map via pdp.yaml:endpoint_map\r\n  Mapper--\x3e>BFF: (resource=form, id=123, action=read, props)\r\n  alt cached decision\r\n    BFF--\x3e>Client: 200 (cached allow)\r\n  else cache miss\r\n    BFF->>PDP: POST /v1/evaluation {subject, resource, action, context}\r\n    PDP--\x3e>BFF: decision\r\n    BFF--\x3e>Client: 200 or 403\r\n  end"}),"\n",(0,i.jsx)(r.h2,{id:"yaml-proxy-routesyaml-model",children:"YAML proxy (routes.yaml) model"}),"\n",(0,i.jsxs)(r.p,{children:["What it defines: ",(0,i.jsx)(r.code,{children:"id"}),", ",(0,i.jsx)(r.code,{children:"path"}),", ",(0,i.jsx)(r.code,{children:"target_service"}),", ",(0,i.jsx)(r.code,{children:"upstream_path"}),", ",(0,i.jsx)(r.code,{children:"methods"}),", ",(0,i.jsx)(r.code,{children:"auth"})," (",(0,i.jsx)(r.code,{children:"session|none"}),"), ",(0,i.jsx)(r.code,{children:"streaming"}),", ",(0,i.jsx)(r.code,{children:"preserve_path"}),"."]}),"\n",(0,i.jsx)(r.mermaid,{value:'flowchart LR\r\n  subgraph Caller\r\n    C[SPA / Service]\r\n  end\r\n  subgraph BFF\r\n    IN["Request: /api/<app>/**"]\r\n    RY[(routes.yaml)]\r\n    OUT[Proxy to upstream]\r\n  end\r\n  subgraph Services\r\n    CRUD[CRUDService]\r\n    OTHER[Other APIs]\r\n  end\r\n  C --\x3e IN --\x3e RY --\x3e OUT --\x3e CRUD\r\n  OUT -.-> OTHER'}),"\n",(0,i.jsx)(r.h2,{id:"legacy-services-proxy",children:"Legacy services proxy"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n  participant SPA\r\n  participant BFF\r\n  participant Legacy as Legacy Service\r\n  SPA->>BFF: /api/v1/proxy/{service}/{path}\r\n  BFF->>BFF: Circuit breaker + cache lookup (GET)\r\n  alt cache hit\r\n    BFF--\x3e>SPA: 200 (X-Cache: HIT)\r\n  else cache miss\r\n    BFF->>Legacy: request (auth headers + correlation id)\r\n    Legacy--\x3e>BFF: response\r\n    BFF->>BFF: cache write (GET 200)\r\n    BFF--\x3e>SPA: response (X-Cache: MISS)\r\n  end"}),"\n",(0,i.jsx)(r.h2,{id:"empowerid-direct-endpoints",children:"EmpowerID direct endpoints"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n  participant SPA\r\n  participant BFF\r\n  participant EmpowerID as EmpowerID API\r\n  SPA->>BFF: POST /api/v1/empowerid/workflow {workflow_name, parameters}\r\n  BFF->>BFF: Load empowerid_endpoints.yaml (pdp_resource/action)\r\n  BFF->>EmpowerID: POST /workflows/{name} (client-credentials bearer)\r\n  EmpowerID--\x3e>BFF: 200 JSON\r\n  BFF--\x3e>SPA: Result"}),"\n",(0,i.jsx)(r.p,{children:"Endpoints quick list:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["POST ",(0,i.jsx)(r.code,{children:"/api/v1/empowerid/workflow"})]}),"\n",(0,i.jsxs)(r.li,{children:["POST ",(0,i.jsx)(r.code,{children:"/api/v1/empowerid/webui"})]}),"\n",(0,i.jsxs)(r.li,{children:["GET ",(0,i.jsx)(r.code,{children:"/api/v1/empowerid/workflows"})]}),"\n",(0,i.jsxs)(r.li,{children:["GET ",(0,i.jsx)(r.code,{children:"/api/v1/empowerid/webui/types"})]}),"\n",(0,i.jsxs)(r.li,{children:["GET ",(0,i.jsx)(r.code,{children:"/api/v1/empowerid/webui/types/{type}/methods"})]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"config-sources-at-a-glance",children:"Config sources at a glance"}),"\n",(0,i.jsx)(r.mermaid,{value:"flowchart TB\r\n  subgraph Config\r\n    RY[routes.yaml]\r\n    PY[pdp.yaml]\r\n    IY[idps.yaml]\r\n    EY[empowerid_endpoints.yaml]\r\n  end\r\n  subgraph Runtime\r\n    BFF[BFF]\r\n  end\r\n  RY --\x3e BFF\r\n  PY --\x3e BFF\r\n  IY --\x3e BFF\r\n  EY --\x3e BFF"}),"\n",(0,i.jsx)(r.h2,{id:"localdev-stack-compose",children:"Local/dev stack (compose)"}),"\n",(0,i.jsx)(r.mermaid,{value:'flowchart LR\r\n  subgraph Traefik\r\n    R1["api.* /api/**"]\r\n    R2["automate, authn, authz /auth/**"]\r\n    FA[bff-forwardauth]\r\n  end\r\n  subgraph BFF\r\n    V["/auth/verify/"]\r\n    A["/auth/login, /auth/callback, /auth/logout/"]\r\n    API["/api/**/"]\r\n  end\r\n  R1 --\x3e FA --\x3e V --\x3e API\r\n  R2 --\x3e A'}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"presenter-notes-grab-and-go",children:"Presenter notes (grab-and-go)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Start with the architecture slide and emphasize: tokens stay server\u2011side; SPAs use cookies."}),"\n",(0,i.jsx)(r.li,{children:"Golden Path: PKCE/PAR redirect; cookie set; CSRF required for writes."}),"\n",(0,i.jsxs)(r.li,{children:["Routing: ForwardAuth only on edge hosts like PDP and dashboard; disabled for same\u2011origin ",(0,i.jsx)(r.code,{children:"/api/**"}),"."]}),"\n",(0,i.jsx)(r.li,{children:"PDP: show how a path maps to resource/action; caching reduces latency."}),"\n",(0,i.jsxs)(r.li,{children:["routes.yaml: canonical ",(0,i.jsx)(r.code,{children:"/api/<app>/**"})," families; use custom endpoints for composition/transformations."]}),"\n",(0,i.jsx)(r.li,{children:"Legacy proxy: bridge with circuit breaker and cache; not for new greenfield."}),"\n",(0,i.jsx)(r.li,{children:"EmpowerID: catalog\u2011driven; workflows via client\u2011credentials; WebUI per catalog."}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>t});var a=n(96540);const i={},s=a.createContext(i);function o(e){const r=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:r},e.children)}}}]);