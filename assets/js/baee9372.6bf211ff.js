"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[1329],{23612:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"services/crud-service/secrets/providers","title":"Providers","description":"OpenBao/HashiCorp KVv2 and YAML dev provider","source":"@site/docs/services/crud-service/secrets/04-providers.md","sourceDirName":"services/crud-service/secrets","slug":"/services/crud-service/secrets/providers","permalink":"/empowernow_docs/docs/services/crud-service/secrets/providers","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/secrets/04-providers.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Providers","description":"OpenBao/HashiCorp KVv2 and YAML dev provider"},"sidebar":"tutorialSidebar","previous":{"title":"Canonical URIs and policy model","permalink":"/empowernow_docs/docs/services/crud-service/secrets/canonical-uris-and-policy"},"next":{"title":"Security model","permalink":"/empowernow_docs/docs/services/crud-service/secrets/security-model"}}');var n=i(74848),d=i(28453);const l={title:"Providers",description:"OpenBao/HashiCorp KVv2 and YAML dev provider"},t=void 0,c={},a=[{value:"What a provider is",id:"what-a-provider-is",level:2},{value:"Multi\u2011provider model",id:"multiprovider-model",level:2},{value:"Capabilities",id:"capabilities",level:2},{value:"How Canonical URIs map to providers",id:"how-canonical-uris-map-to-providers",level:2},{value:"Configuration (ops)",id:"configuration-ops",level:2},{value:"Provider trust and credentials (CISO)",id:"provider-trust-and-credentials-ciso",level:2},{value:"Error mapping and reliability",id:"error-mapping-and-reliability",level:2},{value:"Adding a new provider (extensibility)",id:"adding-a-new-provider-extensibility",level:2},{value:"Enablement steps (Admin)",id:"enablement-steps-admin",level:2},{value:"CLI examples (KVv2)",id:"cli-examples-kvv2",level:2},{value:"QA notes",id:"qa-notes",level:2}];function o(e){const r={code:"code",h2:"h2",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"what-a-provider-is",children:"What a provider is"}),"\n",(0,n.jsx)(r.p,{children:"Providers are backing secret stores that actually persist and return values. The Secrets Platform treats providers behind a stable abstraction so policy (PDP), auditing, and Canonical URIs are consistent regardless of where secrets live."}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"VaultService (PEP) is provider\u2011agnostic. It parses the Canonical Secret URI, authorizes via PDP, then delegates to a provider strategy."}),"\n",(0,n.jsx)(r.li,{children:"Provider strategies implement a common interface (read, write, delete, metadata, versions, list/search when available) and emit audits."}),"\n",(0,n.jsxs)(r.li,{children:["Canonical URIs select the provider and engine: ",(0,n.jsx)(r.code,{children:"provider[+engine]://<mount>/<path>#<fragment>[?version=N]"}),"."]}),"\n"]}),"\n",(0,n.jsx)(r.mermaid,{value:'flowchart LR\r\n  Caller["App / Workflow / Agent"] --\x3e PEP["VaultService (PEP)"]\r\n  PEP --\x3e PDP["SecretPolicyService (PDP)"]\r\n  PEP --\x3e|"strategy: openbao+kv2"| Bao["OpenBao KVv2 strategy"]\r\n  PEP --\x3e|"strategy: hashicorp+kv2"| Hcv["HashiCorp KVv2 strategy"]\r\n  PEP --\x3e|"strategy: yaml"| Yaml["YAML dev strategy"]\r\n  Bao --\x3e ProviderBao[("OpenBao cluster")]\r\n  Hcv --\x3e ProviderHcv[("HashiCorp Vault")]\r\n  Yaml --\x3e FileDev[("dev YAML file")]\r\n  PEP --\x3e Aud["Kafka audits \u2192 Analytics"]'}),"\n",(0,n.jsx)(r.h2,{id:"multiprovider-model",children:"Multi\u2011provider model"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Canonical URIs encode provider and engine (e.g., ",(0,n.jsx)(r.code,{children:"openbao+kv2://secret/app/api#token"}),")."]}),"\n",(0,n.jsxs)(r.li,{children:["Tenant/mount guards are enforced before any provider call (",(0,n.jsx)(r.code,{children:"TENANT_ALLOWED_MOUNTS"}),")."]}),"\n",(0,n.jsx)(r.li,{children:"PDP decision and obligations are uniform across providers; the PEP enforces them, then calls a provider strategy."}),"\n",(0,n.jsxs)(r.li,{children:["Strategies are registered in ",(0,n.jsx)(r.code,{children:"VaultService"})," so adding a new provider does not change callers or policy."]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"capabilities",children:"Capabilities"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Capability"}),(0,n.jsx)(r.th,{children:"OpenBao/HashiCorp KVv2"}),(0,n.jsx)(r.th,{children:"YAML (dev only)"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Read map/fragment"}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u2705"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsxs)(r.td,{children:["Versioned reads (",(0,n.jsx)(r.code,{children:"?version=N"}),")"]}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u274c"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Soft delete"}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u274c"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Undelete versions"}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u274c"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Destroy versions"}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u274c"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"List keys / shallow traversal"}),(0,n.jsx)(r.td,{children:"\u2705 (provider API)"}),(0,n.jsx)(r.td,{children:"\u2705 (in\u2011file)"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Custom metadata (owner/created_by/created_at)"}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u274c"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Owner update API support"}),(0,n.jsx)(r.td,{children:"\u2705"}),(0,n.jsx)(r.td,{children:"\u274c"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Audit events"}),(0,n.jsx)(r.td,{children:"\u2705 (Kafka)"}),(0,n.jsx)(r.td,{children:"\u2705 (Kafka)"})]})]})]}),"\n",(0,n.jsx)(r.p,{children:"Notes"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["KVv2 providers surface ",(0,n.jsx)(r.code,{children:"custom_metadata"})," used as resource attributes in PDP context (owner, created_by, created_at). First write/rotate stamps these."]}),"\n",(0,n.jsx)(r.li,{children:"YAML provider is file\u2011backed for local development and is blocked for writes/deletes outside dev/test."}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"how-canonical-uris-map-to-providers",children:"How Canonical URIs map to providers"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Scheme: ",(0,n.jsx)(r.code,{children:"openbao+kv2"}),", ",(0,n.jsx)(r.code,{children:"hashicorp+kv2"}),", or ",(0,n.jsx)(r.code,{children:"yaml"})]}),"\n",(0,n.jsxs)(r.li,{children:["Mount: first path segment after ",(0,n.jsx)(r.code,{children:"://"})," (e.g., ",(0,n.jsx)(r.code,{children:"secret"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:["Path: remaining path segments (",(0,n.jsx)(r.code,{children:"app/api"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:["Fragment: key within the KV map (",(0,n.jsx)(r.code,{children:"#token"}),")"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"Examples"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.code,{children:"openbao+kv2://secret/app/api#token?version=3"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.code,{children:"yaml://secret/dev#CREDENTIAL_ENCRYPTION_KEY"})}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"configuration-ops",children:"Configuration (ops)"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["KVv2","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"VAULT_URL"}),", ",(0,n.jsx)(r.code,{children:"VAULT_TOKEN"})," (or AppRole)"]}),"\n",(0,n.jsxs)(r.li,{children:["Timeouts, retries, pool size: ",(0,n.jsx)(r.code,{children:"VAULT_TIMEOUT"}),", ",(0,n.jsx)(r.code,{children:"VAULT_POOL_SIZE"}),", etc."]}),"\n",(0,n.jsxs)(r.li,{children:["HA/Load balancing: see ",(0,n.jsx)(r.code,{children:"SECRETS_HA_OPENBAO.md"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["YAML (dev)","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.code,{children:"YAML_VAULT_PATH"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["Platform guards","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"TENANT_ID"}),", ",(0,n.jsx)(r.code,{children:"TENANT_ALLOWED_MOUNTS"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"ENABLE_AUTHORIZATION=true"})," (PEP\u2192PDP)"]}),"\n",(0,n.jsxs)(r.li,{children:["Optional API hardening: ",(0,n.jsx)(r.code,{children:"SECRETS_API_REQUIRE_AUTH"}),", ",(0,n.jsx)(r.code,{children:"SECRETS_ENFORCE_SCOPES"}),", ",(0,n.jsx)(r.code,{children:"SECRETS_AUDIENCE"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"provider-trust-and-credentials-ciso",children:"Provider trust and credentials (CISO)"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Least\u2011privilege provider policies per mount; rotate provider credentials regularly"}),"\n",(0,n.jsx)(r.li,{children:"Provider tokens/AppRole are stored via secure secret pointers; never committed to code"}),"\n",(0,n.jsxs)(r.li,{children:["Audits do not leak sensitive URIs (HMAC(",(0,n.jsx)(r.code,{children:"resource_ref"}),") when ",(0,n.jsx)(r.code,{children:"TENANT_SALT"})," is set)"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"error-mapping-and-reliability",children:"Error mapping and reliability"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Provider 404 vs policy 403 are distinguished at the PEP (guard first, then provider error)"}),"\n",(0,n.jsx)(r.li,{children:"Retries/backoff and rate limiting recommended; 429/503 surfaced upstream with context"}),"\n",(0,n.jsx)(r.li,{children:"OpenTelemetry spans include provider calls; Kafka events capture success/failure"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"adding-a-new-provider-extensibility",children:"Adding a new provider (extensibility)"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["Implement a strategy with the common methods:","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"get_credentials(path, ...)"}),", ",(0,n.jsx)(r.code,{children:"create_or_update_secret(path, payload)"}),", ",(0,n.jsx)(r.code,{children:"delete_secret(path, destroy=...)"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"read_secret_metadata(path)"}),", ",(0,n.jsx)(r.code,{children:"list_keys(prefix)"}),", optional search"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["Register strategy under a new scheme (e.g., ",(0,n.jsx)(r.code,{children:"myprov+engine"}),") in ",(0,n.jsx)(r.code,{children:"VaultService.strategies"})]}),"\n",(0,n.jsx)(r.li,{children:"Ensure Canonical URI parsing supports the scheme (provider and optional engine)"}),"\n",(0,n.jsx)(r.li,{children:"Emit Kafka audits on success/failure; include provider name and canonical URI"}),"\n",(0,n.jsx)(r.li,{children:"Add tests for reads/writes/metadata and edge cases (soft\u2011delete, not found, permissions)"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"enablement-steps-admin",children:"Enablement steps (Admin)"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsx)(r.li,{children:"Configure provider URL/credentials"}),"\n",(0,n.jsx)(r.li,{children:"Define mounts and least\u2011privilege policies"}),"\n",(0,n.jsx)(r.li,{children:"Set tenant/mount guards"}),"\n",(0,n.jsx)(r.li,{children:"Enable PDP authorization and optional API scopes"}),"\n",(0,n.jsx)(r.li,{children:"Validate with sample reads/writes and confirm audits/metrics"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"cli-examples-kvv2",children:"CLI examples (KVv2)"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"# KVv2 write (OpenBao/HashiCorp)\r\nvault kv put secret/app/api token=abc\r\n\r\n# Read a specific version\r\nvault kv get -version=2 secret/app/api\n"})}),"\n",(0,n.jsx)(r.h2,{id:"qa-notes",children:"QA notes"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Use a fake provider or record/replay to avoid touching live vaults in CI"}),"\n",(0,n.jsx)(r.li,{children:"Exercise edge cases: missing metadata, soft\u2011deleted keys, 404 vs 403 mapping, version pin reads"}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.p,{children:"See also"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Authorization model: ",(0,n.jsx)(r.code,{children:"./11-authorization-model-authzen.md"})]}),"\n",(0,n.jsxs)(r.li,{children:["PDP enrichment (context fields): ",(0,n.jsx)(r.code,{children:"./SECRETS_PDP_ENRICHMENT.md"})]}),"\n",(0,n.jsxs)(r.li,{children:["Security model (binding, anti\u2011replay): ",(0,n.jsx)(r.code,{children:"./05-security-model.md"})]}),"\n",(0,n.jsxs)(r.li,{children:["API reference: ",(0,n.jsx)(r.code,{children:"./09-api-reference.md"})]}),"\n",(0,n.jsxs)(r.li,{children:["OpenBao HA: ",(0,n.jsx)(r.code,{children:"./SECRETS_HA_OPENBAO.md"})]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},28453:(e,r,i)=>{i.d(r,{R:()=>l,x:()=>t});var s=i(96540);const n={},d=s.createContext(n);function l(e){const r=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),s.createElement(d.Provider,{value:r},e.children)}}}]);