"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[6075],{28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var r=o(96540);const c={},t=r.createContext(c);function s(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),r.createElement(t.Provider,{value:n},e.children)}},78318:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"services/nowconnect/how-to/cloud-hub-deploy","title":"cloud-hub-deploy","description":"Deploy the NowConnect Cloud Hub","source":"@site/docs/services/nowconnect/how-to/cloud-hub-deploy.md","sourceDirName":"services/nowconnect/how-to","slug":"/services/nowconnect/how-to/cloud-hub-deploy","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/cloud-hub-deploy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/nowconnect/how-to/cloud-hub-deploy.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"NowConnect","permalink":"/empowernow_docs/docs/services/nowconnect/"},"next":{"title":"connect-common-protocols","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/connect-common-protocols"}}');var c=o(74848),t=o(28453);const s={},l=void 0,i={},d=[{value:"Deploy the NowConnect Cloud Hub",id:"deploy-the-nowconnect-cloud-hub",level:2},{value:"Configuration (cloud.yaml excerpt)",id:"configuration-cloudyaml-excerpt",level:3},{value:"Dockerfile (cloud)",id:"dockerfile-cloud",level:3},{value:"Compose (cloud excerpt with Traefik routing to <code>/tunnel</code>)",id:"compose-cloud-excerpt-with-traefik-routing-to-tunnel",level:3},{value:"Notes",id:"notes",level:3}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"deploy-the-nowconnect-cloud-hub",children:"Deploy the NowConnect Cloud Hub"}),"\n",(0,c.jsxs)(n.p,{children:["The Cloud Hub is a FastAPI service exposing ",(0,c.jsx)(n.code,{children:"/tunnel"})," (WebSocket), ",(0,c.jsx)(n.code,{children:"/healthz"}),", ",(0,c.jsx)(n.code,{children:"/readyz"}),", and ",(0,c.jsx)(n.code,{children:"/metrics"}),". It binds TCP listeners that map to connector names."]}),"\n",(0,c.jsx)(n.h3,{id:"configuration-cloudyaml-excerpt",children:"Configuration (cloud.yaml excerpt)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"tunnel:\r\n  host: 0.0.0.0\r\n  port: 8765\r\n\r\nlisteners:\r\n  - name: ldap\r\n    bind: 0.0.0.0:389\r\n    connector: addomain\r\n\r\nlimits:\r\n  queue_depth_per_cid: 100\r\n  idle_timeout_ms: 60000\r\n\r\nsecurity:\r\n  jwks_url: http://idp-app:8002/api/oidc/jwks\r\n  audience: nowconnect\r\n  allow_cidrs:\r\n    - 0.0.0.0/0\r\n\r\nobservability:\r\n  log_level: INFO\n"})}),"\n",(0,c.jsx)(n.h3,{id:"dockerfile-cloud",children:"Dockerfile (cloud)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-dockerfile",children:'FROM python:3.11-slim\r\n\r\nWORKDIR /app\r\n\r\nCOPY pyproject.toml /app/pyproject.toml\r\nCOPY src /app/src\r\n\r\nRUN pip install --no-cache-dir -e .\r\n\r\nENV PYTHONUNBUFFERED=1\r\n\r\nEXPOSE 8765\r\n\r\nCMD ["uvicorn", "nowconnect_cloud.app:app", "--host", "0.0.0.0", "--port", "8765"]\n'})}),"\n",(0,c.jsxs)(n.h3,{id:"compose-cloud-excerpt-with-traefik-routing-to-tunnel",children:["Compose (cloud excerpt with Traefik routing to ",(0,c.jsx)(n.code,{children:"/tunnel"}),")"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'services:\r\n  nowconnect-cloud:\r\n    image: your-registry/nowconnect-cloud:latest\r\n    environment:\r\n      SERVICE_CONFIG_DIR: /app/config\r\n      LOG_LEVEL: info\r\n      OTEL_EXPORTER_OTLP_ENDPOINT: http://otel-collector:4317\r\n      NC_CONFIG: /app/config/cloud.yaml\r\n    volumes:\r\n      - C:/source/repos/ServiceConfigs/NowConnect/config:/app/config\r\n    ports:\r\n      - "389:389"\r\n      - "636:636"\r\n      - "400:400"\r\n    labels:\r\n      - "traefik.enable=true"\r\n      - "traefik.http.routers.nowconnect-ws.rule=Host(`api.ocg.labs.empowernow.ai`) && Path(`/tunnel`)"\r\n      - "traefik.http.routers.nowconnect-ws.entrypoints=websecure"\r\n      - "traefik.http.routers.nowconnect-ws.tls=true"\r\n      - "traefik.http.services.nowconnect-ws.loadbalancer.server.port=8765"\n'})}),"\n",(0,c.jsx)(n.h3,{id:"notes",children:"Notes"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Validate WS upgrade with JWT (audience ",(0,c.jsx)(n.code,{children:"nowconnect"}),"); reconcile ",(0,c.jsx)(n.code,{children:"HELLO"})," claims."]}),"\n",(0,c.jsx)(n.li,{children:"Enforce optional CIDR allowlists on TCP listeners."}),"\n",(0,c.jsxs)(n.li,{children:["Export Prometheus metrics at ",(0,c.jsx)(n.code,{children:"/metrics"}),"; instrument dashboards and alerts."]}),"\n",(0,c.jsxs)(n.li,{children:["See also: ",(0,c.jsx)(n.a,{href:"/empowernow_docs/docs/services/nowconnect/reference/ports-and-protocols",children:"Ports and Protocols"}),"."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}}}]);