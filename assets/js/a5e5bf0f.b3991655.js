"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[9325],{28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>t});var i=r(96540);const s={},l=i.createContext(s);function c(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(l.Provider,{value:n},e.children)}},75009:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"services/pdp/explanation/policy_author_guide","title":"PDP Policy DSL \u2013 Author & Auditor Guide","description":"Last updated 6/1/2025 \u2013 all examples validated with the live YAMLPolicyParser.","source":"@site/docs/services/pdp/explanation/policy_author_guide.md","sourceDirName":"services/pdp/explanation","slug":"/services/pdp/explanation/policy_author_guide","permalink":"/empowernow_docs/docs/services/pdp/explanation/policy_author_guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/pdp/explanation/policy_author_guide.md","tags":[],"version":"current","frontMatter":{}}');var s=r(74848),l=r(28453);const c={},t="PDP Policy DSL \u2013 Author & Auditor Guide",o={},d=[{value:"0  Introduction",id:"0--introduction",level:2},{value:"1  Policy Anatomy (quick recap)",id:"1--policy-anatomy-quick-recap",level:2},{value:"1.1 Metadata",id:"11-metadata",level:3},{value:"1.2 Subjects",id:"12-subjects",level:3},{value:"1.3 Rules",id:"13-rules",level:3},{value:"2  Syntactic-Sugar Catalogue",id:"2--syntactic-sugar-catalogue",level:2},{value:"3  Conditions \u2013 Operator Reminders",id:"3--conditions--operator-reminders",level:2},{value:"3.1 Guarded permits \u2014 prefer <code>when</code> for &quot;permit-only-on-match&quot;",id:"31-guarded-permits--prefer-when-for-permit-only-on-match",level:3},{value:"Correct mental model",id:"correct-mental-model",level:4},{value:"Why this matters",id:"why-this-matters",level:4},{value:"Anti-pattern (over-permitting)",id:"anti-pattern-over-permitting",level:4},{value:"Recommended pattern (true guard)",id:"recommended-pattern-true-guard",level:4},{value:"Alternatives (choose by style)",id:"alternatives-choose-by-style",level:4},{value:"Do / Don\u2019t",id:"do--dont",level:4},{value:"Lint rule suggestion",id:"lint-rule-suggestion",level:4},{value:"Testing checklist",id:"testing-checklist",level:4},{value:"4  Obligations &amp; Constraints",id:"4--obligations--constraints",level:2},{value:"5  Worked Examples",id:"5--worked-examples",level:2},{value:"5.1 Basic allow / deny",id:"51-basic-allow--deny",level:3},{value:"5.2 <code>none</code> sugar",id:"52-none-sugar",level:3},{value:"5.3 <code>If / Then / Else</code>",id:"53-if--then--else",level:3},{value:"5.4 Path-attribute matching",id:"54-path-attribute-matching",level:3},{value:"5.5 Environment &amp; time helpers",id:"55-environment--time-helpers",level:3},{value:"5.6 CIDR and IP range",id:"56-cidr-and-ip-range",level:3},{value:"5.7 Velocity and money operators",id:"57-velocity-and-money-operators",level:3},{value:"5.8 If / Then / Else branching",id:"58-if--then--else-branching",level:3},{value:"6  Application-Scoped Policy Organization",id:"6--application-scoped-policy-organization",level:2},{value:"6.1 How It Works",id:"61-how-it-works",level:3},{value:"6.2 Five-Level Inheritance Hierarchy",id:"62-five-level-inheritance-hierarchy",level:3},{value:"6.3 Directory Structure Example",id:"63-directory-structure-example",level:3},{value:"6.4 Policy File Examples",id:"64-policy-file-examples",level:3},{value:"6.5 Inheritance Behavior",id:"65-inheritance-behavior",level:3},{value:"6.6 Performance Benefits",id:"66-performance-benefits",level:3},{value:"6.7 Fallback Behavior",id:"67-fallback-behavior",level:3},{value:"7  Audit Checklist",id:"7--audit-checklist",level:2},{value:"7.1 Traditional Policy Auditing",id:"71-traditional-policy-auditing",level:3},{value:"7.2 Application-Scoped Policy Auditing",id:"72-application-scoped-policy-auditing",level:3},{value:"8  LLM Assistance",id:"8--llm-assistance",level:2}];function a(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"pdp-policy-dsl--author--auditor-guide",children:"PDP Policy DSL \u2013 Author & Auditor Guide"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Last updated 6/1/2025 \u2013 all examples validated with the live ",(0,s.jsx)(n.code,{children:"YAMLPolicyParser"}),"."]})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"0--introduction",children:"0  Introduction"}),"\n",(0,s.jsxs)(n.p,{children:["This guide complements the quick-reference cheat-sheet and walks you through ",(0,s.jsx)(n.strong,{children:"writing, reviewing and auditing"})," policies using the PDP's DSL (supporting ABAC, PBAC and ReBAC patterns)."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Syntax flexibility"})," \u2013 choose between classical ",(0,s.jsx)(n.code,{children:"effect + when"})," or sugar-based ",(0,s.jsx)(n.code,{children:"allowIf/denyIf"}),", ",(0,s.jsx)(n.code,{children:"all/any/none"}),", ",(0,s.jsx)(n.code,{children:"If/Then/Else"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Human-readable"})," \u2013 every rule can be read aloud; obligations/constraints add enforcement hooks."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deny-override"})," \u2013 if ",(0,s.jsx)(n.strong,{children:"any"})," rule with effect ",(0,s.jsx)(n.strong,{children:"deny"})," matches, the whole request is denied."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"LLM-friendly"})," \u2013 sample system-prompt provided in a separate file (",(0,s.jsx)(n.code,{children:"docs/llm_prompt.md"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1--policy-anatomy-quick-recap",children:"1  Policy Anatomy (quick recap)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Policy  \u2192 metadata + subjects[] + rules[]\r\nRule    \u2192 resource + action + effect/condition + obligations/constraints\r\nEffect  \u2192 permit | deny  (implicitly set by sugar fields)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"11-metadata",children:"1.1 Metadata"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"id"}),", ",(0,s.jsx)(n.code,{children:"name"}),", ",(0,s.jsx)(n.code,{children:"version"}),", ",(0,s.jsx)(n.code,{children:"description"}),", ",(0,s.jsx)(n.code,{children:"schema_version"}),", ",(0,s.jsx)(n.code,{children:"type"}),", ",(0,s.jsx)(n.code,{children:"policy_type"}),", ",(0,s.jsx)(n.code,{children:"terms"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"12-subjects",children:"1.2 Subjects"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Static:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"subjects:\r\n  - type: user\r\n    id: alice@example.com\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Dynamic (predicate):","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"subjects:\r\n  - where: subject.properties.roles IN ['admin','manager']\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"13-rules",children:"1.3 Rules"}),"\n",(0,s.jsx)(n.p,{children:"Minimal sugar style:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- resource: account\r\n  action: create\r\n  allowIf: subject.department == 'Finance'\n"})}),"\n",(0,s.jsx)(n.p,{children:'Same rule, "classic" style:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- resource: account\r\n  action: create\r\n  effect: permit\r\n  when: subject.department == 'Finance'\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2--syntactic-sugar-catalogue",children:"2  Syntactic-Sugar Catalogue"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Sugar"}),(0,s.jsx)(n.th,{children:"Meaning"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"allowIf"})}),(0,s.jsxs)(n.td,{children:["Sets effect ",(0,s.jsx)(n.strong,{children:"permit"})," when expression true"]}),(0,s.jsxs)(n.td,{children:["shorthand for ",(0,s.jsx)(n.code,{children:"effect: permit"})," + ",(0,s.jsx)(n.code,{children:"condition:"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"denyIf"})}),(0,s.jsxs)(n.td,{children:["Sets effect ",(0,s.jsx)(n.strong,{children:"deny"}),"  when expression true"]}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"when"})}),(0,s.jsxs)(n.td,{children:["Alias for ",(0,s.jsx)(n.code,{children:"condition:"})," (classic style)"]}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"all"})," / ",(0,s.jsx)(n.code,{children:"any"})]}),(0,s.jsx)(n.td,{children:"Conjunction / disjunction list"}),(0,s.jsxs)(n.td,{children:["inside ",(0,s.jsx)(n.code,{children:"allowIf"}),", ",(0,s.jsx)(n.code,{children:"denyIf"}),", ",(0,s.jsx)(n.code,{children:"when"}),", ",(0,s.jsx)(n.code,{children:"unless"}),", etc."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"none"})}),(0,s.jsx)(n.td,{children:"NOT(OR(list))"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"unless"})," / ",(0,s.jsx)(n.code,{children:"exceptIf"})]}),(0,s.jsx)(n.td,{children:"Negate the inner condition"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"If / Then / Else"})}),(0,s.jsxs)(n.td,{children:["Branching \u2013 expands to ",(0,s.jsx)(n.code,{children:"(IF and THEN) OR (NOT IF and ELSE)"})]}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Remember: sugar overrides an ",(0,s.jsx)(n.code,{children:"effect:"})," you explicitly set\u2014avoid mixing styles inside one rule."]})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3--conditions--operator-reminders",children:"3  Conditions \u2013 Operator Reminders"}),"\n",(0,s.jsxs)(n.p,{children:["Use uppercase logical connectors ",(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"AND"})," / ",(0,s.jsx)(n.code,{children:"OR"})," / ",(0,s.jsx)(n.code,{children:"NOT"})]}),".  Supported comparison operators:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"== != > < >= <= IN NOT IN LIKE NOT LIKE MATCHES NOT MATCHES\n"})}),"\n",(0,s.jsx)(n.p,{children:"Avoid deprecated patterns:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"context.attributes.delegator_id != None"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u274c ",(0,s.jsx)(n.code,{children:"context.attributes.delegator_id is not None"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"subject.flag == true"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u274c ",(0,s.jsx)(n.code,{children:"subject.flag == True"}),"  (capital ",(0,s.jsx)(n.em,{children:"T"})," unquoted becomes Python, not YAML)"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"31-guarded-permits--prefer-when-for-permit-only-on-match",children:["3.1 Guarded permits \u2014 prefer ",(0,s.jsx)(n.code,{children:"when"}),' for "permit-only-on-match"']}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Audience:"})," Policy authors and reviewers"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Goal:"})," Avoid accidental over-permitting by using the correct guard construct"]}),"\n",(0,s.jsx)(n.h4,{id:"correct-mental-model",children:"Correct mental model"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rule applicability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["A rule first matches by ",(0,s.jsx)(n.code,{children:"resource"})," and ",(0,s.jsx)(n.code,{children:"action"}),". Only then do ",(0,s.jsx)(n.code,{children:"condition"}),"/sugar fields influence outcome."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"allowIf"})," (conditional override)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If condition is true \u2192 the rule\u2019s effect becomes permit."}),"\n",(0,s.jsxs)(n.li,{children:["If condition is false \u2192 the rule keeps its base effect. The rule still applies (it is not ",(0,s.jsx)(n.code,{children:"not_applicable"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"when"})," (guard/condition)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If condition is true \u2192 the rule applies and enforces its effect."}),"\n",(0,s.jsxs)(n.li,{children:["If condition is false \u2192 the rule is ",(0,s.jsx)(n.code,{children:"not_applicable"})," (it contributes neither permit nor deny)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Final default"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If no applicable rule permits, the final decision is deny. There\u2019s no global \u201cfallback to permit.\u201d"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"why-this-matters",children:"Why this matters"}),"\n",(0,s.jsxs)(n.p,{children:["Authors often intend \u201cpermit only when the condition holds.\u201d With ",(0,s.jsx)(n.code,{children:"allowIf"})," + ",(0,s.jsx)(n.code,{children:'effect: "permit"'}),", a false condition keeps the base effect ",(0,s.jsx)(n.code,{children:"permit"})," and still permits. Use ",(0,s.jsx)(n.code,{children:"when"})," for guard semantics so a false condition yields ",(0,s.jsx)(n.code,{children:"not_applicable"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"anti-pattern-over-permitting",children:"Anti-pattern (over-permitting)"}),"\n",(0,s.jsx)(n.p,{children:"Behavior: false condition \u2192 base effect stays permit; rule still permits."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# Avoid: allowIf + effect: permit (acts as override, not a guard)\r\n- description: "EntraID user forms"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "permit"\r\n  allowIf: "resource.properties.resource_id in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"recommended-pattern-true-guard",children:"Recommended pattern (true guard)"}),"\n",(0,s.jsxs)(n.p,{children:["Behavior: true \u2192 permit; false \u2192 ",(0,s.jsx)(n.code,{children:"not_applicable"})," (other rules decide; default deny if none permit)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# Use when for \u201cpermit only on match\u201d\r\n- description: "EntraID user forms (guarded)"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "permit"\r\n  when: "resource.properties.resource_id in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"alternatives-choose-by-style",children:"Alternatives (choose by style)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Default-deny and open on match:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- description: "EntraID user forms (default deny)"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "deny"\r\n  allowIf: "resource.properties.resource_id in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Default-permit but explicitly deny non-listed:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- description: "EntraID user forms (deny negative)"\r\n  resource: "form"\r\n  action: ["read","submit","update"]\r\n  effect: "permit"\r\n  denyIf: "resource.properties.resource_id not in [\'av_entraid_create_user_form\',\'av_entraid_view_user_form\']"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"do--dont",children:"Do / Don\u2019t"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Do: use ",(0,s.jsx)(n.code,{children:"when"})," to guard permits so non-matches are ",(0,s.jsx)(n.code,{children:"not_applicable"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Don\u2019t: pair ",(0,s.jsx)(n.code,{children:"allowIf"})," with ",(0,s.jsx)(n.code,{children:'effect: "permit"'})," when you intend a guard."]}),"\n",(0,s.jsxs)(n.li,{children:["Do: put dynamic attributes under ",(0,s.jsx)(n.code,{children:"resource.properties.*"})," and ",(0,s.jsx)(n.code,{children:"subject.properties.*"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Don\u2019t: use ",(0,s.jsx)(n.code,{children:"conditions"})," (plural) \u2014 it\u2019s unsupported."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"lint-rule-suggestion",children:"Lint rule suggestion"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Flag \u201c",(0,s.jsx)(n.code,{children:"allowIf"})," present AND ",(0,s.jsx)(n.code,{children:"effect: permit"}),"\u201d unless explicitly waived; suggest replacing with ",(0,s.jsx)(n.code,{children:"when"})," or flipping base ",(0,s.jsx)(n.code,{children:"effect"})," to ",(0,s.jsx)(n.code,{children:"deny"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"testing-checklist",children:"Testing checklist"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Positive: matching ",(0,s.jsx)(n.code,{children:"resource_id"})," \u2192 permit via this rule."]}),"\n",(0,s.jsxs)(n.li,{children:["Negative: non-matching id \u2192 rule ",(0,s.jsx)(n.code,{children:"not_applicable"}),"; final allow only if another rule permits; otherwise deny."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4--obligations--constraints",children:"4  Obligations & Constraints"}),"\n",(0,s.jsxs)(n.p,{children:["Attach obligations on permit ",(0,s.jsx)(n.strong,{children:"or"})," deny:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"on_permit:\r\n  obligations:\r\n    - id: require_mfa\r\n      attributes:\r\n        level: high\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Constraints may be embedded as a list or under ",(0,s.jsx)(n.code,{children:"on_permit.constraints"}),".  The parser tags them with ",(0,s.jsx)(n.code,{children:"_constraint: true"})," so the evaluator can enforce them."]}),"\n",(0,s.jsx)(n.p,{children:"Example numeric limit:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"constraints:\r\n  - id: spend_cap\r\n    type: numeric_limit\r\n    value: 5000\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5--worked-examples",children:"5  Worked Examples"}),"\n",(0,s.jsx)(n.h3,{id:"51-basic-allow--deny",children:"5.1 Basic allow / deny"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"rules:\r\n  - resource: document\r\n    action: view\r\n    allowIf: subject.department == 'Engineering'\r\n\r\n  - resource: document\r\n    action: delete\r\n    denyIf: subject.properties.sensitivity == 'high'\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"52-none-sugar",children:["5.2 ",(0,s.jsx)(n.code,{children:"none"})," sugar"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"allowIf:\r\n  none:\r\n    - subject.hrStatus == 'Suspended'\r\n    - subject.hrStatus == 'Terminated'\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"53-if--then--else",children:["5.3 ",(0,s.jsx)(n.code,{children:"If / Then / Else"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"If: subject.role == 'ProdAdmin'\r\nThen: true                # permit immediately\r\nElse: subject.hasFeatureToggle == true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"54-path-attribute-matching",children:"5.4 Path-attribute matching"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'path_attributes:\r\n  - name: doc_path\r\n    type: path\r\n    patterns:\r\n      - "/docs/public/*.pdf"\r\n      - "/docs/internal/**"\r\n\r\nrules:\r\n  - resource: document\r\n    action: view\r\n    effect: permit\r\n    when: "resource.properties.full_path MATCHES doc_path"\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"55-environment--time-helpers",children:"5.5 Environment & time helpers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- resource: report\r\n  action:   view\r\n  effect:   permit\r\n  when: { operator: during_business_hours }\r\n\r\n- resource: batch\r\n  action:   run\r\n  effect:   permit\r\n  when: { operator: after_time, right: "06:00" }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"56-cidr-and-ip-range",children:"5.6 CIDR and IP range"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- resource: api\r\n  action:   call\r\n  effect:   permit\r\n  allowIf:\r\n    any:\r\n      - { operator: cidr_match, scope: context, attribute: request_ip, value: "10.0.0.0/8" }\r\n      - { operator: cidr_match, scope: context, attribute: request_ip, value: "192.168.1.0/24" }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"57-velocity-and-money-operators",children:"5.7 Velocity and money operators"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- resource: payment\r\n  action:   submit\r\n  effect:   deny\r\n  denyIf:\r\n    operator: velocity_within\r\n    scope: subject\r\n    attribute: id\r\n    value: { window_minutes: 60, count: 5 }\r\n\r\n- resource: expense\r\n  action:   approve\r\n  effect:   permit\r\n  allowIf:\r\n    operator: money_less_than\r\n    left:  { ref: "resource.properties.amount" }\r\n    right: { currency: "USD", value: 1000 }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"58-if--then--else-branching",children:"5.8 If / Then / Else branching"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- resource: record\r\n  action:   view\r\n  effect:   permit\r\n  If:   "subject.properties.department == \'Sales\'"\r\n  Then: { allowIf: "resource.properties.region == \'EMEA\'" }\r\n  Else: { allowIf: "resource.properties.is_public == true" }\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6--application-scoped-policy-organization",children:"6  Application-Scoped Policy Organization"}),"\n",(0,s.jsxs)(n.p,{children:["The PDP supports ",(0,s.jsx)(n.strong,{children:"application-scoped policies"})," that provide better governance, performance, and organization. Instead of loading all global policies for every request, you can organize policies by application using a 5-level inheritance hierarchy."]}),"\n",(0,s.jsx)(n.h3,{id:"61-how-it-works",children:"6.1 How It Works"}),"\n",(0,s.jsxs)(n.p,{children:["Include the ",(0,s.jsx)(n.code,{children:"pdp_application"})," field in your AuthZEN request:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "subject": {"type": "user", "id": "alice@example.com"},\r\n  "action": {"name": "view"},\r\n  "resource": {\r\n    "type": "document", \r\n    "id": "doc-123",\r\n    "properties": {\r\n      "pdp_application": "sharepoint-prod"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"The PDP will:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Extract"})," the application ID from ",(0,s.jsx)(n.code,{children:"resource.properties.pdp_application"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resolve"})," the application context using the Application Registry"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Load policies"})," from the 5-level inheritance hierarchy (see below)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache results"})," for optimal performance"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"62-five-level-inheritance-hierarchy",children:"6.2 Five-Level Inheritance Hierarchy"}),"\n",(0,s.jsxs)(n.p,{children:["Policies are organized in a hierarchy where ",(0,s.jsx)(n.strong,{children:"more specific overrides general"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"APPLICATION"})," (Level 1) - Highest priority, most specific"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DOMAIN_ENVIRONMENT"})," (Level 2) - Domain + environment specific"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CROSS_ENVIRONMENT"})," (Level 3) - Cross-environment domain policies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DOMAIN_SHARED"})," (Level 4) - Shared domain policies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"GLOBAL"})," (Level 5) - Global fallback policies"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"63-directory-structure-example",children:"6.3 Directory Structure Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"config/policies/\r\n\u251c\u2500\u2500 global/                           # Level 5: Global policies\r\n\u2502   \u251c\u2500\u2500 authentication.yaml\r\n\u2502   \u2514\u2500\u2500 base-security.yaml\r\n\u251c\u2500\u2500 domains/\r\n\u2502   \u2514\u2500\u2500 sharepoint/                   # Domain: sharepoint\r\n\u2502       \u251c\u2500\u2500 shared/                   # Level 4: Domain shared\r\n\u2502       \u2502   \u251c\u2500\u2500 document-actions.yaml\r\n\u2502       \u2502   \u2514\u2500\u2500 user-roles.yaml\r\n\u2502       \u251c\u2500\u2500 cross-environment/        # Level 3: Cross-environment\r\n\u2502       \u2502   \u2514\u2500\u2500 compliance.yaml\r\n\u2502       \u2514\u2500\u2500 environments/\r\n\u2502           \u251c\u2500\u2500 production/           # Level 2: Domain + environment\r\n\u2502           \u2502   \u251c\u2500\u2500 security.yaml\r\n\u2502           \u2502   \u2514\u2500\u2500 performance.yaml\r\n\u2502           \u2514\u2500\u2500 staging/\r\n\u2502               \u2514\u2500\u2500 testing.yaml\r\n\u2514\u2500\u2500 applications/\r\n    \u251c\u2500\u2500 sharepoint-prod/              # Level 1: Application specific\r\n    \u2502   \u251c\u2500\u2500 document-library.yaml\r\n    \u2502   \u2514\u2500\u2500 site-permissions.yaml\r\n    \u2514\u2500\u2500 sharepoint-stage/\r\n        \u2514\u2500\u2500 dev-overrides.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"64-policy-file-examples",children:"6.4 Policy File Examples"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Level 5 - Global Policy"})," (",(0,s.jsx)(n.code,{children:"config/policies/global/authentication.yaml"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"id: global-auth\r\nname: Global Authentication Policy\r\ndescription: Base authentication requirements for all applications\r\n\r\nsubjects:\r\n  - where: subject.type == 'user'\r\n\r\nrules:\r\n  - resource: \"*\"\r\n    action: \"*\"\r\n    denyIf: subject.status == 'suspended'\r\n    description: Block suspended users globally\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Level 4 - Domain Shared"})," (",(0,s.jsx)(n.code,{children:"config/policies/domains/sharepoint/shared/document-actions.yaml"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"id: sharepoint-document-actions\r\nname: SharePoint Document Actions\r\ndescription: Common document actions available across all SharePoint environments\r\n\r\nsubjects:\r\n  - where: subject.type == 'user'\r\n\r\nrules:\r\n  - resource: document\r\n    action: view\r\n    allowIf: subject.role IN ['employee', 'contractor', 'manager']\r\n    description: Basic document viewing for all SharePoint environments\r\n    \r\n  - resource: document\r\n    action: edit\r\n    allowIf: subject.role IN ['employee', 'manager']\r\n    description: Document editing for employees and managers\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Level 1 - Application Specific"})," (",(0,s.jsx)(n.code,{children:"config/policies/applications/sharepoint-prod/site-permissions.yaml"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"id: sharepoint-prod-site-permissions\r\nname: SharePoint Production Site Permissions\r\ndescription: Production-specific site access controls\r\n\r\nsubjects:\r\n  - where: subject.type == 'user'\r\n\r\nrules:\r\n  - resource: site\r\n    action: create\r\n    allowIf: \r\n      all:\r\n        - subject.role == 'site-admin'\r\n        - subject.clearance >= 'confidential'\r\n    description: Only site admins with confidential clearance can create sites in production\r\n    \r\n  - resource: site\r\n    action: delete\r\n    denyIf: true\r\n    description: No site deletion allowed in production\r\n    on_deny:\r\n      obligations:\r\n        - id: log_delete_attempt\r\n          attributes:\r\n            severity: high\r\n            notify: security-team\n"})}),"\n",(0,s.jsx)(n.h3,{id:"65-inheritance-behavior",children:"6.5 Inheritance Behavior"}),"\n",(0,s.jsxs)(n.p,{children:["When processing a request for ",(0,s.jsx)(n.code,{children:"sharepoint-prod"}),", the PDP loads policies in this order:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Application policies"})," (",(0,s.jsx)(n.code,{children:"sharepoint-prod/"}),") - Applied first, highest priority"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Domain + environment"})," (",(0,s.jsx)(n.code,{children:"sharepoint/environments/production/"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cross-environment"})," (",(0,s.jsx)(n.code,{children:"sharepoint/cross-environment/"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Domain shared"})," (",(0,s.jsx)(n.code,{children:"sharepoint/shared/"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global policies"})," (",(0,s.jsx)(n.code,{children:"global/"}),") - Lowest priority, fallback"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Rules:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["More specific policies ",(0,s.jsx)(n.strong,{children:"override"})," general ones"]}),"\n",(0,s.jsxs)(n.li,{children:["If a rule exists at multiple levels, the ",(0,s.jsx)(n.strong,{children:"most specific"})," level wins"]}),"\n",(0,s.jsxs)(n.li,{children:["Policies are ",(0,s.jsx)(n.strong,{children:"additive"})," - you get rules from all applicable levels"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deny rules"})," always override permit rules (deny-override principle)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"66-performance-benefits",children:"6.6 Performance Benefits"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Targeted Loading"}),": Only loads 5-50 relevant policies vs 100+ global policies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request Caching"}),": 60-second TTL for policy loading results"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Registry Caching"}),": 300-second TTL for application context resolution"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Latency Reduction"}),": ~40% improvement (17ms vs 29ms) for uncached requests"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"67-fallback-behavior",children:"6.7 Fallback Behavior"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Missing ",(0,s.jsx)(n.code,{children:"pdp_application"})]}),": Falls back to global policy loading"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Invalid application"}),": Gracefully degrades to global policies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Policy loading errors"}),": Returns to global resolver with logging"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backward compatibility"}),": Existing global policies continue to work"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"7--audit-checklist",children:"7  Audit Checklist"}),"\n",(0,s.jsx)(n.h3,{id:"71-traditional-policy-auditing",children:"7.1 Traditional Policy Auditing"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Subject coverage"})," \u2013 are all principal types included?  Use ",(0,s.jsx)(n.code,{children:"where:"})," predicates for dynamic roles."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rule clarity"})," \u2013 description field explains business intent."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deny overrides"})," \u2013 ensure any deny rules are intentional (they cancel all permits)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Typo traps"})," \u2013 ",(0,s.jsx)(n.code,{children:"conditions"})," (plural) is unsupported; use ",(0,s.jsx)(n.code,{children:"condition"}),"/",(0,s.jsx)(n.code,{children:"when"}),"/sugar. No parentheses in string expressions."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Obligations"})," \u2013 logging / MFA / workflow clearly defined."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Path patterns"})," \u2013 wildcards reviewed for over-breadth."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"72-application-scoped-policy-auditing",children:"7.2 Application-Scoped Policy Auditing"}),"\n",(0,s.jsxs)(n.ol,{start:"7",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hierarchy organization"})," \u2013 policies placed at appropriate inheritance levels."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Application context"})," \u2013 ",(0,s.jsx)(n.code,{children:"pdp_application"})," field usage documented and consistent."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Inheritance conflicts"})," \u2013 more specific policies properly override general ones."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance impact"})," \u2013 application-scoped policies achieve expected cache hit rates."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Domain boundaries"})," \u2013 cross-application policy leakage prevented."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Environment separation"})," \u2013 production vs staging policies properly isolated."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global fallback"})," \u2013 fallback behavior tested when application policies fail."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"8--llm-assistance",children:"8  LLM Assistance"}),"\n",(0,s.jsxs)(n.p,{children:["For automated policy explanation or generation, feed the prompt in ",(0,s.jsx)(n.code,{children:"docs/llm_prompt.md"})," to your model.  It encodes syntax rules, deny-override semantics and style guidelines."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"End of guide \u2013 see cheat-sheet for the auto-generated reference tables."})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);