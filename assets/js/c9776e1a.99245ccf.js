"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[5552],{28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>t});var r=n(96540);const i={},l=r.createContext(i);function c(e){const s=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:s},e.children)}},88562:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"services/crud-service/secrets/developer-guide","title":"Developer guide","description":"Quick start, Canonical URIs, SDK usage, REST examples, testing, and FAQs","source":"@site/docs/services/crud-service/secrets/08-developer-guide.md","sourceDirName":"services/crud-service/secrets","slug":"/services/crud-service/secrets/developer-guide","permalink":"/empowernow_docs/docs/services/crud-service/secrets/developer-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/secrets/08-developer-guide.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Developer guide","description":"Quick start, Canonical URIs, SDK usage, REST examples, testing, and FAQs"},"sidebar":"tutorialSidebar","previous":{"title":"Admin how\u2011to","permalink":"/empowernow_docs/docs/services/crud-service/secrets/admin-howto"},"next":{"title":"API reference","permalink":"/empowernow_docs/docs/services/crud-service/secrets/api-reference"}}');var i=n(74848),l=n(28453);const c={title:"Developer guide",description:"Quick start, Canonical URIs, SDK usage, REST examples, testing, and FAQs"},t=void 0,a={},d=[{value:"Quick start",id:"quick-start",level:2},{value:"Canonical URIs",id:"canonical-uris",level:2},{value:"SDK usage (Python)",id:"sdk-usage-python",level:2},{value:"Provider notes",id:"provider-notes",level:2},{value:"Security integration",id:"security-integration",level:2},{value:"REST examples",id:"rest-examples",level:2},{value:"Testing",id:"testing",level:2},{value:"Dev vs prod",id:"dev-vs-prod",level:2},{value:"FAQs and pitfalls",id:"faqs-and-pitfalls",level:2}];function o(e){const s={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"quick-start",children:"Quick start"}),"\n",(0,i.jsx)(s.p,{children:"Prerequisites"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Configure one provider (YAML for dev, or OpenBao/HashiCorp KVv2)"}),"\n",(0,i.jsxs)(s.li,{children:["Recommended local flags:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SECRETS_API_REQUIRE_AUTH=false"})," (default)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SECRETS_ENFORCE_SCOPES=false"})," (default)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"TENANT_ID=dev"}),", ",(0,i.jsx)(s.code,{children:"TENANT_ALLOWED_MOUNTS=secret"})]}),"\n",(0,i.jsxs)(s.li,{children:["For YAML: ",(0,i.jsx)(s.code,{children:"YAML_VAULT_PATH=/app/config/data/dev_secrets.yaml"})]}),"\n",(0,i.jsxs)(s.li,{children:["For KVv2: ",(0,i.jsx)(s.code,{children:"VAULT_URL=..."}),", ",(0,i.jsx)(s.code,{children:"VAULT_TOKEN=..."})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Seed a dev YAML file"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["See ",(0,i.jsx)(s.code,{children:"../how-to/yaml-vault-provider.md"})," for ",(0,i.jsx)(s.code,{children:"scripts/yaml_dev_bootstrap.py"})," usage."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"First tests"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Create (YAML dev):"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -X POST "$BASE/api/secrets" \\\r\n  -H "Content-Type: application/json" \\\r\n  -d \'{"uri":"yaml://secret/env#MY_NEW","value":"hello"}\'\n'})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Read value (YAML dev):"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets?uri=yaml://secret/env#MY_NEW"\n'})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Read value (KVv2 via PEP):"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets/value?uri=openbao+kv2://secret/app/api#token"\n'})}),"\n",(0,i.jsx)(s.h2,{id:"canonical-uris",children:"Canonical URIs"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["YAML: ",(0,i.jsx)(s.code,{children:"yaml://secret/<path>#<key>"})]}),"\n",(0,i.jsxs)(s.li,{children:["OpenBao KVv2: ",(0,i.jsx)(s.code,{children:"openbao+kv2://<mount>/<path>#<key>[?version=N]"})]}),"\n",(0,i.jsxs)(s.li,{children:["HashiCorp KVv2: ",(0,i.jsx)(s.code,{children:"hashicorp+kv2://<mount>/<path>#<key>[?version=N]"})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Notes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Guarded by ",(0,i.jsx)(s.code,{children:"TENANT_ID"})," and ",(0,i.jsx)(s.code,{children:"TENANT_ALLOWED_MOUNTS"})]}),"\n",(0,i.jsx)(s.li,{children:"With fragment \u2192 single value; without fragment \u2192 map (provider\u2011specific)"}),"\n",(0,i.jsxs)(s.li,{children:["Version pin (KVv2): add ",(0,i.jsx)(s.code,{children:"?version=N"})," to the URI with ",(0,i.jsx)(s.code,{children:"/api/secrets/value"})]}),"\n",(0,i.jsx)(s.li,{children:"Invalid forms return 400 with structured error details"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Migrate env values to pointers"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-diff",children:"- MY_API_KEY=plaintext-value\r\n+ MY_API_KEY_POINTER=openbao+kv2://secret/app#MY_API_KEY\n"})}),"\n",(0,i.jsx)(s.h2,{id:"sdk-usage-python",children:"SDK usage (Python)"}),"\n",(0,i.jsx)(s.p,{children:"Basic usage"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from src.services.vault_service import VaultService\r\n\r\nsvc = VaultService(ttl=60)\r\nvalue_or_map = await svc.get_credentials("openbao+kv2://secret/app/api#token")\n'})}),"\n",(0,i.jsx)(s.p,{children:"Pass request context (FastAPI/Starlette)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from src.models.execution_context import ExecutionContext\r\npayload = await svc.get_credentials(uri, execution_context=ExecutionContext(request=request))\n"})}),"\n",(0,i.jsx)(s.p,{children:"Return shapes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Fragment present \u2192 returns the value under that key"}),"\n",(0,i.jsx)(s.li,{children:"No fragment \u2192 returns a map (object) for the path"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Errors (typical)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"400 malformed URI/incompatible payload"}),"\n",(0,i.jsx)(s.li,{children:"401/403 when auth/scope/policy denies"}),"\n",(0,i.jsx)(s.li,{children:"404 when path/fragment not found"}),"\n",(0,i.jsx)(s.li,{children:"501 when provider/operation not supported"}),"\n",(0,i.jsx)(s.li,{children:"502 when provider call fails"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"provider-notes",children:"Provider notes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["KVv2: path ",(0,i.jsx)(s.code,{children:"<mount>/<path>"}),"; fragment selects key; supports soft delete/undelete/destroy versions; version pin via ",(0,i.jsx)(s.code,{children:"?version="})]}),"\n",(0,i.jsxs)(s.li,{children:["YAML (dev only): file\u2011backed at ",(0,i.jsx)(s.code,{children:"YAML_VAULT_PATH"}),"; writes/deletes blocked outside dev/test"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"security-integration",children:"Security integration"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"PDP checks happen inside the PEP (VaultService/Secrets API)"}),"\n",(0,i.jsxs)(s.li,{children:["Optional scopes on endpoints: set ",(0,i.jsx)(s.code,{children:"SECRETS_ENFORCE_SCOPES=true"})]}),"\n",(0,i.jsxs)(s.li,{children:["Require auth on endpoints: set ",(0,i.jsx)(s.code,{children:"SECRETS_API_REQUIRE_AUTH=true"})]}),"\n",(0,i.jsxs)(s.li,{children:["Values are masked; audits use non\u2011leaky ",(0,i.jsx)(s.code,{children:"resource_ref"})," when ",(0,i.jsx)(s.code,{children:"TENANT_SALT"})," is set"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"rest-examples",children:"REST examples"}),"\n",(0,i.jsx)(s.p,{children:"Create/update"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -X POST "$BASE/api/secrets" -H "Content-Type: application/json" -d \'{"uri":"openbao+kv2://secret/app/test#value","value":{"value":"hello"}}\'\n'})}),"\n",(0,i.jsx)(s.p,{children:"Read (YAML dev)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets?uri=yaml://secret/env#MY_NEW"\n'})}),"\n",(0,i.jsx)(s.p,{children:"Read (KVv2 via PEP) with version pin"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets/value?uri=openbao+kv2://secret/app/test#value&version=2"\n'})}),"\n",(0,i.jsx)(s.p,{children:"Delete / destroy"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -X DELETE "$BASE/api/secrets?uri=openbao+kv2://secret/app/test#value"\r\ncurl -X DELETE "$BASE/api/secrets?uri=openbao+kv2://secret/app/test#value&destroy=true"\n'})}),"\n",(0,i.jsx)(s.p,{children:"Rotate (KVv2)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -X POST "$BASE/api/secrets/rotate" -H "Content-Type: application/json" -d \'{"uri":"openbao+kv2://secret/app/test#value","value":"new"}\'\n'})}),"\n",(0,i.jsx)(s.p,{children:"Metadata and keys (YAML dev)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets/metadata?prefix=yaml://secret/env/"\r\ncurl "$BASE/api/secrets/keys?uri=yaml://secret/env"\n'})}),"\n",(0,i.jsx)(s.p,{children:"Metadata detail / versions (KVv2)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets/metadata/detail?uri=openbao+kv2://secret/app/test"\r\ncurl "$BASE/api/secrets/versions?uri=openbao+kv2://secret/app/test"\n'})}),"\n",(0,i.jsx)(s.p,{children:"Undelete / destroy versions (KVv2)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -X POST "$BASE/api/secrets/undelete" -H "Content-Type: application/json" -d \'{"uri":"openbao+kv2://secret/app/test","versions":[3,4]}\'\r\ncurl -X POST "$BASE/api/secrets/destroy-versions" -H "Content-Type: application/json" -d \'{"uri":"openbao+kv2://secret/app/test","versions":[1,2]}\'\n'})}),"\n",(0,i.jsx)(s.p,{children:"Search and bulk"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets/search?q=token&prefix=yaml://secret/env/"\r\ncurl -X POST "$BASE/api/secrets/bulk" -H "Content-Type: application/json" -d \'{"operations":[{"op":"set","uri":"yaml://secret/env#NEW","value":"abc"},{"op":"delete","uri":"openbao+kv2://secret/app/test#value"}]}\'\n'})}),"\n",(0,i.jsx)(s.p,{children:"Copy / move"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl -X POST "$BASE/api/secrets/copy" -H "Content-Type: application/json" -d \'{"fromUri":"yaml://secret/env#FROM","toUri":"yaml://secret/env#TO","overwrite":false}\'\r\ncurl -X POST "$BASE/api/secrets/move" -H "Content-Type: application/json" -d \'{"fromUri":"yaml://secret/env#FROM","toUri":"yaml://secret/env#TO"}\'\n'})}),"\n",(0,i.jsx)(s.p,{children:"Events and audit (dev)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'curl "$BASE/api/secrets/events"   # SSE (dev)\r\ncurl "$BASE/api/secrets/audit"    # in-memory buffer (dev)\n'})}),"\n",(0,i.jsxs)(s.p,{children:["See full reference: ",(0,i.jsx)(s.code,{children:"../reference/secrets-api.md"})]}),"\n",(0,i.jsx)(s.h2,{id:"testing",children:"Testing"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Unit: mock ",(0,i.jsx)(s.code,{children:"VaultService"})," and provider strategies"]}),"\n",(0,i.jsx)(s.li,{children:"Integration: YAML provider or KVv2; exercise versioned reads and rotate"}),"\n",(0,i.jsxs)(s.li,{children:["Contract: test 200/400/401/403/404/501 for endpoints incl. ",(0,i.jsx)(s.code,{children:"/value"}),", metadata/detail, versions, bulk, copy/move, search"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"dev-vs-prod",children:"Dev vs prod"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"YAML provider is for dev only; blocked outside dev/test"}),"\n",(0,i.jsxs)(s.li,{children:["Enable ",(0,i.jsx)(s.code,{children:"SECRETS_API_REQUIRE_AUTH"}),"/",(0,i.jsx)(s.code,{children:"SECRETS_ENFORCE_SCOPES"})," as needed in higher environments"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"faqs-and-pitfalls",children:"FAQs and pitfalls"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"400 malformed URI or missing fragment when required"}),"\n",(0,i.jsx)(s.li,{children:"403 policy denied or insufficient scope"}),"\n",(0,i.jsx)(s.li,{children:"404 path/fragment not found"}),"\n",(0,i.jsx)(s.li,{children:"501 operation not supported for provider"}),"\n",(0,i.jsxs)(s.li,{children:["Prefer ",(0,i.jsx)(s.code,{children:"*_POINTER"})," envs; never log secret values"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);