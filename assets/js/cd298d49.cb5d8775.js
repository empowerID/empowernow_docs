"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[3520],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(96540);const r={},o=s.createContext(r);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(o.Provider,{value:n},e.children)}},75222:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"services/bff/reference/amazing-faq","title":"BFF \u2013 FAQ","description":"General","source":"@site/docs/services/bff/reference/amazing-faq.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/amazing-faq","permalink":"/empowernow_docs/docs/services/bff/reference/amazing-faq","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/amazing-faq.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"BFF \u2013 FAQ","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Security Model","permalink":"/empowernow_docs/docs/services/bff/explanation/security-model"},"next":{"title":"AI Chat Completions (PDP Enforcement)","permalink":"/empowernow_docs/docs/services/bff/reference/bff-llm-pdp-enforcement"}}');var r=i(74848),o=i(28453);const t={title:"BFF \u2013 FAQ",sidebar_position:2},c=void 0,l={},d=[];function a(e){const n={code:"code",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"General"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"What is the BFF? A backend that terminates OAuth, issues a session cookie, enforces authorization via a PDP, and proxies to internal services. See: BFF for SPAs overview."}),"\n",(0,r.jsxs)(n.li,{children:["Where are APIs defined? ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config/routes.yaml"})," (canonical ",(0,r.jsx)(n.code,{children:"/api/..."})," paths \u2192 upstream services, ",(0,r.jsx)(n.code,{children:"auth: session"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Where are authorization rules mapped? ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config/pdp.yaml"})," under ",(0,r.jsx)(n.code,{children:"endpoint_map"})," (path/method \u2192 resource/action/id_from/props)."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"What is a BFF (and how ours differs from API gateways)?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Definition: A Backend\u2011for\u2011Frontend is an app\u2011specific backend that owns auth flows (PKCE/PAR, sessions/CSRF), composes data from multiple services, enforces authorization via PDP, and exposes a stable, UX\u2011oriented API to the frontend."}),"\n",(0,r.jsxs)(n.li,{children:["Our BFF (this repo):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Auth: full OAuth login, session cookies, CSRF, optional DPoP/mTLS; ForwardAuth integration at edge; no tokens in the browser for same\u2011origin SPAs."}),"\n",(0,r.jsxs)(n.li,{children:["Authorization: calls a PDP (AuthZEN) using ",(0,r.jsx)(n.code,{children:"pdp.yaml:endpoint_map"}),"; caches decisions with separate allow/deny TTLs."]}),"\n",(0,r.jsx)(n.li,{children:"Composition: aggregates/orchestrates calls, handles streaming, uploads, background work, and error shaping."}),"\n",(0,r.jsxs)(n.li,{children:["Contracts: canonical ",(0,r.jsx)(n.code,{children:"/api/<app>/**"})," via ",(0,r.jsx)(n.code,{children:"routes.yaml"}),"; custom endpoints where composition/security is required."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["vs API gateways (Kong/NGINX/Traefik):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Gateways excel at L7 routing, rate limiting, TLS, and header transforms. They don\u2019t own app auth flows, sessions/CSRF, or PDP enforcement per endpoint."}),"\n",(0,r.jsx)(n.li,{children:"In our stack, Traefik provides edge routing, TLS, security headers, and ForwardAuth. The BFF owns sessions, PDP checks, and business composition. Kong would overlap with Traefik in routing/middleware but still wouldn\u2019t replace the BFF\u2019s app logic."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Admins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Where is configuration kept? ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config/*.yaml"})," including ",(0,r.jsx)(n.code,{children:"routes.yaml"}),", ",(0,r.jsx)(n.code,{children:"pdp.yaml"}),", ",(0,r.jsx)(n.code,{children:"idps.yaml"}),", ",(0,r.jsx)(n.code,{children:"logging.yaml"}),", and more."]}),"\n",(0,r.jsxs)(n.li,{children:["How do I add a new API surface? Add a service in ",(0,r.jsx)(n.code,{children:"routes.yaml:services"}),", then a route entry under ",(0,r.jsx)(n.code,{children:"routes"})," with your ",(0,r.jsx)(n.code,{children:"/api/<app>/*"})," path, ",(0,r.jsx)(n.code,{children:"target_service"}),", ",(0,r.jsx)(n.code,{children:"upstream_path"}),", methods, and ",(0,r.jsx)(n.code,{children:"auth: session"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"DevOps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["How is it run locally? ",(0,r.jsx)(n.code,{children:"CRUDService/docker-compose-authzen4.yml"})," (stack with Traefik, BFF, Redis, PDP, IdP). Health checks: ",(0,r.jsx)(n.code,{children:"http://localhost:8000/health"})," (BFF), ",(0,r.jsx)(n.code,{children:"http://localhost:8080/ping"})," (Traefik)."]}),"\n",(0,r.jsxs)(n.li,{children:["How does Traefik authenticate requests? ForwardAuth hits BFF ",(0,r.jsx)(n.code,{children:"/auth/forward"})," (verified by tests in TEST_EXECUTION_GUIDE). BFF validates session, then routes per ",(0,r.jsx)(n.code,{children:"routes.yaml"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Which PDP endpoints are exposed via BFF? See ",(0,r.jsx)(n.code,{children:"routes.yaml"})," entries like ",(0,r.jsx)(n.code,{children:"/access/v1/evaluation"})," (preserve path) to ",(0,r.jsx)(n.code,{children:"pdp_service"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Frontend (SPA)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["How do SPAs integrate? Set ",(0,r.jsx)(n.code,{children:"VITE_BFF_BASE_URL"}),", wrap with ",(0,r.jsx)(n.code,{children:"AuthProvider"})," from ",(0,r.jsx)(n.code,{children:"@empowernow/bff-auth-react"}),", and call APIs via ",(0,r.jsx)(n.code,{children:"apiClient"}),"/",(0,r.jsx)(n.code,{children:"fetchWithAuth"})," (cookies are sent automatically). Code verified in ",(0,r.jsx)(n.code,{children:"pdp_ui/frontend"})," and ",(0,r.jsx)(n.code,{children:"idp_ui/frontend"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Do I send Authorization headers? No for same\u2011origin; the BFF uses httpOnly cookies. See: Integrate a React SPA with the BFF and SPA Golden Path."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Backend Developers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["How are permissions checked? ",(0,r.jsx)(n.code,{children:"core/permissions.py"})," builds context (roles, headers, query, body subset, correlation ID), ",(0,r.jsx)(n.code,{children:"services/path_mapper.py"})," maps request to resource/action from ",(0,r.jsx)(n.code,{children:"pdp.yaml:endpoint_map"}),", then ",(0,r.jsx)(n.code,{children:"services/pdp_client.py"})," calls PDP and caches decisions."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Where are PDP endpoints configured? ",(0,r.jsx)(n.code,{children:"pdp.yaml:endpoints"})," (e.g., ",(0,r.jsx)(n.code,{children:'evaluation: "v1/evaluation"'}),"). The client uses these for internal PDP calls."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["When do I need a custom BFF endpoint instead of just ",(0,r.jsx)(n.code,{children:"routes.yaml"}),"?"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"routes.yaml"})," when:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You are proxying a single upstream with optional path templating (",(0,r.jsx)(n.code,{children:"upstream_path"})," with ",(0,r.jsx)(n.code,{children:"{path}"}),"), preserving the path, selecting methods, and applying built\u2011in auth modes (",(0,r.jsx)(n.code,{children:"auth: session | bearer | none"}),") and ",(0,r.jsx)(n.code,{children:"streaming: true"})," for SSE."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Create a custom BFF endpoint when you need any of the following (not expressible in ",(0,r.jsx)(n.code,{children:"routes.yaml"}),"):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Aggregation/orchestration: one client call fan\u2011outs to multiple services, merges results, or sequences calls transactionally."}),"\n",(0,r.jsxs)(n.li,{children:["Security transformations: token exchange, signing (DPoP, mTLS client assertions), presigned URL minting, step\u2011up auth, or minting/downscoping ",(0,r.jsx)(n.code,{children:"Authorization"})," headers beyond pass\u2011through."]}),"\n",(0,r.jsx)(n.li,{children:"Request/response shaping: canonical validation, schema mapping, pagination unification, partial field selection, error normalization, or PII redaction."}),"\n",(0,r.jsx)(n.li,{children:"Stateful flows: CSRF\u2011bound actions with server state, idempotency keys, retries/circuit breakers, or saga choreography."}),"\n",(0,r.jsx)(n.li,{children:"Long\u2011running or background work: enqueue a job and return 202 + status polling endpoint."}),"\n",(0,r.jsx)(n.li,{children:"Specialized streaming: upload/download mediation (multipart, chunking, encryption/AV scanning) or WebSockets."}),"\n",(0,r.jsx)(n.li,{children:"Per\u2011user/business rate limits or caching that can\u2019t be handled by Traefik\u2019s generic middleware."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Concrete examples in this repo:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Metrics sink handled directly by BFF: ",(0,r.jsx)(n.code,{children:"POST /api/metrics"})," (see comment in ",(0,r.jsx)(n.code,{children:"ServiceConfigs/BFF/config/routes.yaml"}),": \u201cMetrics sink is handled directly by BFF code at /api/metrics (POST). No YAML proxy entry needed.\u201d)"]}),"\n",(0,r.jsxs)(n.li,{children:["Auth router endpoints: ",(0,r.jsx)(n.code,{children:"/auth/*"})," (login, callback, verify/forward, csrf, token) are implemented in the BFF, not proxied via ",(0,r.jsx)(n.code,{children:"routes.yaml"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Some SPA streaming endpoints are terminated by the BFF first (see Traefik labels in ",(0,r.jsx)(n.code,{children:"CRUDService/docker-compose-authzen4.yml"})," for ",(0,r.jsx)(n.code,{children:"bff-*-streaming"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Quick checklist:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Does the route require calling more than one upstream? \u2192 Custom endpoint."}),"\n",(0,r.jsx)(n.li,{children:"Do you need to alter auth materials (mint/transform tokens or headers)? \u2192 Custom endpoint."}),"\n",(0,r.jsx)(n.li,{children:"Do you need to validate or reshape request/response bodies beyond simple path rewrites? \u2192 Custom endpoint."}),"\n",(0,r.jsx)(n.li,{children:"Is it WebSocket, presigned upload/download, or background job control? \u2192 Custom endpoint."}),"\n",(0,r.jsxs)(n.li,{children:["Otherwise, if it\u2019s a straight proxy with optional SSE, prefer ",(0,r.jsx)(n.code,{children:"routes.yaml"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Security & Auditors"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["What authorizes access? AuthZEN PDP evaluation using mapped resource/action and context. Deny or allow decisions may be cached with different TTLs (",(0,r.jsx)(n.code,{children:"pdp.yaml:cache.ttl_allow/ttl_deny"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Where is direct PDP exposure controlled? Externally via BFF ",(0,r.jsx)(n.code,{children:"routes.yaml"})," entries under PDP Service Routes (e.g., ",(0,r.jsx)(n.code,{children:"/access/v1/evaluation"}),"), internally via ",(0,r.jsx)(n.code,{children:"pdp_client"})," (",(0,r.jsx)(n.code,{children:"v1/evaluation"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"QA & Testing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"How do we prove it works? Follow the QA Test Execution how\u2011to. Critical tests verify: Traefik ForwardAuth \u2192 BFF chain, middleware/routing, and real user workflows across IdP UI, Visual Designer, and PDP UI as documented in TEST_EXECUTION_GUIDE."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Troubleshooting quick answers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"401 vs 403? 401 = unauthenticated (login). 403 = authenticated but PDP denied."}),"\n",(0,r.jsxs)(n.li,{children:["\u201c/api/api/...\u201d double prefix? Use the app wrappers which strip leading ",(0,r.jsx)(n.code,{children:"/api"})," before calling ",(0,r.jsx)(n.code,{children:"apiClient"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["DNS errors with ",(0,r.jsx)(n.code,{children:"*.ocg.labs.empowernow.ai"}),"? Add hosts file entries pointing to 127.0.0.1 for local."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Pointers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Overview: BFF for React SPAs \u2014 How It Works"}),"\n",(0,r.jsx)(n.li,{children:"Tutorial: React SPA + BFF \u2014 Golden Path"}),"\n",(0,r.jsx)(n.li,{children:"How\u2011to: Integrate a React SPA with the BFF"}),"\n",(0,r.jsx)(n.li,{children:"How\u2011to: Configure PDP (pdp.yaml)"}),"\n",(0,r.jsx)(n.li,{children:"Reference: QA \u2014 Troubleshooting Checklist"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);