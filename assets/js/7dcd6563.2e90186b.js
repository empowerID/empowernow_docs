"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2665],{9778:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"services/bff/how-to/spa-with-bff","title":"Integrate a React SPA with the BFF","description":"Audience: React SPA developers building a new app or migrating to the BFF.","source":"@site/docs/services/bff/how-to/spa-with-bff.md","sourceDirName":"services/bff/how-to","slug":"/services/bff/how-to/spa-with-bff","permalink":"/empowernow_docs/docs/services/bff/how-to/spa-with-bff","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/how-to/spa-with-bff.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Integrate a React SPA with the BFF","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"LLM Routing Quickstart","permalink":"/empowernow_docs/docs/services/bff/tutorials/llm-routing-quickstart"},"next":{"title":"Add legacy service","permalink":"/empowernow_docs/docs/services/bff/how-to/add-legacy-service"}}');var r=i(74848),c=i(28453);const t={title:"Integrate a React SPA with the BFF",sidebar_position:1},l=void 0,d={},a=[];function o(e){const s={code:"code",input:"input",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"Audience: React SPA developers building a new app or migrating to the BFF."}),"\n",(0,r.jsx)(s.p,{children:"What you\u2019ll do"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Configure your SPA to talk only to the BFF (no direct service URLs)"}),"\n",(0,r.jsxs)(s.li,{children:["Wire ",(0,r.jsx)(s.code,{children:"@empowernow/bff-auth-react"})," for session-based auth"]}),"\n",(0,r.jsx)(s.li,{children:"Use the shared API client that relies on cookies (no Authorization headers)"}),"\n",(0,r.jsxs)(s.li,{children:["Call canonical ",(0,r.jsx)(s.code,{children:"/api/..."})," routes that the BFF maps to backend services"]}),"\n",(0,r.jsxs)(s.li,{children:["Align the Neon Flux UI using ",(0,r.jsx)(s.code,{children:"@empowernow/ui"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Important conventions"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["No ",(0,r.jsx)(s.code,{children:"@bff/..."})," alias: use ",(0,r.jsx)(s.code,{children:"@empowernow/bff-auth-react"})," and set the base URL."]}),"\n",(0,r.jsxs)(s.li,{children:["Avoid double ",(0,r.jsx)(s.code,{children:"/api"}),": either call ",(0,r.jsx)(s.code,{children:"apiClient.get('/crud/...')"})," with baseUrl set to ",(0,r.jsx)(s.code,{children:"/api"}),", or call ",(0,r.jsx)(s.code,{children:"fetch('/api/crud/...')"})," directly. Do not combine both (which leads to ",(0,r.jsx)(s.code,{children:"/api/api/..."}),")."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Environment variables"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"VITE_BFF_BASE_URL"}),": e.g., ",(0,r.jsx)(s.code,{children:"https://bff.ocg.labs.empowernow.ai"})," or ",(0,r.jsx)(s.code,{children:"/api"})," for same-origin. Both ",(0,r.jsx)(s.code,{children:"idp_ui"})," and ",(0,r.jsx)(s.code,{children:"pdp_ui"})," set this and default to ",(0,r.jsx)(s.code,{children:"/api"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"OIDC values stay in the platform; BFF handles OAuth (no browser SDK needed)."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"App wiring (verified)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",metastring:'title="src/main.tsx (pattern used in idp_ui and pdp_ui)"',children:"import { AuthProvider, setBaseUrl } from '@empowernow/bff-auth-react'\r\n\r\nsetBaseUrl(import.meta.env.VITE_BFF_BASE_URL || '/api')\r\n\r\ncreateRoot(document.getElementById('root')!).render(\r\n  <AuthProvider baseUrl={import.meta.env.VITE_BFF_BASE_URL || '/api'} pollIntervalMs={300000}>\r\n    <App />\r\n  </AuthProvider>\r\n)\n"})}),"\n",(0,r.jsx)(s.p,{children:"Route guarding (verified)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",metastring:'title="src/components/auth/AuthGuard.tsx"',children:"import { useAuth } from '@empowernow/bff-auth-react'\r\n// Redirect unauthenticated users to /login, preserve returnUrl\n"})}),"\n",(0,r.jsx)(s.p,{children:"Calling APIs (verified)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Use your app\u2019s ",(0,r.jsx)(s.code,{children:"fetchWithAuth"})," wrapper which delegates to ",(0,r.jsx)(s.code,{children:"apiClient"})," from ",(0,r.jsx)(s.code,{children:"@empowernow/bff-auth-react"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["It strips a leading ",(0,r.jsx)(s.code,{children:"/api"})," and relies on cookies; no Authorization header required."]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",metastring:'title="lib/api/base.ts"',children:"import { apiClient } from '@empowernow/bff-auth-react'\r\n\r\n// Option A: apiClient with baseUrl '/api'\r\napiClient.get('/crud/forms')\r\napiClient.post('/crud/workflows', payload)\r\n\r\n// Option B: native fetch with explicit '/api' prefix\r\nawait fetch('/api/crud/forms', { credentials: 'include' })\n"})}),"\n",(0,r.jsx)(s.p,{children:"UI theming (verified)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Import ",(0,r.jsx)(s.code,{children:"@empowernow/ui/dist/index.css"})," and tokens; use components like ",(0,r.jsx)(s.code,{children:"GlassCard"}),", ",(0,r.jsx)(s.code,{children:"HeaderNav"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import '@empowernow/ui/dist/index.css'\n"})}),"\n",(0,r.jsx)(s.p,{children:"How the BFF routes your calls (verified)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["BFF maps canonical SPA paths to backend services per ",(0,r.jsx)(s.code,{children:"routes.yaml"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/api/crud/forms/*"})," \u2192 ",(0,r.jsx)(s.code,{children:"crud_service"})," (auth: ",(0,r.jsx)(s.code,{children:"session"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/api/idp/admin/*"})," \u2192 ",(0,r.jsx)(s.code,{children:"idp_service"})," (auth: ",(0,r.jsx)(s.code,{children:"session"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/api/v1/analytics/*"})," \u2192 ",(0,r.jsx)(s.code,{children:"analytics_service"})," (auth: ",(0,r.jsx)(s.code,{children:"session"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Snippet from configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'- id: "crud-forms"\r\n  path: "/api/crud/forms/*"\r\n  target_service: "crud_service"\r\n  upstream_path: "/forms/{path}"\r\n  methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]\r\n  auth: "session"\n'})}),"\n",(0,r.jsx)(s.p,{children:"Routing diagram (at a glance)"}),"\n",(0,r.jsx)(s.mermaid,{value:"flowchart LR\r\n  UI[SPA] --\x3e|GET /api/myapp/items/123 (cookie)| Traefik\r\n  Traefik --\x3e BFF\r\n  subgraph BFF\r\n    R[(routes.yaml: path\u2192upstream_path)]\r\n  end\r\n  BFF --\x3e|GET /items/123 + Authorization + X-Correlation-ID| SVC[my_service]\r\n  SVC --\x3e BFF --\x3e UI"}),"\n",(0,r.jsx)(s.p,{children:"Mental model"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/api"})," is the BFF entrypoint. The SPA calls ",(0,r.jsx)(s.code,{children:"/api/<app>/..."}),", and the BFF translates that to the real backend path per ",(0,r.jsx)(s.code,{children:"routes.yaml"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Automation Studio (Visual Designer) specifics"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"App: React SPA front end for CRUDService."}),"\n",(0,r.jsxs)(s.li,{children:["Paths it calls (same origin):","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["CRUD and SSE: ",(0,r.jsx)(s.code,{children:"/api/crud/..."})," (EventSource updated to use same-origin base)"]}),"\n",(0,r.jsxs)(s.li,{children:["PDP (AuthZEN): ",(0,r.jsx)(s.code,{children:"/access/v1/evaluation"})," and ",(0,r.jsx)(s.code,{children:"/access/v1/evaluations"})," (preserved path)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Traefik routes those requests to the BFF; the BFF proxies per ",(0,r.jsx)(s.code,{children:"ServiceConfigs/BFF/config/routes.yaml"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["CRUD via ",(0,r.jsx)(s.code,{children:"crud_service"})]}),"\n",(0,r.jsxs)(s.li,{children:["PDP via ",(0,r.jsx)(s.code,{children:"pdp_service"})," with ",(0,r.jsx)(s.code,{children:"preserve_path: true"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Cookies/credentials: ensure they are included","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["fetch: ",(0,r.jsx)(s.code,{children:"credentials: 'include'"})]}),"\n",(0,r.jsxs)(s.li,{children:["axios: ",(0,r.jsx)(s.code,{children:"{ withCredentials: true }"})]}),"\n",(0,r.jsxs)(s.li,{children:["EventSource (dev cross-origin): ",(0,r.jsx)(s.code,{children:"new EventSource(url, { withCredentials: true })"})," (same-origin sends cookies automatically)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Examples"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"// fetch (same-origin or cross-origin dev)\r\nawait fetch('/api/crud/items', { method: 'GET', credentials: 'include' });\r\n\r\n// axios\r\nawait axios.post('/access/v1/evaluation', body, { withCredentials: true });\r\n\r\n// SSE\r\nconst es = new EventSource('/api/crud/sse/stream'); // same-origin\r\n// cross-origin dev\r\nconst esDev = new EventSource('http://localhost:8000/api/crud/sse/stream', { withCredentials: true });\n"})}),"\n",(0,r.jsx)(s.p,{children:"Add your app\u2019s API surface"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Add a backend service under ",(0,r.jsx)(s.code,{children:"services"})," with ",(0,r.jsx)(s.code,{children:"base_url"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Add route entries under ",(0,r.jsx)(s.code,{children:"routes"})," with your canonical ",(0,r.jsx)(s.code,{children:"/api/<app>/*"})," paths, ",(0,r.jsx)(s.code,{children:"auth: session"}),", and an ",(0,r.jsx)(s.code,{children:"upstream_path"})," to your backend."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Request flow"}),"\n",(0,r.jsx)(s.mermaid,{value:"sequenceDiagram\r\n  autonumber\r\n  participant UI as React SPA\r\n  participant BFF\r\n  participant SVC as Backend Service\r\n  UI->>BFF: GET /api/<app>/items\r\n  BFF->>SVC: GET /items (session auth enforced)\r\n  SVC--\x3e>BFF: 200 JSON\r\n  BFF--\x3e>UI: 200 JSON"}),"\n",(0,r.jsx)(s.p,{children:"Do and don\u2019t"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Do: set ",(0,r.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," and let the BFF handle auth and cookies"]}),"\n",(0,r.jsxs)(s.li,{children:["Do: call ",(0,r.jsx)(s.code,{children:"/api/..."})," only; avoid hard-coding service URLs"]}),"\n",(0,r.jsxs)(s.li,{children:["Don\u2019t: manually attach ",(0,r.jsx)(s.code,{children:"Authorization"})," headers for same-origin BFF calls"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Local development"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["When the SPA is hosted separately, set ",(0,r.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," to the BFF origin (e.g., ",(0,r.jsx)(s.code,{children:"http://localhost:3000/api"}),") and ensure CORS allows your UI origin."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Troubleshooting"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["401/redirect loops: confirm ",(0,r.jsx)(s.code,{children:"AuthProvider"})," is wrapping ",(0,r.jsx)(s.code,{children:"<App />"})," and baseUrl is correct"]}),"\n",(0,r.jsxs)(s.li,{children:["403: PDP denied; verify your account roles/permissions and the route\u2019s ",(0,r.jsx)(s.code,{children:"auth: session"})]}),"\n",(0,r.jsxs)(s.li,{children:["Network errors: ensure your route exists in ",(0,r.jsx)(s.code,{children:"routes.yaml"})," and upstream service is reachable"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Automation Studio (Visual Designer) checklist"}),"\n",(0,r.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","SPA uses same-origin endpoints only","\n",(0,r.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","CRUD + SSE: ",(0,r.jsx)(s.code,{children:"/api/crud/..."})]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","PDP (AuthZEN): ",(0,r.jsx)(s.code,{children:"/access/v1/evaluation"})," and ",(0,r.jsx)(s.code,{children:"/access/v1/evaluations"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(s.code,{children:"routes.yaml"})," contains required entries","\n",(0,r.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","CRUD routes \u2192 ",(0,r.jsx)(s.code,{children:"crud_service"})]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","PDP routes \u2192 ",(0,r.jsx)(s.code,{children:"pdp_service"})," with ",(0,r.jsx)(s.code,{children:"preserve_path: true"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Browser credentials included","\n",(0,r.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","fetch: ",(0,r.jsx)(s.code,{children:"credentials: 'include'"})]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","axios: ",(0,r.jsx)(s.code,{children:"{ withCredentials: true }"})]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","SSE cross-origin dev: ",(0,r.jsx)(s.code,{children:"{ withCredentials: true }"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Dev vs Prod base URL","\n",(0,r.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Dev: ",(0,r.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," points at BFF origin; CORS allows UI"]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Prod: ",(0,r.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," = ",(0,r.jsx)(s.code,{children:"/api"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>t,x:()=>l});var n=i(96540);const r={},c=n.createContext(r);function t(e){const s=n.useContext(c);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(c.Provider,{value:s},e.children)}}}]);