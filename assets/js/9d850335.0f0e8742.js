"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[6774],{23224:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"services/bff/reference/proxy-yaml-reference","title":"YAML-driven proxy reference","description":"Source of truth: ServiceConfigs/BFF/config/routes.yaml (mounted to /app/config).","source":"@site/docs/services/bff/reference/proxy-yaml-reference.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/proxy-yaml-reference","permalink":"/empowernow_docs/docs/services/bff/reference/proxy-yaml-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/proxy-yaml-reference.md","tags":[{"inline":true,"label":"service:bff","permalink":"/empowernow_docs/docs/tags/service-bff"},{"inline":true,"label":"type:reference","permalink":"/empowernow_docs/docs/tags/type-reference"},{"inline":true,"label":"roles:developer","permalink":"/empowernow_docs/docs/tags/roles-developer"},{"inline":true,"label":"roles:devops","permalink":"/empowernow_docs/docs/tags/roles-devops"}],"version":"current","frontMatter":{"id":"proxy-yaml-reference","title":"YAML-driven proxy reference","sidebar_label":"YAML proxy (routes.yaml)","tags":["service:bff","type:reference","roles:developer","roles:devops"]},"sidebar":"tutorialSidebar","previous":{"title":"pdp.yaml Reference (legacy)","permalink":"/empowernow_docs/docs/services/bff/reference/pdp-reference"},"next":{"title":"QA Appendix \u2014 Full Test Execution Guide","permalink":"/empowernow_docs/docs/services/bff/reference/qa-advanced"}}');var c=n(74848),i=n(28453);const o={id:"proxy-yaml-reference",title:"YAML-driven proxy reference",sidebar_label:"YAML proxy (routes.yaml)",tags:["service:bff","type:reference","roles:developer","roles:devops"]},a=void 0,d={},t=[];function l(e){const r={code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(r.p,{children:["Source of truth: ",(0,c.jsx)(r.code,{children:"ServiceConfigs/BFF/config/routes.yaml"})," (mounted to ",(0,c.jsx)(r.code,{children:"/app/config"}),")."]}),"\n",(0,c.jsx)(r.p,{children:"What it defines"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsx)(r.li,{children:"Service entries and upstreams"}),"\n",(0,c.jsxs)(r.li,{children:["Route entries with: ",(0,c.jsx)(r.code,{children:"id"}),", ",(0,c.jsx)(r.code,{children:"path"}),", ",(0,c.jsx)(r.code,{children:"target_service"}),", ",(0,c.jsx)(r.code,{children:"upstream_path"}),", ",(0,c.jsx)(r.code,{children:"methods"}),", ",(0,c.jsx)(r.code,{children:"auth"})," (",(0,c.jsx)(r.code,{children:"none|session|bearer"}),"), ",(0,c.jsx)(r.code,{children:"streaming"}),", ",(0,c.jsx)(r.code,{children:"preserve_path"}),", ",(0,c.jsx)(r.code,{children:"authz"})," (",(0,c.jsx)(r.code,{children:"none|pdp"}),"), optional inline ",(0,c.jsx)(r.code,{children:"authz_map"})]}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:"Usage from SPA"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:["Call ",(0,c.jsx)(r.code,{children:"/api/..."})," on the BFF domain. Example:"]}),"\n"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-ts",children:"await apiClient.post('/api/crud/execute', { system: 'ad', object_type: 'user', action: 'create', params: { samAccountName: 'ada' } });\n"})}),"\n",(0,c.jsx)(r.p,{children:"Mental model"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"path"})," is what the SPA calls under ",(0,c.jsx)(r.code,{children:"/api/..."}),"; the BFF translates it to an upstream by applying ",(0,c.jsx)(r.code,{children:"upstream_path"})," and the service ",(0,c.jsx)(r.code,{children:"base_url"}),"."]}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:"Example"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-text",children:"GET /api/crud/forms/123  \u2192  BFF \u2192 GET http://crud_service/forms/123\n"})}),"\n",(0,c.jsx)(r.p,{children:"AuthZEN (PDP) preserved-path examples"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:'# POST /access/v1/evaluation (single)\r\n- id: "pdp-authzen-evaluation"\r\n  path: "/access/v1/evaluation*"\r\n  target_service: "pdp_service"\r\n  methods: ["POST", "OPTIONS"]\r\n  preserve_path: true\r\n\r\n# POST /access/v1/evaluations (batch)\r\n- id: "pdp-authzen-evaluations"\r\n  path: "/access/v1/evaluations*"\r\n  target_service: "pdp_service"\r\n  methods: ["POST", "OPTIONS"]\r\n  preserve_path: true\n'})}),"\n",(0,c.jsx)(r.p,{children:"Inline PDP mapping on routes"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:'- id: "crud-tasks-exact"\r\n  path: "/api/crud/tasks"\r\n  target_service: "crud_service"\r\n  upstream_path: "/tasks"\r\n  methods: ["GET", "POST"]\r\n  auth: "session"\r\n  authz: "pdp"\r\n  authz_map:\r\n    GET:\r\n      resource: "task_list"\r\n      action: "read"\r\n    POST:\r\n      resource: "task"\r\n      action: "create"\n'})}),"\n",(0,c.jsx)(r.p,{children:"Resolver precedence"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:["Inline ",(0,c.jsx)(r.code,{children:"authz_map"})," \u2192 external ",(0,c.jsx)(r.code,{children:"pdp.yaml:endpoint_map"})," (legacy) \u2192 derived defaults (if enabled)"]}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:"Examples of families"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"/api/crud/forms*"}),", ",(0,c.jsx)(r.code,{children:"/api/crud/workflows*"}),", ",(0,c.jsx)(r.code,{children:"/api/tasks/*"}),", ",(0,c.jsx)(r.code,{children:"/api/commands/*"}),", ",(0,c.jsx)(r.code,{children:"/api/introspection/*"}),", ",(0,c.jsx)(r.code,{children:"/api/agents/*"}),", ",(0,c.jsx)(r.code,{children:"/api/nodes/*"}),", ",(0,c.jsx)(r.code,{children:"/api/v1/analytics/*"})]}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:"Auth semantics"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"auth: session"})," \u2192 requires BFF session"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"auth: bearer"})," \u2192 validates presented bearer token per ",(0,c.jsx)(r.code,{children:"idps.yaml"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"auth: none"})," \u2192 public"]}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:"Authorization semantics"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"authz: pdp"})," enables per-request authorization via PDP"]}),"\n",(0,c.jsxs)(r.li,{children:["Define per-method mapping with ",(0,c.jsx)(r.code,{children:"authz_map"})," or rely on legacy ",(0,c.jsx)(r.code,{children:"pdp.yaml"})," until migrated"]}),"\n"]}),"\n",(0,c.jsxs)(r.p,{children:["See also: ",(0,c.jsx)(r.code,{children:"../how-to/bff-config-routing"}),", ",(0,c.jsx)(r.code,{children:"./routes-reference"}),", ",(0,c.jsx)(r.code,{children:"./pdp-mapping"})]})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(96540);const c={},i=s.createContext(c);function o(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);