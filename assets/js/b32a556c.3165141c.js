"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[6986],{28453:(e,s,i)=>{i.d(s,{R:()=>r,x:()=>c});var n=i(96540);const t={},l=n.createContext(t);function r(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(l.Provider,{value:s},e.children)}},76474:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"services/bff/tutorials/spa-golden-path","title":"React SPA + BFF \u2014 Golden Path (Step\u2011by\u2011Step)","description":"What is the golden path?","source":"@site/docs/services/bff/tutorials/spa-golden-path.md","sourceDirName":"services/bff/tutorials","slug":"/services/bff/tutorials/spa-golden-path","permalink":"/empowernow_docs/docs/services/bff/tutorials/spa-golden-path","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/tutorials/spa-golden-path.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"React SPA + BFF \u2014 Golden Path (Step\u2011by\u2011Step)","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Backend for Frontend (BFF)","permalink":"/empowernow_docs/docs/services/bff/"},"next":{"title":"Admin Quickstart","permalink":"/empowernow_docs/docs/services/bff/tutorials/bff-quickstart"}}');var t=i(74848),l=i(28453);const r={title:"React SPA + BFF \u2014 Golden Path (Step\u2011by\u2011Step)",sidebar_position:1},c=void 0,a={},d=[{value:"Mental model: <code>/api</code> is the BFF",id:"mental-model-api-is-the-bff",level:3},{value:"Automation Studio (Visual Designer) checklist",id:"automation-studio-visual-designer-checklist",level:3}];function o(e){const s={code:"code",h3:"h3",input:"input",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"What is the golden path?"}),"\n",(0,t.jsxs)(s.p,{children:["The golden path is the recommended, production\u2011grade way for SPAs to reach backend APIs through the BFF. It\r\na) keeps tokens out of the browser, b) uses same\u2011origin ",(0,t.jsx)(s.code,{children:"/api/**"})," for a simple DX, and c) lets Traefik/BFF authorize\r\nevery request. Follow this path unless you have a strong reason not to."]}),"\n",(0,t.jsx)(s.p,{children:"Prereqs"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["BFF running with ",(0,t.jsx)(s.code,{children:"routes.yaml"})," loaded"]}),"\n",(0,t.jsx)(s.li,{children:"IdP reachable by the BFF"}),"\n",(0,t.jsx)(s.li,{children:"Dev: CORS allowlist includes your Vite origin; Prod: same\u2011origin routing via Traefik"}),"\n",(0,t.jsx)(s.li,{children:"Hosts entries for local TLS domains if you use the compose stack (see QA guide)"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Steps"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Configure env"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL=https://bff.example.com/api"})," (or ",(0,t.jsx)(s.code,{children:"/api"})," when same origin)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Wire the app"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Wrap your app with ",(0,t.jsx)(s.code,{children:"AuthProvider"})," and call ",(0,t.jsx)(s.code,{children:"setBaseUrl"}),". Place this in ",(0,t.jsx)(s.code,{children:"src/main.tsx"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-tsx",children:"import { AuthProvider, setBaseUrl } from '@empowernow/bff-auth-react'\r\nsetBaseUrl(import.meta.env.VITE_BFF_BASE_URL || '/api')\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Protect routes"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Use an ",(0,t.jsx)(s.code,{children:"AuthGuard"})," to redirect anonymous users to ",(0,t.jsx)(s.code,{children:"/login"})," and preserve ",(0,t.jsx)(s.code,{children:"returnUrl"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Call your APIs"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Use ",(0,t.jsx)(s.code,{children:"apiClient"}),"/",(0,t.jsx)(s.code,{children:"fetchWithAuth"})," to call canonical ",(0,t.jsx)(s.code,{children:"/api/<app>/..."})," paths. Do not attach Authorization headers; the cookie is sent automatically."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Define routes in the BFF"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Add entries under ",(0,t.jsx)(s.code,{children:"routes:"})," referencing your backend service. Use the canonical ",(0,t.jsx)(s.code,{children:"/api/<app>/*"})," shape and set ",(0,t.jsx)(s.code,{children:"auth: session"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'services:\r\n  my_service:\r\n    base_url: "http://my-service:8080"\r\n    timeout: 30\r\nroutes:\r\n  - id: "my-app-items"\r\n    path: "/api/myapp/items/*"\r\n    target_service: "my_service"\r\n    upstream_path: "/items/{path}"\r\n    methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]\r\n    auth: "session"\n'})}),"\n",(0,t.jsxs)(s.ol,{start:"6",children:["\n",(0,t.jsx)(s.li,{children:"Test the flow"}),"\n"]}),"\n",(0,t.jsx)(s.mermaid,{value:"sequenceDiagram\r\n  participant UI as SPA\r\n  participant BFF\r\n  participant SVC as Service\r\n  UI->>BFF: GET /api/myapp/items\r\n  BFF->>SVC: GET /items\r\n  SVC--\x3e>BFF: 200\r\n  BFF--\x3e>UI: 200"}),"\n",(0,t.jsxs)(s.h3,{id:"mental-model-api-is-the-bff",children:["Mental model: ",(0,t.jsx)(s.code,{children:"/api"})," is the BFF"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Calls that look \u201clocal\u201d like ",(0,t.jsx)(s.code,{children:"/api/<app>/..."})," always go to the BFF first."]}),"\n",(0,t.jsxs)(s.li,{children:["The BFF uses ",(0,t.jsx)(s.code,{children:"routes.yaml"})," to translate them into real backend requests and enforces session/CSRF/PDP."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Concrete example"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"GET /api/myapp/items/123  \u2192  BFF  \u2192  GET http://my-service:8080/items/123\n"})}),"\n",(0,t.jsx)(s.p,{children:"Dev vs Prod base URL"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Dev (separate origins): set ",(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," to the BFF origin (for example ",(0,t.jsx)(s.code,{children:"http://localhost:8000/api"}),") and ensure CORS allows your UI origin."]}),"\n",(0,t.jsxs)(s.li,{children:["Prod (same origin): serve the SPA via Traefik with the BFF and set ",(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," to ",(0,t.jsx)(s.code,{children:"/api"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Common pitfalls"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Double ",(0,t.jsx)(s.code,{children:"/api"})," prefix (client path should start with ",(0,t.jsx)(s.code,{children:"/api/..."}),", wrapper strips leading ",(0,t.jsx)(s.code,{children:"/api"})," once)"]}),"\n",(0,t.jsx)(s.li,{children:"Missing dev origin in CORS allowlist \u2192 opaque 401"}),"\n",(0,t.jsxs)(s.li,{children:["Wrong ",(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," in dev \u2192 calls go to the wrong origin"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Checklist"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"AuthProvider"})," wraps ",(0,t.jsx)(s.code,{children:"<App />"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," set"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Calls go to ",(0,t.jsx)(s.code,{children:"/api/..."})," (no direct service URLs)"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Route exists in ",(0,t.jsx)(s.code,{children:"routes.yaml"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","PDP mapping exists in ",(0,t.jsx)(s.code,{children:"pdp.yaml"})," for your route; action allowed (403 otherwise)"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Unauthenticated call returns JSON + CORS headers in dev (verifies error\u2011path CORS)"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"automation-studio-visual-designer-checklist",children:"Automation Studio (Visual Designer) checklist"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","SPA calls same-origin endpoints only","\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","CRUD + SSE: ",(0,t.jsx)(s.code,{children:"/api/crud/..."})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","PDP (AuthZEN): ",(0,t.jsx)(s.code,{children:"/access/v1/evaluation"})," and ",(0,t.jsx)(s.code,{children:"/access/v1/evaluations"})," (preserved path)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"ServiceConfigs/BFF/config/routes.yaml"})," entries exist","\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","CRUD entries target ",(0,t.jsx)(s.code,{children:"crud_service"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","PDP entries target ",(0,t.jsx)(s.code,{children:"pdp_service"})," with ",(0,t.jsx)(s.code,{children:"preserve_path: true"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Credentials included from the browser","\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","fetch: ",(0,t.jsx)(s.code,{children:"credentials: 'include'"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","axios: ",(0,t.jsx)(s.code,{children:"{ withCredentials: true }"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","SSE: same-origin works by default; cross-origin dev uses ",(0,t.jsx)(s.code,{children:"{ withCredentials: true }"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Dev vs Prod base URL","\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Dev: ",(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," = BFF origin (CORS allows UI origin)"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Prod: ",(0,t.jsx)(s.code,{children:"VITE_BFF_BASE_URL"})," = ",(0,t.jsx)(s.code,{children:"/api"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);