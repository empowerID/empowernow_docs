"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[6805],{15175:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"services/nowconnect/reference/security-overview","title":"security-overview","description":"NowConnect Security Overview","source":"@site/docs/services/nowconnect/reference/security-overview.md","sourceDirName":"services/nowconnect/reference","slug":"/services/nowconnect/reference/security-overview","permalink":"/empowernow_docs/docs/services/nowconnect/reference/security-overview","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/nowconnect/reference/security-overview.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ports-and-protocols","permalink":"/empowernow_docs/docs/services/nowconnect/reference/ports-and-protocols"},"next":{"title":"security","permalink":"/empowernow_docs/docs/services/nowconnect/reference/security"}}');var i=r(74848),o=r(28453);const t={},c=void 0,d={},l=[{value:"NowConnect Security Overview",id:"nowconnect-security-overview",level:2},{value:"Components",id:"components",level:3},{value:"End\u2011to\u2011end data flow and trust boundaries",id:"endtoend-data-flow-and-trust-boundaries",level:3},{value:"Authentication (Agent \u2192 Cloud)",id:"authentication-agent--cloud",level:3},{value:"Authorization (Cloud)",id:"authorization-cloud",level:3},{value:"Transport Security",id:"transport-security",level:3},{value:"Security profiles",id:"security-profiles",level:3},{value:"Compliance overview",id:"compliance-overview",level:3},{value:"Incident response (high level)",id:"incident-response-high-level",level:3},{value:"DR, RTO/RPO guidance",id:"dr-rtorpo-guidance",level:3},{value:"Health and Observability",id:"health-and-observability",level:3},{value:"Secrets",id:"secrets",level:3},{value:"FAPI (optional)",id:"fapi-optional",level:3},{value:"Single\u2011tenant posture",id:"singletenant-posture",level:3}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"nowconnect-security-overview",children:"NowConnect Security Overview"}),"\n",(0,i.jsxs)(n.p,{children:["This page summarizes authentication, authorization, secrets, logging, transport security, and observability for the NowConnect Cloud Hub and Premise Agent. See also: ",(0,i.jsx)(n.a,{href:"/empowernow_docs/docs/services/nowconnect/reference/idp-and-auth",children:"IdP support and auth"}),", ",(0,i.jsx)(n.a,{href:"/empowernow_docs/docs/services/nowconnect/reference/security",children:"Security model"}),", and ",(0,i.jsx)(n.a,{href:"/empowernow_docs/docs/services/nowconnect/reference/configuration",children:"Configuration"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"components",children:"Components"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cloud Hub (FastAPI)"}),": WebSocket ",(0,i.jsx)(n.code,{children:"/tunnel"}),", ",(0,i.jsx)(n.code,{children:"/healthz"}),", ",(0,i.jsx)(n.code,{children:"/readyz"}),", Prometheus ",(0,i.jsx)(n.code,{children:"/metrics"}),", TCP listeners per connector."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Premise Agent (asyncio)"}),": outbound\u2011only ",(0,i.jsx)(n.code,{children:"wss://"})," tunnel, local health TCP, no data\u2011plane listeners."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"endtoend-data-flow-and-trust-boundaries",children:"End\u2011to\u2011end data flow and trust boundaries"}),"\n",(0,i.jsx)(n.mermaid,{value:"flowchart LR\n  subgraph Clients\n    C1[LDAP/Apps]\n  end\n  subgraph Edge[Edge Ingress]\n    IG[LB/Ingress]\n  end\n  subgraph Cloud[NowConnect Cloud]\n    CH1[Cloud Hub A]\n    CH2[Cloud Hub B]\n    MESH[mTLS /mesh]\n    MET[Prometheus /metrics]\n  end\n  subgraph Control[Control Plane]\n    R[(Redis)]\n    IDP[IdP JWKS]\n    SIEM[(SIEM/Log Store)]\n  end\n  subgraph Premise[Premise Network]\n    AG[Premise Agent]\n    TGT[Targets: LDAP/DB/Apps]\n  end\n\n  C1 --\x3e|TCP 389/636/...| IG --\x3e CH1\n  C1 --\x3e|TCP 389/636/...| IG --\x3e CH2\n  CH1 <--\x3e|WSS mTLS| MESH\n  MESH <--\x3e|WSS mTLS| CH2\n  CH1 --\x3e|JWT verify| IDP\n  CH2 --\x3e|JWT verify| IDP\n  CH1 --\x3e R\n  CH2 --\x3e R\n  CH1 --\x3e|Structured logs| SIEM\n  CH2 --\x3e|Structured logs| SIEM\n  AG -- WSS (TLS) + JWT --\x3e IG --\x3e CH1\n  AG -- WSS (TLS) + JWT --\x3e IG --\x3e CH2\n  AG --\x3e|TCP| TGT"}),"\n",(0,i.jsxs)(n.p,{children:["Trust boundaries: TLS at all external hops; mTLS enforced at ingress for ",(0,i.jsx)(n.code,{children:"/mesh"}),"; agent tunnels use TLS + JWT by default (agent mTLS optional)."]}),"\n",(0,i.jsx)(n.h3,{id:"authentication-agent--cloud",children:"Authentication (Agent \u2192 Cloud)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["WebSocket upgrade requires ",(0,i.jsx)(n.code,{children:"Authorization: Bearer <JWT>"})," (a development bypass is available for local testing)."]}),"\n",(0,i.jsxs)(n.li,{children:["JWT validated against IdP JWKS and ",(0,i.jsx)(n.code,{children:"audience"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"HELLO"})," reconciliation: ",(0,i.jsx)(n.code,{children:"HELLO.agent_id"})," must match the JWT ",(0,i.jsx)(n.code,{children:"agent_id"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Configure via env or YAML:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Env: ",(0,i.jsx)(n.code,{children:"NOWCONNECT_JWKS_URL"}),", ",(0,i.jsx)(n.code,{children:"NOWCONNECT_AUDIENCE"})]}),"\n",(0,i.jsxs)(n.li,{children:["YAML: ",(0,i.jsx)(n.code,{children:"security.jwks_url"}),", ",(0,i.jsx)(n.code,{children:"security.audience"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"authorization-cloud",children:"Authorization (Cloud)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Optional PDP authorization on each ",(0,i.jsx)(n.code,{children:"OPEN(connector)"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Toggle via ",(0,i.jsx)(n.code,{children:"pdp.url"})," (YAML) or ",(0,i.jsx)(n.code,{children:"NOWCONNECT_PDP_URL"})," (env). If set, Cloud calls PDP with ",(0,i.jsx)(n.code,{children:"subject=agent_id"}),", ",(0,i.jsx)(n.code,{children:"action=connect"}),", ",(0,i.jsx)(n.code,{children:"resource={type:connector,id}"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Decision cache TTL and timeout configurable (",(0,i.jsx)(n.code,{children:"pdp.cache_ttl_sec"}),", ",(0,i.jsx)(n.code,{children:"pdp.timeout_ms"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Fail\u2011open/closed via ",(0,i.jsx)(n.code,{children:"pdp.fail_open"})," (default false)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Optional connector scope enforcement on HELLO:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Toggle ",(0,i.jsx)(n.code,{children:"security.require_connector_scopes=true"})," or ",(0,i.jsx)(n.code,{children:"NOWCONNECT_REQUIRE_CONNECTOR_SCOPES=true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["JWT must include connector names (via a ",(0,i.jsx)(n.code,{children:"connectors"})," claim or ",(0,i.jsx)(n.code,{children:"scp"})," scope list)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"transport-security",children:"Transport Security"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Tunnel: ",(0,i.jsx)(n.code,{children:"wss://"})," from premise to cloud (TLS). Corporate proxies supported with ",(0,i.jsx)(n.code,{children:"NC_TRUST_ENV=true"})," on the agent; system proxy envs are honored."]}),"\n",(0,i.jsxs)(n.li,{children:["CA bundle: agent can trust corporate CA via ",(0,i.jsx)(n.code,{children:"NC_CA_BUNDLE"})," SSL context."]}),"\n",(0,i.jsx)(n.li,{children:"Protocol payloads: raw TCP; application TLS (e.g., LDAPS/HTTPS) remains end\u2011to\u2011end."}),"\n",(0,i.jsx)(n.li,{children:"Agent\u2194Cloud mTLS: optional and off by default; baseline is TLS (WSS) + JWT. If required, enforce client mTLS at ingress; the app continues to validate JWT."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"security-profiles",children:"Security profiles"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Control"}),(0,i.jsx)(n.th,{children:"Baseline"}),(0,i.jsx)(n.th,{children:"Enterprise Hardened"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Mesh hub\u2194hub"}),(0,i.jsx)(n.td,{children:"TLS with mTLS enforced at ingress in prod"}),(0,i.jsx)(n.td,{children:"Same + cert rotation SLOs + SAN allowlist"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Agent\u2194Cloud"}),(0,i.jsx)(n.td,{children:"TLS (WSS) + JWT"}),(0,i.jsx)(n.td,{children:"Optional client mTLS at ingress; device identity policies"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"JWT"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"aud=nowconnect"}),", JWKS, ",(0,i.jsx)(n.code,{children:"agent_id"})," reconciliation"]}),(0,i.jsx)(n.td,{children:"+ Connector scopes, short TTL, key rotation alerts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AuthZ"}),(0,i.jsx)(n.td,{children:"Optional PDP off"}),(0,i.jsxs)(n.td,{children:["PDP on ",(0,i.jsx)(n.code,{children:"OPEN(connector)"})," with deny-fast and cache"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Inbound listeners"}),(0,i.jsx)(n.td,{children:"TLS where applicable; CIDR allowlists optional"}),(0,i.jsx)(n.td,{children:"Strict CIDR allowlists + dedicated VIPs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TLS profile"}),(0,i.jsx)(n.td,{children:"TLS 1.2/1.3, secure ciphers"}),(0,i.jsx)(n.td,{children:"TLS 1.3 preferred, FIPS images where required"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Observability"}),(0,i.jsx)(n.td,{children:"Metrics/logs shipped to SIEM"}),(0,i.jsx)(n.td,{children:"Baseline + dashboards + SLO/alert pack"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Secrets"}),(0,i.jsx)(n.td,{children:"Files/Secrets, no payload logs"}),(0,i.jsx)(n.td,{children:"HSM/KMS-backed secrets, automated rotation"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"compliance-overview",children:"Compliance overview"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["See compliance mapping for CIS, NIST 800\u201153, ISO 27001, and SOC 2 alignment: ",(0,i.jsx)(n.a,{href:"/empowernow_docs/docs/services/nowconnect/reference/compliance-mapping",children:"Compliance Mapping"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FIPS: Achieved via your base image/OS and crypto modules; NowConnect runs on that foundation and honors system TLS libraries."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"incident-response-high-level",children:"Incident response (high level)"}),"\n",(0,i.jsx)(n.p,{children:"Common scenarios: tunnel token abuse, hub cert/key exposure, mesh mTLS failure."}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n  participant Det as Detect\n  participant Con as Contain\n  participant Era as Eradicate\n  participant Rec as Recover\n  participant Lrn as Lessons\n\n  Det->>Det: Alert: JWT failures/mTLS errors/anomalous traffic\n  Det--\x3e>Con: Triage: identify scope (agent/hub/ingress)\n  Con->>Con: Block: revoke token/cert; tighten ingress; scale down affected pods\n  Con--\x3e>Era: Forensic snapshot; rotate secrets\n  Era->>Era: Re-issue keys/certs; invalidate tokens; update JWKS\n  Era--\x3e>Rec: Redeploy hubs; verify mesh/readyz; validate traffic\n  Rec->>Rec: Monitor SLOs/alerts; confirm eradication\n  Rec--\x3e>Lrn: Postmortem; improve controls/runbooks"}),"\n",(0,i.jsx)(n.p,{children:"Runbook references: token rotation, cert rotation, and ingress mTLS examples in hardening/PKI guidance."}),"\n",(0,i.jsx)(n.h3,{id:"dr-rtorpo-guidance",children:"DR, RTO/RPO guidance"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Targets (starting points): RTO \u2264 15 minutes for Cloud Hub; RPO 0 for runtime state (stateless hubs). Redis availability per your HA deployment."}),"\n",(0,i.jsxs)(n.li,{children:["Validate: failover tests for hub crash, mesh partition, and Redis loss; verify ",(0,i.jsx)(n.code,{children:"/readyz"})," and traffic continuity."]}),"\n",(0,i.jsx)(n.li,{children:"Backups: configuration and secrets only; no payload storage. Redis persistence optional; size for registry usage."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"health-and-observability",children:"Health and Observability"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Agent: TCP health on ",(0,i.jsx)(n.code,{children:"NC_HEALTH_HOST:NC_HEALTH_PORT"})," responds ",(0,i.jsx)(n.code,{children:"OK"})," pre\u2011ACK, ",(0,i.jsx)(n.code,{children:"READY"})," after ",(0,i.jsx)(n.code,{children:"HELLO_ACK"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cloud: ",(0,i.jsx)(n.code,{children:"/healthz"}),", ",(0,i.jsx)(n.code,{children:"/readyz"}),", and Prometheus metrics."]}),"\n",(0,i.jsx)(n.li,{children:"Metrics (Cloud): connections, bytes, FIN/RST, queue overflow, PDP decisions; optional FAPI (DPoP) reject counter when enabled."}),"\n",(0,i.jsxs)(n.li,{children:["Logging: structured JSON on Cloud by default; agent supports ",(0,i.jsx)(n.code,{children:"NC_LOG_FORMAT=json"}),". Logs metadata only (no payload bytes)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"secrets",children:"Secrets"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Agent token: ",(0,i.jsx)(n.code,{children:"NC_TOKEN_FILE"})," path, mounted read\u2011only (Kubernetes Secret or host file). Rotate and restart the agent to pick up a new token."]}),"\n",(0,i.jsxs)(n.li,{children:["Avoid logging secrets; ",(0,i.jsx)(n.code,{children:"Authorization"})," header should be excluded from access logs at the edge."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"fapi-optional",children:"FAPI (optional)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Modes: ",(0,i.jsx)(n.code,{children:"security.fapi_mode"})," (YAML) or ",(0,i.jsx)(n.code,{children:"NOWCONNECT_FAPI_MODE"}),"/",(0,i.jsx)(n.code,{children:"FAPI_MODE"})," (env). Default ",(0,i.jsx)(n.code,{children:"0"})," (off)."]}),"\n",(0,i.jsx)(n.li,{children:"Mode 2 (planned): DPoP verification on WS upgrade with replay protection. Prefer enforcing client mTLS at ingress when required."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"singletenant-posture",children:"Single\u2011tenant posture"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["No tenant claims or tenant indexing at runtime. Connector index keyed by ",(0,i.jsx)(n.code,{children:"connector"})," only. ",(0,i.jsx)(n.code,{children:"HELLO"})," reconciliation uses ",(0,i.jsx)(n.code,{children:"agent_id"})," only."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var s=r(96540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);