"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[3072],{28453:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>c});var r=t(96540);const n={},i=r.createContext(n);function o(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),r.createElement(i.Provider,{value:s},e.children)}},56156:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"services/crud-service/how-to/bff-startup-dcr-iat","title":"Fix BFF startup errors with a DCR Initial Access Token (IAT)","description":"If the BFF fails during startup and shuts down with Dynamic Client Registration (DCR) errors, issue a fresh DCR Initial Access Token (IAT), place it in the compose env, and restart. A ready\u2011to\u2011use Postman request is checked in under the CRUD Service repo.","source":"@site/docs/services/crud-service/how-to/bff-startup-dcr-iat.md","sourceDirName":"services/crud-service/how-to","slug":"/services/crud-service/how-to/bff-startup-dcr-iat","permalink":"/empowernow_docs/docs/services/crud-service/how-to/bff-startup-dcr-iat","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/how-to/bff-startup-dcr-iat.md","tags":[],"version":"current","frontMatter":{"id":"bff-startup-dcr-iat","title":"Fix BFF startup errors with a DCR Initial Access Token (IAT)","sidebar_label":"BFF startup: DCR IAT"},"sidebar":"tutorialSidebar","previous":{"title":"Migration to Visual Designer","permalink":"/empowernow_docs/docs/services/crud-service/how-to/migration-guide-visual-designer"},"next":{"title":"Enable mTLS (Dev & Prod)","permalink":"/empowernow_docs/docs/services/crud-service/how-to/enable-mtls"}}');var n=t(74848),i=t(28453);const o={id:"bff-startup-dcr-iat",title:"Fix BFF startup errors with a DCR Initial Access Token (IAT)",sidebar_label:"BFF startup: DCR IAT"},c=void 0,a={},d=[{value:"When to use this",id:"when-to-use-this",level:2},{value:"Steps",id:"steps",level:2},{value:"Notes",id:"notes",level:2},{value:"Related guides",id:"related-guides",level:3}];function l(e){const s={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.p,{children:"If the BFF fails during startup and shuts down with Dynamic Client Registration (DCR) errors, issue a fresh DCR Initial Access Token (IAT), place it in the compose env, and restart. A ready\u2011to\u2011use Postman request is checked in under the CRUD Service repo."}),"\n",(0,n.jsx)(s.h2,{id:"when-to-use-this",children:"When to use this"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Logs show bootstrap/registration failures (invalid/expired IAT, missing cred cache)"}),"\n",(0,n.jsx)(s.li,{children:"You see hints like: \u201cGet new RAT/IAT from /api/admin/dcr/initial-access-tokens and update DCR_IAT\u201d"}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"steps",children:"Steps"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Generate a DCR IAT (Postman collection available)"}),"\n"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Open Postman collection: ",(0,n.jsx)(s.code,{children:"CRUDService/tests/postman/EmpowerNow.postman_collection.json"})]}),"\n",(0,n.jsx)(s.li,{children:"Request name: DCR IAT"}),"\n",(0,n.jsxs)(s.li,{children:["Method/URL: POST ",(0,n.jsx)(s.code,{children:"https://idp.ocg.labs.empowernow.ai/api/admin/dcr/initial-access-tokens"})]}),"\n",(0,n.jsx)(s.li,{children:"Example JSON body:"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'{\r\n  "label": "ms-bff bootstrap",\r\n  "expires_in": 3600,\r\n  "max_usages": 1\r\n}\n'})}),"\n",(0,n.jsx)(s.p,{children:"Copy the token from the 201 Created response."}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:"Put token into BFF environment (compose)"}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Edit ",(0,n.jsx)(s.code,{children:"CRUDService/docker-compose-authzen4.yml"})," under the ",(0,n.jsx)(s.code,{children:"bff:"})," service:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",children:'environment:\r\n  DCR_ENABLED: "true"\r\n  SKIP_DCR_BOOTSTRAP: "false"\r\n  IDP_BASE_URL: https://idp.ocg.labs.empowernow.ai/api/oidc\r\n  DCR_IAT: "<paste_token_here>"\r\n  ALLOW_BOOTSTRAP_FAILURE: "false"\n'})}),"\n",(0,n.jsxs)(s.ol,{start:"3",children:["\n",(0,n.jsx)(s.li,{children:"Restart BFF and watch logs"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-powershell",children:"cd C:\\source\\repos\\CRUDService\r\ndocker-compose -f docker-compose-authzen4.yml up -d bff\r\ndocker-compose -f docker-compose-authzen4.yml logs -f bff\n"})}),"\n",(0,n.jsx)(s.p,{children:"Expect to see successful client registration and the service staying healthy. If it still fails, ensure the IAT is not expired, and that the IdP admin route is reachable from the BFF network."}),"\n",(0,n.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"IATs are short\u2011lived; create a new one if you see format/expiry errors."}),"\n",(0,n.jsx)(s.li,{children:"After initial bootstrap, credentials are cached; subsequent restarts should not require a new IAT unless you force replace."}),"\n",(0,n.jsx)(s.li,{children:"See also: BFF docs \u2192 How\u2011to \u2192 DCR Bootstrap for deeper context."}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"related-guides",children:"Related guides"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["BFF + IdP OAuth (end\u2011to\u2011end): ",(0,n.jsx)(s.code,{children:"services/bff/reference/bff-idp-oauth-e2e"})]}),"\n",(0,n.jsxs)(s.li,{children:["Register BFF with private_key_jwt (DCR): ",(0,n.jsx)(s.code,{children:"services/bff/how-to/register-bff-private-key-jwt"})]}),"\n",(0,n.jsxs)(s.li,{children:["Switch auth methods: ",(0,n.jsx)(s.code,{children:"services/bff/how-to/switch-auth-methods"})]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);