"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[1391],{28453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>l});var r=n(96540);const c={},i=r.createContext(c);function d(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:d(e.components),r.createElement(i.Provider,{value:s},e.children)}},84592:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"services/crud-service/secrets/api-reference","title":"API reference","description":"Secrets API endpoints, scopes, purposes, and examples","source":"@site/docs/services/crud-service/secrets/09-api-reference.md","sourceDirName":"services/crud-service/secrets","slug":"/services/crud-service/secrets/api-reference","permalink":"/empowernow_docs/docs/services/crud-service/secrets/api-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/secrets/09-api-reference.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"title":"API reference","description":"Secrets API endpoints, scopes, purposes, and examples"},"sidebar":"tutorialSidebar","previous":{"title":"Developer guide","permalink":"/empowernow_docs/docs/services/crud-service/secrets/developer-guide"},"next":{"title":"Troubleshooting and runbooks","permalink":"/empowernow_docs/docs/services/crud-service/secrets/troubleshooting-runbooks"}}');var c=n(74848),i=n(28453);const d={title:"API reference",description:"Secrets API endpoints, scopes, purposes, and examples"},l=void 0,o={},t=[{value:"Endpoint catalog and purposes",id:"endpoint-catalog-and-purposes",level:2},{value:"IdP and authorization requirements",id:"idp-and-authorization-requirements",level:2}];function a(e){const s={code:"code",h2:"h2",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(s.p,{children:["See also: ",(0,c.jsx)(s.code,{children:"../reference/secrets-api.md"})," for a consolidated reference."]}),"\n",(0,c.jsx)(s.h2,{id:"endpoint-catalog-and-purposes",children:"Endpoint catalog and purposes"}),"\n",(0,c.jsxs)(s.p,{children:["Each endpoint uses Canonical Secret URIs (e.g., ",(0,c.jsx)(s.code,{children:"openbao+kv2://secret/app/api#token"}),"). PDP purposes and optional OAuth scopes are noted; see IdP requirements below."]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Create/update \u2014 POST ",(0,c.jsx)(s.code,{children:"/api/secrets"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"write"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scope (optional when enabled): ",(0,c.jsx)(s.code,{children:"secrets.write"})]}),"\n",(0,c.jsxs)(s.li,{children:["Body: ",(0,c.jsx)(s.code,{children:'{ "uri": "<canonical>", "value": <objectOrScalar> }'})]}),"\n",(0,c.jsx)(s.li,{children:"YAML (dev): writes file; KVv2: upserts map or fragment value"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Read (YAML dev) \u2014 GET ",(0,c.jsx)(s.code,{children:"/api/secrets?uri=..."})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Purpose: (YAML dev only)"}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.read"})]}),"\n",(0,c.jsxs)(s.li,{children:["Returns object (no fragment) or ",(0,c.jsx)(s.code,{children:'{ "value": <scalarOrObject> }'})," when fragment present"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Read (provider\u2011backed) \u2014 GET ",(0,c.jsx)(s.code,{children:"/api/secrets/value?uri=...[&version=N]"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: enforced inside PEP (",(0,c.jsx)(s.code,{children:"VaultService.get_credentials"}),")"]}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.read"})]}),"\n",(0,c.jsxs)(s.li,{children:["Supports KVv2 version pin via ",(0,c.jsx)(s.code,{children:"version="})," query"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Delete / Destroy \u2014 DELETE ",(0,c.jsx)(s.code,{children:"/api/secrets?uri=...&destroy=[true|false]"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"delete"})," (soft) or ",(0,c.jsx)(s.code,{children:"destroy_versions"})," (when ",(0,c.jsx)(s.code,{children:"destroy=true"}),")"]}),"\n",(0,c.jsxs)(s.li,{children:["Scopes: ",(0,c.jsx)(s.code,{children:"secrets.delete"})," or ",(0,c.jsx)(s.code,{children:"secrets.destroy"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Rotate \u2014 POST ",(0,c.jsx)(s.code,{children:"/api/secrets/rotate"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"rotate"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.rotate"})]}),"\n",(0,c.jsxs)(s.li,{children:["Body: ",(0,c.jsx)(s.code,{children:'{ "uri": "<canonical>", "value": <objectOrScalar> }'})," (KVv2 writes new version)"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Metadata listing (YAML dev) \u2014 GET ",(0,c.jsx)(s.code,{children:"/api/secrets/metadata?prefix=..."}),", ",(0,c.jsx)(s.code,{children:"/keys?uri=..."})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"read_metadata"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.read_metadata"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Metadata detail / Versions (KVv2) \u2014 GET ",(0,c.jsx)(s.code,{children:"/api/secrets/metadata/detail?uri=..."}),", ",(0,c.jsx)(s.code,{children:"/versions?uri=..."})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"read_metadata"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.read_metadata"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Undelete / Destroy versions (KVv2) \u2014 POST ",(0,c.jsx)(s.code,{children:"/api/secrets/undelete"}),", ",(0,c.jsx)(s.code,{children:"/destroy-versions"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purposes: ",(0,c.jsx)(s.code,{children:"undelete"}),", ",(0,c.jsx)(s.code,{children:"destroy_versions"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scopes: ",(0,c.jsx)(s.code,{children:"secrets.delete"}),", ",(0,c.jsx)(s.code,{children:"secrets.destroy"})]}),"\n",(0,c.jsxs)(s.li,{children:["Body: ",(0,c.jsx)(s.code,{children:'{ "uri": "<canonicalPathNoFragment>", "versions": [N,...] }'})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Update owner metadata (KVv2) \u2014 POST ",(0,c.jsx)(s.code,{children:"/api/secrets/metadata/owner"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"owner_update"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.set_owner"})]}),"\n",(0,c.jsxs)(s.li,{children:["Body: ",(0,c.jsx)(s.code,{children:'{ "uri": "<canonicalPathNoFragment>", "owner": "<subjectOrGroup>" }'})]}),"\n",(0,c.jsxs)(s.li,{children:["Preserves ",(0,c.jsx)(s.code,{children:"created_by"})," and ",(0,c.jsx)(s.code,{children:"created_at"}),"; updates ",(0,c.jsx)(s.code,{children:"owner"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Bulk operations \u2014 POST ",(0,c.jsx)(s.code,{children:"/api/secrets/bulk"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: per operation (",(0,c.jsx)(s.code,{children:"set|delete|undelete|destroy|rotate"}),")"]}),"\n",(0,c.jsx)(s.li,{children:"Scope: per operation (as above)"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Copy / Move \u2014 POST ",(0,c.jsx)(s.code,{children:"/api/secrets/copy"}),", ",(0,c.jsx)(s.code,{children:"/api/secrets/move"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Purpose: read on source + write on destination"}),"\n",(0,c.jsxs)(s.li,{children:["Scopes: ",(0,c.jsx)(s.code,{children:"secrets.read"})," + ",(0,c.jsx)(s.code,{children:"secrets.write"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Search (YAML dev; KVv2 when supported) \u2014 GET ",(0,c.jsx)(s.code,{children:"/api/secrets/search?q=...&prefix=..."})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Purpose: ",(0,c.jsx)(s.code,{children:"read_metadata"})]}),"\n",(0,c.jsxs)(s.li,{children:["Scope: ",(0,c.jsx)(s.code,{children:"secrets.read_metadata"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["Events / Audit (dev) \u2014 GET ",(0,c.jsx)(s.code,{children:"/api/secrets/events"}),", ",(0,c.jsx)(s.code,{children:"/api/secrets/audit"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Dev helpers (SSE stream and in\u2011memory ring buffer). Hide/disable in prod."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"Scopes (optional) and PDP purposes are listed per endpoint in the reference page."}),"\n",(0,c.jsx)(s.p,{children:"Compliance signals (CISO)"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Audit fields: ",(0,c.jsx)(s.code,{children:"subject"}),", ",(0,c.jsx)(s.code,{children:"purpose"}),", ",(0,c.jsx)(s.code,{children:"effect"}),", ",(0,c.jsx)(s.code,{children:"resource_ref"}),", ",(0,c.jsx)(s.code,{children:"decision_id"})]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"Operational limits (Admin)"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Timeouts/retries per provider operation; 429/503 semantics on overload"}),"\n",(0,c.jsx)(s.li,{children:"Pagination defaults: listing/search limit 100 (configurable)"}),"\n",(0,c.jsx)(s.li,{children:"Concurrency caps documented in Admin how\u2011to"}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"QA edge cases to exercise"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Undelete/destroy with empty versions, version pin reads, prefix search traversal"}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"idp-and-authorization-requirements",children:"IdP and authorization requirements"}),"\n",(0,c.jsx)(s.p,{children:"Endpoint auth is off by default for local development. In higher environments enable:"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"SECRETS_API_REQUIRE_AUTH=true"})," \u2014 require session/bearer on ",(0,c.jsx)(s.code,{children:"/api/secrets/*"})]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"SECRETS_ENFORCE_SCOPES=true"})," \u2014 enforce endpoint scopes"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"SECRETS_AUDIENCE=crud.secrets"})," (default) \u2014 audience check when ",(0,c.jsx)(s.code,{children:"aud"})," is present in tokens"]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"Expected OAuth scopes (configure in your IdP):"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"secrets.read"}),", ",(0,c.jsx)(s.code,{children:"secrets.write"}),", ",(0,c.jsx)(s.code,{children:"secrets.delete"}),", ",(0,c.jsx)(s.code,{children:"secrets.destroy"}),", ",(0,c.jsx)(s.code,{children:"secrets.rotate"}),", ",(0,c.jsx)(s.code,{children:"secrets.read_metadata"})]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"secrets.set_owner"})," (for POST ",(0,c.jsx)(s.code,{children:"/api/secrets/metadata/owner"}),")"]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"IdP/client configuration (example):"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Add the audience (e.g., ",(0,c.jsx)(s.code,{children:"crud.secrets"}),") to the scope\u2011to\u2011audience mapping so the IdP issues tokens usable by the secrets API"]}),"\n",(0,c.jsxs)(s.li,{children:["Ensure the client that calls the API (BFF/service/CI) has the allowed audiences including ",(0,c.jsx)(s.code,{children:"crud.secrets"})]}),"\n",(0,c.jsx)(s.li,{children:"Grant only the scopes needed for the operations invoked (least privilege)"}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"PDP purposes (enforced by PEP/PDP):"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"write"}),", ",(0,c.jsx)(s.code,{children:"read"}),", ",(0,c.jsx)(s.code,{children:"delete"}),", ",(0,c.jsx)(s.code,{children:"rotate"}),", ",(0,c.jsx)(s.code,{children:"read_metadata"}),", ",(0,c.jsx)(s.code,{children:"undelete"}),", ",(0,c.jsx)(s.code,{children:"destroy_versions"})]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"owner_update"})," (for POST ",(0,c.jsx)(s.code,{children:"/api/secrets/metadata/owner"}),")"]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"Notes:"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Provider\u2011backed reads invoked by application code use ",(0,c.jsx)(s.code,{children:"VaultService.get_credentials(...)"}),"; the PEP calls the PDP and enforces decisions and obligations."]}),"\n",(0,c.jsxs)(s.li,{children:["YAML provider writes/deletes are blocked when ",(0,c.jsx)(s.code,{children:"ENVIRONMENT"})," is not dev/test."]}),"\n",(0,c.jsxs)(s.li,{children:["On first KVv2 write/rotate, the API/plugin best\u2011effort stamps custom metadata: ",(0,c.jsx)(s.code,{children:"created_by"})," (immutable), ",(0,c.jsx)(s.code,{children:"created_at"})," (ISO UTC), and ",(0,c.jsx)(s.code,{children:"owner"})," (mutable; defaults to subject when available). Providers expose ",(0,c.jsx)(s.code,{children:"custom_metadata"})," via metadata detail."]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"See also:"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["PDP enrichment (subject/resource/purpose/context fields): ",(0,c.jsx)(s.code,{children:"./SECRETS_PDP_ENRICHMENT.md"})]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}}}]);