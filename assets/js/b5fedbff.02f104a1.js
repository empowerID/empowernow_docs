"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[9409],{12765:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"services/bff/devops/experience_routing","title":"Experience App \u2013 BFF Configuration & Routing Guide","description":"Configure the BFF for the Experience app \u2013 ServiceConfigs, required endpoints, CORS, Traefik routing, AuthZEN payload behavior, observability, and health checks.","source":"@site/docs/services/bff/devops/experience_routing.md","sourceDirName":"services/bff/devops","slug":"/services/bff/devops/experience_routing","permalink":"/empowernow_docs/docs/services/bff/devops/experience_routing","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/devops/experience_routing.md","tags":[],"version":"current","frontMatter":{"title":"Experience App \u2013 BFF Configuration & Routing Guide","sidebar_label":"Experience Routing & Config","description":"Configure the BFF for the Experience app \u2013 ServiceConfigs, required endpoints, CORS, Traefik routing, AuthZEN payload behavior, observability, and health checks."}}');var s=i(74848),o=i(28453);const t={title:"Experience App \u2013 BFF Configuration & Routing Guide",sidebar_label:"Experience Routing & Config",description:"Configure the BFF for the Experience app \u2013 ServiceConfigs, required endpoints, CORS, Traefik routing, AuthZEN payload behavior, observability, and health checks."},l=void 0,c={},d=[{value:"Source of truth",id:"source-of-truth",level:2},{value:"Internal routes (target_service: internal)",id:"internal-routes-target_service-internal",level:2},{value:"Required endpoints for Experience",id:"required-endpoints-for-experience",level:2},{value:"CORS and redirect origins",id:"cors-and-redirect-origins",level:2},{value:"Traefik expectations",id:"traefik-expectations",level:2},{value:"Payload behavior for AuthZEN",id:"payload-behavior-for-authzen",level:2},{value:"Observability and troubleshooting",id:"observability-and-troubleshooting",level:2},{value:"Health checklist",id:"health-checklist",level:2},{value:"Routing flows",id:"routing-flows",level:2},{value:"See also",id:"see-also",level:2}];function a(e){const n={code:"code",h2:"h2",li:"li",mermaid:"mermaid",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"source-of-truth",children:"Source of truth"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ServiceConfigs/BFF/config/routes.yaml"}),": defines all public and internal endpoints, upstream targets, and auth requirements"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ServiceConfigs/BFF/config/settings.yaml"}),": CORS, allowed origins, redirect origins, and other runtime settings"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"internal-routes-target_service-internal",children:"Internal routes (target_service: internal)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Internal endpoints are dispatched directly to FastAPI handlers (no HTTP loopback), preserving session context"}),"\n",(0,s.jsxs)(n.li,{children:["Keep ",(0,s.jsx)(n.code,{children:"auth: session"})," on Experience internal endpoints so they remain cookie/session protected"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"required-endpoints-for-experience",children:"Required endpoints for Experience"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["PDP:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /access/v1/evaluation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /access/v1/evaluations"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["UI Config:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/configs/ui"})," (JSON)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/configs/stream"})," (SSE)"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Plugins:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET /api/plugins/manifests"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET /api/plugins/bundle"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"cors-and-redirect-origins",children:"CORS and redirect origins"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"https://experience.ocg.labs.empowernow.ai"})," to ",(0,s.jsx)(n.code,{children:"cors.allow_origins"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"http://localhost:5177"})," to ",(0,s.jsx)(n.code,{children:"cors.dev_origins"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add Experience host to ",(0,s.jsx)(n.code,{children:"ALLOWED_REDIRECT_ORIGINS"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"traefik-expectations",children:"Traefik expectations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Experience SPA router excludes API/auth/stream/PDP routes to avoid intercepting API traffic"}),"\n",(0,s.jsxs)(n.li,{children:["Separate routers on the BFF service for Experience ",(0,s.jsx)(n.code,{children:"Host()"})," that forward ",(0,s.jsx)(n.code,{children:"/api/"}),", ",(0,s.jsx)(n.code,{children:"/auth/"}),", ",(0,s.jsx)(n.code,{children:"/access/v1/"}),", and stream paths to the BFF app"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"payload-behavior-for-authzen",children:"Payload behavior for AuthZEN"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The BFF does not rewrite SPA AuthZEN payloads"}),"\n",(0,s.jsxs)(n.li,{children:["Minimal normalization only: provide a default ",(0,s.jsx)(n.code,{children:"resource.id"})," for collection\u2011level checks when omitted"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"observability-and-troubleshooting",children:"Observability and troubleshooting"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Inspect logs for PDP forwards to verify payloads"}),"\n",(0,s.jsxs)(n.li,{children:["Common misconfigurations:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Experience origin missing from CORS \u2192 browser preflight failures"}),"\n",(0,s.jsxs)(n.li,{children:["Routes missing or not ",(0,s.jsx)(n.code,{children:"auth: session"})," \u2192 404/401"]}),"\n",(0,s.jsx)(n.li,{children:"ForwardAuth enabled for BFF API paths \u2192 cookies stripped (disable for these routers)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Headers to expect:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Allow\u2011list violation \u2192 ",(0,s.jsx)(n.code,{children:"X-Allowlist-Violation: 1"})," (403)"]}),"\n",(0,s.jsxs)(n.li,{children:["Plugin quarantined \u2192 ",(0,s.jsx)(n.code,{children:"X-Plugin-Quarantined: 1"})," (bundle/API/SSE blocked)"]}),"\n",(0,s.jsxs)(n.li,{children:["Response hygiene \u2192 ",(0,s.jsx)(n.code,{children:"Vary: Cookie, X-Plugin-Id"})," on manifests/bundles"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"health-checklist",children:"Health checklist"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Internal routes load without validation errors"}),"\n",(0,s.jsx)(n.li,{children:"CORS origins include Experience"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/api/configs/ui"})," and ",(0,s.jsx)(n.code,{children:"/api/plugins/manifests"})," return 200 with a valid session"]}),"\n",(0,s.jsx)(n.li,{children:"PDP responds 200 for allow and deny test cases through BFF"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"routing-flows",children:"Routing flows"}),"\n",(0,s.jsx)(n.mermaid,{value:'sequenceDiagram\n  autonumber\n  participant SPA as "Experience SPA"\n  participant BFF as "BFF"\n  participant INT as "Internal Handler"\n  participant PDP as "PDP"\n\n  SPA->>BFF: GET /api/configs/ui (cookies)\n  BFF->>INT: Dispatch (target_service: internal)\n  INT--\x3e>BFF: 200 JSON\n  BFF--\x3e>SPA: 200 JSON\n\n  SPA->>BFF: POST /access/v1/evaluation {subject,resource,action,context}\n  BFF->>PDP: Forward AuthZEN request\n  PDP--\x3e>BFF: 200 {decision|allowed}\n  BFF--\x3e>SPA: 200 decision'}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Experience \u2192 Authorization (AuthZEN): ",(0,s.jsx)(n.code,{children:"../../experience/authorization-authzen"})]}),"\n",(0,s.jsxs)(n.li,{children:["Experience \u2192 Plugin System: ",(0,s.jsx)(n.code,{children:"../../experience/plugins"})]}),"\n",(0,s.jsxs)(n.li,{children:["BFF \u2192 ForwardAuth and security model: ",(0,s.jsx)(n.code,{children:"../explanation/security-model"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var r=i(96540);const s={},o=r.createContext(s);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);