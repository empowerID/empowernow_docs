"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[7576],{11363:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"services/crud-service/how-to/secrets-api-openbao","title":"Secrets API hardening and OpenBao provider","description":"How the secrets APIs are secured end-to-end and how to configure OpenBao/HashiCorp as production providers, with YAML for fast local dev.","source":"@site/docs/services/crud-service/how-to/secrets-api-openbao.md","sourceDirName":"services/crud-service/how-to","slug":"/services/crud-service/how-to/secrets-api-openbao","permalink":"/empowernow_docs/docs/services/crud-service/how-to/secrets-api-openbao","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/how-to/secrets-api-openbao.md","tags":[],"version":"current","frontMatter":{"title":"Secrets API hardening and OpenBao provider","description":"How the secrets APIs are secured end-to-end and how to configure OpenBao/HashiCorp as production providers, with YAML for fast local dev."}}');var i=s(74848),d=s(28453);const c={title:"Secrets API hardening and OpenBao provider",description:"How the secrets APIs are secured end-to-end and how to configure OpenBao/HashiCorp as production providers, with YAML for fast local dev."},l=void 0,o={},t=[{value:"Overview",id:"overview",level:2},{value:"Endpoints and authorization model",id:"endpoints-and-authorization-model",level:2},{value:"Visual: end-to-end authorization flow",id:"visual-end-to-end-authorization-flow",level:3},{value:"Canonical Secret URIs",id:"canonical-secret-uris",level:2},{value:"Security controls (PEP)",id:"security-controls-pep",level:2},{value:"Environment settings",id:"environment-settings",level:2},{value:"API/gateway",id:"apigateway",level:3},{value:"PEP/grants",id:"pepgrants",level:3},{value:"YAML provider (dev-only)",id:"yaml-provider-dev-only",level:3},{value:"OpenBao/HashiCorp providers (KVv2)",id:"openbaohashicorp-providers-kvv2",level:3},{value:"Visual: provider strategy placement",id:"visual-provider-strategy-placement",level:4},{value:"Typical production toggles",id:"typical-production-toggles",level:2},{value:"Examples",id:"examples",level:2},{value:"Development flow (YAML)",id:"development-flow-yaml",level:2},{value:"Auditing",id:"auditing",level:2},{value:"Rotation flow",id:"rotation-flow",level:2},{value:"Visual: rotate sequence",id:"visual-rotate-sequence",level:3}];function a(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["PEP at ",(0,i.jsx)(n.code,{children:"VaultService"})]})," enforces policy before any provider access and handles grants, sender-binding, and anti-replay."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"YAML provider"})," is dev-only for rapid iteration; writes are blocked outside dev/test."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OpenBao / HashiCorp"})," providers support KVv2 reads/writes, delete/destroy, version pins, and wrap/unwrap."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Secrets API"})," supports CRUD operations; PDP checks and optional OAuth scopes guard access."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"endpoints-and-authorization-model",children:"Endpoints and authorization model"}),"\n",(0,i.jsx)(n.h3,{id:"visual-end-to-end-authorization-flow",children:"Visual: end-to-end authorization flow"}),"\n",(0,i.jsx)(n.mermaid,{value:'%%{init: {\'theme\':\'base\',\'themeVariables\':{\'lineColor\':\'#9ccfff\',\'textColor\':\'#e6f1ff\'}}}%%\r\nflowchart LR\r\n  A["Client"] --\x3e B["API Gateway"]\r\n  B --\x3e C{"Require auth?"}\r\n  C --|no| D["Proceed (dev)"]\r\n  C --|yes| E["Authenticate (session/bearer)"]\r\n  E --\x3e F{"Scopes enabled?"}\r\n  F --|yes| G{"Check endpoint scope"}\r\n  F --|no| H["Skip scopes"]\r\n  G --|fail| X["403 Forbidden"]\r\n  G --|pass| I["VaultService (PEP)"]\r\n  H --\x3e I\r\n  D --\x3e I\r\n  I --\x3e J["PDP (grants, binding, anti-replay)"]\r\n  J --\x3e K{"Permit?"}\r\n  K --|deny| X\r\n  K --|permit| L{"Provider"}\r\n  L --|yaml (dev)| M[("YAML file")]\r\n  L --|openbao+kv2| N[("OpenBao KVv2")]\r\n  L --|hashicorp+kv2| O[("HashiCorp KVv2")]\r\n  L --\x3e P["Audit (Kafka)"]\r\n  L --\x3e Q["Response (slots/metadata)"]'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["POST ",(0,i.jsx)(n.code,{children:"/api/secrets"})]}),": create/update","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PDP purpose: ",(0,i.jsx)(n.code,{children:"write"})]}),"\n",(0,i.jsxs)(n.li,{children:["Scope (optional, when enabled): ",(0,i.jsx)(n.code,{children:"secrets.write"})]}),"\n",(0,i.jsxs)(n.li,{children:["Providers: ",(0,i.jsx)(n.code,{children:"yaml"})," (dev only), ",(0,i.jsx)(n.code,{children:"openbao+kv2"}),", ",(0,i.jsx)(n.code,{children:"hashicorp+kv2"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["GET ",(0,i.jsx)(n.code,{children:"/api/secrets?uri=..."})]}),": read value (yaml dev only; use ",(0,i.jsx)(n.code,{children:"VaultService"})," for others)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PDP: implicit via PEP when using ",(0,i.jsx)(n.code,{children:"VaultService"})]}),"\n",(0,i.jsxs)(n.li,{children:["Scope (optional): ",(0,i.jsx)(n.code,{children:"secrets.read"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provider: ",(0,i.jsx)(n.code,{children:"yaml"})," only"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["DELETE ",(0,i.jsx)(n.code,{children:"/api/secrets?uri=...&destroy=true|false"})]}),": soft delete or hard destroy","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PDP purpose: ",(0,i.jsx)(n.code,{children:"delete"})]}),"\n",(0,i.jsxs)(n.li,{children:["Scopes (optional): ",(0,i.jsx)(n.code,{children:"secrets.delete"})," or ",(0,i.jsx)(n.code,{children:"secrets.destroy"})]}),"\n",(0,i.jsxs)(n.li,{children:["Providers: ",(0,i.jsx)(n.code,{children:"yaml"})," (dev only), ",(0,i.jsx)(n.code,{children:"openbao+kv2"}),", ",(0,i.jsx)(n.code,{children:"hashicorp+kv2"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["GET ",(0,i.jsx)(n.code,{children:"/api/secrets/metadata?mount=...&prefix=..."})]}),": metadata-only listing","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PDP purpose: ",(0,i.jsx)(n.code,{children:"read_metadata"})]}),"\n",(0,i.jsxs)(n.li,{children:["Scope (optional): ",(0,i.jsx)(n.code,{children:"secrets.read_metadata"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provider: ",(0,i.jsx)(n.code,{children:"yaml"})," (dev)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["GET ",(0,i.jsx)(n.code,{children:"/api/secrets/keys?uri=..."})]}),": enumerate keys under a path (metadata-only)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PDP purpose: ",(0,i.jsx)(n.code,{children:"read_metadata"})]}),"\n",(0,i.jsxs)(n.li,{children:["Scope (optional): ",(0,i.jsx)(n.code,{children:"secrets.read_metadata"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provider: ",(0,i.jsx)(n.code,{children:"yaml"})," (dev)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["POST ",(0,i.jsx)(n.code,{children:"/api/secrets/rotate"})]}),": rotate secret","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PDP purpose: ",(0,i.jsx)(n.code,{children:"rotate"})]}),"\n",(0,i.jsxs)(n.li,{children:["Scope (optional): ",(0,i.jsx)(n.code,{children:"secrets.rotate"})]}),"\n",(0,i.jsxs)(n.li,{children:["Providers: ",(0,i.jsx)(n.code,{children:"yaml"})," (dev semantics), ",(0,i.jsx)(n.code,{children:"openbao+kv2"}),", ",(0,i.jsx)(n.code,{children:"hashicorp+kv2"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["For non-YAML providers, perform reads through ",(0,i.jsx)(n.code,{children:"VaultService.get_credentials(...)"})," using Canonical URIs."]}),"\n",(0,i.jsx)(n.li,{children:"YAML writes/deletes are denied in non-dev environments."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"canonical-secret-uris",children:"Canonical Secret URIs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Format: ",(0,i.jsx)(n.code,{children:"<provider>[+engine]://<mount>/<path>#<fragment>?<sorted-params>"})]}),"\n",(0,i.jsxs)(n.li,{children:["Examples:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"yaml://secret/crud#DB_PASS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"openbao+kv2://secret/app/api#token?version=12"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"hashicorp+kv2://secret/payments/stripe#api_key"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See also: Canonical URI rules and error codes in ",(0,i.jsx)(n.code,{children:"../how-to/secrets-canonical-uris.md"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"security-controls-pep",children:"Security controls (PEP)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Grants"})," (issued by PDP facade for now): ttl, max-uses, decision IDs; cached with negative cache on deny."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sender-binding"}),": binds grant to DPoP ",(0,i.jsx)(n.code,{children:"jkt"})," or mTLS thumbprint when available; binding drift rejects use."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Anti-replay"}),": tracks ",(0,i.jsx)(n.code,{children:"jti"})," to prevent reuse during a short TTL."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audience check"}),": if ",(0,i.jsx)(n.code,{children:"aud"})," is present in the execution context, it must include expected audience."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audits"}),": Kafka events with non-leaky ",(0,i.jsx)(n.code,{children:"resource_ref"}),"; includes decision IDs, kv version, lease fields when available."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"environment-settings",children:"Environment settings"}),"\n",(0,i.jsx)(n.h3,{id:"apigateway",children:"API/gateway"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SECRETS_API_REQUIRE_AUTH"})," (default: ",(0,i.jsx)(n.code,{children:"false"}),"): when true, ",(0,i.jsx)(n.code,{children:"/api/secrets/*"})," requires session or bearer via ",(0,i.jsx)(n.code,{children:"AuthenticationService"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SECRETS_ENFORCE_SCOPES"})," (default: ",(0,i.jsx)(n.code,{children:"false"}),"): when true, enforce OAuth scopes per endpoint:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"secrets.read"}),", ",(0,i.jsx)(n.code,{children:"secrets.write"}),", ",(0,i.jsx)(n.code,{children:"secrets.delete"}),", ",(0,i.jsx)(n.code,{children:"secrets.destroy"}),", ",(0,i.jsx)(n.code,{children:"secrets.rotate"}),", ",(0,i.jsx)(n.code,{children:"secrets.read_metadata"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ENVIRONMENT"})," (default: ",(0,i.jsx)(n.code,{children:"dev"}),"): non-dev disables YAML writes/deletes."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pepgrants",children:"PEP/grants"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SECRETS_AUDIENCE"})," (default: ",(0,i.jsx)(n.code,{children:"crud.secrets"}),"): expected audience for PEP audience check (applies when ",(0,i.jsx)(n.code,{children:"aud"})," present)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ENABLE_AUTHORIZATION"})," (pdp.yaml also supported): enables PDP checks in ",(0,i.jsx)(n.code,{children:"SecretPolicyService"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GRANT_TTL_DEFAULT"})," (default: ",(0,i.jsx)(n.code,{children:"300"}),"), ",(0,i.jsx)(n.code,{children:"GRANT_MAX_USES_DEFAULT"})," (default: ",(0,i.jsx)(n.code,{children:"1"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ANTI_REPLAY_TTL_S"}),", ",(0,i.jsx)(n.code,{children:"NEGATIVE_CACHE_TTL_S"})," (optional): replay and negative-cache TTLs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TENANT_ID"})," (default: ",(0,i.jsx)(n.code,{children:"dev"}),"), ",(0,i.jsx)(n.code,{children:"TENANT_ALLOWED_MOUNTS"})," (CSV): tenant guard for mounts."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TENANT_SALT"})," or ",(0,i.jsx)(n.code,{children:"SECRET_TENANT_SALT"}),": HMAC salt to compute ",(0,i.jsx)(n.code,{children:"resource_ref"})," for audits."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"yaml-provider-dev-only",children:"YAML provider (dev-only)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"YAML_VAULT_PATH"}),": path to the YAML file (e.g., ",(0,i.jsx)(n.code,{children:"/app/config/data/dev_secrets.yaml"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["See ",(0,i.jsx)(n.code,{children:"yaml-vault-provider.md"})," for structure and bootstrap instructions."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"openbaohashicorp-providers-kvv2",children:"OpenBao/HashiCorp providers (KVv2)"}),"\n",(0,i.jsx)(n.h4,{id:"visual-provider-strategy-placement",children:"Visual: provider strategy placement"}),"\n",(0,i.jsx)(n.mermaid,{value:"%%{init: {'theme':'base','themeVariables':{'lineColor':'#9ccfff','textColor':'#e6f1ff'}}}%%\r\nflowchart TD\r\n  PEP[\"VaultService (PEP)\"] --\x3e S1[\"OpenBao KVv2 Strategy\"]\r\n  PEP --\x3e S2[\"HashiCorp KVv2 Strategy\"]\r\n  PEP --\x3e S3[\"YAML Strategy (dev)\"]\r\n  S1 --\x3e OB[(\"OpenBao Cluster\")]\r\n  S2 --\x3e HV[(\"Vault Cluster\")]\r\n  S3 --\x3e Y[(\"dev_secrets.yaml\")]"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Read via ",(0,i.jsx)(n.code,{children:"VaultService"})," using canonical URIs (",(0,i.jsx)(n.code,{children:"openbao+kv2://..."})," or ",(0,i.jsx)(n.code,{children:"hashicorp+kv2://..."}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Config falls back to generic ",(0,i.jsx)(n.code,{children:"VAULT_"})," keys:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENBAO_URL"})," or ",(0,i.jsx)(n.code,{children:"VAULT_URL"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENBAO_TOKEN"})," or ",(0,i.jsx)(n.code,{children:"VAULT_TOKEN"})," (or AppRole below)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"OPENBAO_ROLE_ID"}),", ",(0,i.jsx)(n.code,{children:"OPENBAO_SECRET_ID"})," (or ",(0,i.jsx)(n.code,{children:"HASHICORP_ROLE_ID"}),", ",(0,i.jsx)(n.code,{children:"HASHICORP_SECRET_ID"}),") when token is omitted"]}),"\n",(0,i.jsxs)(n.li,{children:["Optional: ",(0,i.jsx)(n.code,{children:"VAULT_TIMEOUT"}),", ",(0,i.jsx)(n.code,{children:"VAULT_VERIFY_SSL"}),", ",(0,i.jsx)(n.code,{children:"VAULT_POOL_SIZE"}),", ",(0,i.jsx)(n.code,{children:"VAULT_TOKEN_RENEWAL_THRESHOLD"}),", ",(0,i.jsx)(n.code,{children:"VAULT_MAX_CONCURRENT_OPERATIONS"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"typical-production-toggles",children:"Typical production toggles"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"SECRETS_API_REQUIRE_AUTH=true"})," and ",(0,i.jsx)(n.code,{children:"SECRETS_ENFORCE_SCOPES=true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Ensure tokens sent to CRUDService include:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Audience: ",(0,i.jsx)(n.code,{children:"crud.secrets"})," (or your configured ",(0,i.jsx)(n.code,{children:"SECRETS_AUDIENCE"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Scopes: for example ",(0,i.jsx)(n.code,{children:"secrets.write"})," to create/update, ",(0,i.jsx)(n.code,{children:"secrets.delete"}),"/",(0,i.jsx)(n.code,{children:"secrets.destroy"})," to delete/destroy"]}),"\n",(0,i.jsx)(n.li,{children:"Sender-binding (DPoP) where possible; mTLS thumbprint when using mutual TLS."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Disable YAML writes (automatic when ",(0,i.jsx)(n.code,{children:"ENVIRONMENT"})," is not dev/test). Use OpenBao/HashiCorp URIs in all flows."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create/update (OpenBao KVv2) with scope and audience (PowerShell):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'curl -X POST "http://localhost:9100/api/secrets" -H "Authorization: Bearer $env:TOKEN" -H "Content-Type: application/json" -d \'{\r\n  "uri": "openbao+kv2://secret/app/api#token",\r\n  "value": {"token":"s3cr3t"}\r\n}\'\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Delete (hard destroy) (HashiCorp KVv2):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'curl -X DELETE "http://localhost:9100/api/secrets?uri=hashicorp+kv2://secret/app/api#token&destroy=true" -H "Authorization: Bearer $env:TOKEN"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Metadata listing (YAML dev):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'curl "http://localhost:9100/api/secrets/metadata?mount=secret&prefix=env" -H "Authorization: Bearer $env:TOKEN"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"development-flow-yaml",children:"Development flow (YAML)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Bootstrap YAML from multiple ",(0,i.jsx)(n.code,{children:".env"})," files using the manifest:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"python scripts/yaml_dev_bootstrap.py --manifest scripts/bootstrap_manifest.yaml --out ..\\ServiceConfigs\\CRUDService\\config\\data\\dev_secrets.yaml --mount secret --clear\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Read a value in code:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'creds = await vault_service.get_credentials("yaml://secret/crud#DB_PASS", execution_context=ctx)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"auditing",children:"Auditing"}),"\n",(0,i.jsx)(n.h2,{id:"rotation-flow",children:"Rotation flow"}),"\n",(0,i.jsx)(n.h3,{id:"visual-rotate-sequence",children:"Visual: rotate sequence"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\r\n  participant C as Client\r\n  participant G as API Gateway\r\n  participant V as VaultService (PEP)\r\n  participant P as PDP\r\n  participant O as Provider (OpenBao/Vault)\r\n  participant K as Kafka (Audit)\r\n\r\n  C->>G: POST /api/secrets/rotate\r\n  G->>V: Forward (ctx, scopes)\r\n  V->>P: Authorize rotate (grant)\r\n  P--\x3e>V: Permit + obligations\r\n  V->>O: Perform rotate (create new version)\r\n  O--\x3e>V: Rotation result (version/meta)\r\n  V->>K: Emit SECRET_ROTATED (resource_ref, decision, kv_version)\r\n  V--\x3e>G: 200 OK\r\n  G--\x3e>C: Success"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["All operations emit Kafka secret events where configured. Sensitive URIs are replaced by a non-leaky ",(0,i.jsx)(n.code,{children:"resource_ref"})," computed using tenant salt."]}),"\n",(0,i.jsxs)(n.li,{children:["Cache hits may be sampled (",(0,i.jsx)(n.code,{children:"AUDIT_SAMPLE_CACHE_HIT_N"}),"). DENY/ERROR/ROTATE are emitted at full fidelity."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var r=s(96540);const i={},d=r.createContext(i);function c(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);