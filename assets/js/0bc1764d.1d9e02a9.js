"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[598],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var s=i(96540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},51968:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"services/bff/reference/fapi-support","title":"FAPI 2.0 Features \u2014 Verified Support and Configuration","description":"Scope","source":"@site/docs/services/bff/reference/fapi-support.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/fapi-support","permalink":"/empowernow_docs/docs/services/bff/reference/fapi-support","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/fapi-support.md","tags":[],"version":"current","frontMatter":{"title":"FAPI 2.0 Features \u2014 Verified Support and Configuration"},"sidebar":"tutorialSidebar","previous":{"title":"Environment Variables Index","permalink":"/empowernow_docs/docs/services/bff/reference/environment-index"},"next":{"title":"BFF FAQ (for SPA Developers)","permalink":"/empowernow_docs/docs/services/bff/reference/faq"}}');var r=i(74848),t=i(28453);const c={title:"FAPI 2.0 Features \u2014 Verified Support and Configuration"},d=void 0,o={},l=[];function a(e){const n={code:"code",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Scope"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This page lists only features present in our code/config today and how to enable them. No claims beyond what we can verify."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Verified capabilities"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["PKCE: Used in the OAuth code flow; ",(0,r.jsx)(n.code,{children:"code_verifier"})," is persisted and retrieved during token exchange (see ",(0,r.jsx)(n.code,{children:"src/api/v1/endpoints/auth.py"}),", ",(0,r.jsx)(n.code,{children:"IdPClient.exchange_authorization_code"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["PAR (Pushed Authorization Requests): Supported in the auth implementation with feature flag; see ",(0,r.jsx)(n.code,{children:"ms_bff/src/routes/auth_stub.py"})," (",(0,r.jsx)(n.code,{children:"MS_BFF_PAR_ENABLED"}),") and design doc indicating current implementation."]}),"\n",(0,r.jsxs)(n.li,{children:["DPoP (sender\u2011constrained tokens):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Client side: token requests include DPoP header when enabled; see ",(0,r.jsx)(n.code,{children:"IdPClient"})," using the enterprise OAuth client and DPoP manager."]}),"\n",(0,r.jsxs)(n.li,{children:["Server side: ",(0,r.jsx)(n.code,{children:"DPoPValidationMiddleware"})," is added when Redis is available; see ",(0,r.jsx)(n.code,{children:"src/main.py"})," and DPoP metrics in ",(0,r.jsx)(n.code,{children:"src/metrics/__init__.py"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Client authentication methods: Configurable via ",(0,r.jsx)(n.code,{children:"MS_BFF_TOKEN_AUTH_METHOD"})," with support for ",(0,r.jsx)(n.code,{children:"client_secret_basic"})," and ",(0,r.jsx)(n.code,{children:"private_key_jwt"})," (see ",(0,r.jsx)(n.code,{children:"src/services/idp_client.py"})," and ",(0,r.jsx)(n.code,{children:"routes/auth_stub.py"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["mTLS token binding (enterprise client): If enabled in the enterprise OAuth config, ",(0,r.jsx)(n.code,{children:"IdPClient"})," will pass client cert/key to httpx and mark token binding method as ",(0,r.jsx)(n.code,{children:"mtls"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Not implemented (no code present in this repo)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JAR (signed request objects) and JARM (signed authorization response). No request-object signing/verification is present in the public code; keep as future."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Enablement and configuration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Environment variables","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MS_BFF_PAR_ENABLED"}),': "true" to enable PAR path in auth implementation']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MS_BFF_DPOP_ENABLED"}),': "true" to enable DPoP usage in auth implementation']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MS_BFF_TOKEN_AUTH_METHOD"}),": ",(0,r.jsx)(n.code,{children:"client_secret_basic"})," or ",(0,r.jsx)(n.code,{children:"private_key_jwt"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"OIDC_ISSUER"}),", ",(0,r.jsx)(n.code,{children:"OIDC_TOKEN_URL"}),", ",(0,r.jsx)(n.code,{children:"OIDC_AUTHORIZATION_URL"}),": IdP endpoints (HTTPS in production; internal HTTP allowed for container comms as coded)"]}),"\n",(0,r.jsxs)(n.li,{children:["For mTLS (enterprise OAuth): provide cert/key via the enterprise SDK config so ",(0,r.jsx)(n.code,{children:"IdPClient"})," detects ",(0,r.jsx)(n.code,{children:"is_mtls_enabled()"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Operational notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["DPoP middleware requires Redis. When Redis is unavailable, middleware is skipped and a warning is logged (see ",(0,r.jsx)(n.code,{children:"create_app()"})," in ",(0,r.jsx)(n.code,{children:"src/main.py"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Metrics: DPoP validation failures and PAR request counters are exposed via Prometheus metrics in ",(0,r.jsx)(n.code,{children:"src/metrics/__init__.py"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Frontends: SPAs do not handle DPoP; all PoP and OAuth mechanics are server\u2011side in the BFF."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Security profiles (practical view)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"FAPI 2.0 Baseline\u2011aligned: PKCE + PAR + sender\u2011constrained tokens (DPoP) with proper server\u2011side authorization."}),"\n",(0,r.jsx)(n.li,{children:"FAPI 2.0 Advanced path: mTLS and/or DPoP are the sender\u2011constraining options; mTLS can be enabled via enterprise OAuth config, DPoP is already integrated. JAR/JARM not present."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Dependencies"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Production IdP operations rely on ",(0,r.jsx)(n.code,{children:"empowernow_common.oauth.HardenedOAuth"})," (enterprise SDK). The BFF fails fast if unavailable (see ",(0,r.jsx)(n.code,{children:"src/services/idp_client.py"}),")."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);