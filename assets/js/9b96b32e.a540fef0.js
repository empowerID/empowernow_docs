"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[8349],{18244:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"services/crud-service/secrets/architecture-design","title":"Architecture and design","description":"Core components, data flow, and trust boundaries","source":"@site/docs/services/crud-service/secrets/02-architecture-design.md","sourceDirName":"services/crud-service/secrets","slug":"/services/crud-service/secrets/architecture-design","permalink":"/empowernow_docs/docs/services/crud-service/secrets/architecture-design","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/secrets/02-architecture-design.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Architecture and design","description":"Core components, data flow, and trust boundaries"},"sidebar":"tutorialSidebar","previous":{"title":"Executive overview","permalink":"/empowernow_docs/docs/services/crud-service/secrets/executive-overview"},"next":{"title":"Canonical URIs and policy model","permalink":"/empowernow_docs/docs/services/crud-service/secrets/canonical-uris-and-policy"}}');var i=s(74848),t=s(28453);const c={title:"Architecture and design",description:"Core components, data flow, and trust boundaries"},a=void 0,o={},d=[];function l(e){const r={li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.p,{children:"Components"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"VaultService (PEP): parses Canonical URIs, authorizes with PDP, fetches from providers, emits audits"}),"\n",(0,i.jsx)(r.li,{children:"SecretPolicyService (PDP client): batch authorization with purposes (read, write, delete, rotate, read_metadata)"}),"\n",(0,i.jsx)(r.li,{children:"Providers: OpenBao/HashiCorp KVv2, YAML (dev)"}),"\n",(0,i.jsx)(r.li,{children:"CRUDService Secrets API: management endpoints for admins and automation"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Flow"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n  participant A as App/Service\r\n  participant V as VaultService (PEP)\r\n  participant P as SecretPolicyService (PDP)\r\n  participant S as Provider (KVv2)\r\n  A->>V: get_credentials(canonical_uri)\r\n  V->>P: authorize(subject, resource, purpose)\r\n  P--\x3e>V: decision + obligations (ttl, max_uses)\r\n  V->>S: fetch secret (versioned)\r\n  S--\x3e>V: value (map or scalar)\r\n  V--\x3e>A: redacted slot / materialized value\r\n  V--\x3e>A: audits + metrics"}),"\n",(0,i.jsx)(r.p,{children:"Trust boundaries"}),"\n",(0,i.jsx)(r.mermaid,{value:'flowchart LR\r\n  subgraph "App Boundary"\r\n    A["Caller"]\r\n    V["VaultService"]\r\n  end\r\n  A -- "DPoP/mTLS (preferred)" --\x3e V\r\n  V -- "least-privilege scopes" --\x3e P["SecretPolicyService"]\r\n  V -- "provider creds" --\x3e S[(Providers)]\r\n  S --\x3e OB["OpenBao"]\r\n  S --\x3e HV["HashiCorp"]\r\n  classDef ctrl fill:#eef,stroke:#99f,stroke-width:1px;\r\n  class V,P ctrl;'}),"\n",(0,i.jsx)(r.p,{children:"Data in transit/at rest"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"TLS between components; provider credentials stored securely"}),"\n",(0,i.jsx)(r.li,{children:"Audits emitted to Kafka; logs redacted; resource_ref HMAC masks URIs"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Failure modes"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Policy deny \u2192 fail closed with 403"}),"\n",(0,i.jsx)(r.li,{children:"Provider down \u2192 502 with retries/backoff; no cache of plaintext"}),"\n",(0,i.jsx)(r.li,{children:"Binding failure (DPoP/mTLS) \u2192 401/403"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Scale and HA"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"VaultService stateless (horizontal scale); PDP caches decisions with TTL"}),"\n",(0,i.jsx)(r.li,{children:"Backpressure: queue limits on provider calls; circuit breaking recommended"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Configuration surface"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Timeouts, retries, max concurrency documented in Admin how\u2011to; default sane limits"}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,r,s)=>{s.d(r,{R:()=>c,x:()=>a});var n=s(96540);const i={},t=n.createContext(i);function c(e){const r=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),n.createElement(t.Provider,{value:r},e.children)}}}]);