"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2423],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>d});var r=s(96540);const i={},c=r.createContext(i);function o(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(c.Provider,{value:n},e.children)}},58854:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"services/bff/reference/config-overview","title":"Configuration Overview","description":"Where configuration lives","source":"@site/docs/services/bff/reference/config-overview.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/config-overview","permalink":"/empowernow_docs/docs/services/bff/reference/config-overview","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/config-overview.md","tags":[],"version":"current","frontMatter":{"title":"Configuration Overview"},"sidebar":"tutorialSidebar","previous":{"title":"Certificates, Keys, and Secrets (DevOps)","permalink":"/empowernow_docs/docs/services/bff/reference/certificates-devops"},"next":{"title":"Configuration Map","permalink":"/empowernow_docs/docs/services/bff/reference/configuration"}}');var i=s(74848),c=s(28453);const o={title:"Configuration Overview"},d=void 0,l={},t=[];function a(e){const n={code:"code",li:"li",ol:"ol",p:"p",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Where configuration lives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Primary files: ",(0,i.jsx)(n.code,{children:"ServiceConfigs/BFF/config/*.yaml"})]}),"\n",(0,i.jsxs)(n.li,{children:["Env overrides: process env (Docker/K8s/Compose) replace ",(0,i.jsx)(n.code,{children:"${VAR}"})," and take precedence at runtime"]}),"\n",(0,i.jsx)(n.li,{children:"Secrets: use Docker/K8s secrets; mount as files; reference via file: pointers where supported"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Load order"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["YAML defaults \u2192 2) ",(0,i.jsx)(n.code,{children:"${VAR}"})," expansion \u2192 3) runtime env overrides"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Recipes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Dynamic callback"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"BFF_DYNAMIC_CALLBACK=true"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"BFF_DEFAULT_HOST=api.<env>.empowernow.ai"}),", ",(0,i.jsx)(n.code,{children:"BFF_DEFAULT_SCHEME=https"})]}),"\n",(0,i.jsxs)(n.li,{children:["Alternative (static): ",(0,i.jsx)(n.code,{children:"BFF_DYNAMIC_CALLBACK=false"})," + ",(0,i.jsx)(n.code,{children:"BFF_CALLBACK_URL=https://api.../auth/callback"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Cookie/session"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"BFF_COOKIE_DOMAIN=.ocg.labs.empowernow.ai"}),", ",(0,i.jsx)(n.code,{children:"SESSION_LIFETIME=3600"})]}),"\n",(0,i.jsxs)(n.li,{children:["Single cookie: ",(0,i.jsx)(n.code,{children:"bff_session"})," (HttpOnly, Secure, SameSite=Lax)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Traefik ForwardAuth"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Middleware address: ",(0,i.jsx)(n.code,{children:"http://bff:8000/auth/forward"})," (alias of ",(0,i.jsx)(n.code,{children:"/auth/verify"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Request headers: ",(0,i.jsx)(n.code,{children:"Cookie"}),", ",(0,i.jsx)(n.code,{children:"User-Agent"}),", ",(0,i.jsx)(n.code,{children:"X-Forwarded-For"})]}),"\n",(0,i.jsxs)(n.li,{children:["Response headers: ",(0,i.jsx)(n.code,{children:"X-User-ID"}),", ",(0,i.jsx)(n.code,{children:"X-Session-ID"}),", ",(0,i.jsx)(n.code,{children:"X-Auth-Time"})," (and Authorization when used)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SPA same\u2011origin model"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["SPA calls ",(0,i.jsx)(n.code,{children:"/api/**"})," on its own host; BFF handles auth and returns 401 JSON when unauthenticated"]}),"\n",(0,i.jsxs)(n.li,{children:["Add dev origins in ",(0,i.jsx)(n.code,{children:"CORS__ALLOW_ORIGINS"})," for local tools; production SPAs should be same\u2011origin"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);