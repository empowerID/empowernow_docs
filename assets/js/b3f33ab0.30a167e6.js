"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[8673],{8108:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"services/idp/how-to/mint-iat-and-dcr","title":"Mint an Initial Access Token (IAT) and register a client (DCR)","description":"How to use an admin access token to mint an IAT and then perform OAuth Dynamic Client Registration for services like the BFF.","source":"@site/docs/services/idp/how-to/mint-iat-and-dcr.md","sourceDirName":"services/idp/how-to","slug":"/services/idp/how-to/mint-iat-and-dcr","permalink":"/empowernow_docs/docs/services/idp/how-to/mint-iat-and-dcr","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/idp/how-to/mint-iat-and-dcr.md","tags":[],"version":"current","frontMatter":{"id":"mint-iat-and-dcr","title":"Mint an Initial Access Token (IAT) and register a client (DCR)","description":"How to use an admin access token to mint an IAT and then perform OAuth Dynamic Client Registration for services like the BFF.","sidebar_label":"Mint IAT and DCR"},"sidebar":"tutorialSidebar","previous":{"title":"Azure Entra Federation","permalink":"/empowernow_docs/docs/services/idp/how-to/azure-entra-federation"},"next":{"title":"Persona FAQ","permalink":"/empowernow_docs/docs/personas/faq"}}');var s=t(74848),r=t(28453);const o={id:"mint-iat-and-dcr",title:"Mint an Initial Access Token (IAT) and register a client (DCR)",description:"How to use an admin access token to mint an IAT and then perform OAuth Dynamic Client Registration for services like the BFF.",sidebar_label:"Mint IAT and DCR"},a=void 0,c={},d=[{value:"When to use this",id:"when-to-use-this",level:2},{value:"Step 1 \u2014 Mint an IAT (admin token required)",id:"step-1--mint-an-iat-admin-token-required",level:2},{value:"Step 2 \u2014 Register the client using the IAT (DCR)",id:"step-2--register-the-client-using-the-iat-dcr",level:2},{value:"Notes and troubleshooting",id:"notes-and-troubleshooting",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"when-to-use-this",children:"When to use this"}),"\n",(0,s.jsxs)(n.p,{children:["Use this flow when bootstrapping a new OAuth client (for example, ",(0,s.jsx)(n.code,{children:"bff-server"}),"). An admin access token mints a short\u2011lived Initial Access Token (IAT), which authorizes a one\u2011time or limited client registration via DCR."]}),"\n",(0,s.jsx)(n.h2,{id:"step-1--mint-an-iat-admin-token-required",children:"Step 1 \u2014 Mint an IAT (admin token required)"}),"\n",(0,s.jsxs)(n.p,{children:["POST ",(0,s.jsx)(n.code,{children:"https://idp.ocg.labs.empowernow.ai/api/admin/dcr/initial-access-tokens"})]}),"\n",(0,s.jsx)(n.p,{children:"Body (JSON):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{ "label": "ms-bff bootstrap", "expires_in": 3600, "max_uses": 10 }\n'})}),"\n",(0,s.jsx)(n.p,{children:"Headers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Authorization: ",(0,s.jsx)(n.code,{children:"Bearer <ADMIN_ACCESS_TOKEN>"})]}),"\n",(0,s.jsxs)(n.li,{children:["Content-Type: ",(0,s.jsx)(n.code,{children:"application/json"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"PowerShell"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"$adminToken = '<ADMIN_ACCESS_TOKEN>'\r\n$body = @{ label='ms-bff bootstrap'; expires_in=3600; max_uses=10 } | ConvertTo-Json\r\n$iatRes = Invoke-RestMethod -Method Post `\r\n  -Uri 'https://idp.ocg.labs.empowernow.ai/api/admin/dcr/initial-access-tokens' `\r\n  -Headers @{ Authorization = \"Bearer $adminToken\" } `\r\n  -ContentType 'application/json' -Body $body\r\n$iat = $iatRes.token\n"})}),"\n",(0,s.jsx)(n.p,{children:"cURL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -sS -X POST \'https://idp.ocg.labs.empowernow.ai/api/admin/dcr/initial-access-tokens\' \\\r\n  -H "Authorization: Bearer <ADMIN_ACCESS_TOKEN>" -H "Content-Type: application/json" \\\r\n  -d \'{"label":"ms-bff bootstrap","expires_in":3600,"max_uses":10}\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"step-2--register-the-client-using-the-iat-dcr",children:"Step 2 \u2014 Register the client using the IAT (DCR)"}),"\n",(0,s.jsxs)(n.p,{children:["POST ",(0,s.jsx)(n.code,{children:"https://idp.ocg.labs.empowernow.ai/api/oidc/dcr/register"})]}),"\n",(0,s.jsx)(n.p,{children:"Headers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Authorization: ",(0,s.jsx)(n.code,{children:"Bearer <IAT_TOKEN>"})]}),"\n",(0,s.jsxs)(n.li,{children:["Content-Type: ",(0,s.jsx)(n.code,{children:"application/json"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example payload for BFF (Private Key JWT):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "client_name": "bff-server",\r\n  "token_endpoint_auth_method": "private_key_jwt",\r\n  "grant_types": ["authorization_code"],\r\n  "response_types": ["code"],\r\n  "scope": "openid profile email offline_access admin.api application.all dcr.register",\r\n  "redirect_uris": [\r\n    "https://automate.ocg.labs.empowernow.ai/auth/callback",\r\n    "https://authn.ocg.labs.empowernow.ai/auth/callback",\r\n    "https://authz.ocg.labs.empowernow.ai/auth/callback"\r\n  ]\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"PowerShell"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"$client = @{ \r\n  client_name = 'bff-server'\r\n  token_endpoint_auth_method = 'private_key_jwt'\r\n  grant_types = @('authorization_code')\r\n  response_types = @('code')\r\n  scope = 'openid profile email offline_access admin.api application.all dcr.register'\r\n  redirect_uris = @(\r\n    'https://automate.ocg.labs.empowernow.ai/auth/callback',\r\n    'https://authn.ocg.labs.empowernow.ai/auth/callback',\r\n    'https://authz.ocg.labs.empowernow.ai/auth/callback'\r\n  )\r\n} | ConvertTo-Json -Depth 5\r\n\r\nInvoke-RestMethod -Method Post `\r\n  -Uri 'https://idp.ocg.labs.empowernow.ai/api/oidc/dcr/register' `\r\n  -Headers @{ Authorization = \"Bearer $iat\" } `\r\n  -ContentType 'application/json' -Body $client\n"})}),"\n",(0,s.jsx)(n.p,{children:"cURL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -sS -X POST \'https://idp.ocg.labs.empowernow.ai/api/oidc/dcr/register\' \\\r\n  -H "Authorization: Bearer <IAT_TOKEN>" -H "Content-Type: application/json" \\\r\n  -d \'{ "client_name":"bff-server", "token_endpoint_auth_method":"private_key_jwt", "grant_types":["authorization_code"], "response_types":["code"], "scope":"openid profile email offline_access admin.api application.all dcr.register", "redirect_uris":["https://automate.ocg.labs.empowernow.ai/auth/callback"] }\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"notes-and-troubleshooting",children:"Notes and troubleshooting"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"IATs are short\u2011lived and limited\u2011use. Re\u2011mint if it expires or is exhausted."}),"\n",(0,s.jsxs)(n.li,{children:["For BFF bootstrap, set the minted token as the ",(0,s.jsx)(n.code,{children:"DCR_IAT"})," environment/config value."]}),"\n",(0,s.jsx)(n.li,{children:"Ensure your IdP client has permissions to mint IATs (admin token context) and that your IdP allows DCR."}),"\n",(0,s.jsxs)(n.li,{children:["If registration fails with ",(0,s.jsx)(n.code,{children:"invalid_client_metadata"}),", validate ",(0,s.jsx)(n.code,{children:"redirect_uris"}),", ",(0,s.jsx)(n.code,{children:"grant_types"}),", and ",(0,s.jsx)(n.code,{children:"token_endpoint_auth_method"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"See also:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"services/bff/how-to/dcr-compose-wiring"})," (where to paste IAT in compose and restart order)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"services/bff/how-to/dcr-bootstrap"})," (operational policy and flow details)"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);