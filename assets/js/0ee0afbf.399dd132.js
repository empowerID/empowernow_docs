"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[5120],{28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var s=r(96540);const o={},c=s.createContext(o);function i(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(c.Provider,{value:n},e.children)}},40521:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"services/nowconnect/reference/perf-nowconnect-ldap-guide","title":"NowConnect LDAP Performance Runner \u2013 Guide","description":"How to run tools/perf_nowconnect_ldap.py, all settings, and how to interpret and gate results.","source":"@site/docs/services/nowconnect/reference/perf_nowconnect_ldap_guide.md","sourceDirName":"services/nowconnect/reference","slug":"/services/nowconnect/reference/perf-nowconnect-ldap-guide","permalink":"/empowernow_docs/docs/services/nowconnect/reference/perf-nowconnect-ldap-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/nowconnect/reference/perf_nowconnect_ldap_guide.md","tags":[],"version":"current","frontMatter":{"id":"perf-nowconnect-ldap-guide","title":"NowConnect LDAP Performance Runner \u2013 Guide","description":"How to run tools/perf_nowconnect_ldap.py, all settings, and how to interpret and gate results.","sidebar_label":"Perf runner guide"},"sidebar":"tutorialSidebar","previous":{"title":"metrics","permalink":"/empowernow_docs/docs/services/nowconnect/reference/metrics"},"next":{"title":"Perf results (sample)","permalink":"/empowernow_docs/docs/services/nowconnect/reference/perf-nowconnect-report"}}');var o=r(74848),c=r(28453);const i={id:"perf-nowconnect-ldap-guide",title:"NowConnect LDAP Performance Runner \u2013 Guide",description:"How to run tools/perf_nowconnect_ldap.py, all settings, and how to interpret and gate results.",sidebar_label:"Perf runner guide"},l=void 0,t={},d=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick start",id:"quick-start",level:2},{value:"CLI reference (and environment variables)",id:"cli-reference-and-environment-variables",level:2},{value:"Output format",id:"output-format",level:2},{value:"Viewing results",id:"viewing-results",level:3},{value:"Common scenarios",id:"common-scenarios",level:2},{value:"Running locations",id:"running-locations",level:2},{value:"CI integration (Azure Pipelines example)",id:"ci-integration-azure-pipelines-example",level:2},{value:"HA and resilience checks",id:"ha-and-resilience-checks",level:2},{value:"Interpreting results",id:"interpreting-results",level:2},{value:"Suggested SLOs (local baseline)",id:"suggested-slos-local-baseline",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Security notes",id:"security-notes",level:2},{value:"Related files",id:"related-files",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["This document explains the performance test runner ",(0,o.jsx)(n.code,{children:"tools/perf_nowconnect_ldap.py"}),": what it measures, how to run it across environments, all settings, and how to interpret and gate results for DevOps, QA, and Docs teams."]}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Purpose"}),": Generate concurrent LDAP search traffic through NowConnect (Cloud\u2192tunnel\u2192Premise\u2192OpenLDAP) and report latency distribution, throughput, and errors."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Core metrics"}),": p50/p90/p99/max latency, average latency, total requests, total errors."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Traffic path (host-mode example)"}),": Client \u2192 ",(0,o.jsx)(n.code,{children:"localhost:1389"})," \u2192 NowConnect Cloud listener (389) \u2192 WebSocket tunnel (8765) \u2192 NowConnect Premise \u2192 OpenLDAP (389)."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Python 3.10+"}),"\n",(0,o.jsxs)(n.li,{children:["Package: ",(0,o.jsx)(n.code,{children:"ldap3"})," (install if needed)"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install ldap3\n"})}),"\n",(0,o.jsx)(n.p,{children:"Repo path of the runner:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"CRUDService/tools/perf_nowconnect_ldap.py"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"quick-start",children:"Quick start"}),"\n",(0,o.jsx)(n.p,{children:"Run a 30-second baseline against the NowConnect Cloud listener mapped to localhost:1389."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:'python tools\\perf_nowconnect_ldap.py --host localhost --port 1389 --concurrency 10 --rps-per-worker 2 --duration 30 --base-dn "dc=example,dc=org" --bind-dn "cn=admin,dc=example,dc=org" --password "admin"\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"python tools/perf_nowconnect_ldap.py --host localhost --port 1389 \\\r\n  --concurrency 10 --rps-per-worker 2 --duration 30 \\\r\n  --base-dn 'dc=example,dc=org' --bind-dn 'cn=admin,dc=example,dc=org' --password 'admin'\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Output is printed to stdout and saved as JSON (default ",(0,o.jsx)(n.code,{children:"perf_nowconnect.json"}),")."]}),"\n",(0,o.jsx)(n.h2,{id:"cli-reference-and-environment-variables",children:"CLI reference (and environment variables)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--host"})," (env: ",(0,o.jsx)(n.code,{children:"NC_HOST"}),", default: ",(0,o.jsx)(n.code,{children:"localhost"}),"): Target host; use ",(0,o.jsx)(n.code,{children:"nowconnect-cloud"})," inside the compose network."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--port"})," (env: ",(0,o.jsx)(n.code,{children:"NC_PORT"}),", default: ",(0,o.jsx)(n.code,{children:"1389"}),"): Target port; host-mapped to Cloud listener 389."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--ssl"})," (env: ",(0,o.jsx)(n.code,{children:"NC_SSL"}),", default: ",(0,o.jsx)(n.code,{children:"false"}),"): Enable LDAPS; use with port 1636 if mapped."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--bind-dn"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_BIND_DN"}),", default: ",(0,o.jsx)(n.code,{children:"cn=admin,dc=example,dc=org"}),"): Bind DN."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--password"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_PASSWORD"}),", default: ",(0,o.jsx)(n.code,{children:"admin"}),"): Bind password."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--base-dn"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_BASE_DN"}),", default: ",(0,o.jsx)(n.code,{children:"dc=example,dc=org"}),"): Search base DN."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--filter"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_FILTER"}),", default: ",(0,o.jsx)(n.code,{children:"(objectClass=inetOrgPerson)"}),"): LDAP filter."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--attrs"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_ATTRS"}),", default: ",(0,o.jsx)(n.code,{children:"uid,cn,sn"}),"): Comma-separated attribute list."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--scope"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_SCOPE"}),", default: ",(0,o.jsx)(n.code,{children:"sub"}),"): ",(0,o.jsx)(n.code,{children:"base"})," | ",(0,o.jsx)(n.code,{children:"one"})," | ",(0,o.jsx)(n.code,{children:"sub"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--page-size"})," (env: ",(0,o.jsx)(n.code,{children:"LDAP_PAGE"}),", default: ",(0,o.jsx)(n.code,{children:"100"}),"): Page size for paged search control."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--concurrency"})," (env: ",(0,o.jsx)(n.code,{children:"NC_CONCURRENCY"}),", default: ",(0,o.jsx)(n.code,{children:"10"}),"): Number of parallel workers (one LDAP connection per worker)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--rps-per-worker"})," (env: ",(0,o.jsx)(n.code,{children:"NC_RPS_PER_WORKER"}),", default: ",(0,o.jsx)(n.code,{children:"2"}),"): Target rate per worker (best-effort pacing)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--duration"})," (env: ",(0,o.jsx)(n.code,{children:"NC_DURATION"}),", default: ",(0,o.jsx)(n.code,{children:"30"}),"): Duration in seconds."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--timeout"})," (env: ",(0,o.jsx)(n.code,{children:"NC_TIMEOUT"}),", default: ",(0,o.jsx)(n.code,{children:"10"}),"): Connect and receive timeout (seconds)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"--out"})," (env: ",(0,o.jsx)(n.code,{children:"NC_OUT"}),", default: ",(0,o.jsx)(n.code,{children:"perf_nowconnect.json"}),"): Output JSON file path."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"output-format",children:"Output format"}),"\n",(0,o.jsx)(n.p,{children:"The runner prints and writes a JSON summary like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "run_id": "<uuid>",\r\n  "target": {"host": "localhost", "port": 1389, "ssl": false},\r\n  "workload": {\r\n    "concurrency": 10,\r\n    "rps_per_worker": 2.0,\r\n    "duration_s": 30,\r\n    "page_size": 100,\r\n    "scope": "sub",\r\n    "filter": "(objectClass=inetOrgPerson)",\r\n    "attributes": ["uid", "cn", "sn"]\r\n  },\r\n  "latency_ms": {"count": 610, "avg_ms": 59.1, "p50_ms": 49.2, "p90_ms": 107.3, "p99_ms": 152.8, "max_ms": 191.1},\r\n  "requests_total": 610,\r\n  "errors_total": 0,\r\n  "start_iso": "2025-08-18T01:20:39Z"\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"viewing-results",children:"Viewing results"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Plain read: open the JSON file."}),"\n",(0,o.jsxs)(n.li,{children:["With ",(0,o.jsx)(n.code,{children:"jq"})," (bash):"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"jq '.latency_ms, {requests: .requests_total, errors: .errors_total}' perf_nowconnect.json\n"})}),"\n",(0,o.jsx)(n.h2,{id:"common-scenarios",children:"Common scenarios"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Baseline"})," (moderate):","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"--concurrency 10 --rps-per-worker 2 --duration 30 --page-size 100"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Higher throughput"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--concurrency 20 --rps-per-worker 3"})," (approx 60 RPS)"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"High concurrency"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--concurrency 50 --rps-per-worker 2"})," (approx 100 RPS)"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Large page / broader filter"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"--page-size 1000 --filter '(objectClass=*)' --attrs 'uid,cn,sn,mail'"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"LDAPS"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--ssl --port 1636"})," (ensure port is mapped and certificates are configured)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"running-locations",children:"Running locations"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Host against compose-mapped ports"})," (recommended for local): ",(0,o.jsx)(n.code,{children:"--host localhost --port 1389"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Inside compose network"})," (e.g., from a container): ",(0,o.jsx)(n.code,{children:"--host nowconnect-cloud --port 389"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Compose snippets of interest:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Cloud listener: ",(0,o.jsx)(n.code,{children:"nowconnect-cloud"})," binds 389; compose maps ",(0,o.jsx)(n.code,{children:"1389:389"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Premise agent connects to Cloud via ",(0,o.jsx)(n.code,{children:"NC_AGENT_URL=ws://nowconnect-cloud:8765/tunnel"})," and targets OpenLDAP."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"ci-integration-azure-pipelines-example",children:"CI integration (Azure Pipelines example)"}),"\n",(0,o.jsx)(n.p,{children:"Add a perf step and gate on SLO:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"- task: PythonScript@0\r\n  displayName: Run NowConnect perf baseline\r\n  inputs:\r\n    scriptSource: inline\r\n    script: |\r\n      python tools/perf_nowconnect_ldap.py --host localhost --port 1389 \\\r\n        --concurrency 10 --rps-per-worker 2 --duration 30 \\\r\n        --base-dn \"dc=example,dc=org\" --bind-dn \"cn=admin,dc=example,dc=org\" --password \"admin\" \\\r\n        --out perf_nowconnect.json\r\n      python - << 'PY'\r\n      import json, sys\r\n      with open('perf_nowconnect.json','r') as f:\r\n          d=json.load(f)\r\n      p99=d['latency_ms']['p99_ms']\r\n      errs=d['errors_total']\r\n      print(f\"p99={p99}ms errors={errs}\")\r\n      # Gate: p99 <= 200ms and no errors\r\n      sys.exit(0 if p99 <= 200 and errs == 0 else 1)\r\n      PY\r\n  continueOnError: false\r\n\r\n- publish: perf_nowconnect.json\r\n  artifact: nowconnect-perf\n"})}),"\n",(0,o.jsx)(n.h2,{id:"ha-and-resilience-checks",children:"HA and resilience checks"}),"\n",(0,o.jsx)(n.p,{children:"To simulate a connector disruption during a run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Start a longer run in one shell\r\npython tools/perf_nowconnect_ldap.py --host localhost --port 1389 --concurrency 20 --rps-per-worker 3 --duration 120\r\n\r\n# In another shell, restart the premise after ~30s\r\ndocker compose -f docker-compose-nowconnect.yml restart nowconnect_premise\n"})}),"\n",(0,o.jsx)(n.p,{children:"Expect brief latency spikes and minimal or no errors if the tunnel recovers quickly."}),"\n",(0,o.jsx)(n.h2,{id:"interpreting-results",children:"Interpreting results"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Latency percentiles"}),": p50 (typical), p90 (tail), p99 (worst-case under load). Track p99 over time."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Throughput"}),": ",(0,o.jsx)(n.code,{children:"requests_total / duration_s"})," approximates actual RPS achieved."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Errors"}),": Should be 0 under healthy conditions; investigate connection/cert/DN issues if non-zero."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"suggested-slos-local-baseline",children:"Suggested SLOs (local baseline)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"errors_total == 0"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"p99_ms <= 200"})," (baseline:\r\n10\xd72 RPS, page=100)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:['"invalid server address": Use ',(0,o.jsx)(n.code,{children:"--host localhost --port 1389"})," (host-mode) or ",(0,o.jsx)(n.code,{children:"--host nowconnect-cloud --port 389"})," (in-network)."]}),"\n",(0,o.jsxs)(n.li,{children:["LDAPS handshake errors: ensure certificates are configured; try ",(0,o.jsx)(n.code,{children:"--ssl --port 1636"})," only if mapped."]}),"\n",(0,o.jsxs)(n.li,{children:["Timeouts: increase ",(0,o.jsx)(n.code,{children:"--timeout"}),", reduce ",(0,o.jsx)(n.code,{children:"--rps-per-worker"})," or ",(0,o.jsx)(n.code,{children:"--concurrency"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Bind errors: verify ",(0,o.jsx)(n.code,{children:"--bind-dn"})," and ",(0,o.jsx)(n.code,{children:"--password"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"security-notes",children:"Security notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The examples use admin DN for convenience. Use a least-privilege service account for routine perf checks."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"related-files",children:"Related files"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Runner: ",(0,o.jsx)(n.code,{children:"CRUDService/tools/perf_nowconnect_ldap.py"})]}),"\n",(0,o.jsxs)(n.li,{children:["Sample report: ",(0,o.jsx)(n.code,{children:"CRUDService/tools/perf_nowconnect_report.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Compose: ",(0,o.jsx)(n.code,{children:"CRUDService/docker-compose-nowconnect.yml"})]}),"\n",(0,o.jsxs)(n.li,{children:["Cloud config: ",(0,o.jsx)(n.code,{children:"ServiceConfigs/NowConnect/config/cloud.yaml"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["See also: ",(0,o.jsx)(n.code,{children:"services/nowconnect/how-to/operational-validation-health"})," and ",(0,o.jsx)(n.code,{children:"services/nowconnect/explanation/metrics-and-reliability"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);