"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[173],{14050:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"services/bff/reference/routes-reference","title":"routes-reference","description":"Budgets","source":"@site/docs/services/bff/reference/routes-reference.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/routes-reference","permalink":"/empowernow_docs/docs/services/bff/reference/routes-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/routes-reference.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"QA \u2014 Troubleshooting Checklist","permalink":"/empowernow_docs/docs/services/bff/reference/qa-troubleshooting"},"next":{"title":"Session Binding and CSRF (Verified)","permalink":"/empowernow_docs/docs/services/bff/reference/session-binding-csrf"}}');var c=r(74848),t=r(28453);const i={},d=void 0,l={},a=[{value:"Budgets",id:"budgets",level:2},{value:"title: routes.yaml Reference",id:"title-routesyaml-reference",level:2}];function o(e){const n={code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"budgets",children:"Budgets"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'- id: "authzen-effective-budgets"\r\n  path: "/access/v1/budgets/effective"\r\n  target_service: "pdp_service"\r\n  upstream_path: "/access/v1/budgets/effective"\r\n  methods: ["GET", "OPTIONS"]\r\n  auth: "session"\r\n  preserve_path: true\r\n  authz: "none"\n'})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"title-routesyaml-reference",children:"title: routes.yaml Reference"}),"\n",(0,c.jsx)(n.p,{children:"Structure"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"services: container DNS and base URLs for upstreams"}),"\n",(0,c.jsxs)(n.li,{children:["routes[]:","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"id, description"}),"\n",(0,c.jsxs)(n.li,{children:["path: client path, supports wildcard ",(0,c.jsx)(n.code,{children:"*"})]}),"\n",(0,c.jsx)(n.li,{children:"target_service: key from services"}),"\n",(0,c.jsxs)(n.li,{children:["upstream_path: templated backend path, ",(0,c.jsx)(n.code,{children:"{path}"})," is wildcard capture"]}),"\n",(0,c.jsx)(n.li,{children:"methods: [GET, POST, ...]"}),"\n",(0,c.jsxs)(n.li,{children:["auth: ",(0,c.jsx)(n.code,{children:"session"})," | ",(0,c.jsx)(n.code,{children:"bearer"})," | ",(0,c.jsx)(n.code,{children:"none"})]}),"\n",(0,c.jsxs)(n.li,{children:["authz: ",(0,c.jsx)(n.code,{children:"none"})," | ",(0,c.jsx)(n.code,{children:"pdp"})]}),"\n",(0,c.jsxs)(n.li,{children:["authz_map: optional per-method map for PDP (",(0,c.jsx)(n.code,{children:"GET"}),"/",(0,c.jsx)(n.code,{children:"POST"}),"/... \u2192 resource/action)"]}),"\n",(0,c.jsx)(n.li,{children:"streaming: boolean (SSE)"}),"\n",(0,c.jsx)(n.li,{children:"preserve_path: boolean"}),"\n",(0,c.jsx)(n.li,{children:"internal: optional boolean; when true, dispatches to internal handlers (no HTTP loopback)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Mental model"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"path"})," is the SPA\u2019s client path (what your app calls under ",(0,c.jsx)(n.code,{children:"/api/..."}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"upstream_path"})," is the backend path the BFF will call; ",(0,c.jsx)(n.code,{children:"{path}"})," captures the wildcard portion."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Example translation"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-text",children:'Client: GET /api/crud/forms/123\r\nRoute:  path "/api/crud/forms/*"  \u2192  upstream_path "/forms/{path}" (target_service: crud_service)\r\nBFF:    GET http://crud_service/forms/123\n'})}),"\n",(0,c.jsx)(n.p,{children:"Auth semantics"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"session: cookie\u2011based session check, headers injected to backend"}),"\n",(0,c.jsx)(n.li,{children:"bearer: pass/validate bearer token per idps/audience"}),"\n",(0,c.jsx)(n.li,{children:"none: public endpoint (e.g., health, OIDC discovery)"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Canonical prefixes"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["CRUD APIs are exposed under ",(0,c.jsx)(n.code,{children:"/api/crud/**"})]}),"\n",(0,c.jsxs)(n.li,{children:["AuthZEN preserved paths are proxied as-is: ",(0,c.jsx)(n.code,{children:"/access/v1/evaluation"})," and ",(0,c.jsx)(n.code,{children:"/access/v1/evaluations"})," (paths preserved to PDP)"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Inline PDP mapping examples"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'- id: "crud-tasks-exact"\r\n  path: "/api/crud/tasks"\r\n  target_service: "crud_service"\r\n  upstream_path: "/tasks"\r\n  methods: ["GET", "POST"]\r\n  auth: "session"\r\n  authz: "pdp"\r\n  authz_map:\r\n    GET:\r\n      resource: "task_list"\r\n      action: "read"\r\n    POST:\r\n      resource: "task"\r\n      action: "create"\n'})}),"\n",(0,c.jsx)(n.p,{children:"Resolver precedence"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Inline ",(0,c.jsx)(n.code,{children:"authz_map"})," \u2192 external ",(0,c.jsx)(n.code,{children:"pdp.yaml:endpoint_map"})," (legacy) \u2192 derived defaults (if enabled)"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Internal routes"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Set ",(0,c.jsx)(n.code,{children:"target_service: internal"})," and optionally ",(0,c.jsx)(n.code,{children:"internal: true"})," for FastAPI handlers within the BFF. Keep Experience endpoints ",(0,c.jsx)(n.code,{children:"auth: session"})," so cookies/CSRF apply."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>d});var s=r(96540);const c={},t=s.createContext(c);function i(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);