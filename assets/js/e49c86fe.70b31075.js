"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2813],{28453:(e,s,r)=>{r.d(s,{R:()=>t,x:()=>l});var n=r(96540);const c={},i=n.createContext(c);function t(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),n.createElement(i.Provider,{value:s},e.children)}},78908:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"services/bff/reference/legacy-services-reference","title":"legacy_services.yaml Reference","description":"Purpose","source":"@site/docs/services/bff/reference/legacy-services-reference.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/legacy-services-reference","permalink":"/empowernow_docs/docs/services/bff/reference/legacy-services-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/legacy-services-reference.md","tags":[],"version":"current","frontMatter":{"title":"legacy_services.yaml Reference"},"sidebar":"tutorialSidebar","previous":{"title":"Legacy proxy","permalink":"/empowernow_docs/docs/services/bff/reference/legacy-proxy"},"next":{"title":"LLM Routing Configuration Reference","permalink":"/empowernow_docs/docs/services/bff/reference/llm-routing-config"}}');var c=r(74848),i=r(28453);const t={title:"legacy_services.yaml Reference"},l=void 0,o={},a=[];function d(e){const s={code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.p,{children:"Purpose"}),"\n",(0,c.jsx)(s.p,{children:"Defines the legacy C# microservices the BFF can reach via the legacy proxy. DevOps maintains this file; SPAs call the proxy paths exposed by the BFF."}),"\n",(0,c.jsx)(s.p,{children:"Relationship to the proxy"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["SPA calls: ",(0,c.jsx)(s.code,{children:"/api/v1/proxy/{service}/{path}"})]}),"\n",(0,c.jsxs)(s.li,{children:["This file maps ",(0,c.jsx)(s.code,{children:"{service}"})," to a base URL and sets timeouts/limits/caching."]}),"\n",(0,c.jsx)(s.li,{children:"Errors such as 503 (circuit open) or 413 (body too large) are governed by these settings."}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"Sections"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["legacy_services: per\u2011service base URLs (override with ",(0,c.jsx)(s.code,{children:"LEGACY_SERVICE_<NAME>_URL"}),")"]}),"\n",(0,c.jsxs)(s.li,{children:["legacy_service_timeouts: per\u2011service timeouts (override with ",(0,c.jsx)(s.code,{children:"LEGACY_SERVICE_<NAME>_TIMEOUT"}),")"]}),"\n",(0,c.jsxs)(s.li,{children:["circuit_breaker: ",(0,c.jsx)(s.code,{children:"threshold"}),", ",(0,c.jsx)(s.code,{children:"reset_time"})," (env overrides available)"]}),"\n",(0,c.jsxs)(s.li,{children:["response_cache: ",(0,c.jsx)(s.code,{children:"enabled"}),", ",(0,c.jsx)(s.code,{children:"default_ttl"}),", ",(0,c.jsx)(s.code,{children:"max_size"})]}),"\n",(0,c.jsxs)(s.li,{children:["request_limits: ",(0,c.jsx)(s.code,{children:"max_body_size"})]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"Examples"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"Register a service:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-yaml",children:'legacy_services:\r\n  res-admin: "https://api.empoweriam.com/api"\r\nlegacy_service_timeouts:\r\n  res-admin: 30.0\r\ncircuit_breaker:\r\n  threshold: 5\r\n  reset_time: 60\r\nresponse_cache:\r\n  enabled: true\r\n  default_ttl: 30\r\nrequest_limits:\r\n  max_body_size: 10485760\n'})}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"SPA call using the mapping above:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-ts",children:"await apiClient.get('/api/v1/proxy/res-admin/services/v1/resadmin/resources/people/getsearch', { params: { top: 25 } });\n"})}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"Environment override (per env):"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"LEGACY_SERVICE_RES_ADMIN_URL=https://staging.api.empoweriam.com/api\r\nLEGACY_SERVICE_RES_ADMIN_TIMEOUT=20\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"CB/cache notes"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["Circuit opens after ",(0,c.jsx)(s.code,{children:"threshold"})," consecutive failures; requests return 503 until ",(0,c.jsx)(s.code,{children:"reset_time"})," elapses."]}),"\n",(0,c.jsxs)(s.li,{children:["GET 200 responses are cached (memory + Redis if available) up to ",(0,c.jsx)(s.code,{children:"default_ttl"})," or ",(0,c.jsx)(s.code,{children:"Cache-Control: max-age"}),"."]}),"\n",(0,c.jsx)(s.li,{children:"Non\u2011GET successes trigger targeted invalidation."}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["See also: ",(0,c.jsx)(s.code,{children:"./legacy-proxy"}),", ",(0,c.jsx)(s.code,{children:"../how-to/add-legacy-service"}),", ",(0,c.jsx)(s.code,{children:"../how-to/tune-legacy-circuit-cache"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);