"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[4559],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var s=i(96540);const r={},l=s.createContext(r);function o(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:n},e.children)}},91682:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"services/bff/how-to/fips-startup-guard","title":"FIPS 140\u20113 startup guard \u2014 how it works, develop locally, and go to production","description":"Overview","source":"@site/docs/services/bff/how-to/fips-startup-guard.md","sourceDirName":"services/bff/how-to","slug":"/services/bff/how-to/fips-startup-guard","permalink":"/empowernow_docs/docs/services/bff/how-to/fips-startup-guard","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/how-to/fips-startup-guard.md","tags":[],"version":"current","frontMatter":{"id":"fips-startup-guard","title":"FIPS 140\u20113 startup guard \u2014 how it works, develop locally, and go to production","sidebar_label":"FIPS startup guard"},"sidebar":"tutorialSidebar","previous":{"title":"Enable PAR/DPoP and Client Auth Methods","permalink":"/empowernow_docs/docs/services/bff/how-to/fapi-switches"},"next":{"title":"Health and Readiness Probes","permalink":"/empowernow_docs/docs/services/bff/how-to/health-readiness"}}');var r=i(74848),l=i(28453);const o={id:"fips-startup-guard",title:"FIPS 140\u20113 startup guard \u2014 how it works, develop locally, and go to production",sidebar_label:"FIPS startup guard"},d=void 0,t={},c=[{value:"Overview",id:"overview",level:2},{value:"Develop locally (safe overrides)",id:"develop-locally-safe-overrides",level:2},{value:"What you\u2019ll see in logs",id:"what-youll-see-in-logs",level:2},{value:"Production enablement checklist",id:"production-enablement-checklist",level:2},{value:"Policy for training/QA",id:"policy-for-trainingqa",level:2},{value:"Quick troubleshooting",id:"quick-troubleshooting",level:2},{value:"References",id:"references",level:2}];function a(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["The BFF runs a FIPS 140\u20113 compliance check at startup via ",(0,r.jsx)(n.code,{children:"empowernow_common.fips.validator.FIPSValidator.ensure_compliance()"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If critical checks fail (for example, OpenSSL FIPS provider not enabled, Python ",(0,r.jsx)(n.code,{children:"cryptography"})," backend not FIPS), the app fails closed by default."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"develop-locally-safe-overrides",children:"Develop locally (safe overrides)"}),"\n",(0,r.jsx)(n.p,{children:"Most developer machines and base images don\u2019t enable the OpenSSL FIPS provider. For local/dev, you can allow startup with explicit overrides."}),"\n",(0,r.jsxs)(n.p,{children:["Add these under the ",(0,r.jsx)(n.code,{children:"bff"})," service in ",(0,r.jsx)(n.code,{children:"CRUDService/docker-compose-authzen4.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Dev-only: allow startup without system-wide FIPS by overriding validator\r\nEMPOWERNOW_FIPS_MODE: "true"          #  signals FIPS semantics for logging/context\r\nPYTHONHASHSEED: "random"              #  recommended entropy hygiene\r\nCRYPTOGRAPHY_OPENSSL_NO_LEGACY: "1"   #  prevent legacy provider usage\r\nEMPOWERNOW_FIPS_DISABLE: "true"       #  final guard: continue startup even if checks fail\n'})}),"\n",(0,r.jsx)(n.p,{children:"Behavior with override:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Logs warnings (e.g., "OpenSSL 3.0+ FIPS provider not enabled")'}),"\n",(0,r.jsxs)(n.li,{children:["Proceeds only because ",(0,r.jsx)(n.code,{children:"EMPOWERNOW_FIPS_DISABLE"})," is set"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"what-youll-see-in-logs",children:"What you\u2019ll see in logs"}),"\n",(0,r.jsx)(n.p,{children:"Dev override path examples:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"OpenSSL 3.0+ FIPS provider not enabled"'}),"\n",(0,r.jsx)(n.li,{children:'"FIPS environment configured: EMPOWERNOW_FIPS_MODE=1"'}),"\n",(0,r.jsx)(n.li,{children:"\"FIPS COMPLIANCE FAILURE \u2026 failed_checks: ['cryptography_backend']\""}),"\n",(0,r.jsx)(n.li,{children:'"FIPS compliance not detected; continuing due to dev override \u2026"'}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Proper FIPS runtime (prod):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No critical failures; validator completes without raising"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"production-enablement-checklist",children:"Production enablement checklist"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Base image/runtime","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use a base OS image with OpenSSL 3.x FIPS provider installed"}),"\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"openssl.cnf"})," loads the FIPS provider and sets default properties to ",(0,r.jsx)(n.code,{children:"fips=yes"})," (system\u2011wide or container\u2011local)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Python cryptography binding","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Confirm the ",(0,r.jsx)(n.code,{children:"cryptography"})," library links against that FIPS\u2011enabled OpenSSL"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Environment hygiene","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Keep ",(0,r.jsx)(n.code,{children:"PYTHONHASHSEED=random"})," and ",(0,r.jsx)(n.code,{children:"CRYPTOGRAPHY_OPENSSL_NO_LEGACY=1"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Remove dev overrides","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Unset ",(0,r.jsx)(n.code,{children:"EMPOWERNOW_FIPS_DISABLE"})," (and, if desired, ",(0,r.jsx)(n.code,{children:"EMPOWERNOW_FIPS_MODE"}),") in prod"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Verify","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Restart the BFF and confirm the validator passes with no critical failures"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"policy-for-trainingqa",children:"Policy for training/QA"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"EMPOWERNOW_FIPS_DISABLE"})," is only for development and training environments"]}),"\n",(0,r.jsx)(n.li,{children:"Do not use this override in production; each environment should be validated in true FIPS mode at least once"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"quick-troubleshooting",children:"Quick troubleshooting"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Failure: ",(0,r.jsx)(n.code,{children:"cryptography_backend=false"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Cause: Python ",(0,r.jsx)(n.code,{children:"cryptography"})," not using an OpenSSL build with FIPS provider"]}),"\n",(0,r.jsxs)(n.li,{children:["Fix: Rebuild to link ",(0,r.jsx)(n.code,{children:"cryptography"})," against FIPS\u2011enabled OpenSSL; remove the dev override"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Failure: ",(0,r.jsx)(n.code,{children:"openssl_fips=false"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Cause: FIPS provider not loaded or default properties not set to ",(0,r.jsx)(n.code,{children:"fips=yes"})]}),"\n",(0,r.jsxs)(n.li,{children:["Fix: Update ",(0,r.jsx)(n.code,{children:"openssl.cnf"}),"; verify with ",(0,r.jsx)(n.code,{children:"openssl list -providers"})," inside the container"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Environment warnings","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"PYTHONHASHSEED=random"})," and ",(0,r.jsx)(n.code,{children:"CRYPTOGRAPHY_OPENSSL_NO_LEGACY=1"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Release notes: see \u201cFIPS startup guard and development override\u201d in ",(0,r.jsx)(n.code,{children:"ms_bff_spike/ms_bff/docs/release_notes_bff_migration.md"})]}),"\n",(0,r.jsxs)(n.li,{children:["Compose location: ",(0,r.jsx)(n.code,{children:"CRUDService/docker-compose-authzen4.yml"})," under the ",(0,r.jsx)(n.code,{children:"bff"})," service"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);