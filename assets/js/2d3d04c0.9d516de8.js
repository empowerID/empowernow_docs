"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[8337],{28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var i=r(96540);const s={},o=i.createContext(s);function t(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(o.Provider,{value:n},e.children)}},48380:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"services/bff/how-to/configure-pdp","title":"Configure PDP (pdp.yaml)","description":"What this file is","source":"@site/docs/services/bff/how-to/configure-pdp.md","sourceDirName":"services/bff/how-to","slug":"/services/bff/how-to/configure-pdp","permalink":"/empowernow_docs/docs/services/bff/how-to/configure-pdp","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/how-to/configure-pdp.md","tags":[],"version":"current","frontMatter":{"title":"Configure PDP (pdp.yaml)"},"sidebar":"tutorialSidebar","previous":{"title":"Configure IdPs (idps.yaml)","permalink":"/empowernow_docs/docs/services/bff/how-to/configure-idps"},"next":{"title":"Configure CORS and Cookie Domain (Verified)","permalink":"/empowernow_docs/docs/services/bff/how-to/cors-cookie-domain"}}');var s=r(74848),o=r(28453);const t={title:"Configure PDP (pdp.yaml)"},c=void 0,a={},d=[];function l(e){const n={code:"code",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"What this file is"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ServiceConfigs/BFF/config/pdp.yaml"})," configures the BFF\u2019s connection to the Policy Decision Point (PDP) and defines how API paths map to authorization resources/actions."]}),"\n",(0,s.jsx)(n.li,{children:"The BFF uses this file to ask the PDP \u201cis user X allowed to perform action Y on resource Z?\u201d for every protected request."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"What is supported"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Connection and endpoints: ",(0,s.jsx)(n.code,{children:"connection"})," (base URL, client credentials), ",(0,s.jsx)(n.code,{children:"endpoints"})," (",(0,s.jsx)(n.code,{children:"evaluation"}),", ",(0,s.jsx)(n.code,{children:"batch"}),", ",(0,s.jsx)(n.code,{children:"search_actions"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Resilience: ",(0,s.jsx)(n.code,{children:"retry"})," with max retries, backoff, and retryable status codes."]}),"\n",(0,s.jsxs)(n.li,{children:["Performance: ",(0,s.jsx)(n.code,{children:"cache"})," with separate TTLs for allow/deny, max size, and invalidation on policy change."]}),"\n",(0,s.jsxs)(n.li,{children:["Stability: ",(0,s.jsx)(n.code,{children:"circuit_breaker"})," with thresholds and reset times."]}),"\n",(0,s.jsxs)(n.li,{children:["Mapping: ",(0,s.jsx)(n.code,{children:"endpoint_map"})," translating path+method to ",(0,s.jsx)(n.code,{children:"resource"}),", ",(0,s.jsx)(n.code,{children:"action"}),", optional ",(0,s.jsx)(n.code,{children:"id_from"}),", and ",(0,s.jsx)(n.code,{children:"props"})," (simple JSONPath ",(0,s.jsx)(n.code,{children:"$.field"})," extraction from request body)."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'connection:\r\n  base_url: http://pdp-service:8000\r\n  client_id: bff-service\r\n  client_secret: ${PDP_CLIENT_SECRET}\r\n  token_url: http://auth-server:8080/oauth/token\r\n  timeout: 5.0\r\n  verify_ssl: true\r\n\r\nendpoints:\r\n  evaluation: v1/evaluation\r\n  batch: v1/evaluations\r\n  search_actions: access/v1/search/actions\r\n\r\ncache:\r\n  enabled: true\r\n  ttl_allow: 300\r\n  ttl_deny: 60\r\n\r\nendpoint_map:\r\n  /api/v1/membership/people/{person_id}:\r\n    GET:\r\n      resource: membership:people\r\n      id_from: "{person_id}"\r\n      action: read\n'})}),"\n",(0,s.jsx)(n.p,{children:"How it\u2019s enforced in the BFF"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Path mapping: ",(0,s.jsx)(n.code,{children:"services/path_mapper.py"})," reads ",(0,s.jsx)(n.code,{children:"endpoint_map"}),", compiles rules, extracts URL params and body fields, and returns ",(0,s.jsx)(n.code,{children:"(resource, action, id, props)"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Authorization: ",(0,s.jsx)(n.code,{children:"core/permissions.py"})," assembles context (roles/permissions, headers, query/body subset, correlation ID) and calls ",(0,s.jsx)(n.code,{children:"services/pdp_client.py"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Caching: allow/deny decisions are cached with separate TTLs from ",(0,s.jsx)(n.code,{children:"pdp.yaml"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Flow"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\r\n  autonumber\r\n  participant Client\r\n  participant BFF\r\n  participant PDP\r\n  Client->>BFF: POST /api/... { body }\r\n  BFF->>BFF: Map path+method via endpoint_map \u2192 (resource, action, id, props)\r\n  BFF->>PDP: Evaluate(resource, action, subject, props)\r\n  alt allow\r\n    PDP--\x3e>BFF: allow\r\n    BFF--\x3e>Client: 200\r\n  else deny\r\n    PDP--\x3e>BFF: deny\r\n    BFF--\x3e>Client: 403\r\n  end"}),"\n",(0,s.jsx)(n.p,{children:"Tips"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Start small: add mappings for the endpoints you are enabling; expand iteratively."}),"\n",(0,s.jsxs)(n.li,{children:["Use canonical prefixes (",(0,s.jsx)(n.code,{children:"/api/crud/**"}),", preserved AuthZEN ",(0,s.jsx)(n.code,{children:"/access/v1/evaluation"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"Set shorter TTL for deny to reduce false negatives after permissions change."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"See also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Explanation \u2192 Authorization Model (PDP, Mapping, Caching)"}),"\n",(0,s.jsx)(n.li,{children:"Reference \u2192 routes.yaml Reference"}),"\n",(0,s.jsx)(n.li,{children:"How\u2011to \u2192 Validate endpoint_map entries (Quick Checklist)"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);