"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2821],{28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var c=o(96540);const t={},i=c.createContext(t);function s(e){const n=c.useContext(i);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),c.createElement(i.Provider,{value:n},e.children)}},71718:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>d});const c=JSON.parse('{"id":"services/nowconnect/how-to/operational-validation-health","title":"NowConnect operational validation and health guide","description":"Runbook for DC Ops and DevOps/SRE to validate NowConnect end\u2011to\u2011end, check health endpoints, read metrics, and troubleshoot common issues.","source":"@site/docs/services/nowconnect/how-to/operational-validation-health.md","sourceDirName":"services/nowconnect/how-to","slug":"/services/nowconnect/how-to/operational-validation-health","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/operational-validation-health","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/nowconnect/how-to/operational-validation-health.md","tags":[],"version":"current","frontMatter":{"id":"operational-validation-health","title":"NowConnect operational validation and health guide","description":"Runbook for DC Ops and DevOps/SRE to validate NowConnect end\u2011to\u2011end, check health endpoints, read metrics, and troubleshoot common issues.","sidebar_label":"Operational validation & health"},"sidebar":"tutorialSidebar","previous":{"title":"ldaps-multi-backend","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/ldaps-multi-backend"},"next":{"title":"premise-agent","permalink":"/empowernow_docs/docs/services/nowconnect/how-to/premise-agent"}}');var t=o(74848),i=o(28453);const s={id:"operational-validation-health",title:"NowConnect operational validation and health guide",description:"Runbook for DC Ops and DevOps/SRE to validate NowConnect end\u2011to\u2011end, check health endpoints, read metrics, and troubleshoot common issues.",sidebar_label:"Operational validation & health"},l=void 0,r={},d=[{value:"Audience",id:"audience",level:3},{value:"What NowConnect is (in this stack)",id:"what-nowconnect-is-in-this-stack",level:2},{value:"Quick \u201cping-pong\u201d validation (end-to-end)",id:"quick-ping-pong-validation-end-to-end",level:2},{value:"Health endpoints and what \u201cgood\u201d looks like",id:"health-endpoints-and-what-good-looks-like",level:2},{value:"Operational runbook",id:"operational-runbook",level:2},{value:"Fast diagnostic checklist",id:"fast-diagnostic-checklist",level:3},{value:"Common failure signatures and actions",id:"common-failure-signatures-and-actions",level:3},{value:"Reliability and observability recommendations",id:"reliability-and-observability-recommendations",level:2},{value:"Dashboards",id:"dashboards",level:3},{value:"Alerts (examples)",id:"alerts-examples",level:3},{value:"CI/CD health gate (optional but encouraged)",id:"cicd-health-gate-optional-but-encouraged",level:2},{value:"Notes and improvements",id:"notes-and-improvements",level:2},{value:"One-command \u201cping-pong and metrics\u201d bundle (copy/paste)",id:"one-command-ping-pong-and-metrics-bundle-copypaste",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"audience",children:"Audience"}),"\n",(0,t.jsx)(n.p,{children:"DC Ops and DevOps/SRE teams supporting NowConnect in the empowernow stack."}),"\n",(0,t.jsx)(n.h2,{id:"what-nowconnect-is-in-this-stack",children:"What NowConnect is (in this stack)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Cloud hub service: ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"})," (WS endpoint on port 8765; TCP listeners that accept client traffic, e.g., LDAP on 389)."]}),"\n",(0,t.jsxs)(n.li,{children:["Premise agent service: ",(0,t.jsx)(n.code,{children:"nowconnect-premise"})," (maintains WS tunnel to the cloud hub and forwards TCP to the actual target)."]}),"\n",(0,t.jsxs)(n.li,{children:["Connector mapping: listener ",(0,t.jsx)(n.code,{children:"addomain"})," forwards to ",(0,t.jsx)(n.code,{children:"openldap"})," (config: ",(0,t.jsx)(n.code,{children:"ServiceConfigs/NowConnect/config/cloud.yaml"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Validation target in this doc: OpenLDAP via the NowConnect tunnel."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"quick-ping-pong-validation-end-to-end",children:"Quick \u201cping-pong\u201d validation (end-to-end)"}),"\n",(0,t.jsx)(n.p,{children:"Run these anytime to prove the data path and quantify traffic. Commands are PowerShell\u2011friendly."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Ensure the services are up"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"cd C:\\source\\repos\\CRUDService\r\ndocker compose -f docker-compose-nowconnect.yml up -d nowconnect-cloud nowconnect-premise openldap\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Sanity logs (cloud and agent)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"docker compose -f docker-compose-nowconnect.yml logs --tail 100 nowconnect-cloud\r\ndocker compose -f docker-compose-nowconnect.yml logs --tail 100 nowconnect-premise\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expect to see:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["cloud: ",(0,t.jsx)(n.code,{children:"listener_started"})," on 0.0.0.0:389 with connector ",(0,t.jsx)(n.code,{children:"addomain"}),", then ",(0,t.jsx)(n.code,{children:"agent_connected"}),", then ",(0,t.jsx)(n.code,{children:"connection open"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"agent: \u201cconnecting to cloud\u201d, \u201cconnection open\u201d."}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Generate tunnel traffic (read\u2011only LDAP search via the gateway)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"docker compose -f docker-compose-nowconnect.yml run --rm `\r\n  -e OPENLDAP_URL=ldap://nowconnect-cloud -e OPENLDAP_PORT=389 `\r\n  -e OPENLDAP_BASE_DN=dc=example,dc=org `\r\n  -e OPENLDAP_USERNAME=cn=admin,dc=example,dc=org `\r\n  -e OPENLDAP_PASSWORD=admin -e OPENLDAP_SSL=false `\r\n  crud-service pytest tests/integration/test_openldap_readonly_extended.py::test_anonymous_bind_search -q\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["This connects to host ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"}),", which proves the path goes through the tunnel (not directly to ",(0,t.jsx)(n.code,{children:"openldap"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Verify traffic counters (Prometheus metrics from cloud hub)"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The metrics endpoint is exposed on the cloud hub process (port 8765). From inside the container:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"docker compose -f docker-compose-nowconnect.yml exec nowconnect-cloud sh -lc `\r\n\"python - <<'PY'\r\nimport urllib.request\r\nd = urllib.request.urlopen('http://localhost:8765/metrics', timeout=3).read().decode()\r\nfor l in d.splitlines():\r\n    if l.startswith('nowconnect_tcp_connections_total') or l.startswith('nowconnect_tcp_bytes_total'):\r\n        print(l)\r\nPY\"\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expect counters like:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'nowconnect_tcp_connections_total{connector="addomain"} N\r\nnowconnect_tcp_bytes_total{direction="c2a",connector="addomain"} X\r\nnowconnect_tcp_bytes_total{direction="a2c",connector="addomain"} Y\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Re\u2011run the LDAP test; the bytes counters should increase (c2a = client\u2192agent; a2c = agent\u2192client)."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"health-endpoints-and-what-good-looks-like",children:"Health endpoints and what \u201cgood\u201d looks like"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Cloud hub:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["HTTP: ",(0,t.jsx)(n.code,{children:"GET /healthz"})," \u2192 ",(0,t.jsx)(n.code,{children:'{"status":"ok"}'})," (on port 8765 in\u2011container)"]}),"\n",(0,t.jsxs)(n.li,{children:["WebSocket: ",(0,t.jsx)(n.code,{children:"/tunnel"})," (agent connects here; presence is visible in logs)"]}),"\n",(0,t.jsxs)(n.li,{children:["Metrics: ",(0,t.jsx)(n.code,{children:"GET /metrics"})," (Prometheus exposition; see counters above)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Agent: lifecycle visible in logs (\u201cconnecting to cloud\u201d, \u201cconnection open\u201d)."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Recommended Prometheus scrape (internal network):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- job_name: 'nowconnect'\r\n  static_configs:\r\n    - targets: ['nowconnect-cloud:8765']\r\n  metrics_path: /metrics\n"})}),"\n",(0,t.jsx)(n.h2,{id:"operational-runbook",children:"Operational runbook"}),"\n",(0,t.jsx)(n.h3,{id:"fast-diagnostic-checklist",children:"Fast diagnostic checklist"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Is the listener up?","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Cloud logs contain: ",(0,t.jsx)(n.code,{children:"listener_started"})," with the expected bind/connector."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Is the agent connected?","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Cloud logs contain: ",(0,t.jsx)(n.code,{children:"agent_connected"}),' (agent_id: dev-agent-1; connectors: ["addomain"]).']}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Is traffic flowing?","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Run the LDAP test via ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"})," host (above)."]}),"\n",(0,t.jsxs)(n.li,{children:["Confirm counter deltas on:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'nowconnect_tcp_connections_total{connector="addomain"}'})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'nowconnect_tcp_bytes_total{direction="c2a|a2c",connector="addomain"}'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"common-failure-signatures-and-actions",children:"Common failure signatures and actions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Cloud log ",(0,t.jsx)(n.code,{children:"no_agent_for_connector"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Agent not registered or not connected; check agent logs; verify ",(0,t.jsx)(n.code,{children:"NC_CONNECTORS"})," includes ",(0,t.jsx)(n.code,{children:"addomain"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Cloud log ",(0,t.jsx)(n.code,{children:"cidr_blocked"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Client source IP not in ",(0,t.jsx)(n.code,{children:"allow_cidrs"})," (",(0,t.jsx)(n.code,{children:"ServiceConfigs/NowConnect/config/cloud.yaml"}),"). Update allowlist if needed."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Metrics fetch \u201cconnection refused\u201d:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Query from inside the ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"})," container on ",(0,t.jsx)(n.code,{children:"http://localhost:8765/metrics"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"If you need host access, expose 8765 externally or route via Traefik."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["LDAP errors \u201cattribute type not present\u201d on group membership deletion:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"This is benign on idempotent cleanup. Tests were updated to ignore this when the member is already absent. For production, we recommend the connector treats LDAP result code 16 (noSuchAttribute) as success on delete."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"reliability-and-observability-recommendations",children:"Reliability and observability recommendations"}),"\n",(0,t.jsx)(n.h3,{id:"dashboards",children:"Dashboards"}),"\n",(0,t.jsx)(n.p,{children:"Track at minimum:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"nowconnect_tcp_connections_total{connector}"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"rate(nowconnect_tcp_bytes_total[1m]) by (direction,connector)"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nowconnect_tcp_active_connections"})," (if added later)"]}),"\n",(0,t.jsx)(n.li,{children:"FIN/RST counters (FIN_SENT/FIN_RECV/RST_RECV) for anomalies"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"alerts-examples",children:"Alerts (examples)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u201cNo traffic\u201d burn alert:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["No increase in ",(0,t.jsx)(n.code,{children:'nowconnect_tcp_connections_total{connector="addomain"}'})," for 15m during business hours."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u201cOne-way traffic\u201d:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'rate(nowconnect_tcp_bytes_total{direction="c2a"}[5m]) > 0'})," and ",(0,t.jsx)(n.code,{children:'rate(...{direction="a2c"}[5m]) == 0'})," (or vice versa) for 5m."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u201cAgent disconnected\u201d:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Cloud log scrape detects loss of ",(0,t.jsx)(n.code,{children:"agent_connected"})," without reconnect, or long gap in connections while service is up."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"cicd-health-gate-optional-but-encouraged",children:"CI/CD health gate (optional but encouraged)"}),"\n",(0,t.jsx)(n.p,{children:"Add a job that:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Spins up ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"}),", ",(0,t.jsx)(n.code,{children:"nowconnect-premise"}),", ",(0,t.jsx)(n.code,{children:"openldap"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Executes the read\u2011only LDAP test with host ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Pulls and asserts metrics deltas > 0 on c2a/a2c bytes counters."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"notes-and-improvements",children:"Notes and improvements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"System definition for tunnel route"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Added ",(0,t.jsx)(n.code,{children:"ServiceConfigs/CRUDService/config/systems/av_openldap_nowconnect.yaml"})," with ",(0,t.jsx)(n.code,{children:"base_url: nowconnect-cloud"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["For runs that load a system by name, you can shadow ",(0,t.jsx)(n.code,{children:"av_openldap"})," with this file via ",(0,t.jsx)(n.code,{children:"SERVICE_CONFIG_DIR=/tmp/nowconnect"})," (copy/rename) so existing code paths use the tunnel without code edits."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Idempotency fix in tests"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tests/integration/test_openldap_write_path.py"})," now ignores \u201cattribute type not present\u201d on member removal (safe retry behavior)."]}),"\n",(0,t.jsx)(n.li,{children:"Recommended connector hardening: treat LDAP result code 16 (noSuchAttribute) as success on delete; result code 20 (typeOrValueExists) as success on add."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Externalizing metrics (optional)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Today we read metrics from inside the ",(0,t.jsx)(n.code,{children:"nowconnect-cloud"})," container."]}),"\n",(0,t.jsx)(n.li,{children:"To query from host, map port 8765 or route with Traefik and restrict access (IP allowlist)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"one-command-ping-pong-and-metrics-bundle-copypaste",children:"One-command \u201cping-pong and metrics\u201d bundle (copy/paste)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# 1) Start services\r\ndocker compose -f CRUDService/docker-compose-nowconnect.yml up -d nowconnect-cloud nowconnect-premise openldap\r\n\r\n# 2) Generate tunnel traffic\r\ndocker compose -f CRUDService/docker-compose-nowconnect.yml run --rm `\r\n  -e OPENLDAP_URL=ldap://nowconnect-cloud -e OPENLDAP_PORT=389 `\r\n  -e OPENLDAP_BASE_DN=dc=example,dc=org -e OPENLDAP_USERNAME=cn=admin,dc=example,dc=org `\r\n  -e OPENLDAP_PASSWORD=admin -e OPENLDAP_SSL=false `\r\n  crud-service pytest tests/integration/test_openldap_readonly_extended.py::test_anonymous_bind_search -q\r\n\r\n# 3) Show counters\r\ndocker compose -f CRUDService/docker-compose-nowconnect.yml exec nowconnect-cloud sh -lc `\r\n\"python - <<'PY'\r\nimport urllib.request\r\nd = urllib.request.urlopen('http://localhost:8765/metrics', timeout=3).read().decode()\r\nfor l in d.splitlines():\r\n    if l.startswith('nowconnect_tcp_connections_total') or l.startswith('nowconnect_tcp_bytes_total'):\r\n        print(l)\r\nPY\"\n"})}),"\n",(0,t.jsx)(n.p,{children:"This gives you a reliable, self\u2011service \u201cping\u2011pong\u201d and metrics\u2011based validation for NowConnect at any time."}),"\n",(0,t.jsx)(n.p,{children:"See also:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"services/nowconnect/explanation/metrics-and-reliability"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"services/crud-service/explanation/ldap-connector-idempotency"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);