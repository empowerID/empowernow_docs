"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2245],{28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>d});var r=n(96540);const i={},t=r.createContext(i);function c(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:s},e.children)}},84289:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"services/bff/reference/certificates-devops","title":"Certificates, Keys, and Secrets (DevOps)","description":"This page summarizes certificate and secret management relevant to the BFF stack (compose + K8s), verified from docker-compose-authzen4.yml and the Certificate Management Guide.","source":"@site/docs/services/bff/reference/certificates-devops.md","sourceDirName":"services/bff/reference","slug":"/services/bff/reference/certificates-devops","permalink":"/empowernow_docs/docs/services/bff/reference/certificates-devops","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/reference/certificates-devops.md","tags":[],"version":"current","frontMatter":{"title":"Certificates, Keys, and Secrets (DevOps)"},"sidebar":"tutorialSidebar","previous":{"title":"Certificates & Keys (Auditors)","permalink":"/empowernow_docs/docs/services/bff/reference/certificates-audit"},"next":{"title":"Configuration Overview","permalink":"/empowernow_docs/docs/services/bff/reference/config-overview"}}');var i=n(74848),t=n(28453);const c={title:"Certificates, Keys, and Secrets (DevOps)"},d=void 0,o={},l=[{value:"Inventory (stack subset)",id:"inventory-stack-subset",level:2},{value:"Where they are wired (compose)",id:"where-they-are-wired-compose",level:2},{value:"Dependency map",id:"dependency-map",level:2},{value:"Rotation (high-level)",id:"rotation-high-level",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Emergency",id:"emergency",level:2}];function a(e){const s={code:"code",h2:"h2",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.p,{children:["This page summarizes certificate and secret management relevant to the BFF stack (compose + K8s), verified from ",(0,i.jsx)(s.code,{children:"docker-compose-authzen4.yml"})," and the Certificate Management Guide."]}),"\n",(0,i.jsx)(s.h2,{id:"inventory-stack-subset",children:"Inventory (stack subset)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Traefik TLS: wildcard cert for ",(0,i.jsx)(s.code,{children:"*.ocg.labs.empowernow.ai"})," (mounted under ",(0,i.jsx)(s.code,{children:"../IdP/certs"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["IdP JWT signing keys: ",(0,i.jsx)(s.code,{children:"idp-signing-1"})," (JWKS), used for OIDC tokens"]}),"\n",(0,i.jsxs)(s.li,{children:["BFF service keys: ",(0,i.jsx)(s.code,{children:"/app/keys/bff-sig-001.pem"})," (volume ",(0,i.jsx)(s.code,{children:"bff-keys"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Client secrets (compose secrets dir): ",(0,i.jsx)(s.code,{children:"oidc-client-secret.txt"}),", ",(0,i.jsx)(s.code,{children:"pdp-client-secret.txt"}),", etc."]}),"\n",(0,i.jsxs)(s.li,{children:["Cryptographic salts: ",(0,i.jsx)(s.code,{children:"token-hash-salt.txt"}),", ",(0,i.jsx)(s.code,{children:"ua-hash-salt.txt"})," (mounted to BFF via Docker secrets)"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"where-they-are-wired-compose",children:"Where they are wired (compose)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Traefik mounts: ",(0,i.jsx)(s.code,{children:"../IdP/certs:/certs:ro"})]}),"\n",(0,i.jsxs)(s.li,{children:["BFF env:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"BFF_JWT_SIGNING_KEY=/app/keys/bff-sig-001.pem"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"TOKEN_HASH_SALT=file:/run/secrets/token-hash-salt"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"UA_HASH_SALT=file:/run/secrets/ua-hash-salt"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["IdP JWT: ",(0,i.jsx)(s.code,{children:"JWT_SIGNING_KEY"})," secret, ",(0,i.jsx)(s.code,{children:"TOKEN_KEY_ID"}),", JWKS published by IdP"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"dependency-map",children:"Dependency map"}),"\n",(0,i.jsx)(s.mermaid,{value:"graph TD\r\n  A[Traefik TLS] --\x3e B[External Hosts *.ocg.labs]\r\n  C[IdP JWT Keys] --\x3e D[OIDC Tokens]\r\n  D --\x3e E[BFF Validation]\r\n  F[BFF Keys] --\x3e G[JWT/DCR where applicable]\r\n  H[Client Secrets] --\x3e I[Service-to-Service]\r\n  J[Crypto Salts] --\x3e K[HMAC/Hashing in BFF]"}),"\n",(0,i.jsx)(s.h2,{id:"rotation-high-level",children:"Rotation (high-level)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Traefik TLS: renew every 90 days; hot-reload via Traefik restart"}),"\n",(0,i.jsxs)(s.li,{children:["IdP JWT keys: rotate annually; update ",(0,i.jsx)(s.code,{children:"TOKEN_KEY_ID"})," and JWKS; maintain overlap window"]}),"\n",(0,i.jsx)(s.li,{children:"BFF keys: rotate annually; update volume key file and env; restart BFF"}),"\n",(0,i.jsx)(s.li,{children:"Client secrets: rotate 6 months; update secret files and IdP client; restart affected services"}),"\n",(0,i.jsx)(s.li,{children:"Salts: rotate per policy; update Docker secrets; restart BFF"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Add expiry checks (openssl) for PEM files under ",(0,i.jsx)(s.code,{children:"IdP/certs"})," and any custom keys"]}),"\n",(0,i.jsxs)(s.li,{children:["Prom scrape enabled on BFF (",(0,i.jsx)(s.code,{children:"/metrics"}),") for auth-related counters"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"emergency",children:"Emergency"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"If TLS outage: deploy temporary self-signed, restart Traefik, then replace with CA-issued"}),"\n",(0,i.jsx)(s.li,{children:"If JWT compromise: generate new key, publish JWKS, rotate clients, invalidate sessions as needed"}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);