"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[2318],{28453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>o});var i=n(96540);const s={},t=i.createContext(s);function c(e){const r=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(t.Provider,{value:r},e.children)}},95307:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"services/crud-service/secrets/secrets_visual_guide","title":"Secrets visual guide","description":"High\u2011level architecture, decision tree, URI anatomy, and migration flow for the Secrets Platform.","source":"@site/docs/services/crud-service/secrets/secrets_visual_guide.md","sourceDirName":"services/crud-service/secrets","slug":"/services/crud-service/secrets/secrets_visual_guide","permalink":"/empowernow_docs/docs/services/crud-service/secrets/secrets_visual_guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/crud-service/secrets/secrets_visual_guide.md","tags":[],"version":"current","frontMatter":{"title":"Secrets visual guide","description":"High\u2011level architecture, decision tree, URI anatomy, and migration flow for the Secrets Platform."},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/empowernow_docs/docs/services/crud-service/secrets/"},"next":{"title":"checkpointing","permalink":"/empowernow_docs/docs/services/crud-service/explanation/checkpointing"}}');var s=n(74848),t=n(28453);const c={title:"Secrets visual guide",description:"High\u2011level architecture, decision tree, URI anatomy, and migration flow for the Secrets Platform."},o=void 0,a={},l=[{value:"Architecture flow \u2014 at a glance",id:"architecture-flow--at-a-glance",level:2},{value:"Decision tree \u2014 which store or pointer to use",id:"decision-tree--which-store-or-pointer-to-use",level:2},{value:"Canonical Secret URI anatomy",id:"canonical-secret-uri-anatomy",level:2},{value:"Migration flow \u2014 from .env to pointers",id:"migration-flow--from-env-to-pointers",level:2},{value:"Quick cheat sheet",id:"quick-cheat-sheet",level:2},{value:"Verification",id:"verification",level:2},{value:"Production switches",id:"production-switches",level:2}];function d(e){const r={a:"a",code:"code",h2:"h2",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"architecture-flow--at-a-glance",children:"Architecture flow \u2014 at a glance"}),"\n",(0,s.jsx)(r.mermaid,{value:'flowchart LR\r\n  A["Client or connector"] --\x3e B["CRUDService API or worker"]\r\n  B --\x3e C["VaultService (PEP)"]\r\n  C --\x3e D["SecretPolicyService (PDP)"]\r\n  D -- "Grants and obligations" --\x3e C\r\n  C --\x3e E{"Providers"}\r\n  E --\x3e E1["OpenBao KVv2"]\r\n  E --\x3e E2["DB credentials (encrypted)"]\r\n  E --\x3e E3["File (Docker / K8s CSI)"]\r\n  E --\x3e E4["YAML (dev only)"]\r\n  C --\x3e F["Audits \u2192 Kafka"]\r\n  C -- "Secret (slot)" --\x3e B\r\n  F -. "Non\u2011leaky resource_ref" .- G["Analytics / monitoring"]'}),"\n",(0,s.jsx)(r.h2,{id:"decision-tree--which-store-or-pointer-to-use",children:"Decision tree \u2014 which store or pointer to use"}),"\n",(0,s.jsx)(r.mermaid,{value:'flowchart TD\r\n  Start["Need a secret"] --\x3e Q1{"Needed before app starts?"}\r\n  Q1 -- "Yes" --\x3e File["Use file (Docker secret / K8s CSI)\\nPointer: file:primary:<name>"]\r\n  Q1 -- "No" --\x3e Q2{"App\u2011managed credential?"}\r\n  Q2 -- "Yes" --\x3e DB["Use DB credential\\nPointer: db:credentials:<uuid>"]\r\n  Q2 -- "No" --\x3e Q3{"Platform / service secret?"}\r\n  Q3 -- "Yes" --\x3e KV["Use OpenBao KVv2\\nPointer: openbao+kv2://secret/...#KEY"]\r\n  Q3 -- "Local\u2011only" --\x3e YAML["Use YAML (dev only)\\nPointer: yaml://secret/...#KEY"]\r\n  File --\x3e End["Reference with pointer in env / config"]\r\n  DB --\x3e End\r\n  KV --\x3e End\r\n  YAML --\x3e End'}),"\n",(0,s.jsx)(r.h2,{id:"canonical-secret-uri-anatomy",children:"Canonical Secret URI anatomy"}),"\n",(0,s.jsx)(r.mermaid,{value:'flowchart LR\r\n  U["URI"] --\x3e A["provider"]\r\n  U --\x3e B["engine (optional)"]\r\n  U --\x3e C["mount"]\r\n  U --\x3e D["path"]\r\n  U --\x3e E["fragment key"]\r\n  U --\x3e F["params (optional)"]\r\n\r\n  S1["Example: openbao+kv2://secret/azure/msgraph#CLIENT_SECRET?version=3"]\r\n  S1 --\x3e A\r\n  S1 --\x3e B\r\n  S1 --\x3e C\r\n  S1 --\x3e D\r\n  S1 --\x3e E\r\n  S1 --\x3e F\r\n\r\n  subgraph "Legend"\r\n    A1["provider = openbao | hashicorp | file | db | yaml"]\r\n    B1["engine = kv2 (for Vault KVv2)"]\r\n    C1["mount = first path segment (e.g., secret)"]\r\n    D1["path = remaining segments (e.g., azure/msgraph)"]\r\n    E1["fragment = key within object (e.g., CLIENT_SECRET)"]\r\n    F1["params = query options (e.g., version=3)"]\r\n  end'}),"\n",(0,s.jsx)(r.h2,{id:"migration-flow--from-env-to-pointers",children:"Migration flow \u2014 from .env to pointers"}),"\n",(0,s.jsx)(r.mermaid,{value:'flowchart LR\r\n  A["Inventory .env secrets"] --\x3e B{"Classify"}\r\n  B -- "Bootstrap" --\x3e C["Create Docker secret / K8s CSI file\\nPointer: file:primary:<name>"]\r\n  B -- "Platform" --\x3e D["Create in OpenBao KVv2\\nPointer: openbao+kv2://...#KEY"]\r\n  B -- "App\u2011managed" --\x3e E["Create via /api/crud/credentials\\nPointer: db:credentials:<uuid>"]\r\n  C --\x3e F["Replace env literals with pointers"]\r\n  D --\x3e F\r\n  E --\x3e F\r\n  F --\x3e G["Verify with /api/secrets/value and app flows"]\r\n  G --\x3e H["Enable prod guards: REQUIRE_AUTH, ENFORCE_SCOPES, PDP"]'}),"\n",(0,s.jsx)(r.h2,{id:"quick-cheat-sheet",children:"Quick cheat sheet"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Use file (Docker / K8s CSI) for bootstrap secrets: ",(0,s.jsx)(r.code,{children:"file:primary:<name>"}),"; set ",(0,s.jsx)(r.code,{children:"FILE_MOUNT_PATH"})," for CSI."]}),"\n",(0,s.jsxs)(r.li,{children:["Use OpenBao KVv2 for platform / service secrets: ",(0,s.jsx)(r.code,{children:"openbao+kv2://secret/<path>#KEY[?version=N]"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Use DB credential for app\u2011managed OAuth / API: ",(0,s.jsx)(r.code,{children:"db:credentials:<uuid>"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Dev\u2011only YAML for quick iteration: ",(0,s.jsx)(r.code,{children:"yaml://secret/<path>#KEY"}),"."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"verification",children:"Verification"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Seed KVv2:"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'curl -s -X POST "http://localhost:8000/api/secrets" \\\r\n  -H "Content-Type: application/json" \\\r\n  -d \'{"uri":"openbao+kv2://secret/crud#CREDENTIAL_ENCRYPTION_KEY","value":"<base64-or-random>"}\'\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Read to confirm:"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'curl -s "http://localhost:8000/api/secrets/value?uri=openbao+kv2://secret/crud#CREDENTIAL_ENCRYPTION_KEY"\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Live events:"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'curl -N "http://localhost:8000/api/secrets/events"\n'})}),"\n",(0,s.jsx)(r.h2,{id:"production-switches",children:"Production switches"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Set ",(0,s.jsx)(r.code,{children:"SECRETS_API_REQUIRE_AUTH=true"}),", ",(0,s.jsx)(r.code,{children:"SECRETS_ENFORCE_SCOPES=true"}),", ",(0,s.jsx)(r.code,{children:"ENABLE_AUTHORIZATION=true"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Keep ",(0,s.jsx)(r.code,{children:"TENANT_ALLOWED_MOUNTS=secret"})," and set strong ",(0,s.jsx)(r.code,{children:"SECRET_TENANT_SALT"}),"."]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsxs)(r.p,{children:["See also: ",(0,s.jsx)(r.a,{href:"./providers",children:"Providers"}),", ",(0,s.jsx)(r.a,{href:"./canonical-uris-and-policy",children:"Canonical URIs and policy"}),", ",(0,s.jsx)(r.a,{href:"./security-model",children:"Security model"}),", ",(0,s.jsx)(r.a,{href:"./SECRETS_MIGRATION_GUIDE",children:"Migration guide"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["If you want, I can embed these diagrams and a condensed narrative into ",(0,s.jsx)(r.code,{children:"CRUDService/docs/guides/SECRETS_MIGRATION_GUIDE.md"})," as a \u201cVisual Learner\u2019s\u201d section."]})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);