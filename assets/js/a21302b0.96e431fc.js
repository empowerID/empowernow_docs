"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[1638],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var a=i(96540);const s={},r=a.createContext(s);function o(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(r.Provider,{value:n},e.children)}},84962:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"services/pdp/explanation/debug_tracing","title":"Debug & Tracing \u2014 Understanding Policy Resolution","description":"Canonical reference: scopedpolicydesign.md. This doc shows how to trace policy loading and evaluation, and the endpoints available.","source":"@site/docs/services/pdp/explanation/debug_tracing.md","sourceDirName":"services/pdp/explanation","slug":"/services/pdp/explanation/debug_tracing","permalink":"/empowernow_docs/docs/services/pdp/explanation/debug_tracing","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/pdp/explanation/debug_tracing.md","tags":[],"version":"current","frontMatter":{}}');var s=i(74848),r=i(28453);const o={},c="Debug & Tracing \u2014 Understanding Policy Resolution",t={},l=[{value:"What you can trace",id:"what-you-can-trace",level:2},{value:"Resolution trace (sequence)",id:"resolution-trace-sequence",level:2},{value:"Example trace schema (simplified)",id:"example-trace-schema-simplified",level:2},{value:"HTTP endpoints (suggested)",id:"http-endpoints-suggested",level:2},{value:"How to enable tracing",id:"how-to-enable-tracing",level:2},{value:"Interpreting results",id:"interpreting-results",level:2},{value:"UI hints",id:"ui-hints",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"debug--tracing--understanding-policy-resolution",children:"Debug & Tracing \u2014 Understanding Policy Resolution"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Canonical reference: ",(0,s.jsx)(n.code,{children:"scoped_policy_design.md"}),". This doc shows how to trace policy loading and evaluation, and the endpoints available."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"what-you-can-trace",children:"What you can trace"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Policy source resolution (which directories contributed which policies)"}),"\n",(0,s.jsx)(n.li,{children:"Load order and inheritance source"}),"\n",(0,s.jsx)(n.li,{children:"Matched rules and reasons"}),"\n",(0,s.jsx)(n.li,{children:"Timing, cache hits, config hash"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"resolution-trace-sequence",children:"Resolution trace (sequence)"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\r\n  participant Client\r\n  participant PDP\r\n  participant Loader as Policy Loader\r\n  participant Trace as Trace Engine\r\n\r\n  Client->>PDP: /applications/{app}/evaluate?trace=true\r\n  PDP->>Loader: Load scoped policies\r\n  Loader--\x3e>PDP: Policies + source metadata\r\n  PDP->>Trace: Assemble PolicyResolutionTrace\r\n  PDP--\x3e>Client: Decision + trace (optional)"}),"\n",(0,s.jsx)(n.h2,{id:"example-trace-schema-simplified",children:"Example trace schema (simplified)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsonc",children:'{\r\n  "request_id": "uuid",\r\n  "application_id": "sharepoint-prod",\r\n  "policies_loaded": [\r\n    {"policy_id": "global-auth", "source_type": "global_fallback", "path": "policies/global/auth.yaml", "load_order": 5},\r\n    {"policy_id": "sp-doc-actions", "source_type": "domain_shared", "path": "policies/domains/sharepoint/shared/document-actions.yaml", "load_order": 4}\r\n  ],\r\n  "matched_rules": [\r\n    {"policy_id": "sp-doc-actions", "rule_id": "view-doc", "reason": "subject.role in [\'employee\']"}\r\n  ],\r\n  "resolution_time_ms": 17.2,\r\n  "cache_hit": false,\r\n  "config_hash": "ab12cd34ef56"\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"http-endpoints-suggested",children:"HTTP endpoints (suggested)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/v1/applications/{app_id}"})," \u2013 application metadata"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/v1/applications/{app_id}/policies"})," \u2013 policy list with source info"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/v1/debug/applications/{app_id}/policy-resolution"})," \u2013 policy source paths by priority"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /api/v1/debug/evaluate/trace"})," \u2013 full evaluation trace for a request"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-enable-tracing",children:"How to enable tracing"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Set environment flags (optional, for verbose logs):","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export TRACE_POLICY_LOADING=true\r\nexport TRACE_POLICY_EVALUATION=true\n"})}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Call evaluation with trace endpoint or UI toggle."}),"\n",(0,s.jsxs)(n.li,{children:["Inspect ",(0,s.jsx)(n.code,{children:"policies_loaded"})," for source/priority and ",(0,s.jsx)(n.code,{children:"matched_rules"})," for reasons."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"interpreting-results",children:"Interpreting results"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["A deny in ",(0,s.jsx)(n.code,{children:"matched_rules"})," explains a final DENY even if permits exist (deny-override)."]}),"\n",(0,s.jsxs)(n.li,{children:["If no rules match, expect ",(0,s.jsx)(n.code,{children:"matched_rules: []"})," and a DENY default."]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"config_hash"})," to correlate with cache invalidation and deployment versions."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"ui-hints",children:"UI hints"}),"\n",(0,s.jsx)(n.mermaid,{value:"flowchart LR\r\n  A[Select application] --\x3e B[Load policies + sources]\r\n  B --\x3e C[Evaluate sample request]\r\n  C --\x3e D[Render matched rules & sources]\r\n  D --\x3e E[Show timing, cache, config hash]"})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);