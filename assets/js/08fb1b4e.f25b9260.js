"use strict";(self.webpackChunkempowernow_docs=self.webpackChunkempowernow_docs||[]).push([[6939],{28453:(e,i,n)=>{n.d(i,{R:()=>c,x:()=>l});var s=n(96540);const o={},r=s.createContext(o);function c(e){const i=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(r.Provider,{value:i},e.children)}},66914:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"services/bff/devops/mcp_proxy_routing","title":"mcp_proxy_routing","description":"BFF MCP proxy routing to CRUDService","source":"@site/docs/services/bff/devops/mcp_proxy_routing.md","sourceDirName":"services/bff/devops","slug":"/services/bff/devops/mcp_proxy_routing","permalink":"/empowernow_docs/docs/services/bff/devops/mcp_proxy_routing","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/services/bff/devops/mcp_proxy_routing.md","tags":[],"version":"current","frontMatter":{}}');var o=n(74848),r=n(28453);const c={},l=void 0,t={},d=[{value:"BFF MCP proxy routing to CRUDService",id:"bff-mcp-proxy-routing-to-crudservice",level:2},{value:"Overview",id:"overview",level:3},{value:"Routes to add (ServiceConfigs)",id:"routes-to-add-serviceconfigs",level:3},{value:"Security model",id:"security-model",level:3},{value:"Environment flags (CRUDService)",id:"environment-flags-crudservice",level:3},{value:"Validation checklist",id:"validation-checklist",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function a(e){const i={code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.h2,{id:"bff-mcp-proxy-routing-to-crudservice",children:"BFF MCP proxy routing to CRUDService"}),"\n",(0,o.jsx)(i.p,{children:"This guide shows how to expose CRUDService Loopback MCP endpoints through the BFF, including route entries, auth, CSRF implications, and environment flags."}),"\n",(0,o.jsx)(i.h3,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(i.mermaid,{value:"flowchart LR\r\n  C[Clients / UIs / Agents] --\x3e BFF[/api/crud/mcp/*]\r\n  BFF --\x3e CRUD[/mcp/*]\r\n  CRUD --\x3e GEN[Loopback MCP Generator]"}),"\n",(0,o.jsx)(i.h3,{id:"routes-to-add-serviceconfigs",children:"Routes to add (ServiceConfigs)"}),"\n",(0,o.jsxs)(i.p,{children:["Add the following proxy routes in ",(0,o.jsx)(i.code,{children:"ServiceConfigs/BFF/config/routes.yaml"}),":"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{children:"GET  /api/crud/mcp/tools/list   ->  CRUD /mcp/tools/list\r\nPOST /api/crud/mcp/jsonrpc      ->  CRUD /mcp/jsonrpc\r\nGET|POST /api/crud/mcp/*        ->  CRUD /mcp/{path}\n"})}),"\n",(0,o.jsx)(i.p,{children:"Virtual servers (views):"}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{children:"GET  /api/crud/mcp/{view}/tools/list -> CRUD /mcp/{view}/tools/list\r\nPOST /api/crud/mcp/{view}/jsonrpc    -> CRUD /mcp/{view}/jsonrpc\n"})}),"\n",(0,o.jsxs)(i.p,{children:["Keep existing ",(0,o.jsx)(i.code,{children:"/api/crud/tools/*"})," (ToolCatalogue) endpoints for merged catalogue access from Visual Designer."]}),"\n",(0,o.jsx)(i.h3,{id:"security-model",children:"Security model"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"BFF enforces session authentication and standard middlewares."}),"\n",(0,o.jsxs)(i.li,{children:["CRUDService enforces scopes:","\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"mcp.tools.discovery"})," for listing"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"mcp.tools.invoke"})," for invoking"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["CRUDService exempts ",(0,o.jsx)(i.code,{children:"/mcp/*"})," from CSRF/origin validation for server\u2011side clients; the BFF path (",(0,o.jsx)(i.code,{children:"/api/crud/mcp/*"}),") should be used from browsers."]}),"\n"]}),"\n",(0,o.jsx)(i.h3,{id:"environment-flags-crudservice",children:"Environment flags (CRUDService)"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"MCP_LOOPBACK_WORKFLOW_DIRECT_INVOKE=true"})," \u2013 start workflows immediately when invoking (dev/test only)"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"OTEL_DISABLED=true"})," \u2013 disable OpenTelemetry locally/tests"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"MCP_MAX_TOOLS"})," \u2013 cap number of published tools"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"MCP_DUPLICATE_POLICY=fail"})," \u2013 fail fast on naming collisions"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"MCP_VIRTUAL_SERVERS_FILE"})," \u2013 override path to ",(0,o.jsx)(i.code,{children:"mcp_virtual_servers.yaml"})]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"MCP_TOOL_NAME_CAP"})," \u2013 cap tool names to satisfy client UI limits"]}),"\n"]}),"\n",(0,o.jsx)(i.h3,{id:"validation-checklist",children:"Validation checklist"}),"\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsx)(i.li,{children:"Deploy BFF with the routes above"}),"\n",(0,o.jsxs)(i.li,{children:["Verify ",(0,o.jsx)(i.code,{children:"GET /api/crud/mcp/tools/list"})," returns tools with a scoped token"]}),"\n",(0,o.jsxs)(i.li,{children:["Verify ",(0,o.jsx)(i.code,{children:"POST /api/crud/mcp/jsonrpc"})," and ",(0,o.jsx)(i.code,{children:"/api/crud/mcp/{view}/jsonrpc"})," handle ",(0,o.jsx)(i.code,{children:"tools/list"})," and ",(0,o.jsx)(i.code,{children:"tools/call"})]}),"\n",(0,o.jsxs)(i.li,{children:["From Visual Designer, confirm ",(0,o.jsx)(i.code,{children:"/api/crud/tools/*"})," works (merged catalogue)"]}),"\n",(0,o.jsxs)(i.li,{children:["Check structured logs for ",(0,o.jsx)(i.code,{children:"mcp_*"})," events and correlation IDs end\u2011to\u2011end"]}),"\n"]}),"\n",(0,o.jsx)(i.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"403 on list/invoke \u2192 missing scope on service token"}),"\n",(0,o.jsx)(i.li,{children:"CSRF errors \u2192 ensure clients hit the BFF path, not CRUDService directly"}),"\n",(0,o.jsx)(i.li,{children:"Empty list \u2192 confirm ServiceConfigs mount and ToolCatalogue refresh"}),"\n"]})]})}function p(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,o.jsx)(i,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);